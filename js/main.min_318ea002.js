function CrossPlayerReg(e){for(var t=[],i=1;i<arguments.length;i++)t[i-1]=arguments[i];CrossPlayer["in"]&&(r=CrossPlayer["in"].hall)[e].apply(r,t);var r}var __reflect=this&&this.__reflect||function(e,t,i){e.__class__=t,i?i.push(t):i=[t],e.__types__=e.__types__?i.concat(e.__types__):i},__extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);i.prototype=t.prototype,e.prototype=new i},__awaiter=this&&this.__awaiter||function(e,t,i,r){return new(i||(i=Promise))(function(n,a){function o(e){try{l(r.next(e))}catch(t){a(t)}}function s(e){try{l(r["throw"](e))}catch(t){a(t)}}function l(e){e.done?n(e.value):new i(function(t){t(e.value)}).then(o,s)}l((r=r.apply(e,t||[])).next())})},__generator=this&&this.__generator||function(e,t){function i(e){return function(t){return r([e,t])}}function r(i){if(n)throw new TypeError("Generator is already executing.");for(;l;)try{if(n=1,a&&(o=a[2&i[0]?"return":i[0]?"throw":"next"])&&!(o=o.call(a,i[1])).done)return o;switch(a=0,o&&(i=[0,o.value]),i[0]){case 0:case 1:o=i;break;case 4:return l.label++,{value:i[1],done:!1};case 5:l.label++,a=i[1],i=[0];continue;case 7:i=l.ops.pop(),l.trys.pop();continue;default:if(o=l.trys,!(o=o.length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){l=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){l.label=i[1];break}if(6===i[0]&&l.label<o[1]){l.label=o[1],o=i;break}if(o&&l.label<o[2]){l.label=o[2],l.ops.push(i);break}o[2]&&l.ops.pop(),l.trys.pop();continue}i=t.call(e,l)}catch(r){i=[6,r],a=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}var n,a,o,s,l={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return s={next:i(0),"throw":i(1),"return":i(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s},Scene=function(e){function t(t,i,r,n){void 0===i&&(i=0),void 0===r&&(r=null),void 0===n&&(n=null);var a=e.call(this,t,i,r,n)||this;a.roomsn=0,a.tag="",a.roomId=0,a.mapId=0,a.seed=0,a.isPlotEnd=!0,a.isControl=!1,a.isPause=!1,a.pauseBossEffect=!0,a.allowBgm=!1;var o=a;return o.stepTotal=0,o.cwx=.5,o.chy=.65,o.actionWidth=0,o.lastcx=o.lastcy=0,o.sprites={},o.spriteList=[],o.agents={},o.agentRids={},o.agentList=[],o.portals={},o.portalList=[],o.npcs={},o.npcList=[],o.callLaters={},o.callLaterList=[],o.callLaterIds={},a}return __extends(t,e),Object.defineProperty(t.prototype,"isLocal",{get:function(){return 0===Fixed.value(this.roomId).div(100).floor().value},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isRemote",{get:function(){return 1===Fixed.value(this.roomId).div(100).floor().value},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isCity",{get:function(){var e=Fixed.value(this.roomId).div(100).floor().value;return 3===e||2===e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isRoom",{get:function(){var e=Fixed.value(this.roomId).div(100).floor().value;return 0===e||1===e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"mapClass",{get:function(){return BaseMap},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"loadPanelId",{get:function(){return 160},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scenePanelId",{get:function(){return null},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"canUpdateCamera",{get:function(){var e=this;return!e.isLockCamera&&e.cdirty&&e.master&&e.isOpen},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isOver",{get:function(){return!1},enumerable:!0,configurable:!0}),t.prototype.onCreate=function(){var e=this;e.roomCfg=Data.getItem("RoomData",e.roomId),e.camera=egret.Rectangle.create(),e.mapId&&e.setMapId(e.mapId),e.isSceneLoaded=!1,e.isLoadShowEnd=!1,e.createGuise(),SceneMgr.addScene(e),e.uploadPlayerStatus()},t.prototype.uploadPlayerStatus=function(){},t.prototype.addSprite=function(e){var t=this,i=e.$eid;return i in t.sprites?!1:(t.sprites[i]=e,t.spriteList.push(e),ArrayUtils.sortOn(t.spriteList,"$eid",16),e instanceof Agent&&(t.agents[i]=e,t.agentRids[e.rid]=e,!e.viewer&&t.agentList.push(e),ArrayUtils.sortOn(t.agentList,"$eid",16),e.hold&&(t.player=e)),e instanceof Npc?(t.npcs[i]=e,t.npcList.push(e)):e instanceof Portal&&(t.portals[i]=e,t.portalList.push(e)),!0)},t.prototype.removeSprite=function(e){var t=this,i=e.$eid;if(!(t.sprites&&i in t.sprites))return!1;delete t.sprites[i];var r=t.spriteList.indexOf(e);return r>=0&&t.spriteList.splice(r,1),e instanceof Agent&&(delete t.agents[i],delete t.agentRids[e.rid],r=t.agentList.indexOf(e),r>=0&&t.agentList.splice(r,1),e.hold&&(t.player=null)),e instanceof Npc?(delete t.npcs[i],r=t.npcList.indexOf(e),r>=0&&t.npcList.splice(r,1)):e instanceof Portal&&(delete t.portals[i],r=t.portalList.indexOf(e),r>=0&&t.portalList.splice(r,1)),!0},t.prototype.startLoad=function(){var e=this,t=GameStatic.isFirstScene?null:e.getLoadUrls();e.loader=e.loader||ObjectPool.pop(LoadMgr);var i=!0;if(!GameStatic.isFirstScene&&t&&t.length){var r=null;i&&(r=PanelMgr.open(e.loadPanelId,{scene:e})),e.loader.init(r),e.loader.loadResByUrlItems(t,3,e.onLoadComplete,e)}else GameStatic.isFirstScene&&(GameStatic.isFirstScene=!1,GameStatic.firstEnterGame()),Login.closeMainLoading=!0,e.loader.init(null),e.onLoadComplete();e.loadShowTime?e.addOnceTimer(e.loadShowTime,e.onLoadShowEnd):e.onLoadShowEnd()},t.prototype.setBgmData=function(e){},t.prototype.onLoadComplete=function(){var e=this;e.isSceneLoaded=!0,e.checkSceneLoaded()},t.prototype.onLoadShowEnd=function(){var e=this;e.isLoadShowEnd=!0,e.checkSceneLoaded()},t.prototype.checkSceneLoaded=function(){},t.prototype.onDelaySceneStarted=function(){var e=this;PanelMgr.close(e.loadPanelId),e.seedr=new Random(e.seed),e.initControl(),e.onSceneStartedBefor(),e.initCamera(),e.onSceneStart(),PanelMgr.open(e.scenePanelId,{scene:e}),e.createClientSprite(),e.onSceneStartedAfter()},t.prototype.createClientSprite=function(){},t.prototype.setMapId=function(e){var t=this;t.mapId=e;var i=Data.getItem("MapData",e);Functor.assert(!!i,"地图模版数据不存在:"+e);var r=t.actionWidth;t.mapCfg=i,t.width=i.w||1,t.height=i.h||1,t.scale=i.scale||1,t.cameraTop=i.ct||0,t.cameraBottom=Fixed.value(t.height).sub(App.battleHeight).value,t.cameraLeft=Fixed.max(r,i.cl||0),t.cameraRight=Fixed.value(t.width).sub(r).sub(App.battleWidth).value,t.roadTop=i.rt,t.roadBottom=i.rb,t.roadLeft=Fixed.value(t.cameraLeft).add(i.rl||0).value,t.roadRight=Fixed.value(t.width).sub(r).sub(i.rr||0).value},t.prototype.initControl=function(){this.setControl(!0)},t.prototype.setControl=function(e){var t=this;t.isControl!=e&&(t.isControl=e,e?t.onOpenControl():t.onCloseControl())},t.prototype.onOpenControl=function(){},t.prototype.onCloseControl=function(){},t.prototype.onSceneStartedBefor=function(){},t.prototype.onSceneStartedAfter=function(){},t.prototype.onSceneStart=function(){var e=this;e.isSceneStart=!0,App.stage.addEventListener(Evt.resize,e.onResizeHandler,e),e.onResizeHandler(),e.guise&&LayerManager.addLayer(0,e.guise),e.playBGM()},t.prototype.resetFrameTime=function(){var e=this;e.lastTime=e.frameRemain=e.waitStep=e.skipFrame=e.delayWaitCount=e.logicTime=0,e.lastTime=egret.getTimer(),e.halfStepTime=0},t.prototype.leaveMap=function(){var e=this;e.isOpen=!1,e.onSceneStop(),e.clearCallLater(),e.removeAllSprite();var t=e.scenePanelId,i=PanelMgr.getUI(t);i&&i.vo&&i.vo.params&&i.vo.params.scene==e&&PanelMgr.close(t),e.onLeaveMap()},t.prototype.onLeaveMap=function(){},t.prototype.onSceneStop=function(){var e=this;e.isSceneStart=!1,e.isStopRender&&e.onStopEnd(),App.stage.removeEventListener(Evt.resize,e.onResizeHandler,e),e.frameId&&(clearTimeout(e.frameId),e.frameId=e.delayWaitCount=0);var t=e.callLaterList;t&&t.length&&(t=t.concat(),t.forEach(function(t){t.stopClear&&e.removeCallLaterIdx(t.idx)})),e.guise&&(e.guise.destroy(),e.guise=null)},t.prototype.initCamera=function(e){var t=this,i=t.mapCfg;if(i){var r=t.master,n=t.camera,a=App.battleWidth,o=App.battleHeight;t.lastcx=Math.max(0,(i.cx||0)-a*t.cwx),e||(t.lastcy=Math.max(0,(i.cy||0)-o*t.chy)),!t.isLockCamera&&r&&(t.lastcx=NumberUtils.limit(Math.floor(r.x-a*(t.cwx-0*r.multiply)),0,t.width-a),e||(t.lastcy=NumberUtils.limit(Math.floor(r.y-o*t.chy),0,t.height-o))),t.lastcx=NumberUtils.limit(t.lastcx,t.cameraLeft,t.cameraRight),e||(t.lastcy=NumberUtils.limit(t.lastcy,t.cameraTop,t.cameraBottom)),n.setTo(t.lastcx,t.lastcy,a,o),t.guise&&(t.guise.refreshFrame=0),t.cdirty=!0,t.mdirty=!0}},t.prototype.updateCamera=function(){var e=this,t=e.master,i=e.camera,r=i.width,n=i.height,a=.1*r,o=0,s=e.lastcx,l=e.lastcy,u=t.x,c=t.y,p=e.cwx,d=e.chy,f=s+r*p-u,h=l+n*d-c,v=!0,m=!0,y=13,g=5;f>a?s=Math.round(!y||y>=f-a?u+a-r*p:s-y):-a>f?s=Math.round(!y||y>=-f-a?u-a-r*p:s+y):v=!1,h>o?l=Math.round(!g||g>=h-o?c+o-n*d:l-g):-o>h?l=Math.round(!g||g>=-h-o?c-o-n*d:l+g):m=!1,s=e.lastcx=NumberUtils.limit(s,e.cameraLeft,e.cameraRight),l=e.lastcy=NumberUtils.limit(l,e.cameraTop,e.cameraBottom),v&&(f>a?v=s!=e.cameraLeft:-a>f&&(v=s!=e.cameraRight)),m&&(h>o?m=l!=e.cameraTop:-o>h&&(m=l!=e.cameraBottom)),i.setTo(s,l,r,n),v||m||!e.cdirty||(e.cdirty=!1)},t.prototype.onUpdateStep=function(){var e,t=this;if(!t.isLockStep){var i=egret.getTimer();e=i-t.lastTime,t.lastTime=i}return DebugStatic.isOpenFrameOper||t.pauseFrame||t.onEnterFrame(!1,e),!0},t.prototype.onEnterFrame=function(e,t,i){void 0===i&&(i=0);var r=this,n=r.isStopRender;if(r.frameId&&(clearTimeout(r.frameId),r.frameId=0),!t&&!r.isLockStep){var a=egret.getTimer();t=a-r.lastTime,r.lastTime=a}r.addFrameRecord(t),n||(r.halfStepTime+=t,r.stepTotal=i?i:r.stepTotal+1);var o,s=r.spriteList;if(!n){if(r.isSlowRate){if(r.slowStopFrame>0)return void r.slowStopFrame--;if(r.stepTotal%r.slowFrame!=0)return;e=!1}var l=r.callLaterList;l&&l.length&&(l=l.concat(),l.forEach(function(e){e.delayFrame=e.delayFrame-(e.isTime?t:1),e.delayFrame<=0&&r.trigCallLater(e)})),o=r.stepTotal%30==0,s.forEach(function(e){o&&e.onHalfSecond(r.halfStepTime),e.onEnterFrame(t)})}r.doEnterFrame();var u=r.guise;e&&5!=r.skipFrame?r.skipFrame++:(r.skipFrame=0,n||s.forEach(function(e){e.afterEnterFrame()}),o&&u&&u.onHalfSecond(r.halfStepTime),r.mdirty&&(r.mdirty=!1,u&&u.onEnterFrame(t)),u&&u.onUpdateVisible()),o&&r.doHalfFrame(),!n&&u&&u.updateRectShape(),!n&&o&&(r.halfStepTime=0),n&&(r.stopFrame--,r.stopFrame<=0&&r.onStopEnd()),r.onTickTime(t);var c=r.waitStep;if(c>0){var p=r.delayWaitCount;p>0&&(r.delayWaitCount=p-=1),0==p&&c>15?(r.delayWaitCount=15,r.waitStep=c-=1,r.frameId=r.addOnceTimer(.005,r.onEnterFrame,0!=c,17)):(r.waitStep=c-=1,r.onEnterFrame(0!=c,17))}},t.prototype.doEnterFrame=function(){this.canUpdateCamera&&(this.mdirty=!0,this.updateCamera())},t.prototype.doHalfFrame=function(){},t.prototype.onTickTime=function(e){},t.prototype.onLockStepFrame=function(){},t.prototype.onResizeHandler=function(){GameLog.log("触发舞台尺寸改变"),App.resizeBattleSize();var e=this,t=e.camera;t&&(t.width=App.battleWidth,t.height=App.battleHeight,e.cameraRight=Fixed.value(e.width).sub(e.actionWidth).sub(t.width).value,e.cameraBottom=Fixed.value(e.height).sub(t.height).value,e.cdirty=!0),e.guise&&e.guise.updateSize()},t.prototype.playBGM=function(){this.allowBgm=!0,SoundUtils.playingUIBgm||SoundUtils.playBGM(this.bgm,this.$eid)},t.prototype.stopBGM=function(){this.allowBgm=!1,SoundUtils.playingUIBgm||SoundUtils.playBGM("0",this.$eid)},t.prototype.addGuise=function(e){this.guise&&this.guise.addGuise(e)},t.prototype.addFrameRecord=function(e){},t.prototype.removeAllSprite=function(){this.spriteList.concat().forEach(function(e){!e.$isRemoved&&e.receiveLeaveScene()})},t.prototype.addCallLater=function(e,t,i,r,n){for(var a=[],o=5;o<arguments.length;o++)a[o-5]=arguments[o];var s=DelayCallbackInfo.create.apply(DelayCallbackInfo,[e,t,i,r,n].concat(a));this.callLaterList.push(s);var l=this.callLaters,u=l[t.hashCode];return u||(u=l[t.hashCode]=[]),u.push(s),this.callLaterIds[s.idx]=s,s.idx},t.prototype.removeCallLater=function(e){var t=this.callLaters;if(t){var i=t[e.hashCode];if(i){var r=this.callLaterIds,n=this.callLaterList;i.forEach(function(e){var t=n.indexOf(e);t>=0&&n.splice(t,1),delete r[e.idx],e.dispose()}),delete t[e.hashCode]}}},t.prototype.removeCallLaterIdx=function(e){var t=this.callLaterIds;if(t){var i=t[e];if(i){delete t[i.idx];var r=this.callLaterList;if(r){var n=r.indexOf(i);n>=0&&r.splice(n,1)}var a=this.callLaters,o=a[i.thisObject.hashCode];if(o){var n=o.indexOf(i);n>=0&&o.splice(n,1),o.length||delete a[i.thisObject.hashCode]}i.dispose()}}},t.prototype.trigCallLater=function(e){if(e.isvalid){var t=this.callLaterList,i=t.indexOf(e);i>=0&&t.splice(i,1),delete this.callLaterIds[e.idx];var r=this.callLaters,n=r[e.thisObject.hashCode];n&&(i=n.indexOf(e),i>=0&&n.splice(i,1)),n.length||delete r[e.thisObject.hashCode],e.callL(),e.dispose()}},t.prototype.clearCallLater=function(){var e=this,t=e.callLaterList;t.forEach(function(e){e.dispose()}),e.callLaterList.length=0,e.callLaters={},e.callLaterIds={}},t.prototype.stopRender=function(e,t,i,r){void 0===i&&(i=null),void 0===r&&(r=null);var n=this;n.isStopRender=!0,n.stopFrame=e,n.spriteList.forEach(function(e){e.onStopRender()})},t.prototype.onStopEnd=function(){var e=this;e.isStopRender=!1,e.stopFrame=0,e.spriteList.forEach(function(e){e.onStopEnd()}),GameStatic.battleWait.next()},t.prototype.slowRender=function(e){void 0===e&&(e=1.2);var t=this;t.isSlowRate&&t.onSlowEnd(),t.isSlowRate=!0,t.slowStopFrame=12,t.slowFrame=3,t.slowTimeId=t.addOnceTimer(e,t.onSlowEnd)},t.prototype.onSlowEnd=function(){var e=this;e.isSlowRate&&(e.isSlowRate=!1,e.slowTimeId&&e.delTimer(e.slowTimeId),GameStatic.battleWait.next())},t.prototype.changePauseFrame=function(e){var t=this;t.roomCfg.isLockStep||t.pauseFrame==e||(t.pauseFrame=e,App.dispatch("c105",{pauseTime:t.pauseTime,pauseFrame:t.pauseFrame}))},t.prototype.changePauseTime=function(e){var t=this;t.pauseTime!=e&&(t.pauseTime=e,App.dispatch("c105",{pauseTime:t.pauseTime,pauseFrame:t.pauseFrame}))},t.prototype.createGuise=function(){var e=this;e.guise=ObjectPool.pop(e.mapClass),e.guise.initialize(e)},t.prototype.setCameraFollow=function(e){var t=this,i=t.getCameraFollow();i&&i!=t.master&&(t.cdirty=!0,t.master=i,t.initCamera(e))},t.prototype.getCameraFollow=function(){return null},t.prototype.getLoadUrls=function(){return[]},t.prototype.getAgent=function(e){return this.agentRids[e]},t.prototype.getLayerSpeedx=function(e){if(0==e||1==e||2==e){if(this.mapCfg){var t=this.mapCfg.layer||[],i=t[e];return i.speed||0}return 0}return 4==e||10==e||3==e||9==e?0:1},t.prototype.getLayerSpeedy=function(e){return 4==e||10==e||3==e||9==e?0:1},t.prototype.getLayerItems=function(e){var t=this.mapCfg.layer||[],i=t[e]||{};return i.item||[]},t.prototype.checkHitPortal=function(e){for(var t=0,i=this.portalList;t<i.length;t++){var r=i[t];if(r.rect.hitTestPoint(e.x,e.y))return!0}return!1},t.prototype.findFirstPortal=function(){return this.portalList[0]},t.prototype.limitX=function(e){return NumberUtils.limit(e,this.roadLeft,this.roadRight)},t.prototype.limitY=function(e){return NumberUtils.limit(e,this.roadTop,this.roadBottom)},t.prototype.onDestroy=function(){var e=this;TimerManager.removeTask(e.hashCode),App.stage.removeEventListener(Evt.resize,e.onResizeHandler,e),e.clearCallLater(),e.onSlowEnd(),e.isOpen&&e.leaveMap(),e.loader&&e.loader.destroy(),SceneMgr.removeScene(e),e.loader=null,e.sprites=null,e.spriteList=null,e.agents=null,e.agentRids=null,e.agentList=null,e.portals=null,e.portalList=null,e.npcs=null,e.npcList=null,e.roomCfg=null,e.mapCfg=null,e.player=null,e.seedr=null,e.guise=null,egret.Rectangle.release(e.camera),e.camera=null,e.master=null,e.master_monster=null,e.master_bullet=null,e.master_kill=null,e.frameId=0,e.delayWaitCount=0},t}(GameEntity);__reflect(Scene.prototype,"Scene"),window.Scene=Scene;var Sprite=function(e){function t(t,i,r,n){void 0===i&&(i=0),void 0===r&&(r=null),void 0===n&&(n=null);var a=e.call(this,t,i,r,n)||this;return a._visible_guise=!1,a._visible_view=!0,a._visible_ui=!1,a._visible_top=!1,a._visible_shadow=!1,a._visible_halo=!1,a.x=0,a.y=0,a.z=0,a.ox=0,a.oy=0,a.oz=0,a.specialSpd=0,a.speedx=0,a.speedy=0,a.right=!1,a.speedx_lerp=!1,a.speedx_s=0,a.speedx_t=0,a.speedy_lerp=!1,a.speedy_s=0,a.speedy_t=0,a.speed_amt=0,a.bornx=0,a.borny=0,a.unselect=!1,a}return __extends(t,e),Object.defineProperty(t.prototype,"isPlayerSide",{get:function(){var e=this.scene;return e&&e.player&&e.player.side==this.side},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"resId",{get:function(){return null},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"guiseClass",{get:function(){return BaseGuise},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"direction",{get:function(){return this.right?3:7},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"multiply",{get:function(){return this.right?1:-1},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isAir",{get:function(){return this.z>0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"spd",{get:function(){return this.specialSpd||0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hpRateFloor",{get:function(){return 0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isCanBeHit",{get:function(){return this.canbeHit},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"visible_guise",{get:function(){return this._visible_guise},set:function(e){var t=this;t._visible_guise!=e&&(t._visible_guise=e,t.guise&&t.guise.updateGuiseVisible())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"visible_view",{get:function(){return this._visible_view},set:function(e){var t=this;t._visible_view!=e&&(t._visible_view=e,t.guise&&t.guise.updateGuiseVisible())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"visible_ui",{get:function(){return this._visible_ui},set:function(e){var t=this;t._visible_ui!=e&&(t._visible_ui=e,t.guise&&t.guise.updateUIVisible())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"visible_top",{get:function(){return this._visible_top},set:function(e){var t=this;t._visible_top!=e&&(t._visible_top=e,t.guise&&t.guise.updateUIVisible())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"visible_shadow",{get:function(){return this._visible_shadow},set:function(e){var t=this;t._visible_shadow!=e&&(t._visible_shadow=e,t.guise&&t.guise.updateShadowVisible())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"visible_halo",{get:function(){return this._visible_halo},set:function(e){var t=this;t._visible_halo!=e&&(t._visible_halo=e,t.guise&&t.guise.updateHaloVisible())},enumerable:!0,configurable:!0}),t.prototype.onCreate=function(){var e=this;e.ox=e.x,e.oy=e.y,e.oz=e.z,e.hold=Player["in"]&&Player["in"].rid==e.prid},t.prototype.enterScene=function(e,t,i,r){var n=this,a=n.scene;a&&a.$eid==e||(n.canbeHit=!1,n.sceneeid=e,a=n.scene=SceneMgr.getScene(e),n.roomsn=a.roomsn,n.prid&&(n.agent=a.getAgent(n.prid),n.agentInfo=a instanceof Room?a.getAgentInfo(n.prid):null),n.updatePos(t,i,n.z,r),n.onEnterScene(),a.addSprite(n),n.createGuise(),n.updateRect(),n.visible_guise=!0,n.visible_ui=!0,n.visible_top=!0,n.visible_shadow=!0,n.visible_halo=!0,n.canbeHit=!0,n.onEnteredScene(),n.bornx=n.x,n.borny=n.y,!n.playEnterEffect()&&n.onEnterEffectEnd())},t.prototype.onEnterScene=function(){},t.prototype.onEnteredScene=function(){},t.prototype.playEnterEffect=function(){return!1},t.prototype.onEnterEffectEnd=function(){},t.prototype.leaveScene=function(){this.receiveLeaveScene()},t.prototype.receiveLeaveScene=function(){var e=this,t=e.scene;t&&(e.onLeaveScene(),e.destroyGuise(!0),t.removeSprite(e),e.onLeftScene(),e.agent=null,e.agentInfo=null,e.scene=null,e.isClient&&ServiceMgr.removeEntity(e.$channel,e.$eid))},t.prototype.onLeaveScene=function(){},t.prototype.onLeftScene=function(){},t.prototype.createGuise=function(){var e=this;if(e.destroyGuise(),e.resId){var t=e.guise=ObjectPool.pop(e.guiseClass);t.initOwner(e),e.addGuiseL(),t.create()}e.guise&&e.scene.addGuise(e.guise)},t.prototype.onSynPos=function(e,t,i,r){var n=this;RecordMgr.record(29,n.roomsn,n.$eid,e,t,i,r),n.updatePos(e,t,i,r)},t.prototype.updatePos=function(e,t,i,r){var n=this,a=n.scene;isNaN(e)&&(e=n.x),isNaN(t)&&(t=n.y),isNaN(i)&&(i=n.z),n.ox=e,n.oy=t,n.oz=i,e=Math.round(e),t=Math.round(t),i=Math.round(i),!a||a.master!=n&&a.master_monster!=n||a.cdirty||n.x==e&&n.y==t||(n.scene.cdirty=!0),n.x!=e&&(n.x=e),n.y!=t&&(n.y=t),n.z!=i&&(n.z=i),n.right!=r&&n.changeDirection(r),n.updateRect()},t.prototype.onLocation=function(e,t,i,r){var n=this;n.ox=n.x=e,n.oy=n.y=t,n.oz=n.z=i,n.right!=r&&n.changeDirection(r)},t.prototype.changeDirection=function(e){this.right!=e&&(this.right=e)},t.prototype.updateRect=function(){},t.prototype.updateSpecialSpd=function(e){this.specialSpd=e},t.prototype.updateSpdByDir=function(e,t){void 0===t&&(t=0);var i=this.spd;i=Fixed.value(1).add(t).mul(i).value;var r;r=1==e?0:5==e?Fixed.PI_2:9==e?Fixed.PI:13==e?Fixed.value(Fixed.PI_2).neg().value:Fixed.value(e).sub(1).mul(22.5).div(180).mul(Fixed.PI).value,this.calSpdByRadian1(i,r)},t.prototype.calSpdByRadian1=function(e,t){var i=1,r=.6,n=0,a=0,o=Fixed.PI,s=Fixed.value(o).neg().value,l=Fixed.PI_2,u=Fixed.value(l).neg().value,c=!1,p=!1;if(t>=o){var d=Fixed.value(o).mul(2).value;t=Fixed.value(t).sub(d).value}if(t>=0&&l>t||t>u&&0>=t){var d=Fixed.value(t).tan().pow(2).value;d=Fixed.value(i).pow(2).mul(d).value,d=Fixed.value(r).pow(2).add(d).sqrt().value,n=Fixed.value(i).mul(r).div(d).value,a=Fixed.value(t).tan().mul(n).value,c=!0,p=!0}else if(t>l&&o>t||t>=s&&u>t){var d=Fixed.value(t).tan().pow(2).value;d=Fixed.value(i).pow(2).mul(d).value,d=Fixed.value(r).pow(2).add(d).sqrt().value,n=Fixed.value(i).mul(r).div(d).neg().value,a=Fixed.value(t).tan().mul(n).value,c=!0,p=!0}else t==l?(n=0,a=r,c=!0,p=!0):t==u?(n=0,a=Fixed.value(r).neg().value,c=!0,p=!0):o>t&&(n=Fixed.value(i).neg().value,a=0,c=!0,p=!0);var f=this;f.speedx_lerp=c,f.speedy_lerp=p,f.speed_amt=0,c?(f.speedx_s=f.speedx,f.speedx_t=Fixed.value(n).mul(e).value):f.speedx=Fixed.value(n).mul(e).value,p?(f.speedy_s=f.speedy,f.speedy_t=Fixed.value(a).mul(e).value):f.speedy=Fixed.value(a).mul(e).value},t.prototype.clearSpeedLerp=function(){var e=this;e.speedx_lerp&&(e.speedx_lerp=!1,e.speedx_s=0,e.speedx_t=0,e.speed_amt=0),e.speedy_lerp&&(e.speedy_lerp=!1,e.speedy_s=0,e.speedy_t=0,e.speed_amt=0)},t.prototype.updateSpdByPos=function(e,t,i,r,n){void 0===n&&(n=0);var a=this.spd;a=Fixed.value(1).add(n).mul(a).value;var o=Fixed.atan2_pos(e,t,i,r);this.calSpdByRadian2(a,o)},t.prototype.calSpdByRadian2=function(e,t){var i=1,r=.6,n=0,a=0,o=Fixed.PI,s=Fixed.value(o).neg().value,l=Fixed.PI_2,u=Fixed.value(l).neg().value;if(t>=o){var c=Fixed.value(o).mul(2).value;t=Fixed.value(t).sub(c).value}if(t>=0&&l>t||t>u&&0>=t){var c=Fixed.value(t).tan().pow(2).value;c=Fixed.value(i).pow(2).mul(c).value,c=Fixed.value(r).pow(2).add(c).sqrt().value,n=Fixed.value(i).mul(r).div(c).value,a=Fixed.value(t).tan().mul(n).value}else if(t>l&&o>t||t>=s&&u>t){var c=Fixed.value(t).tan().pow(2).value;c=Fixed.value(i).pow(2).mul(c).value,c=Fixed.value(r).pow(2).add(c).sqrt().value,n=Fixed.value(i).mul(r).div(c).neg().value,a=Fixed.value(t).tan().mul(n).value}else t==l?(n=0,a=r):t==u?(n=0,a=Fixed.value(r).neg().value):o>t&&(n=Fixed.value(i).neg().value,a=0);var p=this;p.clearSpeedLerp(),p.speedx=Fixed.value(n).mul(e).value,p.speedy=Fixed.value(a).mul(e).value},t.prototype.onHalfSecond=function(e){},t.prototype.onEnterFrame=function(e){var t=this,i=t.speedx_lerp,r=t.speedy_lerp;if(i||r){var n=t.speed_amt,a=3;if(a>n)if(n=t.speed_amt=n+1,n==a)i&&(t.speedx=t.speedx_t),r&&(t.speedy=t.speedy_t),t.clearSpeedLerp();else{var o=Fixed.value(n).div(a).value,s=Fixed.value(1).sub(o).value,l=Fixed.value(s).mul(s).mul(s).value;o=Fixed.value(1).sub(l).value;var u=Fixed.value(1).sub(o).value;if(i){var c=Fixed.value(t.speedx_s).mul(u).value;t.speedx=Fixed.value(t.speedx_t).mul(o).add(c).value}if(r){var p=Fixed.value(t.speedy_s).mul(u).value;t.speedy=Fixed.value(t.speedy_t).mul(o).add(p).value}}}},t.prototype.afterEnterFrame=function(){this.guise&&this.guise.afterEnterFrame()},t.prototype.onStartPvPWait=function(){},t.prototype.onStartPvPRound=function(){},t.prototype.onStopPvERound=function(){},t.prototype.onStopPvPRound=function(e){},t.prototype.onNextRound=function(){var e=this,t=e.guise;e.visible_guise=!0,t&&(e.scene.addGuise(t),t.onNextRound())},t.prototype.onStopRender=function(){this.guise&&this.guise.playBlackEffect(),this.visible_ui=!1},t.prototype.onStopEnd=function(){this.guise&&this.guise.stopBlackEffect(),this.visible_ui=!0},t.prototype.resetDamage=function(){},t.prototype.resetBehurt=function(){},t.prototype.addGuiseL=function(){},t.prototype.removeGuiseL=function(){},t.prototype.getGlobalPos=function(e){void 0===e&&(e=null);var t=this,i=t.guise;return e=e||egret.Point.create(0,0),i&&i.parent?i.parent.localToGlobal(t.x,t.y,e):e},t.prototype.addPropItem=function(e,t,i,r,n){if(e.name&&e.val){r="maxHpBase"==e.name?n:r;var a=t[e.name];a?a.val=Fixed.value(e.val).mul(r).add(a.val).value:(a={name:e.name,val:Fixed.value(e.val).mul(r).value},t[e.name]=a,i.push(a))}},t.prototype.onAttPropChange=function(e,t){},t.prototype.destroyGuise=function(e){void 0===e&&(e=!1);var t=this;t.canbeHit=!1,egret.Tween.removeTweens(t),t.guise&&(t.removeGuiseL(),t.guise.destroy(),t.guise=null)},t.prototype.onDestroy=function(){var e=this;e.scene&&e.receiveLeaveScene(),e.rect&&e.rect.destroy(),e.rect=null,e.scene=null,e.props=null,e.sceneeid=0},t}(GameEntity);__reflect(Sprite.prototype,"Sprite"),window.Sprite=Sprite;var BaseGuise=function(e){function t(){return e.call(this)||this}return __extends(t,e),Object.defineProperty(t.prototype,"enabled",{get:function(){return this._enabled},set:function(e){var t=this;t._enabled!=e&&(t._enabled=e,t.touchChildren=e,t.touchEnabled=e)},enumerable:!0,configurable:!0}),t.prototype.initOwner=function(e){var t=this;t.clear(),t.isvalid=!0,t.owner=e,t._initialized||(t._initialized=!0,t.preInitialize()),t.initialize(),t.childrenCreated()},t.prototype.preInitialize=function(){},t.prototype.initialize=function(){},t.prototype.childrenCreated=function(){},t.prototype.create=function(){},t.prototype.onGuiseReady=function(){this.updateUIPos()},t.prototype.updateGuiseVisible=function(){this.visible=this.owner.visible_guise&&this.owner.visible_view},t.prototype.updateUIVisible=function(){},t.prototype.updateTopVisible=function(){},t.prototype.updateShadowVisible=function(){},t.prototype.updateHaloVisible=function(){},t.prototype.afterEnterFrame=function(){var e=this.owner;e&&this.updatePos(e.x,e.y,e.z)},t.prototype.updateDirection=function(e){},t.prototype.updatePos=function(e,t,i){var r=this;e!=r.$x&&(r.x=e),t!=r.$y&&(r.y=r.layouty=t)},t.prototype.updateUIPos=function(){return null},t.prototype.playBlackEffect=function(){},t.prototype.stopBlackEffect=function(){},t.prototype.onNextRound=function(){},t.prototype.getRefPoint=function(e){return egret.Point.create(0,0)},t.prototype.getGuiseRect=function(){return this.getBounds()},t.prototype.clear=function(){var e=this;e.enabled=!0,e.owner=null,e.x=0,e.y=0,e.alpha=1,e.visible=!0,e.filters=null},t.prototype.destroy=function(){var e=this;e.isvalid&&(e.isvalid=!1,e.onDestroy(),e.clear(),e.parent&&e.parent.removeChild(e),ObjectPool.push(e))},t.prototype.onDestroy=function(){},t}(DSprite);__reflect(BaseGuise.prototype,"BaseGuise"),window.BaseGuise=BaseGuise;var Role=function(e){function t(t,i,r,n){void 0===i&&(i=0),void 0===r&&(r=null),void 0===n&&(n=null);var a=e.call(this,t,i,r,n)||this;return a._visible_undead=!0,a.level=1,a.rotation=0,a.invisibleTime=0,a.floatTime=0,a}return __extends(t,e),Object.defineProperty(t.prototype,"aiClass",{get:function(){return BaseAI},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"guiseClass",{get:function(){return GRole},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"skillClass",{get:function(){return Skill},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"curHeroCfg",{get:function(){return this.heroCfg},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"curHeroResCfg",{get:function(){return this.heroResCfg},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"element",{get:function(){var e=this.buff.element;return e?e:this.heroCfg.element||0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"resId",{get:function(){return this.heroResCfg.res},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"heroUrl",{get:function(){return Urls.hero()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"titleUrl",{get:function(){return null},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"upperHaloAction",{get:function(){return null},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"lowerHaloAction",{get:function(){return null},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"weaponUrl",{get:function(){return this.heroResCfg.weapon},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"weaponEffectUrl",{get:function(){return null},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"wingUrl",{get:function(){return null},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"spd",{get:function(){var e=this,t=e.props,i=e.specialSpd;if(i){var r=e.skill.curSkillCfg,n=r&&r.isSpdEff?0:t.gv("spdInc");return Fixed.value(n).add(1).mul(i).div(50).value}return t.gv("spd")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"beControl",{get:function(){var e=this.state;return e.hasState(103)||e.hasState(113)||e.hasState(1)||e.hasState(2)||e.hasState(4)||e.hasState(5)||e.hasState(6)||e.hasState(17)||e.hasState(33)||e.hasState(38)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isCanBeHit",{get:function(){return this.canbeHit&&!this.state.hasState(118)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hpRateFloor",{get:function(){var e=this,t=e.props,i=t.gv("hp"),r=t.gv("maxHp");return Fixed.value(i).mul(100).div(r).floor().value},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"visible_name",{get:function(){return this._visible_name},set:function(e){var t=this;t._visible_name!=e&&(t._visible_name=e,t.guise&&t.guise.updateNameVisible())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"visible_title",{get:function(){return this._visible_title},set:function(e){var t=this;t._visible_title!=e&&(t._visible_title=e,t.guise&&t.guise.updateTitle())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"visible_effect",{get:function(){return this._visible_effect},set:function(e){var t=this;t._visible_effect!=e&&(t._visible_effect=e,t.guise&&t.guise.updateEffectsVisible())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"visible_undead",{get:function(){return this._visible_undead},set:function(e){var t=this;t._visible_undead!=e&&(t._visible_undead=e,t.guise&&t.guise.updateTopVisible())},enumerable:!0,configurable:!0}),t.prototype.onCreate=function(){e.prototype.onCreate.call(this);var t=this;t.visible_name=SceneMgr.battleName,t.visible_title=SceneMgr.battleTitle;var i=t.heroCfg=Data.getItem("HeroData",t.heroId);t.heroResCfg=Data.getItem("HeroResData",i.guise),t.actionCfg=Data.getOppItem("RoleAction",t.heroResCfg.res);var r=i.ba;r&&(t.sbaval=t.sbaval||r.val||0,t.sbatime=t.sbatime||r.time||0,t.sbabuff=r.buff||0)},t.prototype.createCom=function(){var e=this,t=ServiceMgr.createGameCom;e.props=t(Props,e,!0),e.state=t(State,e,!0),e.warn=t(Warn,e,!0),e.skill=t(e.skillClass,e,!0),e.buff=t(Buff,e,!0),e.ai=t(e.aiClass,e,!0),e.props.notice=!0,e.props.isBattle=!0},t.prototype.onEnterScene=function(){var e,t=this,i=t.scene,r=i?i.player:null;e=t instanceof Pet?t.hold&&i?i.ownerPetEffect:r&&t.side==r.side?i.teamPetEffect:r&&t.side!=r.side?i.enemyPetEffect:!0:t.hold||r&&r.side!=t.side||!t.prid?!0:t.scene.battleEffect,t.visible_effect=e,this.ai&&this.ai.onEnterScene()
},t.prototype.onEnteredScene=function(){var e=this,t=e.heroCfg;e.visible_ui=!t.hideUI,e.visible_shadow=!t.hideShadow,e.visible_halo=!t.hideHalo,e.scene.onAddHaloBuff(e),e.buff.trigPassiveBuff(1),e.onResetBalance(!0),e.state.normal(112,!1),e.ai.showTrigTimeBar(),e.ai.trig(25),e.heroCfg.enterSound&&SoundUtils.playSoundById(e.heroCfg.enterSound,e.hashCode)},t.prototype.onLeftScene=function(){},t.prototype.playEnterEffect=function(){var e=this;return e.skill.enterSkillId?(e.skill.onBeginSkill(e.skill.enterSkillId,!1,!1),!0):!1},t.prototype.onEnterEffectEnd=function(){this.ai.trig(26)},t.prototype.onLeaveScene=function(){var e=this;e.canbeHit=!1,e.buff.trigPassiveBuff(4),e.ai.clearAll(),e.skill.clearAll(),e.buff.clearAll(),e.state.clearAll(),e.dispatch("onLeaveScene",{target:this})},t.prototype.onHalfSecond=function(e){this.ai.onHalfSecond(e)},t.prototype.onEnterFrame=function(t){e.prototype.onEnterFrame.call(this,t);var i=this;i.invisibleTime&&(i.invisibleTime=Fixed.value(i.invisibleTime).sub(t).value,i.invisibleTime<=0&&i.stopInvisible()),i.baTime&&(i.baTime=Fixed.value(i.baTime).sub(t).value,i.baTime<=0&&i.onResetBalance(!1)),i.hithealt&&(i.hithealt=Fixed.value(i.hithealt).sub(t).value,i.hithealt<=0&&i.stopHitTransHeal()),i.signEffTime&&(i.signEffTime=Fixed.value(i.signEffTime).sub(t).value,i.signEffTime<=0&&i.signEffId&&i.stopSignTarget(i.signEffId)),i.signType&&(i.signStatuTime&&(i.signStatuTime=Fixed.value(i.signStatuTime).sub(t).value,i.signStatuTime<=0&&i.setSignTypeStatu(0,0)),i.signTypeTime&&(i.signTypeTime=Fixed.value(i.signTypeTime).sub(t).value,i.signTypeTime<=0&&i.signType&&i.stopSignType(i.signType))),i.guise&&this.guise.onEnterFrame(t),i.warn.onEnterFrame(t),i.scene.pauseTime||(i.skill.onEnterFrame(t),i.buff.onEnterFrame(t)),i.ai.onEnterFrame(t),i.state.onEnterFrame(t)},t.prototype.onNextRound=function(){var t=this;t.state.hasState(110)&&t.state.interrupt(5),t.ai.onNextRound(),t.state.normal(112,!0),e.prototype.onNextRound.call(this)},t.prototype.onBattleOver=function(){},t.prototype.updateLevel=function(){var e=this;e.agent&&(e.level=e.agent.level),e.props.setPropSlot("level","BASE",e.level)},t.prototype.standLand=function(){this.z=this.oz=0,this.updateRect()},t.prototype.updateHeroInfo=function(e,t,i){var r=this,n=DebugStatic.heroBuffs;if(n){var a=n[r.heroId];a&&a.forEach(function(e){i.push({buffId:e.buffId,lv:e.buffLv})})}for(var o=[],s=0,l=e;s<l.length;s++){var u=l[s],c=u.val||0,p=Fixed.value(c).mul(23e4).round().value,d=5792,f=1;p>1073741824?(c=Functor.yihuo(p,d),f=2):(c=p^d,f=1),o.push({name:u.name,val:c,type:f})}r.svrProps=o,r.svrSkills=t,r.svrBuffs=i,r.props.initProps(e),r.buff.initBuffs(i),r.updateLevel(),r.skill.initSkills(t)},t.prototype.updateRect=function(){var e=this;e.rect||(e.rect=ObjectPool.pop(Rect,"IntersectRect"));var t=e.curHeroCfg,i=e.curHeroResCfg,r=t.w||i.w||1,n=t.h||i.h||1,a=Fixed.value(n).mul(.5).floor().value;a=Fixed.value(e.y).sub(e.z).sub(a).value,e.rect.reset(e.x,a,r,n,0)},t.prototype.onFree=function(e,t){var i=this;if(i.isAir)return void i.state.flyDown(t);if(i.isDead)return void i.dead(!1,!1,!0);(103==e||113==e)&&i.ai.trig(23);var r=i.skill;i.isPress&&!r.nextSkillId&&(r.nextSkillId=r.nskillId),r.nextSkillId&&r.playComboSkill()||i.state.limit(112)||(i.state.normal(112,!1),i.ai.onStateFree(e))},t.prototype.onBuffEffect=function(e,t,i,r,n,a){var o,s,l=this,u=l.props,c=e.caster,p=e.target,d=!1,f=l.isDead,h=i;e.helpRid;if(!f&&2097152&t&&u.gv("hp")+i>0&&(i=-u.gv("hp")),0!=i){if(o=u.gv("hp"),4&t&&l.buff.dealTrigBuff(3,e.buffId,e.target,e.caster),0>i&&l.isInfiniteHp)s=Math.max(0,u.gv("hp")+i);else{if(!f&&Math.max(0,u.gv("hp")+i)<=0){var v=l.buff.dealTrigBuff(15,e.buffId,e.target,e.caster);1==v&&u.gv("hp")+i<=0&&(i=1-u.gv("hp"))}if(!f&&Math.max(0,u.gv("hp")+i)<=0&&l.ai.trig(4),l.state.hasState(118)?u.setPropSlot("hp","BASE",Math.max(1,Math.max(0,u.gv("hp")+i))):u.setPropSlot("hp","BASE",Math.max(0,u.gv("hp")+i)),s=u.gv("hp"),l.buff.dealTrigBuff(5,e.buffId,e.target,e.caster,!1,l.hpRateFloor),l.buff.dealTrigBuff(27,e.buffId,e.target,e.caster,!1,l.hpRateFloor),0>i){var m=u.gv("maxHp"),y=Fixed.value(i).abs().div(m).mul(100).floor().value;l.buff.dealTrigBuff(21,e.buffId,e.target,e.caster,!1,y)}}f||(l.isDead=u.gv("hp")<=0,l.isDead&&(l.scene.onRoleDead(l,c,!0,!0),l.scene.addCallLater(l.dead,l,1,!1,!1,!0,!1,!0),c.agentInfo&&(c.agentInfo.lastDamage=r-i)),d=l.isDead)}else o=s=u.gv("hp");if(i&&r||l.guise&&l.guise.updateHp(),!f&&(0!=i||0!=r)){var g=s-o;if(c.agentInfo&&c.agentInfo.onBuffEffect(c,p,t,g,r),c.prid!=p.prid&&p.agentInfo&&p.agentInfo.onBuffEffect(c,p,t,g,r),(l.hold||l.agent&&l.agent.isRobot)&&l.agent.checkAutoUseItem(2),DebugStatic.isOpenDPS&&c.hold){var b=0;0>i&&(b+=Math.abs(i)),r&&(b+=Math.abs(r)),DebugStatic.dps(c,e.skillId,b)}}0!=n&&(u.setPropSlot("mp","BASE",u.gv("mp")+n),p.agentInfo&&p.agentInfo.updateMpRate(p)),e.buffCfg.unfloat||!d&&l.isDead||l.scene.guise&&l.scene.guise.onBuffEffect(e,t,Math.ceil(h),r,Math.ceil(n),a,d),f||0>i&&l.scene.addCallLater(l.onDelayTrigDamage,l,1,!1,!1,e.caster,i,l.isDead)},t.prototype.onDelayTrigDamage=function(e,t,i){this.ai&&this.ai.trigDamage(e,t,i)},t.prototype.startMove=function(e,t,i,r,n,a,o,s){void 0===t&&(t=null),void 0===i&&(i=null),void 0===r&&(r=null),void 0===n&&(n=0),void 0===a&&(a=!0),void 0===o&&(o=0),void 0===s&&(s=0);var l=this;return l.moveType==e?(l.state.move(!0,t,i,r,n,a,o,s),!1):(l.moveType=e,l.state.actionState instanceof SkillState?1==l.state.actionState.move&&(l.state.interrupt(1),l.state.move(!1,t,i,r,n,a,o,s)):l.state.move(!1,t,i,r,n,a,o,s),!0)},t.prototype.stopMove=function(){var e=this;e.moveType&&(e.clearSpeedLerp(),e.moveType=0,e.skill&&!e.skill.curSkillInfo&&!e.isDead&&e.state.normal(112,!1))},t.prototype.onStopEnd=function(){var e=this;e.guise&&e.guise.stopBlackEffect(),e.isDead||(e.visible_ui=!e.heroCfg.hideUI)},t.prototype.dead=function(e,t,i,r){void 0===r&&(r=!0);var n=this;n.isDead=!0,n.visible_ui=!1,n.guise&&n.guise.hideBalanceBar(),n.scene.onRoleDead(n,null,r,i),n.scene.clearTrap(n),n.state.normal(102,e,null,t)},t.prototype.onDead=function(){var e=this;e.canbeHit=!1,e.isPress=!1,e.signing=!1,e.canBeKill=!1,e.signType&&e.setSignTypeStatu(0,0),e.stopInvisible(),e.signEffId&&e.stopSignTarget(e.signEffId),e.ai.stop(),e.ai.changeTarget(null),e.scene.addCallLater(e.onDelayClearAllHaloBuff,e,1,!1,!1,0)},t.prototype.onDelayClearAllHaloBuff=function(){this.buff&&this.buff.clearAllHaloBuff()},t.prototype.onEndDead=function(){var e=this;e.clearAll(),GameStatic.target==e&&App.dispatch("c66",{target:e}),e.dispatch("onDead",{target:e})},t.prototype.clearAll=function(){var e=this;e.scene&&e.scene.onRemoveHaloBuff(e),e.buff&&e.buff.clearStates(),e.buff&&e.buff.clearAll(),e.state&&e.state.remove(21,!1),e.balancing=!1},t.prototype.relive=function(){var e=this;e.isDead=!1,e.standLand(),e.updatePos(e.x,e.y,e.z,e.right),e.createGuise(),e.updateRect(),e.props.initProps(e.getSvrProps()),e.updateLevel();var t=e.ai,i=e.aiId||e.heroCfg.ai;i&&t&&t.aiId!=i&&(t.aiId&&t.removeAITrigs(t.aiId),t.changeAI(i,!1),e.skill&&e.skill instanceof AvatarSkill&&e.skill.onTransStop()),e.buff.trigPassiveBuff(1),e.onResetBalance(!0),e.visible_guise=!0,e.visible_ui=!e.heroCfg.hideUI,e.visible_top=!0,e.visible_shadow=!e.heroCfg.hideShadow,e.visible_halo=!e.heroCfg.hideHalo,e.state.normal(111,!1),t&&t.trig(27)},t.prototype.onReliveEnd=function(){var e=this;e.canbeHit=!0,e.guise&&e.guise.updateHp(),e.signType&&e.setSignTypeStatu(0,0),e.scene.onAddHaloBuff(e)},t.prototype.onExeuntEnd=function(){},t.prototype.onHitBalance=function(e){var t=this;if(!(!t.baVal||t.buff&&t.buff.protectXbuff)&&(t.balancing=!0,t.baVal=Fixed.value(t.baVal).sub(e).value,t.guise&&t.guise.showBalanceBar(),t.baVal<=0)){t.sbabuff&&t.buff.addBuff(t,0,0,t.sbabuff),t.onResetBalance(!0);t.scene}},t.prototype.setBalanceTime=function(){var e=this,t=e.state;e.balancing&&(t.limit(101)?e.baTime&&(e.baTime=0):e.baTime||(e.baTime=Fixed.millisecond(e.sbatime)))},t.prototype.onResetBalance=function(e){var t=this;(e||t.balancing)&&t.sbabuff&&t.sbaval&&t.sbatime&&(t.balancing=!1,t.baVal=t.sbaval,t.baTime=0,t.guise&&t.guise.hideBalanceBar())},t.prototype.onAttPropChange=function(e){var t=this;GameStatic.target==t&&("hp"in e||"maxHp"in e||"mp"in e||"maxMp"in e)&&App.dispatch("c59",{rid:t.prid,target:t,changedKeys:e})},t.prototype.onUseSkill=function(e){this.skill.onBeginSkill(e,!1,!1)},t.prototype.onSetComboSkill=function(e){this.skill.setComboSkill(e)},t.prototype.onInterruptXuli=function(e){var t=this.skill.getSkillInfo(e);if(t&&t.isRelayXuli){this.skill.stopXuli(e,!1)}},t.prototype.changePress=function(e){this.agent.syncChangePress(e?1:0)},t.prototype.onChangePress=function(e){this.isPress=!!e},t.prototype.resetDamage=function(){this.buff&&this.buff.resetDamage()},t.prototype.resetBehurt=function(){this.buff&&this.buff.resetBehurt()},t.prototype.showBubble=function(e){var t=this;if(t.guise){var i=Data.getItem("BattleBubbleData",e);t.guise.updateText(i.type,i.text,i.fadeIn,i.duration,i.fadeOut,i.scale,t.showNextBubble,t)}},t.prototype.showBubbles=function(e){var t=this.waitBubbleList;t||(t=this.waitBubbleList=[]),t.unshift.apply(t,e),this.showNextBubble()},t.prototype.showNextBubble=function(){var e=this.waitBubbleList;e&&e.length&&this.showBubble(e.shift())},t.prototype.playSpineAction=function(e,t){this.guise&&this.guise.playSpineAction(e,t)},t.prototype.stopShader=function(){this.guise&&this.guise.stopShader()},t.prototype.updateRotation=function(e){this.rotation!=e&&(this.rotation=e)},t.prototype.startInvisible=function(e){if(!(0>=e)){var t=this;t.invisibleTime=e,t.invisible||(t.invisible=!0,t.guise&&t.guise.onStartInvisible()),t.dispatch("onInvisible",{target:t})}},t.prototype.stopInvisible=function(){var e=this;e.invisible&&(e.invisibleTime=0,e.invisible=!1,e.guise&&e.guise.onStopInvisible())},t.prototype.startHitTransHeal=function(e,t,i){0>=e&&0>=t||0>i||(this.hithealw=e,this.hithealh=t,this.hithealt=i)},t.prototype.stopHitTransHeal=function(){this.hithealw=0,this.hithealh=0,this.hithealt=0},t.prototype.startSignTarget=function(e,t){if(e&&!(0>t)){var i=this;i.signEffId&&i.stopSignTarget(i.signEffId),i.signEffId=e,i.signEffTime=t;var r=i.ai.target;r&&r.onStartSign(e)}},t.prototype.onStartSign=function(e){this.signing=!0,this.guise&&this.guise.addEffect(e,1)},t.prototype.stopSignTarget=function(e){var t=this;if(e==t.signEffId&&t.signEffId){t.signEffId=0,t.signEffTime=0;var i=t.ai.target;i&&i.onStopSign(e)}},t.prototype.onStopSign=function(e){this.signing=!1,this.guise&&this.guise.removeEffectId(e)},t.prototype.startSignType=function(e,t,i,r,n){if(e&&!(0>i)){var a=this;a.signType&&a.stopSignType(a.signType),a.signType=e,a.signTypeEffIds=t,a.signTypeTime=i,a.setSignTypeStatu(r,n)}},t.prototype.stopSignType=function(e){var t=this;if(e==t.signType&&t.signType){var i=t.signTypeEffIds,r=t.signTypeStatu;if(t.signType=0,t.signTypeEffIds=null,t.signTypeTime=0,t.signTypeStatu=0,t.signStatuTime=0,i&&t.guise){var n=+i[r];n&&t.guise.removeEffectId(n)}}},t.prototype.setSignTypeStatu=function(e,t){var i=this;if(!(0>t)&&this.signType){var r=i.signTypeEffIds,n=i.signTypeStatu;if(i.signTypeStatu=e,i.signStatuTime=t,r&&i.guise){var a=+r[n];a&&i.guise.removeEffectId(a),a=+r[e],a&&i.guise.addEffect(a,1)}}},t.prototype.onStartPvPWait=function(){var e=this;e.isDead||(e.state.interrupt(5),e.scene.clearRoleBullet(e),e.ai&&(e.ai.stop(),e.ai.changeTarget(null)),e.stopMove(),e.state.clearAll(),e.skill.clearAll(),e.state.normal(112,!1),e.buff.trigPassiveBuff(1))},t.prototype.onStartPvPRound=function(){this.skill.startInitCd(),this.onResetBalance(!0)},t.prototype.onStopPvPRound=function(e){var t=this;t.ai&&(t.ai.stop(),t.ai.changeTarget(null)),t.stopMove()},t.prototype.getAttackPos=function(e,t){var i=this.actionCfg.dic[e];return i?(ConstD.parseActionData(i),MmeUtils.getApInfo(e,i,t)):null},t.prototype.getRoleInfo=function(){var e=this,t=e.props;return{eid:e.$eid,x:e.x,y:e.y,z:e.z,isDead:e.isDead,hp:t.gv("hp"),maxHp:t.gv("maxHp")}},t.prototype.getSvrProps=function(){for(var e=[],t=0,i=this.svrProps;t<i.length;t++){var r=i[t],n=r.val||0,a=5792,o=r.type||1,s=void 0;s=1==o?n^a:Functor.yihuo(n,a),s=Fixed.value(s).div(23e4).value,r&&e.push({name:r.name,val:s})}return e},t.prototype.onStopPvERound=function(){var e=this;e.skill&&e.skill.clearPortalDelayBullet(),e.isClient&&e.receiveLeaveScene()},t.prototype.isBulletActive=function(e){var t=this.svrActBullets;return t?t[e]:!1},t.prototype.isBulletUnactive=function(e){var t=this.svrUnactBullets;return t?t[e]:!1},t.prototype.isSkillBulletActive=function(e,t){var i=this.svrActSkillBullets;if(!i)return!1;var r=i[e];return r?r[t]:!1},t.prototype.isSkillBulletUnactive=function(e,t){var i=this.svrUnactSkillBullets;if(!i)return!1;var r=i[e];return r?r[t]:!1},t.prototype.isSkillActionActive=function(e,t){var i=this.svrActSkillActions;if(!i)return!1;var r=i[e];return r?r[t]:!1},t.prototype.getEquipProp=function(e,t){var i=this.equipProps;if(!i)return 0;var r=this.skill.skills[e];if(!r)return 0;var n=i[e]||i[r.skillId];return n?n[t]||0:0},t.prototype.getChangeSkillId=function(e){var t=this.changeSkillIds;return t?t[e]||e:e},t.prototype.destroyGuise=function(t){void 0===t&&(t=!1),e.prototype.destroyGuise.call(this,t);var i=this;i.scene&&i.scene.clearRoleBullet(i),i.warn.clearAllWarn()},t.prototype.onDestroy=function(){var t=this;t.scene&&t.scene.removeCallLater(t),t.state.clearAll(),e.prototype.onDestroy.call(this),t.heroCfg=null,t.heroResCfg=null,t.actionCfg=null,t.props=null,t.skill=null,t.buff=null,t.ai=null,t.state=null,t.warn=null,t.svrProps=null,t.svrSkills=null,t.svrBuffs=null,t.svrActBullets=null,t.svrUnactBullets=null,t.svrActSkillBullets=null,t.svrUnactSkillBullets=null,t.equipProps=null,t.svrActSkillActions=null,t.changeSkillIds=null,t.signType=0,t.signTypeEffIds=null,t.signTypeTime=0,t.signTypeStatu=0,t.signStatuTime=0},t}(Sprite);__reflect(Role.prototype,"Role"),window.Role=Role;var Agent=function(e){function t(t,i,r,n){void 0===i&&(i=0),void 0===r&&(r=null),void 0===n&&(n=null);var a=e.call(this,t,i,r,n)||this;return a.rid=0,a.job=0,a.head=0,a.headFrame=0,a.level=0,a.teamSlotId=0,a.viewer=0,a}return __extends(t,e),t.prototype.on_rid=function(e){var t=this;t.prid=t.rid,t.hold=Player["in"]&&Player["in"].rid==t.prid},t.prototype.onCreate=function(){var e=this;e.jobCfg=Data.getItem("JobData",e.job),e.ox=e.x,e.oy=e.y,e.oz=e.z,e.prid=e.rid,e.hold=Player["in"]&&Player["in"].rid==e.prid},t.prototype.openScene=function(e){this.enterScene(e,this.x,this.y,this.right)},t.prototype.closeScene=function(e){var t;t=SceneMgr.getScene(e),t&&t.leaveMap()},t.prototype.onEnteredScene=function(){this.canbeHit=!1},t.prototype.onLeftScene=function(){},t.prototype.onStopPvERound=function(){this.isClient&&this.receiveLeaveScene()},t.prototype.onDestroy=function(){e.prototype.onDestroy.call(this),this.jobCfg=null},t}(Sprite);__reflect(Agent.prototype,"Agent"),window.Agent=Agent;var City=function(e){function t(t,i,r,n){void 0===i&&(i=0),void 0===r&&(r=null),void 0===n&&(n=null);var a=e.call(this,t,i,r,n)||this;a.svrType=0,a.sn=0,a.cityId=0;var o=a;return o.cwx=.5,o.chy=.8,o.fruits={},o.fruitList=[],a}return __extends(t,e),Object.defineProperty(t.prototype,"mapClass",{get:function(){return CityMap},enumerable:!0,configurable:!0}),t.prototype.addSprite=function(t){var i=e.prototype.addSprite.call(this,t);if(i){var r=this;t instanceof CityAgent?t.hold&&r.setCameraFollow():t instanceof CityFruit&&(r.fruits[t.$eid]=t,r.fruitList.push(t),ArrayUtils.sortOn(r.fruitList,"$eid",16))}return i},t.prototype.removeSprite=function(t){var i=e.prototype.removeSprite.call(this,t);if(i&&t instanceof CityFruit){delete this.fruits[t.$eid];var r=this.fruitList.indexOf(t);r>=0&&this.fruitList.splice(r,1)}return i},t.prototype.onCreate=function(){this.cityCfg=Data.getItem("CityData",this.cityId),e.prototype.onCreate.call(this)},t.prototype.uploadPlayerStatus=function(){},t.prototype.startScene=function(){this.isOpen=!0,this.setBgmData(1),this.startLoad()},t.prototype.checkSceneLoaded=function(){this.isSceneLoaded&&this.isLoadShowEnd&&this.onSceneStarted()},t.prototype.onSceneStarted=function(){var e=this;e.resetFrameTime(),e.onDelaySceneStarted(),TimerManager.addFrameTask(e.onUpdateStep,e)},t.prototype.onSceneStartedBefor=function(){e.prototype.onSceneStartedBefor.call(this);var t=this.cityCfg;this.bgm=t.bgm,this.setMapId(t.roundMap)},t.prototype.createClientSprite=function(){this.addCallLater(this.createNpcs,this,1,!1,!0)},t.prototype.createNpcs=function(){var e=this;e.guise&&e.guise.onUpdateDepth()},t.prototype.onCloseControl=function(){this.player&&this.player.stopMove()},t.prototype.getCameraFollow=function(){var e=this,t=e.master;if(!t)for(var i=0,r=e.agentList;i<r.length;i++){var n=r[i];if(n.hold){t=n;break}}return t},t}(Scene);__reflect(City.prototype,"City"),window.City=City;var BasePlayerInfo=function(){function e(){}return Object.defineProperty(e.prototype,"relayStatus",{get:function(){return this.isOnline?this.gameStatus:99},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"body",{get:function(){var e=Data.getItem("JobData",this.job);return e.dragonBones},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"spineParts",{get:function(){var e={};return e[1]={part:1,resId:this.body,url:Urls.spine()},e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isOnline",{get:function(){return void 0!==this._isOnline?this._isOnline:this.uplineTime>=this.offlineTime},set:function(e){this._isOnline=e},enumerable:!0,configurable:!0}),e.prototype.getOffDuration=function(){if(!this.isOnline){var e=DateUtils.secondNow-this.offlineTime;return e}return 0},Object.defineProperty(e.prototype,"offlineTimeDes",{get:function(){if(!this.isOnline){var e=CommonUtils.formatOffTimeDes(DateUtils.secondNow-this.offlineTime);return e}return""},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"recentLoginTimeDes",{get:function(){var e=1e3*this.uplineTime;return CommonUtils.formatRemainTime((DateUtils.serverNow-e)/1e3,e)},enumerable:!0,configurable:!0}),e.prototype.parse=function(e){var t=this;if(t.isvalid=!0,e&&ObjectUtils.merge(t,e),t.name){var i=t.name.split(".");t.rname=i[1],t.svrName=i[0]}t.hold=t.rid==Player["in"].rid},e.prototype.updateData=function(e){if(ObjectUtils.merge(this,e),e.name){var t=e.name.split(".");this.rname=t[1],this.svrName=t[0]}},e.prototype.dispose=function(){var e=this;e.isvalid&&(e.isvalid=!1,e.onDispose(),e._isOnline=void 0,ObjectUtils.clearKeys(e,["rid","svrId","job","freeze","name","head","headFrame","level","vip","ability","partyName","partyId","offlineTime","uplineTime","gameStatus","laddersLv","petAbility"]),ObjectPool.push(e))},e.prototype.onDispose=function(){},e}();__reflect(BasePlayerInfo.prototype,"BasePlayerInfo",["IBasePlayerInfo"]),window.BasePlayerInfo=BasePlayerInfo;var BaseAction=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.initialize=function(e){var t=this;t.clearSubActions(),t.isvalid=!0,t.owner=e.owner,t.state=e,t.slowStatus=0,t.subActions=[]},t.prototype.play=function(){!this.subAction&&this.next()},t.prototype.next=function(){var e=this;e.subActions.length>0?(e.subAction=e.subActions.shift(),e.subAction.play()):(e.state.cfg.type||e.state.cfg.action)&&e.onAllSubActionEnd()},t.prototype.onEnterFrame=function(e){var t=this,i=t.stillType,r=!1,n=!1,a=!1,o=1;t.slowStatus=0,4==i?(a=!0,o=t.slowTimes[t.curSlowFrame-1],t.curSlowTimes>=o?(r=!1,t.curSlowFrame++,t.curSlowTimes=0,t.slowStatus=3):(r=!0,t.curSlowTimes++,t.slowStatus=1==t.curSlowTimes?1:2),t.curSlowFrame>t.slowFrames&&(r=!1,a=!1,t.stillType=t.slowFrames=t.curSlowFrame=t.curSlowTimes=0,t.slowTimes=null,t.slowStatus=4)):i&&(t.stillTrig>0?t.stillTrig--:t.stillFrame>0?(1==i?n=!0:3==i?r=!0:2==i&&(r=!0,n=!0),t.stillFrame--):t.stillType=0),t.doFrame(e,r,n,a,o),t.doSubFrame(e,r,n,a,o)},t.prototype.doFrame=function(e,t,i,r,n){},t.prototype.doSubFrame=function(e,t,i,r,n){this.subAction&&this.subAction.onEnterFrame(e,t,i,r,n)},t.prototype.onAllSubActionEnd=function(){this.state.onActionEnd()},t.prototype.onSubActionEnd=function(){var e=this;e.subAction&&(e.subAction.destroy(),e.subAction=null),e.next()},t.prototype.clearSubActions=function(){var e=this;e.subActions&&e.subActions.forEach(function(e){e.destroy()}),e.subAction&&e.subAction.destroy(),e.subActions=null,e.subAction=null},t.prototype.destroy=function(){var e=this;e.isvalid&&(e.isvalid=!1,e.onDestroy(),e.clearSubActions(),e.owner=null,e.state=null,e.stillType=0,e.stillTrig=0,e.stillFrame=0,e.stillShake=!1,e.slowFrames=0,e.curSlowFrame=0,e.curSlowTimes=0,e.slowTimes=null,ObjectPool.push(e))},t.prototype.onDestroy=function(){},t}(egret.HashObject);__reflect(BaseAction.prototype,"BaseAction"),window.BaseAction=BaseAction;var Room=function(e){function t(t,i,r,n){void 0===i&&(i=0),void 0===r&&(r=null),void 0===n&&(n=null);var a=e.call(this,t,i,r,n)||this;a.status=0,a.roundId=0,a.timeIndex=0,a.startSeconds=0,a.stopTickTime=0,a.multiply=1,a.masterSide=0,a.isProtNpcDead=!1,a.isAllPetUp=!1,a.isPetSally=!1,a.isShowUi=!0,a.battleEffect=!0,a.ownerPetEffect=!0,a.teamPetEffect=!0,a.enemyPetEffect=!0,a.logicList=[],a.waveAverage=0,a.waveTotal=0,a.waveAverageCount=0,a.waveMax=0,a.waveRecords=0,a.lastFrameTime=0,a.cacheSize=0;var o=a;return o.actionWidth=214,o.agentSits={},o.roles={},o.roleList=[],o.avatars={},o.avatarList=[],o.pets={},o.petList=[],o.fruits={},o.fruitList=[],o.monsters={},o.monsterList=[],o.battNpcs={},o.battNpcList=[],o.bullets={},o.bulletList=[],o.traps={},o.trapList=[],o.agentInfos={},o.agentInfoList=[],o.portalOverTime=0,o.delayMonsterCount=0,o.deads={},o.aiTrigs={},o.battleEffect=SceneMgr.battleEffect,o.ownerPetEffect=SceneMgr.ownerPetEffect,o.teamPetEffect=SceneMgr.teamPetEffect,o.enemyPetEffect=SceneMgr.enemyPetEffect,a}return __extends(t,e),Object.defineProperty(t.prototype,"mapClass",{get:function(){return RoomMap},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"resultPanelId",{get:function(){return 140},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isPreWar",{get:function(){return 2==this.status},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isRoundWait",{get:function(){return 3==this.status},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isPlaying",{get:function(){return 4==this.status},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isPass",{get:function(){return 5==this.status||6==this.status},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isRoundLoad",{get:function(){return 7==this.status},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isWaitVerify",{get:function(){return 8==this.status},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isFail",{get:function(){return 10==this.status},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isOver",{get:function(){return 9==this.status||10==this.status||11==this.status},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isCanControl",{get:function(){var e=this.status;return 4==e||5==e||9==e||10==e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"petTickAI",{get:function(){return!1},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fruitTickAI",{get:function(){return!1},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hasRoundResult",{get:function(){return!1},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hasMiniResult",{get:function(){return!1},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hasMvp",{get:function(){return this.roomCfg.mvp},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isPlayerFight",{get:function(){return!0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"canUseItem",{get:function(){return this.roomCfg.useItem},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"remainTime",{get:function(){return Math.max(0,this.timeout-this.startSeconds)},enumerable:!0,configurable:!0}),t.prototype.addSprite=function(t){var i=e.prototype.addSprite.call(this,t);if(i){var r=this,n=t.$eid;t instanceof RoomAgent?r.agentSits[t.sit]=t:t instanceof Role?(r.roles[n]=t,r.roleList.push(t),ArrayUtils.sortOn(r.roleList,"$eid",16),t instanceof Avatar?(r.avatars[n]=t,r.avatarList.push(t),ArrayUtils.sortOn(r.avatarList,"$eid",16)):t instanceof Pet?(r.pets[n]=t,r.petList.push(t),ArrayUtils.sortOn(r.petList,"$eid",16)):t instanceof Fruit?(r.fruits[n]=t,r.fruitList.push(t),ArrayUtils.sortOn(r.fruitList,"$eid",16)):t instanceof Monster?(r.monsters[n]=t,r.monsterList.push(t),ArrayUtils.sortOn(r.monsterList,"$eid",16)):t instanceof BattNpc&&(r.battNpcs[n]=t,r.battNpcList.push(t),ArrayUtils.sortOn(r.battNpcList,"$eid",16))):t instanceof Bullet?(r.bullets[n]=t,r.bulletList.push(t),ArrayUtils.sortOn(r.bulletList,"$eid",16)):t instanceof Trap&&(r.traps[n]=t,r.trapList.push(t),ArrayUtils.sortOn(r.trapList,"$eid",16))}return i},t.prototype.removeSprite=function(t){var i=e.prototype.removeSprite.call(this,t);if(i){var r=this,n=t.$eid;if(t instanceof RoomAgent)delete r.agentSits[t.sit],r.addCallLater(r.checkPlayerLeaved,r,1,!1,!1);else if(t instanceof Role){delete r.roles[n];var a=r.roleList.indexOf(t);a>=0&&r.roleList.splice(a,1),t instanceof Avatar?(delete r.avatars[n],a=r.avatarList.indexOf(t),a>=0&&r.avatarList.splice(a,1)):t instanceof Pet?(delete r.pets[n],a=r.petList.indexOf(t),a>=0&&r.petList.splice(a,1)):t instanceof Fruit?(delete r.fruits[n],a=r.fruitList.indexOf(t),a>=0&&r.fruitList.splice(a,1)):t instanceof Monster?(delete r.monsters[n],a=r.monsterList.indexOf(t),a>=0&&r.monsterList.splice(a,1)):t instanceof BattNpc&&(delete r.battNpcs[n],a=r.battNpcList.indexOf(t),a>=0&&r.battNpcList.splice(a,1))}else if(t instanceof Bullet){delete r.bullets[n];var a=r.bulletList.indexOf(t);a>=0&&r.bulletList.splice(a,1)}else if(t instanceof Trap){delete r.traps[n];var a=r.trapList.indexOf(t);a>=0&&r.trapList.splice(a,1)}}return i},t.prototype.onAddRecord=function(){var e=this;RecordMgr.record(1,e.roomsn,e.$className,e.active,e.$eid,e.init_props,e.params)},t.prototype.onRemoveRecord=function(){RecordMgr.record(2,this.roomsn,this.$eid)},t.prototype.onPropChange=function(t,i){var r=this;r.needVerify&&RecordMgr.record(12,r.roomsn,r.$eid,t,r[t]),e.prototype.onPropChange.call(this,t,i)},t.prototype.onCreate=function(){e.prototype.onCreate.call(this),SceneMgr.onEnterScene()},t.prototype.uploadPlayerStatus=function(){},t.prototype.setStatus=function(e){this.status!=e&&(this.status=e,this.initControl())},t.prototype.initControl=function(){this.setControl(this.isCanControl)},t.prototype.startScene=function(e,t,i){for(var r=[],n=3;n<arguments.length;n++)r[n-3]=arguments[n];var a=this;a.needVerify&&RecordMgr.record.apply(RecordMgr,[7,a.roomsn,a.$eid,e,t,i].concat(r)),DebugStatic.monsterIndex=0,a.playerInfos=i,a.masterSide=t;var o,s;i.forEach(function(e){s=ObjectPool.pop(RoomAgentInfo),s.parse(e),s.hold=e.rid==a.player.rid,s.scene=a,a.agentInfos[s.rid]=s,a.agentInfoList.push(s),o=a.agentRids[e.rid],o&&(o.agentInfo=s,o.side=s.side,o.order=s.order,s.isRobot=o.isRobot)}),ArrayUtils.sortOn(a.agentInfoList,"rid",16),this.isOpen=!0,this.setBgmData(1),a.addOnceTimer(0,a.onDelayStartScene)},t.prototype.onDelayStartScene=function(){var e=this;e.roomCfg.quit?UI.closeOpenedUI(!1):UI.stashPush(),SceneMgr.unlock(),Dialog.enterBattle(),this.startLoad()},t.prototype.checkSceneLoaded=function(){var e=this;e.isSceneLoaded&&e.isLoadShowEnd&&e.player&&e.isPlotEnd&&e.player.syncSceneLoaded()},t.prototype.onSceneStarted=function(){var e=this;e.needVerify&&RecordMgr.record(8,e.roomsn,e.$eid),e.logicList.length=0,e.resetFrameTime(),TimerManager.addFrameTask(e.onUpdateStep,e),!e.isPlaying&&e.addCallLater(e.onDelaySceneStarted,e,1,!1,!1)},t.prototype.onSceneStartedAfter=function(){e.prototype.onSceneStartedAfter.call(this),DebugStatic.isOpenDPS&&(DebugStatic.resetDps(),UI.open("GMDPSUI"))},t.prototype.onOpenControl=function(){e.prototype.onOpenControl.call(this),this.agentList.forEach(function(e){e.callingAllPet&&e.autoCallNextPet()})},t.prototype.onCloseControl=function(){this.roleList.forEach(function(e){e.ai.stop()}),this.avatarList.forEach(function(e){e.onChangePress(0),1==e.moveType&&e.stopMove()})},t.prototype.onSyncFrame=function(e,t){var i=this,r=egret.getTimer(),n=0;this.lastFrameTime>0&&(n=r-this.lastFrameTime),this.waveMax=Math.max(n,this.waveMax),0==this.waveAverage&&(this.waveAverage=this.waveMax),this.waveRecords++,this.waveRecords>=1e3/17/10&&(this.waveTotal+=this.waveMax,this.waveAverageCount++,this.waveAverage=Math.ceil(this.waveTotal/this.waveAverageCount),this.waveRecords=0,this.waveMax=0,this.waveAverageCount>=5&&(this.waveAverageCount--,this.waveTotal-=this.waveAverage)),this.cacheSize=Math.min(Math.floor(this.waveAverage/17),3),this.lastFrameTime=r,DebugStatic.isOpenFrameOper||i.pauseFrame||i.logicList.push({frame:e,cmd:t})},t.prototype.onCmdNoParams=function(e,t){this.doCmdNoParams(e,t)},t.prototype.doCmdNoParams=function(e,t){var i=this;switch(t){case 2:i.cmd_nextRoundLoaded(e);break;case 4:i.cmd_touchMoveEnd(e);break;case 14:i.cmd_relive(e);break;case 18:i.cmd_randomBuffAgain(e);break;case 25:i.cmd_npcTransStop(e)}},t.prototype.onCmdInt1=function(e,t,i){this.doCmdInt1(e,t,i)},t.prototype.doCmdInt1=function(e,t,i){var r=this;switch(t){case 3:r.cmd_touchMoveBegin(e,i);break;case 5:r.cmd_touchMoveChange(e,i);break;case 6:r.cmd_useAvatarSkill(e,i);break;case 7:r.cmd_comboAvatarSkill(e,i);break;case 8:r.cmd_breakAvatarXuli(e,i);break;case 9:r.cmd_callPet(e,i);break;case 10:r.cmd_petHide(e,i);break;case 11:r.cmd_petFuse(e,i);break;case 12:r.cmd_useItem(e,i);break;case 13:r.cmd_useHelpSkill(e,i);break;case 15:r.cmd_changePress(e,i);break;case 16:r.cmd_autoBattle(e,!!i);break;case 17:r.cmd_selectRandomBuff(e,i);break;case 22:r.cmd_autoSpeSkill(e,!!i);break;case 23:r.cmd_autoCallPet(e,!!i);break;case 24:r.cmd_npcTransBegin(e,i);break;case 26:r.cmd_usePickupTrap(e,i);break;case 28:r.cmd_avatarDead(e,i);break;case 29:r.cmd_petDead(e,i);break;case 30:r.cmd_usePetKillSkill(e,i)}},t.prototype.onCmdInt2=function(e,t,i,r){this.doCmdInt2(e,t,i,r)},t.prototype.doCmdInt2=function(e,t,i,r){var n=this;switch(t){case 1:n.cmd_nextRoundReady(e,i,r);break;case 19:n.cmd_usePetSkill(e,i,r);break;case 20:n.cmd_comboPetSkill(e,i,r);break;case 21:n.cmd_breakPetXuli(e,i,r);break;case 27:n.cmd_passRound(i,r)}},t.prototype.onCmdStr=function(e,t,i,r,n){},t.prototype.addFrameRecord=function(e){this.needVerify&&RecordMgr.record(13,this.roomsn,this.$eid,e)},t.prototype.createMonster=function(e,t){var i=this;if(t||i.isPlaying){if(i.delayMonsterCount-=4,!e.ownereid){var r=1,n=DebugStatic.monsterList;if(n){if(n.length<=DebugStatic.monsterIndex)return;var a=n[DebugStatic.monsterIndex];e.monsterId=a.monsterId,e.type=a.type,e.posType=a.posType,e.offx=a.offx,e.offy=a.offy,e.x=a.x,e.y=a.y,e.radius=a.radius,e.randomh=a.randomh,e.dir=a.dir,e.effect=a.effect,e.ai=a.ai||e.ai||0,r=a.count||1,DebugStatic.monsterIndex++}for(var o=1;r>o;o++){var s=RecordMgr.createGameEntity(i.roomsn,i.$channel,SceneMgr.getMonsterEntityType(e.type),!1,0,null,e);s.enterScene(i.$eid,s.x,s.y,s.right)}}var l;l=RecordMgr.createGameEntity(i.roomsn,i.$channel,SceneMgr.getMonsterEntityType(e.type),!1,0,null,e),l.enterScene(i.$eid,l.x,l.y,l.right)}},t.prototype.cmd_touchMoveBegin=function(e,t){var i=this;i.needVerify&&RecordMgr.record(14,i.roomsn,i.$eid,e,t);var r=i.agentSits[e];r&&r.onTouchBegin(t)},t.prototype.cmd_touchMoveEnd=function(e){var t=this;t.needVerify&&RecordMgr.record(15,t.roomsn,t.$eid,e);var i=t.agentSits[e];i&&i.onTouchEnd()},t.prototype.cmd_touchMoveChange=function(e,t){var i=this;i.needVerify&&RecordMgr.record(16,i.roomsn,i.$eid,e,t);var r=i.agentSits[e];r&&r.onTouchChange(t)},t.prototype.cmd_callPet=function(e,t){var i=this;i.needVerify&&RecordMgr.record(20,i.roomsn,i.$eid,e,t);var r=i.agentSits[e];r&&r.onCallPet(t,!1)},t.prototype.cmd_useAvatarSkill=function(e,t){var i=this;i.needVerify&&RecordMgr.record(17,i.roomsn,i.$eid,e,t);
var r=i.agentSits[e];r&&r.onUseAvatarSkill(t)},t.prototype.cmd_usePetSkill=function(e,t,i){var r=this;r.needVerify&&RecordMgr.record(34,r.roomsn,r.$eid,e,t,i);var n=r.agentSits[e];n&&n.onUsePetSkill(t,i)},t.prototype.cmd_useItem=function(e,t){var i=this;i.needVerify&&RecordMgr.record(23,i.roomsn,i.$eid,e,t);var r=i.agentSits[e];r&&r.onUseItem(0,t)},t.prototype.cmd_relive=function(e){var t=this;t.needVerify&&RecordMgr.record(26,t.roomsn,t.$eid,e);var i=t.agentSits[e];i&&i.onRelive(0)},t.prototype.cmd_autoBattle=function(e,t){var i=this;i.needVerify&&RecordMgr.record(28,i.roomsn,i.$eid,e,t);var r=i.agentSits[e];r&&r.onChangeAutoBattle(t)},t.prototype.cmd_comboAvatarSkill=function(e,t){var i=this;i.needVerify&&RecordMgr.record(18,i.roomsn,i.$eid,e,t);var r=i.agentSits[e];r&&r.onComboAvatarSkill(t)},t.prototype.cmd_comboPetSkill=function(e,t,i){var r=this;r.needVerify&&RecordMgr.record(35,r.roomsn,r.$eid,e,t,i);var n=r.agentSits[e];n&&n.onComboPetSkill(t,i)},t.prototype.cmd_changePress=function(e,t){var i=this;i.needVerify&&RecordMgr.record(27,i.roomsn,i.$eid,e,t);var r=i.agentSits[e];r&&r.onChangePress(t)},t.prototype.cmd_breakAvatarXuli=function(e,t){var i=this;i.needVerify&&RecordMgr.record(19,i.roomsn,i.$eid,e,t);var r=i.agentSits[e];r&&r.onBreakAvatarXuli(t)},t.prototype.cmd_autoSpeSkill=function(e,t){var i=this;i.needVerify&&RecordMgr.record(37,i.roomsn,i.$eid,e,t);var r=i.agentSits[e];r&&r.onChangeAutoSpeSkill(t)},t.prototype.cmd_autoCallPet=function(e,t){var i=this;i.needVerify&&RecordMgr.record(38,i.roomsn,i.$eid,e,t);var r=i.agentSits[e];r&&r.onChangeAutoCallPet(t)},t.prototype.cmd_npcTransBegin=function(e,t){var i=this;i.needVerify&&RecordMgr.record(39,i.roomsn,i.$eid,e,t);var r=i.agentSits[e];r&&r.onNpcTransBegin(t)},t.prototype.cmd_npcTransStop=function(e){var t=this;t.needVerify&&RecordMgr.record(40,t.roomsn,t.$eid,e);var i=t.agentSits[e];i&&i.onNpcTransStop()},t.prototype.cmd_breakPetXuli=function(e,t,i){var r=this;r.needVerify&&RecordMgr.record(36,r.roomsn,r.$eid,e,t,i);var n=r.agentSits[e];n&&n.onBreakPetXuli(t,i)},t.prototype.cmd_petHide=function(e,t){var i=this;i.needVerify&&RecordMgr.record(21,i.roomsn,i.$eid,e,t);var r=i.agentSits[e];r&&r.onPetHide(0,t,!1)},t.prototype.cmd_petFuse=function(e,t){var i=this;i.needVerify&&RecordMgr.record(22,i.roomsn,i.$eid,e,t);var r=i.agentSits[e];r&&r.onPetFuse(0,t,!1)},t.prototype.cmd_useHelpSkill=function(e,t){var i=this;i.needVerify&&RecordMgr.record(24,i.roomsn,i.$eid,e,t);var r=i.agentSits[e];r&&r.onUseHelpSkill(t)},t.prototype.cmd_nextRoundReady=function(e,t,i){var r=this;r.needVerify&&RecordMgr.record(9,r.roomsn,r.$eid,e,t,i);var n=r.agentSits[t];n&&n.onNextRoundReady(!!i)},t.prototype.cmd_nextRoundLoaded=function(e){var t=this;t.needVerify&&RecordMgr.record(10,t.roomsn,t.$eid,e);var i=t.agentSits[e];i&&i.onNextRoundLoaded()},t.prototype.cmd_selectRandomBuff=function(e,t){},t.prototype.cmd_randomBuffAgain=function(e){},t.prototype.cmd_usePickupTrap=function(e,t){var i=this;i.needVerify&&RecordMgr.record(41,i.roomsn,i.$eid,e,t);var r=i.agentSits[e];r&&r.onUsePickupTrap(t)},t.prototype.cmd_passRound=function(e,t){this.needVerify&&RecordMgr.record(43,this.roomsn,this.$eid,e,t),this.roundId==e&&this.isPlaying&&this.onPassRound(t)},t.prototype.cmd_avatarDead=function(e,t){var i=this;i.needVerify&&RecordMgr.record(44,this.roomsn,this.$eid,e,t);var r=i.agentSits[e];if(r&&r.avatar&&!r.avatar.isDead){var n=void 0,a=i.agentSits[t];n=a&&a.avatar?a.avatar:i.monsterList[0],i.onRoleDead(r.avatar,n,!1,!0),r.avatar.dead(!1,!1,!0,!1)}},t.prototype.cmd_petDead=function(e,t){var i=this;i.needVerify&&RecordMgr.record(45,this.roomsn,this.$eid,e,t);var r=i.agentSits[e];if(r){var n=r.getPetInfoBySlotId(t);n&&n.pet&&!n.pet.isDead&&n.pet.exeuntScene(!1)}},t.prototype.cmd_usePetKillSkill=function(e,t){var i=this,r=i.agentSits[e];r&&r.avatar&&r.avatar.onUsePetKillSkill(t)},t.prototype.onPassRound=function(e){},t.prototype.onAgentSelectBuff=function(e,t){},t.prototype.doEnterFrame=function(){var e,t=this;if(t.guise&&t.guise.updateSplashFrame(),t.action&&(e=t.action.onEnterFrame()),t.canUpdateCamera&&(e=!0,t.mdirty=!0,t.updateCamera()),e&&t.guise){var i=t.guise.blindTarget;i&&t.guise.updateBlindPos(i)}},t.prototype.onTickTime=function(e){var t=this;t.checkCanTickTime()&&(t.stopTickTime>0?(t.stopTickTime=Fixed.value(t.stopTickTime).sub(e).value,t.stopTickTime<=0&&(t.stopTickTime=0,App.dispatch("c110",{change:!0}))):(t.timeIndex++,t.timeIndex%60==0&&(t.startSeconds++,t.onStartSeconds())))},t.prototype.onStartSeconds=function(){var e=this;e.needVerify&&30==e.startSeconds&&e.recordVerifyMaxTime(),e.timeout>0&&e.startSeconds>=e.timeout&&e.onBattleTimeOut()},t.prototype.recordVerifyMaxTime=function(){var e=this;if(e.needVerify){var t=RecordMgr.records[e.roomsn];if(t&&!t.isOver&&!t.isMax){var i=e.playId,r=13==i||24==i?e.selfDamage:0,n=[];e.roleList.forEach(function(e){n.push(e.getRoleInfo())}),RecordMgr.record(46,e.roomsn,e.$eid,n,r)}}},t.prototype.updateCamera=function(){var e=this,t=0,i=0,r=e.action,n=e.camera,a=n.width,o=n.height;if(r&&(t=r.x,i=r.y,r.ismoving)){var s=r.moveInfo;if(s.noDepend)return n.setTo(n.x+s.spdx,n.y+s.spdy,a,o),void(e.cdirty=!0)}var l,u,c=e.master,p=e.master_monster||e.master_bullet||e.master_kill;p?(l=p.x,u=p.y):(l=c.x,u=c.y);var d=.1*a,f=0,h=e.lastcx,v=e.lastcy,m=e.cwx,y=e.chy,g=h+a*m-l,b=v+o*y-u,x=!0,I=!0,_=13,S=5;g>d?h=Math.round(!_||_>=g-d?l+d-a*m:h-_):-d>g?h=Math.round(!_||_>=-g-d?l-d-a*m:h+_):x=!1,b>f?v=Math.round(!S||S>=b-f?u+f-o*y:v-S):-f>b?v=Math.round(!S||S>=-b-f?u-f-o*y:v+S):I=!1,e.lastcx=NumberUtils.limit(h,e.cameraLeft,e.cameraRight),e.lastcy=NumberUtils.limit(v,e.cameraTop,e.cameraBottom),h=NumberUtils.limit(h+t,e.cameraLeft,e.cameraRight),v=NumberUtils.limit(v-i,e.cameraTop,e.cameraBottom),x&&(g>d?x=h!=e.cameraLeft:-d>g&&(x=h!=e.cameraRight)),I&&(b>f?I=v!=e.cameraTop:-f>b&&(I=v!=e.cameraBottom)),n.setTo(h,v,a,o),x||I||!e.cdirty||(e.cdirty=r?r.ismoving||r.isscaling:!1)},t.prototype.onUpdateStep=function(){var e=this,t=egret.getTimer(),i=t-e.lastTime;return e.isLockStep?e.onServerFrame(i):e.onClientFrame(i),e.lastTime=t,!0},t.prototype.onServerFrame=function(e){var t=this,i=t.logicTime;if(i+=e,i>=17){var r=t.logicList,n=r.length;if(this.cacheSize>0&&n>this.cacheSize?n-=this.cacheSize:0==this.cacheSize||(n=Math.min(n,1)),i=Math.max(0,i-17*n),n>0)for(var a=0;n>a;a++){var o=r.shift(),s=o.cmd;s&&s.forEach(function(e){var i=e.params;switch(e.paramtype){case 1:t.doCmdNoParams(i[0],i[1]);break;case 2:t.doCmdInt1(i[0],i[1],i[2]);break;case 3:t.doCmdInt2(i[0],i[1],i[2],i[3])}}),t.onEnterFrame(!1,17,o.frame)}}t.logicTime=i},t.prototype.onClientFrame=function(e){var t=this,i=e+t.frameRemain,r=Math.max(1,Math.floor(i/17)),n=17*r;t.frameRemain=Math.max(0,i-n),DebugStatic.isOpenFrameOper||t.pauseFrame||(t.frameId?t.waitStep+=r:(t.waitStep+=r-1,t.onEnterFrame(0!=t.waitStep,17)))},t.prototype.passRound=function(e){void 0===e&&(e=0)},t.prototype.onAgentNextRound=function(){},t.prototype.onAgentNextRoundLoaded=function(){},t.prototype.onStopRound=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t]},t.prototype.onBattleTimeOut=function(){App.dispatch("c102")},t.prototype.setAgentBattleDamage=function(e,t){var i=t[e.side];e.totalDamage=i.totalDamage,e.totalHeal=i.totalHeal,e.totalBeHurt=i.totalBeHurt},t.prototype.syncBattleResult=function(e){this.clearReliveTime(),this.player.syncBattleResult(e)},t.prototype.onVerifyAbilityFail=function(e){Prompt.alert(Msg.phe(110))},t.prototype.clearReliveTime=function(){},t.prototype.onWin=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.setStatus(9)},t.prototype.onFail=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.setStatus(10)},t.prototype.battleOver=function(e,t){},t.prototype.checkShowSpecialItems=function(){this.showSpecialItemNext()},t.prototype.showSpecialItemNext=function(){GameStatic.battleWait.next()},t.prototype.onLeaveMap=function(){},t.prototype.playCameraEffect=function(e,t,i){var r=this;if(r.guise){var n=r.action;n||(n=r.action=ObjectPool.pop(CameraEffectAction),n.initialize(r)),r.cdirty=!0,n.playAction(e,t,i)}},t.prototype.stopSkillCamera=function(e,t){this.action&&this.action.onSkillEnd(e,t)},t.prototype.clearSkillBullet=function(e,t){this.bulletList&&this.bulletList.concat().forEach(function(i){i.castereid==e.$eid&&i.skillId==t&&i.clear&&i.onBulletEnd(!1)})},t.prototype.clearRoleBullet=function(e){this.bulletList&&this.bulletList.concat().forEach(function(t){t.castereid==e.$eid&&t.onBulletEnd(!0)})},t.prototype.removeBulletByTrigId=function(e,t,i){this.bulletList&&this.bulletList.concat().forEach(function(r){r.castereid==e.$eid&&r.trigId==t&&r.onBulletEnd(!i)})},t.prototype.clearTrap=function(e){void 0===e&&(e=null),this.trapList.concat().forEach(function(t){(!e||t.caster==e)&&t.onTrapEnd()})},t.prototype.onTrigCreateTrap=function(e,t){this.addCallLater(this.onDelayCreateTrap,this,t,!1,!0,e)},t.prototype.onTrigTrap=function(e,t,i,r,n){void 0===n&&(n=null);var a,o,s=this,l=t.datas,u=s instanceof PartyWarRRoom;e=!e||e.isDead||e.$isRemoved?null:e;for(var c=0,p=l.length;p>c;c++)if(a=l[c],n=n||s.getTrapDepend(a.depend||0,a.dval,e,r))switch(o=u&&a.hasParty?a.pval:a.val,a.type){case 1:var d=o[0];d&&r.buff.addBuff(n,0,0,d);break;case 2:var f=o[0],h=o[1]||0,v=void 0;if(v=1==h?n:2==h?r:i){var m=BulletExtra.create(n,v,f,0,0,1);m&&n.skill.onTrigBullet(m)}break;case 3:var y=o[0];if(y){var g=TrapExtra.createByPos(y,i.x,i.y,i.roomsn,i.prid,i.side,n);s.onTrigCreateTrap(g,o[1]||1)}break;case 4:var b=o[0];b&&r.skill.onUseTrapSkill(b);break;case 5:if(i instanceof Trap){var x=o[0]?String(o[0]):"",I=o[1]?String(o[0]):"";(x||I)&&i.playAction(x,I,o[2]||0,o[3]||0)}}},t.prototype.onDelayCreateTrap=function(e){var t,i=this;t=RecordMgr.createGameEntity(i.roomsn,i.$channel,"Trap",!1,0,null,e),t.enterScene(i.$eid,t.x,t.y,t.right)},t.prototype.addAITrig=function(e){var t=this.aiTrigs[e.type];t||(t=this.aiTrigs[e.type]=[]),t.push(e)},t.prototype.removeAITrig=function(e){var t=e.type,i=this.aiTrigs[t];if(i){var r=i.indexOf(e);r>=0&&i.splice(r,1),i.length||delete this.aiTrigs[t]}},t.prototype.trigAI=function(e,t){for(var i=[],r=2;r<arguments.length;r++)i[r-2]=arguments[r];var n=this.aiTrigs[e];n&&n.forEach(function(e){e.trig.apply(e,[t].concat(i))})},t.prototype.trigAvatarBehurt=function(e,t){var i=e.agent?e.agent.pet:null;if(i){var r=this.aiTrigs[18];r&&r.forEach(function(r){i==r.owner&&r.trig(e,t)})}},t.prototype.onRoleDead=function(e,t,i,r){var n=this,a=!t;t=t||e,n.deads[e.$eid]||(n.deads[e.$eid]=!0,e.isDead=!0,e instanceof Monster?!e.ownereid&&n.onMonsterDead(e,t,i):e instanceof Avatar?n.onAvatarDead(e,t,i,r):e instanceof Pet?n.onPetDead(e,t,a,i):e instanceof BattNpc&&n.onBattNpcDead(e,t,i),e.hasCalled&&n.monsterList.concat().forEach(function(t){t.ownereid==e.$eid&&!t.isDead&&t.dead(!1,!1,!0)}),n.trigAI(6,e))},t.prototype.onAvatarDead=function(e,t,i,r){var n=this;e==n.master&&n.setCameraFollow(),n.onAvatarDeadBefor(e,t,i),n.onAvatarDeadAfter(e,t,i),r&&n.checkAllPlayerDead()},t.prototype.onAvatarDeadBefor=function(e,t,i){e.agent.onAvatarDead(t,i)},t.prototype.onAvatarDeadAfter=function(e,t,i){},t.prototype.onRelive=function(e){this.deads&&delete this.deads[e]},t.prototype.checkAllPlayerDead=function(){this.checkPlayerLeaved()},t.prototype.checkPlayerLeaved=function(){},t.prototype.onPetDead=function(e,t,i,r){e.agent.onPetDead(e,i,r)},t.prototype.onBattNpcDead=function(e,t,i){},t.prototype.onMonsterDead=function(e,t,i){var r=this;r.isPlaying&&(r.player&&r.player.syncMonsterDead(t,e,i),r.onMonsterDeadBegin(e,t,i),r.onMonsterDeadAfter(e,t,i))},t.prototype.onMonsterDeadBegin=function(e,t,i){},t.prototype.onMonsterDeadAfter=function(e,t,i){},t.prototype.onMonsterDrop=function(e,t,i,r,n,a){},t.prototype.exitRoom=function(){var e=this.player;e&&e.reqQuit()},t.prototype.stopRender=function(t,i,r,n){void 0===r&&(r=null),void 0===n&&(n=null),e.prototype.stopRender.call(this,t,i,r);var a=this,o=PanelMgr.getUI(a.scenePanelId);o&&(o.visible=!1),i&&a.playCameraEffect(a.player.avatar,i,0),r&&(a.overEff=RenderUtils.playSceneEffect(r,Urls.uieff(),"idle",0,"M")),n&&SoundUtils.playBattleSound(4,a.$eid,a.stepTotal,IDUtils.genID("battleSound"),"",0,n,1,1),a.pauseDropItems()},t.prototype.onStopEnd=function(){e.prototype.onStopEnd.call(this);var t=this,i=PanelMgr.getUI(t.scenePanelId);i&&(i.visible=!0),t.action&&t.action.clearAction(),t.resumeDropItems()},t.prototype.canShowPortal=function(){return this.isPass},t.prototype.checkHitPortal=function(e){if(!this.canShowPortal())return!1;for(var t=0,i=this.portalList;t<i.length;t++){var r=i[t];if(r.rect.hitTestPoint(e.x,e.y))return!0}return!1},t.prototype.showPortal=function(){var e=this;e.isPass&&e.canShowPortal()&&e.portalList.forEach(function(e){e.showPortal()})},t.prototype.hidePortal=function(){this.portalList.forEach(function(e){e.hidePortal()})},t.prototype.createClientSprite=function(){var e=this;e.addCallLater(e.createPortals,e,1,!1,!1),e.addCallLater(e.createBattNpcs,e,1,!1,!1),e.addCallLater(e.createTraps,e,1,!1,!1)},t.prototype.createPortals=function(){var e=this,t=e.battleCfg.portal,i=e.mapCfg.portals;if(i&&t){var r=i[t-1];if(r){var n;n=RecordMgr.createGameEntity(e.roomsn,e.$channel,"Portal",!1,0,null,{portalId:r.portal,x:r.x||0,y:r.y||0}),n.enterScene(e.$eid,n.x,n.y,n.right)}}},t.prototype.createBattNpcs=function(){var e=this,t=e.battleCfg,i=e.player.side,r=t.pNpcId;r&&e.createBattNpc(r,i);var n=t.allyNpcs;n&&n.forEach(function(t){e.createBattNpc(t,i)});var a=t.enemyNpcId;a&&a.forEach(function(t){e.createBattNpc(t,0)})},t.prototype.createBattNpc=function(e,t){var i,r=this;i=RecordMgr.createGameEntity(r.roomsn,r.$channel,"BattNpc",!1,0,null,{battNpcId:e,roomsn:r.roomsn,side:t}),i.enterScene(r.$eid,i.x,i.y,i.right)},t.prototype.createTraps=function(){var e=this,t=e.battleCfg.traps;if(t){var i,r=e.seedr;t.forEach(function(t){t&&(i=t.length,i>0&&e.createAreaTraps(i>1?Fixed.randGet(t,r):t[0]))})}},t.prototype.createAreaTraps=function(e){if(e){var t,i,r,n,a,o,s,l=this,u=this.seedr,c=Data.getItem("TrapAreaData",e),p={};c.datas&&c.datas.forEach(function(e,c){e.index?r=p[e.index]:e.isRandom?(t=Data.getItem("TrapGroupData",e.groupId),t&&t.datas&&(i=Fixed.randGet(t.datas,u),r=i.trapId)):r=e.trapId,e.id?(o=Fixed.value(e.id).mod(12).value,o=0==o?12:o,s=6>=o,s?(n=138,n=Fixed.value(e.id).sub(o).div(12).mul(204.8).add(n).value,n=Fixed.value(o).sub(1).mul(35).add(n).round().value,a=Fixed.value(o).sub(1).mul(48.6).add(531).round().value):(n=258,n=Fixed.value(e.id).sub(o).div(12).mul(204.8).add(n).value,n=Fixed.value(o).sub(6).sub(1).mul(35).add(n).round().value,a=Fixed.value(o).sub(6).sub(1).mul(48.6).add(555).round().value)):(n=e.x||0,a=e.y||0),r&&(p[c+1]=r,l.onDelayCreateTrap(TrapExtra.createByPos(r,n,a,l.roomsn,0,2)))})}},t.prototype.stopAI=function(){this.reqPause(!0);var e=this.roleList;if(e&&e.length)for(var t=0,i=e;t<i.length;t++){var r=i[t];r.ai.stop(),r.stopMove()}},t.prototype.pauseDropItems=function(){},t.prototype.resumeDropItems=function(){},t.prototype.reqPause=function(e){var t=this;t.roomCfg.isLockStep||t.isPause==e||(t.isPause=e)},t.prototype.updateBattleEffect=function(){var e=this.battleEffect,t=this.player.side;this.roleList.forEach(function(i){i.hold||i.side!=t||!i.prid||i instanceof Pet||(i.visible_effect=e)}),this.bulletList.forEach(function(i){i.hold||i.side!=t||!i.prid||i.caster instanceof Pet||(i.visible_guise=e)})},t.prototype.updateBattleName=function(e){this.roleList.forEach(function(t){t.visible_name=e})},t.prototype.updateBattleTitle=function(e){this.roleList.forEach(function(t){t.visible_title=e})},t.prototype.updateOwnerPetEffect=function(e){this.petList.forEach(function(t){t.hold&&(t.visible_effect=e)}),this.bulletList.forEach(function(t){t.hold&&t.caster instanceof Pet&&(t.visible_guise=e)})},t.prototype.updateTeamPetEffect=function(e){var t=this.player.side;this.petList.forEach(function(i){i.hold||i.side!=t||(i.visible_effect=e)}),this.bulletList.forEach(function(i){!i.hold&&i.side==t&&i.caster instanceof Pet&&(i.visible_guise=e)})},t.prototype.updateEnemyPetEffect=function(e){var t=this.player.side;this.petList.forEach(function(i){i.side!=t&&(i.visible_effect=e)}),this.bulletList.forEach(function(i){i.side!=t&&i.caster instanceof Pet&&(i.visible_guise=e)})},t.prototype.resetMachine=function(e,t,i,r){this.monsterList.forEach(function(n){n instanceof Machine?-1!=t.indexOf(n.heroId)&&n.changeActivated(!1):-1!=i.indexOf(n.heroId)&&(n.state.remove(118),r&&n.buff.addBuff(e,0,0,r))})},t.prototype.removeAllSprite=function(){this.roleList.concat().forEach(function(e){!e.$isRemoved&&e.receiveLeaveScene()}),this.spriteList.concat().forEach(function(e){!e.$isRemoved&&e.receiveLeaveScene()})},t.prototype.onStopTick=function(e){var t=0==this.stopTickTime&&e>0;this.stopTickTime=e,App.dispatch("c110",{change:t})},t.prototype.addHaloBuff=function(e){var t,i=this.halos,r=e.haloRoles,n=e.target;i||(i=this.halos={});var a=i[n.$eid];a||(a=i[n.$eid]=[]),-1==a.indexOf(e.buffId)&&a.push(e.buffId),this.roleList.forEach(function(i){if(t=!1,(!r||!r[i.$eid])&&i.isCanBeHit&&(!(i instanceof BattNpc)||!i.isTransNpc&&!i.isTrapNpc))switch(e.buffCfg.haloType){case 1:t=i.side==n.side;break;case 2:t=i.side!=n.side;break;case 3:t=n.agent&&n.agent.avatar==i}t&&(r||(r=e.haloRoles={}),r[i.$eid]=!0,i.buff.addBuff(e.target,e.skillId,e.skillLv,e.buffId,0,0,e.helpRid,!0))})},t.prototype.onAddHaloBuff=function(e){if(e.isCanBeHit&&!(e instanceof BattNpc&&(e.isTransNpc||e.isTrapNpc))){var t=this.halos;if(t){var i,r,n,a,o,s=this.roles;for(var l in t)i=s[l],r=t[l],i&&i.buff&&r&&r.forEach(function(t){if(n=i.buff.getHaloBuff(t)){if(a=!1,o=n.haloRoles,!o||!o[e.$eid])switch(n.buffCfg.haloType){case 1:a=e.side==i.side;break;case 2:a=e.side!=i.side;break;case 3:a=i.agent&&i.agent.avatar==e}a&&(o||(o=n.haloRoles={}),o[e.$eid]=!0,e.buff.addBuff(i,n.skillId,n.skillLv,n.buffId,0,0,n.helpRid,!0))}})}}},t.prototype.removeHaloBuff=function(e,t){var i=e.haloRoles;if(i){var r,n=this.roles;for(var a in i)r=n[a],r&&r.buff&&r.buff.removeId(e.buffId,t,!0);for(var o,s=0,l=this.roleList;s<l.length;s++){var u=l[s];if(u&&u.buff&&(o=u.buff.getHaloBuff(e.buffId)))break}o&&this.addHaloBuff(o)}},t.prototype.onRemoveHaloBuff=function(e){if(e&&e.buff){var t=this.halos;if(t){var i,r,n,a,o=this.roles;for(var s in t)i=o[s],r=t[s],i&&i.buff&&r&&r.forEach(function(t){n=i.buff.getHaloBuff(t),n&&(a=n.haloRoles,a&&a[e.$eid]&&(delete a[e.$eid],e.buff.removeId(t,1,!0)))})}}},t.prototype.showFetterTip=function(e,t){if(e&&t){var i=BattleFetterInfo.create(e,t);App.dispatch("c116",{fetterInfo:i})}},t.prototype.getCameraFollow=function(){var e=this,t=e.player,i=e.master;if(i&&i.hold&&!i.isDead)return i;var r=t.avatar;if(!r)return i;if(!r.isDead)return r;for(var n=0,a=e.avatarList;n<a.length;n++){var o=a[n];if(!o.isDead&&o.side==t.side)return o}return i},t.prototype.getFirstUnDeadAvatar=function(e){for(var t,i=this.avatarList,r=0,n=i.length;n>r;r++)if(t=i[r],!t.isDead&&t.side==e)return t;return i[0]},t.prototype.getAllUndeadAvatar=function(){return this.avatarList.filter(function(e){return!e.isDead})},t.prototype.getSumAvatar=function(e,t){var i=this;if(0==t){var r=e.agent?e.agent.avatar:null;return r&&!r.isDead?r:null}if(1==t){var n=i.avatarList.filter(function(t){return t.side==e.side&&!t.isDead}),a=n.length;return a>0?Fixed.randGet(n,i.seedr):null}if(2==t){var n=i.avatarList.filter(function(t){return t.side!=e.side&&!t.isDead}),a=n.length;return a>0?Fixed.randGet(n,i.seedr):null}return null},t.prototype.getNearestTarget=function(e,t,i){var r=null,n=null,a=Number.MAX_VALUE,o=null,s=Number.MAX_VALUE;return this.roleList.forEach(function(i){if(i.side!=e.side&&i.isCanBeHit&&!i.unselect&&!i.invisible){var l=Fixed.distance(e.x,e.y,i.x,i.y);!i.signing||i.isDead||r||(r=i),!i.isDead&&a>l&&(!t||t>=l)&&(a=l,n=i),s>l&&(!t||t>=l)&&(s=l,o=i)}}),r||n||o},t.prototype.getAISelectTarget=function(e,t,i,r){void 0===r&&(r=null);var n=this;switch(t){case 1:return n.getNearestTarget(e,0,!1);case 2:var a,o,s=1,l=1;return n.roleList.forEach(function(t){if(t.side!=e.side&&t.isCanBeHit&&!t.unselect&&!t.invisible){var i=t.hpRateFloor;!t.isDead&&s>i&&(s=i,a=t),l>i&&(l=i,o=t)}}),a||o;case 3:return r&&r.side!=e.side&&r.isCanBeHit&&!r.unselect&&!r.invisible?r:null;case 4:var u=[];n.roleList.forEach(function(t){t.side==e.side||!t.isCanBeHit||t.unselect||t.invisible||u.push(t)});var c=u.length;return c>0?Fixed.randGet(u,this.seedr):null;case 5:for(var p=0,d=n.battNpcList;p<d.length;p++){var f=d[p];if(f.side!=e.side&&f.isCanBeHit&&!f.unselect&&!f.invisible&&(!i||i==f.battNpcId))return f}return null;case 6:return n.getNearestTarget(e,0,!0)}return null},t.prototype.findViewEnemy=function(e,t,i){return this.getNearestTarget(e,t,i)},t.prototype.getBulletDropTarget=function(e,t,i,r){var n,a=this;switch(r){case 1:var o;a.monsterList.forEach(function(t){t.side!=e.side&&t.isCanBeHit&&!t.unselect&&!t.isDead&&t.type>=100&&(!o||o.type>t.type)&&(o=t)}),n=o;break;case 2:case 4:case 5:var s,l;l=4==r?"pd":5==r?"pd":"hp",a.roleList.forEach(function(t){t.side==e.side||!t.isCanBeHit||t.unselect||t.isDead||s&&!(t.props.gv(l)<s.props.gv(l))||(s=t)}),n=s;break;case 3:var u;a.roleList.forEach(function(t){if(t.side!=e.side&&t.isCanBeHit&&!t.unselect&&!t.isDead)if(u){var i=t.props.gv("hp"),r=t.props.gv("maxHp"),n=u.props.gv("hp"),a=u.props.gv("maxHp");Fixed.value(i).div(r).value<Fixed.value(n).div(a).value&&(u=t)}else u=t}),n=u;break;case 6:var c,p=1;a.roleList.forEach(function(t){t.side==e.side||!t.isCanBeHit||t.unselect||t.isDead||c&&c.agent.job!=p||(c=t)}),n=c;break;case 7:var d,f=4;a.roleList.forEach(function(t){t.side==e.side||!t.isCanBeHit||t.unselect||t.isDead||d||!t.state.hasState(f)||(d=t)}),n=d;break;case 9:var h,v=Number.MAX_VALUE;a.avatarList.forEach(function(t){if(t.side!=e.side&&t.isCanBeHit&&!t.unselect&&!t.isDead)if(h){var i=Fixed.distance(t.x,t.y,h.x,h.y);v>i&&(v=i,h=t)}else h=t}),n=h}if(!n){var m,y=Number.MAX_VALUE;a.roleList.forEach(function(t){if(t.side!=e.side&&t.isCanBeHit&&!t.unselect&&!t.isDead)if(m){var i=Fixed.distance(t.x,t.y,m.x,m.y);y>i&&(y=i,m=t)}else m=t}),n=m}return n},t.prototype.getBulletDropTargets=function(e,t){var i=this,r=[];switch(t){case 0:i.roleList.forEach(function(t){t.side!=e.side&&t.isCanBeHit&&!t.unselect&&(i.battleCfg.pNpcId&&t instanceof BattNpc&&t.battNpcId==i.battleCfg.pNpcId||r.push(t))});break;case 1:r.push(e);break;case 2:i.roleList.forEach(function(t){t.side==e.side&&t.isCanBeHit&&!t.unselect&&(i.battleCfg.pNpcId&&t instanceof BattNpc&&t.battNpcId==i.battleCfg.pNpcId||r.push(t))});break;case 3:i.avatarList.forEach(function(t){t.side==e.side&&t.isCanBeHit&&!t.unselect&&r.push(t)});break;case 4:i.petList.forEach(function(t){t.side==e.side&&t.isCanBeHit&&!t.unselect&&r.push(t)});break;case 5:i.avatarList.forEach(function(t){t.side!=e.side&&t.isCanBeHit&&!t.unselect&&r.push(t)});break;case 6:i.petList.forEach(function(t){t.side!=e.side&&t.isCanBeHit&&!t.unselect&&r.push(t)});break;case 7:var n=i.avatarList.filter(function(t){return t.side!=e.side&&t.isCanBeHit&&!t.unselect?!0:void 0}),a=n.length,o=a>0?Fixed.randGet(n,i.seedr):null;o&&r.push(o)}return r},t.prototype.getBulletHits=function(e,t,i,r,n,a,o){var s=this,l=[],u=e.rect,c=e.bulletCfg,p=c.target||0,d=c.exc;if(!s.isControl)return l;switch(p){case 0:s.roleList.forEach(function(c){c.side==e.side||!c.isCanBeHit||c.unselect||a&&!((o[c.$eid]||0)<a)||i&&!(Fixed.value(c.y).sub(e.y).abs().value<=i)||r&&n&&!u.intersects(c.rect)||t&&c.state.hasState(115)||(1==d?s.battleCfg.pNpcId&&c instanceof BattNpc&&c.battNpcId==s.battleCfg.pNpcId||l.push(c):l.push(c))});break;case 1:var f=e.caster;!f.isCanBeHit||f.unselect||a&&!((o[f.$eid]||0)<a)||i&&!(Fixed.value(f.y).sub(e.y).abs().value<=i)||r&&n&&!u.intersects(f.rect)||t&&f.state.hasState(115)||(1==d?s.battleCfg.pNpcId&&f instanceof BattNpc&&f.battNpcId==s.battleCfg.pNpcId||l.push(f):l.push(f));break;case 2:s.roleList.forEach(function(c){c.side!=e.side||!c.isCanBeHit||c.unselect||a&&!((o[c.$eid]||0)<a)||i&&!(Fixed.value(c.y).sub(e.y).abs().value<=i)||r&&n&&!u.intersects(c.rect)||t&&c.state.hasState(115)||(1==d?s.battleCfg.pNpcId&&c instanceof BattNpc&&c.battNpcId==s.battleCfg.pNpcId||l.push(c):l.push(c))});break;case 3:s.avatarList.forEach(function(s){s.side!=e.side||!s.isCanBeHit||s.unselect||a&&!((o[s.$eid]||0)<a)||i&&!(Fixed.value(s.y).sub(e.y).abs().value<=i)||r&&n&&!u.intersects(s.rect)||t&&s.state.hasState(115)||l.push(s)});break;case 4:s.petList.forEach(function(s){s.side!=e.side||!s.isCanBeHit||s.unselect||a&&!((o[s.$eid]||0)<a)||i&&!(Fixed.value(s.y).sub(e.y).abs().value<=i)||r&&n&&!u.intersects(s.rect)||t&&s.state.hasState(115)||l.push(s)});break;case 5:s.avatarList.forEach(function(s){s.side==e.side||!s.isCanBeHit||s.unselect||a&&!((o[s.$eid]||0)<a)||i&&!(Fixed.value(s.y).sub(e.y).abs().value<=i)||r&&n&&!u.intersects(s.rect)||t&&s.state.hasState(115)||l.push(s)});break;case 6:s.petList.forEach(function(s){s.side==e.side||!s.isCanBeHit||s.unselect||a&&!((o[s.$eid]||0)<a)||i&&!(Fixed.value(s.y).sub(e.y).value<=i)||r&&n&&!u.intersects(s.rect)||t&&s.state.hasState(115)||l.push(s)});break;case 7:var h=s.avatarList.filter(function(s){return s.side==e.side||!s.isCanBeHit||s.unselect||a&&!((o[s.$eid]||0)<a)||i&&!(Fixed.value(s.y).sub(e.y).abs().value<=i)||r&&n&&!u.intersects(s.rect)||t&&s.state.hasState(115)?void 0:!0}),v=h.length,m=v>0?Fixed.randGet(h,s.seedr):null;m&&l.push(m);break;case 8:if(e.params){var y=e.params.depend;y instanceof Role&&y.isCanBeHit&&!y.unselect&&l.push(y)}}return l},t.prototype.getCanHitAvatar=function(e){for(var t=0,i=this.avatarList;t<i.length;t++){var r=i[t];if(r.side!=e&&r.isCanBeHit&&!r.unselect)return r}return null},t.prototype.getTrapHits=function(e,t,i,r,n){var a=this,o=a.roleList,s=[],l=0,u=e.rect;switch(t){case 1:for(var c=0,p=o;c<p.length;c++){var d=p[c];if(d.side!=e.side&&d.isCanBeHit&&!d.unselect&&(!n||(n[d.$eid]||0)<=0)&&(!i||Fixed.value(d.y).sub(e.y).abs().value<=i)&&u.intersects(d.rect)&&(l++,s.push(d)),r&&l>=r)break}break;case 2:for(var f=0,h=o;f<h.length;f++){var d=h[f];if(d.isCanBeHit&&!d.unselect&&d instanceof Avatar&&(!n||(n[d.$eid]||0)<=0)&&(!i||Fixed.value(d.y).sub(e.y).abs().value<=i)&&u.intersects(d.rect)&&(l++,s.push(d)),r&&l>=r)break}}return s},t.prototype.getPassiveBuffTarget=function(e,t){var i=this,r=[];switch(t){case 1:!e.isDead&&r.push(e);break;case 2:var n=e.agent;n&&n.avatar&&!n.avatar.isDead&&r.push(n.avatar);break;case 3:i.roleList.forEach(function(t){t.side==e.side||t.unselect||r.push(t)})}return r},t.prototype.getBuffTirgCaster=function(e,t,i,r){switch(r){case 0:return e.target;case 1:return e.caster;case 2:return t;case 3:return i}return null},t.prototype.getBuffTirgTarget=function(e,t,i,r){switch(r){case 0:return e.target;case 1:return e.caster;case 2:return t;case 3:return i}return null},t.prototype.getPetHideSkillTarget=function(e){var t,i,r,n,a=e.agent.avatar,o=Data.getItem("SkillData",a.skill.nskillId),s=o.aw||0,l=o.ah||0;return this.roleList.forEach(function(o){if(o.isCanBeHit&&!o.unselect&&o.side!=e.side){var u=Fixed.distance(o.x,o.y,a.x,a.y);(a.right&&o.x>=a.x||!a.right&&o.x<=a.x)&&(!s||Fixed.value(o.x).sub(a.x).abs().value<=s)&&(!l||Fixed.value(o.y).sub(a.y).abs().value<=l)&&(!i||t>u)&&(t=u,i=o),i||n&&!(r>u)||(r=u,n=o)}}),i||n},t.prototype.getCallPetTarget=function(e){var t,i,r,n;return this.roleList.forEach(function(a){if(a.isCanBeHit&&!a.unselect&&a.side!=e.side){var o=Fixed.distance(a.x,a.y,e.x,e.y);e.right&&a.x>=e.x&&(!i||t>o)&&(t=o,i=a),!e.right&&a.x<=e.x&&(!n||r>o)&&(r=o,n=a)}}),i||n},t.prototype.getSkillPosTarget=function(e,t,i,r,n){var a,o,s=this,l=Fixed.value(t).mul(e.multiply).add(e.x).value,u=Fixed.value(e.y).add(i).value,c=Fixed.value(l).sub(r).value,p=Fixed.value(l).add(r).value,d=Fixed.value(u).sub(n).value,f=Fixed.value(u).add(n).value,h=Number.MAX_VALUE;return s.roleList.forEach(function(t){t.side==e.side||!t.isCanBeHit||t.unselect||t.invisible||r&&n&&!(t.x>=c&&t.x<=p&&t.y>=d&&t.y<=f)||(o=Fixed.distance(e.x,e.y,t.x,t.y),(!a||h>o)&&(h=o,a=t))}),a},t.prototype.getSkillPosAvatar=function(e){var t,i,r=this,n=Number.MAX_VALUE;return r.roleList.forEach(function(r){r.side!=e.side&&r.isCanBeHit&&!r.unselect&&!r.invisible&&r instanceof Avatar&&(i=Fixed.distance(e.x,e.y,r.x,r.y),(!t||n>i)&&(n=i,t=r))}),t},t.prototype.getBuffCollideTarget=function(e,t,i,r,n){for(var a=0,o=this.roleList;a<o.length;a++){var s=o[a];if(e!=s&&s.isCanBeHit&&!s.unselect&&(!t||Fixed.value(e.y).sub(s.y).abs().value<=t)&&s.buff.hasBuffById(n.buffId)){var l=Fixed.value(n.w).mul(.5).value;if(r.setTo(Fixed.value(s.x).sub(l).value,Fixed.value(s.y).sub(n.h).value,n.w,n.h),i.intersects(r))return s}}return null},t.prototype.getAITrigBulletTargets=function(e,t,i,r){if(!t||!i)return null;var n,a,o=this.roleList.filter(function(o){return o.side!=e.side&&o.isCanBeHit&&!o.unselect?(n=Fixed.value(e.x).sub(o.x).abs().value,a=Fixed.value(e.y).sub(o.y).abs().value,r?n>t||a>i:t>=n&&i>=a):void 0});return o},t.prototype.getRandomEnemyAvatar=function(e){var t=this.avatarList.filter(function(t){return t.isCanBeHit&&!t.unselect&&!t.isDead&&!t.invisible&&t.side!=e}),i=t.length;return i>0?Fixed.randGet(t,this.seedr):null},t.prototype.getSignEnemyAvatar=function(e,t){return this.avatarList.filter(function(i){return i.isCanBeHit&&!i.unselect&&!i.isDead&&!i.invisible&&i.side!=e&&i.signType&&i.signTypeStatu==t})},t.prototype.getSignDeadTargets=function(e,t,i){var r,n=this.roleList,a=[];return n.forEach(function(o){o.side==e||!o.isCanBeHit||o.unselect||o.invisible||o.signType!=t||o.signTypeStatu!=i||2!=i||1==t&&(r=n.filter(function(e){return e.side==o.side&&e.isCanBeHit&&e.unselect&&!(o instanceof BattNpc)&&(o.right&&!e.right&&e.x>=o.x||!o.right&&e.right&&e.x<=o.x)&&-1==a.indexOf(e)}),r.length>0&&(a=a.concat(r),-1==a.indexOf(o)&&a.push(o)))}),a},t.prototype.getCallMonsterNum=function(e,t){var i=0;return this.monsterList.forEach(function(r){r.ownereid&&r.side==e&&r.monsterId==t&&!r.isDead&&i++}),i},t.prototype.getUndeadNum=function(e){var t=0;return this.roleList.forEach(function(e){e.state.hasState(118)&&t++}),t},t.prototype.getTrapDepend=function(e,t,i,r){var n=this;switch(e){case 0:for(var a=t[0],o=0,s=n.battNpcList;o<s.length;o++){var l=s[o];if(l.battNpcId==a)return l.isDead||l.$isRemoved?null:l}return null;case 1:return i.isDead||i.$isRemoved?null:i;case 2:return!r||r.isDead||r.$isRemoved?null:r;case 3:for(var u=0,c=n.battNpcList;u<c.length;u++){var l=c[u];if(l.isTrapNpc&&!l.isDead&&!l.$isRemoved)return l}return null;default:return null}},t.prototype.checkBulletNumLimit=function(e,t,i){if(!i)return!1;var r=0;return this.bulletList.forEach(function(e){e.trigId==t&&r++}),r>=i},t.prototype.checkHitTransHeal=function(e){for(var t=0,i=this.roleList;t<i.length;t++){var r=i[t];if(e.side!=r.side&&r.hithealw&&r.hithealh&&(Fixed.value(e.x).sub(r.x).abs().value>r.hithealw||Fixed.value(e.y).sub(r.y).abs().value>r.hithealh))return!0}return!1},t.prototype.checkCollideTarget=function(e,t,i){for(var r=0,n=this.roleList;r<n.length;r++){var a=n[r];if(a.heroId==t&&a.isCanBeHit&&a.unselect&&!a.isDead&&!a.invisible&&(!i||Fixed.value(a.y).sub(e.y).abs().value<=i)&&a.rect.intersects(e.rect))return!0}return!1},t.prototype.onBossEnterScene=function(){this.agentList&&this.agentList.concat().forEach(function(e){e&&e.checkAutoCallPet()})},t.prototype.getRoleTimeBarOwner=function(e,t){switch(t){case 1:return e.agent?e.agent.avatar:null;default:return e}},t.prototype.getLoadUrls=function(){return PreloadUtils.getPreloadUrls(this,this.battleId,this.playerInfos)},t.prototype.getAgent=function(e){return this.agentRids[e]},t.prototype.getAgentInfo=function(e){return this.agentInfos[e]},t.prototype.getAgentInfoList=function(e){var t=[];return this.agentInfoList.forEach(function(i){i.side==e&&t.push(i)}),ArrayUtils.sortOn(t,["hold","rid"],[18,16]),t},t.prototype.getRoleByEid=function(e){return this.roles[e]},t.prototype.getTotalKillNum=function(e){return this.agentInfoList.reduce(function(t,i){return i.side==e?t+i.killNum:t},0)},t.prototype.getWinSide=function(e){return!this.player,1==e?this.player.side:1==this.player.side?2:1
},t.prototype.getBornPos=function(e,t){var i=this.battleCfg,r=1==e?i.left:i.right;return r?r[t-1]||r[0]:{x:1,y:1}},t.prototype.getPlotParamData=function(e){return{dungeonId:0,win:1===e,fail:2===e}},t.prototype.setBattleDamages=function(){var e,t,i=this,r=i.agentInfoList||[],n={},a=[];r.forEach(function(t){e=n[t.side],e||(e=n[t.side]={totalHp:0,totalDamage:0,totalHeal:0,totalBeHurt:0,playerNum:0}),e.playerNum+=1,e.totalHp=Fixed.value(e.totalHp).add(t.avatarData.hpRate).value;var i=t.getTotal("damage"),r=t.getTotal("heal"),o=t.getTotal("beHurt");e.totalDamage=Fixed.value(e.totalDamage).add(i).value,e.totalHeal=Fixed.value(e.totalHeal).add(r).value,e.totalBeHurt=Fixed.value(e.totalBeHurt).add(o).value,-1==a.indexOf(t.side)&&a.push(t.side)}),r.forEach(function(e){i.setAgentBattleDamage(e,n)});var o;i.hasMvp&&a.forEach(function(e){t=null,o=r.filter(function(t){return t.side==e}),o.forEach(function(e){5!=e.score&&(!t||t.score<e.score||t.score==e.score&&t.getTotal("damage")<e.getTotal("damage"))&&(t=e)}),t&&(t.isMvp=!0)})},t.prototype.isAgentFight=function(e){return!0},t.prototype.checkSpecialItem=function(){},t.prototype.getBattleMvps=function(){var e={};return this.agentInfoList.forEach(function(t){t.isMvp&&(e[t.side]=t.rid)}),e},t.prototype.getBattleScoreRanks=function(e){var t=this.agentInfoList.concat(),i=[];return t.forEach(function(t){t.winSide=e}),ArrayUtils.sortOn(t,["score","isWin","order","rid"],[18,18,16,16]),t.forEach(function(e){i.push(e.rid)}),i},t.prototype.getBattNpcByNpcId=function(e){for(var t=0,i=this.battNpcList;t<i.length;t++){var r=i[t];if(r.battNpcId==e)return r}return null},t.prototype.getBattleResultParams=function(e){var t=this,i=t.getWinSide(e),r=t.agentInfoList.concat();return r.forEach(function(e){e.winSide=i}),ArrayUtils.sortOn(r,["score","isWin","order","rid"],[18,18,16,16]),{winSide:i,agentList:r,agents:t.agentInfos,playId:t.playId}},t.prototype.isAllDead=function(e){var t=this.agentRids[e];if(t)for(var i=0,r=this.agentList;i<r.length;i++){var n=r[i];if(n.side==t.side&&!n.isDead)return!1}return!0},t.prototype.hasBoss=function(){for(var e=0,t=this.monsterList;e<t.length;e++){var i=t[e];if(!i.isDead&&i.isBoss)return!0}return!1},t.prototype.hasMonster=function(){for(var e=0,t=this.monsterList;e<t.length;e++){var i=t[e];if(!i.isDead)return!0}return!1},t.prototype.checkAllowRelive=function(){var e=this.roomCfg;return e&&e.relive},t.prototype.checkCanTickTime=function(){return!0},t.prototype.clearPortalTime=function(){var e=this.portalTimeOutId;e&&(this.removeCallLaterIdx(e),this.portalTimeOutId=0)},Object.defineProperty(t.prototype,"selfDamage",{get:function(){var e=this.player,t=e&&e.agentInfo?e.agentInfo.getTotal("damage"):0;return t},enumerable:!0,configurable:!0}),t.prototype.onPetExeunt=function(e){this.roleList.forEach(function(t){!t.isDead&&t.buff&&t.buff.dealRmvBuff(6,t,e)})},t.prototype.isInfiniteHp=function(e){return!1},t.prototype.isHideLv=function(e){return!1},t.prototype.onDestroy=function(){var t=this;DebugStatic.isOpenDPS&&UI.close("GMDPSUI"),RecordMgr.dipose(t.roomsn),GameStatic.battleWait.clear(!0),SoundUtils.stopBattleSound(),t.action&&(t.action.destroy(),t.action=null),t.clearReliveTime();var i=t.agentInfoList;i&&i.forEach(function(e){e.dispose()});var r=t.overEff;r&&(t.overEff=null,r.parent&&r.parent.removeChild(r));var n=t.loadPanelId,a=PanelMgr.getUI(n);a&&a.vo&&a.vo.params&&a.vo.params.scene==t&&PanelMgr.close(n),t.agentList&&t.agentList.concat().forEach(function(e){!e.$isRemoved&&Functor.delay(ServiceMgr.removeEntity,0,ServiceMgr,e.$channel,e.$eid)}),e.prototype.onDestroy.call(this),ObjectUtils.clearKeys(t,["battleCfg","playerInfos","agentInfos","agentInfoList","agentSits","roles","roleList","avatars","avatarList","pets","petList","fruits","fruitList","monsters","monsterList","battNpcs","battNpcList","bullets","bulletList","traps","trapList","deads","hasBossDrop","aiTrigs","logicList"])},t.prototype.onLockStepFrame=function(){},t}(Scene);__reflect(Room.prototype,"Room"),window.Room=Room;var BaseBattleUI=function(e){function t(){var t=e.call(this)||this,i=t;return i.fullScreen=!1,i.adaptation=!0,i.modal=!1,i.layerIndex=1,i.touchEnabled=!1,i.isScene=!0,t}return __extends(t,e),t.prototype.initUI=function(){},t.prototype.addUI=function(){this.room=this.vo.params.scene},t.prototype.update=function(){},t.prototype.removeUI=function(){var e=this;e.room=null},t}(BaseUI);__reflect(BaseBattleUI.prototype,"BaseBattleUI"),window.BaseBattleUI=BaseBattleUI;var SubAction=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.initialize=function(e,t,i,r,n,a){void 0===a&&(a=null);var o=this,s=e.owner;(90==i||91==i)&&s.guise&&s.guise.body&&(t=s.guise.body.actionName||t),o.isvalid=!0,o.owner=s,o.action=e,o.actionName=t,o.playType=i,o.ctime=o.time=r,o.shakeIndex=0,o.astate=n,o.callback=a,o.isInStopLast=!1,o.status=0},t.prototype.play=function(){var e=this,t=e.owner,i=1,r=e.actionData;r&&r.action==e.actionName||(r=e.actionData=t.actionCfg.dic[e.actionName]),Functor.assert(!!r,"模型动作资源："+e.owner.actionCfg.res+" 缺少动作配置动作数据:"+e.actionName),ConstD.parseActionData(r),e.totalFrame=r.total||1,(90==e.playType||91==e.playType)&&t.guise&&t.guise.body&&(i=t.guise.body.curFrame||i),e.curFrame=i,e.status=1,e.astate&&e.action.state.com.normal(e.astate,!1),e.onFrameEvent()},t.prototype.onEnterFrame=function(e,t,i,r,n){var a=this,o=a.action;return 2==a.status?void a.onActionEnd():(!t&&a.gotoFrame(e,t,i,r,n),!i&&a.doMove(e,t,i,r,n),!t&&a.doAction(e,t,i,r,n),t&&o.stillShake&&(a.stilling||(a.stilling=!0),a.shakeIndex++,a.owner.guise.onStillShake(a.shakeIndex)),void a.checkEnd(e,t,i,r,n))},t.prototype.gotoFrame=function(e,t,i,r,n){var a=this;a.stilling&&(a.stilling=!1,a.owner.guise.resetStillPos());var o,s=!0,l=a.playType;90==l||91==l?(o=a.curFrame,s=!1):(o=a.curFrame+1,o>a.totalFrame&&(o=1==l||3==l?1:a.totalFrame,(2==l||4==l)&&(a.isInStopLast||(a.isInStopLast=!0),s=!1))),a.curFrame=o,s&&a.onFrameEvent()},t.prototype.doAction=function(e,t,i,r,n){},t.prototype.doMove=function(e,t,i,r,n){},t.prototype.checkEnd=function(e,t,i,r,n){var a=this;if(!t){var o=a.playType;1==o||2==o||90==o?a.ctime&&(a.time=Fixed.value(a.time).sub(e).value,a.time<=0&&(a.status=2)):3==o||4==o||91==o?a.ctime&&(a.time=Fixed.value(a.time).sub(1).value,a.time<=0&&(a.status=2)):a.curFrame==a.totalFrame&&(a.status=2)}},t.prototype.onActionEnd=function(){this.doActionEnd()},t.prototype.doActionEnd=function(){var e=this;e.stilling&&(e.stilling=!1,e.owner.guise.resetStillPos());var t=e.astate;t&&e.action.state.com.remove(t,!1);var i=e.callback;i&&(i.apply(e.action),e.callback=null),e.action.onSubActionEnd()},t.prototype.onFrameEvent=function(){var e=this,t=e.owner;if(Functor.assert(!!e.actionData,"模型动作资源："+t.actionCfg.res+" 缺少动作配置动作数据:"+e.actionName),e.actionData.events){var i=e.actionData.events[e.curFrame];if(i&&i.length){var r=t.$eid,n=t.scene.stepTotal;i.forEach(function(i){switch(i[0]){case"playShake":SceneMgr.onFrameShake(t.scene,t,i[1]);break;case"sound":e.soundId||(e.soundId=IDUtils.genID("battleSound")),SceneMgr.onFrameSound(r,n,e.soundId,e.actionName,e.curFrame,i[1]);break;case"effect":t.agent&&t.agent.fuseing&&t.guise&&t.guise.onFrameEffect(i[1])}})}}},t.prototype.destroy=function(){var e=this;e.isvalid&&(e.isvalid=!1,e.onDestroy(),e.stilling&&(e.stilling=!1,e.owner.guise&&e.owner.guise.resetStillPos()),SoundUtils.onBattleActionEnd(e.soundId),e.owner=null,e.action=null,e.actionName=null,e.actionData=null,e.ctime=0,e.time=0,e.playType=0,e.totalFrame=0,e.curFrame=0,e.isInStopLast=!1,e.status=0,e.shakeIndex=0,e.astate=0,e.callback=null,e.soundId=0,ObjectPool.push(e))},t.prototype.onDestroy=function(){},t}(egret.HashObject);__reflect(SubAction.prototype,"SubAction"),window.SubAction=SubAction;var AIAction_Base=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.play=function(e,t){var i=this;i.isvalid=!0,i.ai=e,i.owner=e.owner,i.cfg=t,i.type=t.type||0,i.time=Fixed.millisecond(t.time),i.tickTime=Fixed.millisecond(t.tick),i.isEnd=!1,i.onPlay()},t.prototype.onPlay=function(){},t.prototype.onHalfSecond=function(e){},t.prototype.onEnterFrame=function(e){var t=this;if(t.isEnd)return void t.onActionEnd();var i=t.cfg;i.time&&(t.time=Fixed.value(t.time).sub(e).value,t.time<=0&&(t.isEnd=!0)),!t.isEnd&&i.tick&&(t.tickTime=Fixed.value(t.tickTime).sub(e).value,t.tickTime<=0&&(t.tickTime=Fixed.millisecond(i.tick),t.owner.scene.seedr.random<i.stop&&(t.isEnd=!0))),t.doEnterFrame(e)},t.prototype.doEnterFrame=function(e){},t.prototype.onActionEnd=function(){this.ai.onActionEnd(this.skillInfo)},t.prototype.destroy=function(){var e=this;e.isvalid&&(e.isvalid=!1,e.onDestroy(),ObjectUtils.clearKeys(e,["ai","owner","cfg","isEnd","skillInfo"]),ObjectUtils.clearKeysNum(e,["type","time","tickTime"]),ObjectPool.push(e))},t.prototype.onDestroy=function(){},t}(egret.HashObject);__reflect(AIAction_Base.prototype,"AIAction_Base"),window.AIAction_Base=AIAction_Base;var GRole=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.preInitialize=function(){var e=this;e.filterEffects=[],e.shakeIndex=0,e.content=new egret.DisplayObjectContainer,e.upper=new egret.DisplayObjectContainer,e.lower=new egret.DisplayObjectContainer,e.topGrp=new egret.DisplayObjectContainer;var t=e.shadow=new UIImage;t.width=121,t.height=80,t.anchorOffsetX=.5*t.width,t.anchorOffsetY=.5*t.height;var i=e.nameTxt=new eui.Label;i.size=20},t.prototype.initialize=function(){var e=this;e.enabled=!1;var t=e.effect=ObjectPool.pop(GEffect);t.initialize(e.owner,e.upper,e.lower),e.upperHalo=ObjectPool.pop(MmeRender,"BattleMmeRender"),e.lowerHalo=ObjectPool.pop(MmeRender,"BattleMmeRender"),e.title=ObjectPool.pop(MmeRender,"BattleMmeRender"),e.upperHalo.depth=e.depth,e.updateNameStyle(),EventCenter.addProxy(t,e),EventCenter.addEvent(t,"actionPlayEnd",e.onEffectPlayEnd,e)},t.prototype.childrenCreated=function(){var e=this,t=e.content;t.addChild(e.lower),t.addChild(e.upper),t.addChild(e.topGrp),e.topGrp.addChild(e.nameTxt),e.topGrp.addChild(e.title),e.addChild(e.lowerHalo),e.addChild(t)},t.prototype.create=function(){var e=this;e.destroyBody(),e.createBody();var t=e.owner;e.updatePos(t.x,t.y,t.z),e.updateIcon(),e.updateHalo(),e.updateTitle(),e.updateName(),e.updateHp(),e.updateElementImg()},t.prototype.createBody=function(){var e=this,t=e.owner,i=t.curHeroCfg,r=i.flag,n=i.color,a=e.body=ObjectPool.pop(UnitPlayer);EventCenter.addProxy(a,e);var o={};o[1]={part:1,url:t.heroUrl,id:t.resId,flag:r,color:n};var s=t.weaponUrl;s&&(o[2]={part:2,url:Urls.weapon(),id:s,flag:r,color:n});var l=t.wingUrl;l&&(o[3]={part:3,url:Urls.wing(),id:l,flag:r,color:n});var u=t.weaponEffectUrl;if(u&&(o[4]={part:4,url:Urls.weaponEffect(),id:u,flag:r,color:n}),EventCenter.addEvent(a,"ready",e.onGuiseReady,e),a.initialize(o,3),e.content.addChildAt(a,1),t.heroResCfg.spine&&!e.spineBody){var c=e.spineBody=ObjectPool.pop(SpineAni);c.load(t.heroResCfg.spine,Urls.spine(),"default",3),e.playSpineAction("idle",0),a.spineBody=c}},t.prototype.hpLabelFunctionce=function(e,t){return""},t.prototype.getHpBarCls=function(){var e=this.owner;return e.hold?PlayerHpBar:e.side==e.scene.player.side?TeamHpBar:MonsterHpBar},t.prototype.updateIcon=function(){this.shadow.source="hero_shadow"},t.prototype.updateHalo=function(){var e=this,t=e.owner.lowerHaloAction,i=e.owner.upperHaloAction,r=e.lowerHalo,n=e.upperHalo;t?(r=e.lowerHalo=e.lowerHalo||ObjectPool.pop(MmeRender,"BattleMmeRender"),r.load("1",Urls.halo(),null,null,3),r.playAction(t,3,1,!0)):r&&r.unload(),i?(n=e.upperHalo=e.upperHalo||ObjectPool.pop(MmeRender,"BattleMmeRender"),n.load("1",Urls.halo(),null,null,3),n.playAction(i,3,1,!0)):n&&n.unload(),e.updateHaloVisible()},t.prototype.updateTitle=function(){var e=this,t=e.title,i=e.owner.titleUrl;i&&e.owner.visible_title?(t||(t=e.title=ObjectPool.pop(MmeRender,"BattleMmeRender")),t.addEventListener("loaded",e.updateUIPos,e),t.load(i,Urls.title(),null,null,3),t.playAction("idle-3",3,1,!0)):t&&(t.removeEventListener("loaded",e.updateUIPos,e),t.unload(),e.updateUIPos())},t.prototype.updateHp=function(){},t.prototype.updateText=function(e,t,i,r,n,a,o,s,l){},t.prototype.updatePos=function(e,t,i){var r=this;e!=r.$x&&(r.x=r.upperHalo.x=r.shadow.x=e),t!=r.$y&&(r.y=r.layouty=r.upperHalo.y=r.shadow.y=t),i!=r.content.y&&(r.content.y=-i);var n=r.body;if(n){var a=r.owner.rotation;if(a){if(!n.rotation&&0==n.anchorOffsetY){var o=this.getRefPoint("p_spin");n.anchorOffsetY=o.y,n.y=o.y}}else n.anchorOffsetY=0,n.y=0;n.rotation=a}r.spineBody&&(r.spineBody.x=e+(r.owner.heroResCfg.soffx||0),r.spineBody.y=t+(r.owner.heroResCfg.soffy||0))},t.prototype.updateUIPos=function(){var e=this,t=this.getRefPoint("p_hp"),i=t.y,r=e.timeBar;r&&r.visible&&(r.x=t.x,r.y=i-=10);var n=e.castBar;n&&n.visible&&(n.x=t.x,n.y=i-=10);var a=e.protectBar;a&&a.visible&&(a.x=t.x,a.y=i-=10);var o=e.balanceBar;o&&o.visible&&(o.x=t.x,o.y=i-=10),i-=10;var s=this.nameTxt;s.visible&&(s.x=t.x-.5*s.width,s.y=i-=24);var l=e.title;l&&l.isLoaded&&(l.x=t.x,l.y=i-=15);var u=e.shieldBar;return u&&u.visible&&(u.x=t.x,u.y=i-=80),t},t.prototype.onEnterFrame=function(e){this.effect&&this.effect.onEnterFrame(e)},t.prototype.afterEnterFrame=function(){e.prototype.afterEnterFrame.call(this);var t=this;t.body&&t.playBodyAction(),t.effect&&t.effect.afterEnterFrame(),t.title&&t.title.manualEnterFrame(),t.upperHalo&&t.upperHalo.manualEnterFrame(),t.lowerHalo&&t.lowerHalo.manualEnterFrame(),t.shader&&t.shader.manualEnterFrame()},t.prototype.playBodyAction=function(){var e=this,t=e.owner.state.actionState;if(t&&t.action&&t.action.subAction){var i=t.action.subAction;e.body.gotoAction(i.actionName,e.owner.direction,i.totalFrame,i.curFrame)}e.body.afterEnterFrame()},t.prototype.playSpineAction=function(e,t){var i=this.spineBody;i&&(i.playAction(e,t),t&&i.addEventListener("action_play_end",this.onSpineActionEnd,this))},t.prototype.onSpineActionEnd=function(){var e=this;e.spineBody&&e.spineBody.removeEventListener("action_play_end",e.onSpineActionEnd,e),e.playSpineAction("idle",0)},t.prototype.onStartInvisible=function(){var e=this;e.updateGuiseVisible(),e.updateEffectsVisible(),e.body&&e.body.playInvisibleFilter()},t.prototype.onStopInvisible=function(){var e=this;e.updateGuiseVisible(),e.updateEffectsVisible(),e.body&&e.body.stopInvisibleFilter()},t.prototype.updateGuiseVisible=function(){var e=this,t=e.owner,i=t.visible_guise&&t.visible_view&&(t.isPlayerSide||!t.invisible),r=t.visible_ui;e.visible=i,e.upperHalo&&(e.upperHalo.visible=i&&r&&t.visible_halo),e.shadow&&(e.shadow.visible=i&&r&&t.visible_shadow),e.spineBody&&(e.spineBody.visible=i)},t.prototype.updateUIVisible=function(){var e=this,t=e.owner,i=t.visible_guise&&t.visible_view&&(t.isPlayerSide||!t.invisible),r=t.visible_ui,n=t.visible_halo;e.upperHalo&&(e.upperHalo.visible=i&&r&&n),e.lowerHalo&&(e.lowerHalo.visible=r&&n),e.shadow&&(e.shadow.visible=i&&r&&t.visible_shadow),e.updateTopVisible()},t.prototype.updateTopVisible=function(){var e=this,t=e.owner;e.topGrp.visible=t.visible_top&&t.visible_ui&&t.visible_undead&&!DebugStatic.isVideo},t.prototype.updateShadowVisible=function(){var e=this,t=e.owner;e.shadow&&(e.shadow.visible=t.visible_guise&&t.visible_view&&(t.isPlayerSide||!t.invisible)&&t.visible_ui&&t.visible_shadow)},t.prototype.updateHaloVisible=function(){var e=this,t=e.owner,i=t.visible_guise&&t.visible_view&&(t.isPlayerSide||!t.invisible),r=t.visible_ui,n=t.visible_halo;e.upperHalo&&(e.upperHalo.visible=i&&r&&n),e.lowerHalo&&(e.lowerHalo.visible=r&&n)},t.prototype.updateName=function(){var e=this;e.nameTxt.text=e.owner.heroCfg.name,e.nameTxt.visible=e.owner.visible_name,e.updateUIPos()},t.prototype.updateNameStyle=function(){this.nameTxt.textColor=16777215},t.prototype.addBuffEffect=function(e,t,i){var r=this,n=this.owner;if(n||n.visible_effect){var a,o,s=Data.getItem("EffectData",t),l=s.suf?n.element:0;if(1==s.pos)a=0,o=0;else if(2==s.pos){var u=r.getRefPoint("p_hp");a=u.x,o=u.y}else{var u=r.getRefPoint("p_defence");a=u.x,o=u.y}return r.playEffect(s,l,0,a,o,i,!1,e.agent?e.agent.fuseing:!1)}},t.prototype.addHitEffect=function(e,t,i,r){var n=this,a=n.owner;if(a||a.visible_effect){var o,s,l=Data.getItem("EffectData",t),u=l.suf?n.owner.element:0;if(1==l.pos)o=0,s=0;else if(2==l.pos){var c=n.getRefPoint("p_hp");o=c.x,s=c.y}else{var c=n.getRefPoint("p_defence");o=c.x,s=c.y}var p;return p=l.turn?1==i?a.x<e.x?e.right?7:3:e.direction:3==i?a.right?7:3:e.direction:l.mirror?3:0,n.playEffect(l,u,p,o,s,0,r,e.agent?e.agent.fuseing:!1,!0)}},t.prototype.addRunEffect=function(e,t,i){var r=this.owner;if(r||r.visible_effect)return this.playEffect(Data.getItem("EffectData",e),0,r.direction,t*r.multiply,i,0)},t.prototype.addEffect=function(e,t){var i=this,r=i.owner;if(r&&r.visible_effect){var n,a,o=Data.getItem("EffectData",e);if(1==o.pos)n=0,a=0;else if(2==o.pos){var s=i.getRefPoint("p_hp");n=s.x,a=s.y}else{var s=i.getRefPoint("p_defence");n=s.x,a=s.y}var l;return l=o.mirror?3:0,i.playEffect(o,0,l,n,a,t,!1,r.agent?r.agent.fuseing:!1)}},t.prototype.playEffect=function(e,t,i,r,n,a,o,s,l){if(void 0===o&&(o=!1),void 0===s&&(s=!1),void 0===l&&(l=!1),!e)return null;var u=this,c=u.effect.playEffect(e,t,i,r,n,a,o,s,l);if(c&&c.cfg.filter&&u.body){-1==u.filterEffects.indexOf(c)&&u.filterEffects.push(c);var p=u.getFilterEffect();p&&p!=u.body.effectInfo&&u.body.playNormalFilter(p)}return c},t.prototype.removeEffect=function(e){var t=this,i=t.body,r=t.effect.removeEffect(e);if(r&&r.cfg.filter){var n=t.filterEffects.indexOf(r);if(n>=0&&t.filterEffects.splice(n,1),i.effectInfo==r)if(t.filterEffects.length>0){var a=t.getFilterEffect();a&&t.body.playNormalFilter(a)}else i.stopNormalFilter()}},t.prototype.removeEffectId=function(e){var t=this,i=this.effect.getEffectsById(e);i&&i.forEach(function(e){t.removeEffect(e.uid)})},t.prototype.onEffectPlayEnd=function(e){this.removeEffect(e.uid),this.owner.buff.onEffectPlayEnd(e)},t.prototype.getFilterEffect=function(){for(var e,t,i,r=0,n=this.filterEffects;r<n.length;r++){var a=n[r];if(i=a.cfg.filter,3==i)return a;7==i?e||(e=a):2==i&&(t||(t=a))}return e||t||this.filterEffects[0]},t.prototype.playSpecialFilter=function(e){this.body&&this.body.playSpecialFilter(e)},t.prototype.resetStillPos=function(){this.body.x=0},t.prototype.playDeadShader=function(e,t,i){void 0===t&&(t=null),void 0===i&&(i=null);for(var r=[],n=3;n<arguments.length;n++)r[n-3]=arguments[n];var a=this.body;a&&(a.stopFilter(),this.playShader.apply(this,[a,255,255,255,0,1,0,1,e,t,i].concat(r)))},t.prototype.playDisappearShader=function(e,t){void 0===e&&(e=null),void 0===t&&(t=null);for(var i=[],r=2;r<arguments.length;r++)i[r-2]=arguments[r];this.playShader.apply(this,[this,255,255,255,0,.01,0,1,.02,e,t].concat(i))},t.prototype.playShader=function(e,t,i,r,n,a,o,s,l,u,c){void 0===u&&(u=null),void 0===c&&(c=null);for(var p=[],d=11;d<arguments.length;d++)p[d-11]=arguments[d];var f=this,h=f.shader;h?(h.r=t,h.g=i,h.b=r,h.threshold=n,h.edgeWidth=a):(h=f.shader=ObjectPool.pop(DissolveShader),h.initialize({r:t,g:i,b:r,threshold:n,edgeWidth:a})),h.to.apply(h,[e,o,s,l,u,c].concat(p))},t.prototype.stopShader=function(e){void 0===e&&(e=!1),this.shader&&this.shader.stop(e)},t.prototype.onStillShake=function(e){if(e%4==0){var t=this;0==t.shakeIndex?(t.shakeIndex=1,t.body.x=-9):(t.shakeIndex=0,t.body.x=9)}},t.prototype.playBlackEffect=function(){var e=this;e.filters=FiltersUtils.BLACK_FILTERS,e.upperHalo&&(e.upperHalo.filters=FiltersUtils.BLACK_FILTERS),e.shadow&&(e.shadow.filters=FiltersUtils.BLACK_FILTERS)},t.prototype.stopBlackEffect=function(){var e=this;e.filters=null,e.upperHalo&&(e.upperHalo.filters=null),e.shadow&&(e.shadow.filters=null)},t.prototype.showBalanceBar=function(){var e=this,t=e.owner,i=e.balanceBar;i||(i=e.balanceBar=ObjectPool.pop(BalanceBar),e.topGrp.addChild(i)),i.minimum=0,i.maximum=t.sbaval,i.value=t.baVal,i.visible=!0,e.updateUIPos()},t.prototype.hideBalanceBar=function(){this.balanceBar&&(this.balanceBar.visible=!1,this.updateUIPos())},t.prototype.showProtectBar=function(){var e=this,t=e.owner,i=t.buff.protectXbuff;if(i){var r=e.protectBar;r||(r=e.protectBar=ObjectPool.pop(ProtectBar),e.topGrp.addChild(r)),r.minimum=0,r.maximum=i.duration,r.value=i.totalTime,r.visible=!0,e.updateUIPos()}},t.prototype.updateProtectBar=function(){var e=this,t=e.protectBar,i=e.owner.buff.protectXbuff;t&&i&&(t.value=i.totalTime)},t.prototype.hideProtectBar=function(){this.protectBar&&(this.protectBar.visible=!1,this.updateUIPos())},t.prototype.showShieldBar=function(){var e=this,t=e.owner,i=t.buff.shieldXbuff;if(i){var r=e.shieldBar;r||(r=e.shieldBar=ObjectPool.pop(ShieldBar),e.topGrp.addChild(r)),r.minimum=0,r.maximum=i.maxShield,r.value=i.shield,r.visible=!0,r.updateTime(i.duration,i.totalTime),e.updateUIPos()}},t.prototype.updateShieldTime=function(){var e=this,t=e.shieldBar,i=e.owner.buff.shieldXbuff;t&&i&&t.updateTime(i.duration,i.totalTime)},t.prototype.updateShieldBar=function(){var e=this,t=e.shieldBar,i=e.owner.buff.shieldXbuff;t&&i&&(t.value=i.shield)},t.prototype.updateBuff=function(){},t.prototype.hideShieldBar=function(){this.shieldBar&&(this.shieldBar.visible=!1)},t.prototype.showTimeBar=function(e,t,i){var r=this,n=r.timeBar;if(n&&n.barType!=e&&r.destroyTimeBar(),!r.timeBar){var a=void 0;switch(e){case 2:a=TimeBar2;break;case 3:a=FuseSkillBar;break;case 4:a=FuseSkillBar;break;default:a=TimeBar1}n=r.timeBar=ObjectPool.pop(a),n.barType=e,r.topGrp.addChild(n)}n.minimum=0,n.maximum=i,n.value=t,n.visible=t>=0,n.visible&&r.updateUIPos()},t.prototype.updateTimeBar=function(e){var t=this,i=t.timeBar;i&&(!i.visible&&e>=0&&(i.visible=!0,t.updateUIPos()),i.value=e)},t.prototype.hideTimeBar=function(){this.timeBar&&(this.timeBar.visible=!1)},t.prototype.showCastBar=function(e,t,i){var r=this,n=r.castBar;n||(n=r.castBar=ObjectPool.pop(CastBar),r.topGrp.addChild(n)),n.visible=!0,n.minimum=0,n.maximum=t,r.updateCastBar(e,i),r.updateUIPos()},t.prototype.updateCastBar=function(e,t){var i=this.castBar;i&&(i.value=2==e?i.maximum-t:t)},t.prototype.hideCastBar=function(){this.castBar&&(this.castBar.visible=!1,this.updateUIPos())},t.prototype.updateNameVisible=function(){this.nameTxt.visible=this.owner.visible_name,this.updateUIPos()},t.prototype.updateEffectsVisible=function(){this.effect.updateEffectsVisible()},t.prototype.onFrameEffect=function(e){},t.prototype.onNextRound=function(){this.effect&&this.effect.onNextRound()},t.prototype.getRefPoint=function(e){return this.body?this.body.getRefPoint(e)||egret.Point.create(0,0):egret.Point.create(0,0)},t.prototype.updateElementImg=function(){},t.prototype.destroyBody=function(){var e=this,t=e.body;t&&(e.body=null,EventCenter.removeProxy(t),EventCenter.clearTarget(t),t.destroy());var i=e.spineBody;i&&(e.spineBody=null,i.removeEventListener("action_play_end",e.onSpineActionEnd,e),i.destroy())},t.prototype.destroyTimeBar=function(){var e=this.timeBar;e&&(this.timeBar=null,ObjectPool.push(e))},t.prototype.onDestroy=function(){var e=this;EventCenter.removeEvent(e.effect,"actionPlayEnd",e.onEffectPlayEnd,e),EventCenter.removeProxy(e.effect),EventCenter.clearTarget(e),e.destroyBody(),e.effect.destroy(),e.effect=null,e.upperHalo&&(e.upperHalo.dispose(),e.upperHalo=null),e.lowerHalo&&(e.lowerHalo.dispose(),e.lowerHalo=null);var t=e.title;t&&(t.removeEventListener("loaded",e.updateUIPos,e),t.dispose(),t=null);var i=e.shader;i&&(i.destroy(),e.shader=null,ObjectPool.push(i));var r=e.balanceBar;r&&(e.balanceBar=null,ObjectPool.push(r));var n=e.protectBar;n&&(e.protectBar=null,ObjectPool.push(n));var a=e.shieldBar;a&&(e.shieldBar=null,ObjectPool.push(a));var o=e.castBar;o&&(e.castBar=null,ObjectPool.push(o));var s=e.elementImg;s&&(s.source=null,s.parent&&s.parent.removeChild(s),e.elementImg=null,ObjectPool.push(s)),e.destroyTimeBar();var l=e.shadow;l.parent&&l.parent.removeChild(l),e.nameTxt.text="",e.removeChildren(),e.content.removeChildren(),e.upper.removeChildren(),e.lower.removeChildren(),e.topGrp.removeChildren(),e.filterEffects=[],e.alpha=1,e.filters=null,e.visible=!0},t}(BaseGuise);__reflect(GRole.prototype,"GRole"),window.GRole=GRole;var TabBarItemBase=function(e){function t(){var t=e.call(this)||this;return t.useFuncId=!0,t}return __extends(t,e),Object.defineProperty(t.prototype,"commands",{get:function(){return["c256"]},enumerable:!0,configurable:!0}),t.prototype.update=function(){this.funcId(),this.redPoint(),this.regUIName(),this.updateBubble(),this.invalidateState()},t.prototype.command=function(e,t){switch(e){case"c256":this.funcId()}},t.prototype.initUI=function(){},t.prototype.addUI=function(){var e="UI_Tab";SoundUtils.reg(this,e)},t.prototype.removeUI=function(){SoundUtils.un(this)},t.prototype.funcId=function(){if(this.useFuncId){var e=this.getFuncId();if(e){var t=Data.getItem("OpenFuncData",e),i=t.unOpenShowType;switch(i){case 1:this.visible=this.includeInLayout=!1;break;case 2:this.filters=FiltersUtils.GRAY_FILTERS;break;case 3:}}}},t.prototype.regUIName=function(){var e=this.data;e&&e.uiName&&this.addName(this,e.uiName)},t.prototype.onEnd=function(e){},t.prototype.getFuncId=function(){var e,t=this.data;return t&&(e=t.funcId,"string"==typeof e&&(e=Number(e))),e||0},t.prototype.redPoint=function(){var e=this.data;e&&e.redId?this.addRed(this,e.redId):this.rmRed(this)},t.prototype.updateBubble=function(){},t}(BaseItem);__reflect(TabBarItemBase.prototype,"TabBarItemBase"),window.TabBarItemBase=TabBarItemBase;var CityAgent=function(e){function t(t,i,r,n){void 0===i&&(i=0),void 0===r&&(r=null),void 0===n&&(n=null);var a=e.call(this,t,i,r,n)||this;return a.svrId=0,a.ability=0,a.haloId=0,a.fashionId=0,a.titleId=0,a.weaponId=0,a.weaponRTimes=0,a.weaFasId=0,a.wingFasId=0,a.fruitId=0,a}return __extends(t,e),Object.defineProperty(t.prototype,"guiseClass",{get:function(){return GAgent},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"resId",{get:function(){if(this.fashionId){var e=Data.getItem("ClothData",this.fashionId);return e.res}return this.heroResCfg.res},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"heroUrl",{get:function(){return this.fashionId?Urls.fashion_c():Urls.hero()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"titleUrl",{get:function(){if(this.titleId){var e=Data.getItem("TitleData",this.titleId);return e.res}return null},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"upperHaloAction",{get:function(){return this.hold?"1_upper":null},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"lowerHaloAction",{get:function(){return this.hold?"1_lower":null},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"weaponUrl",{get:function(){var e=this;if(e.weaFasId)return"";if(e.weaponId){var t=Data.getItem("EquipApData",e.weaponId);return t?t.res:this.heroResCfg.weapon}return this.heroResCfg.weapon},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"weaponEffectUrl",{get:function(){var e=this;if(!e.weaponId)return null;var t=Data.getItem("EquipApData",e.weaponId);return t?t.cityRes:null},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"wingUrl",{get:function(){if(this.wingFasId){var e=Data.getItem("WingSkinData",this.wingFasId);return e.exteriorRes+"_"+this.job}return""},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"spd",{get:function(){return this.specialSpd||Player["in"].props.gv("spd")},enumerable:!0,configurable:!0}),t.prototype.onCreate=function(){e.prototype.onCreate.call(this);var t=this;t.heroId=t.jobCfg.heroId,t.heroCfg=Data.getItem("HeroData",t.heroId),t.heroResCfg=Data.getItem("HeroResData",t.heroCfg.guise),t.hold&&t.onVerifyGuise()},t.prototype.createCom=function(){var e=this;e.state=ServiceMgr.createGameCom(AgentStates,e,!0),e.ai=ServiceMgr.createGameCom(AgentAI,e,!0)},t.prototype.onVerifyGuise=function(){},t.prototype.onEnteredScene=function(){e.prototype.onEnteredScene.call(this);var t=this;t.visible_shadow=!t.heroCfg.hideShadow,t.visible_halo=!t.heroCfg.hideHalo,t.state.add(112),t.hold&&t.onPlayerInvisibily(),t.createFruit()},t.prototype.onLeaveScene=function(){e.prototype.onLeaveScene.call(this),this.fruit&&this.fruit.receiveLeaveScene()},t.prototype.createFruit=function(){var e=this,t=e.scene;if(e.fruitId&&!e.fruit){var i=FruitExtra.create(e.roomsn,e.side,e.rid,e.fruitId,0),r=ServiceMgr.createEntity(e.$channel,"CityFruit",!1,0,null,i);r.enterScene(t.$eid,e.x,e.y,e.right)}},t.prototype.onHalfSecond=function(e){this.ai.onHalfSecond(e)},t.prototype.onEnterFrame=function(t){e.prototype.onEnterFrame.call(this,t),this.ai.onEnterFrame(t)},t.prototype.changeDirection=function(e){var t=this;t.right!=e&&(t.right=e,t.guise&&t.guise.updateDirection(t.direction))},t.prototype.moveToPos=function(e,t){this.ai.moveToPos(this.scene.limitX(e),this.scene.limitY(t))},t.prototype.touchMoveBegin=function(e){var t=this;t.isTouch=!0,t.touchDir=e,t.updateSpdByDir(e),t.syncTouchBegin(e),t.startMove(1)},t.prototype.touchMoveChange=function(e){var t=this;t.touchDir!=e&&(t.touchDir=e,t.updateSpdByDir(e),t.syncTouchChange(e))},t.prototype.touchMoveEnd=function(){var e=this;e.clearTouch(),1==e.moveType&&e.stopMove(),e.syncTouchEnd()},t.prototype.clearTouch=function(){this.isTouch=!1,this.touchDir=0},t.prototype.startMove=function(e){var t=this;return t.moveType==e?!1:(t.moveType=e,t.state.add(101),!0)},t.prototype.stopMove=function(){var e=this;e.moveType&&(e.moveType=0,e.state.add(112),e.onStopMove())},t.prototype.onStopMove=function(){},t.prototype.syncTouchBegin=function(e){},t.prototype.onTouchBegin=function(e,t,i,r,n){var a=this;a.hold||1==a.moveType||(a.isTouch=!0,a.touchDir=n,a.updatePos(e,t,i,r),a.startMove(1),a.updateSpdByDir(n))},t.prototype.syncTouchEnd=function(){},t.prototype.onTouchEnd=function(e,t,i,r){var n=this;n.hold||1!=n.moveType||(n.clearTouch(),n.stopMove(),n.updatePos(e,t,i,r))},t.prototype.syncTouchChange=function(e){},t.prototype.onTouchChange=function(e){var t=this;t.hold||1!=t.moveType||(t.touchDir=e,t.updateSpdByDir(e))},t.prototype.syncMoveToPos=function(e,t,i,r){},t.prototype.onMoveToPos=function(e,t,i,r){!this.hold&&this.ai.moveToPos(e,t)},t.prototype.synPos=function(e,t,i,r){},t.prototype.syncSeeOther=function(e){e!=this.seeOther&&this.hall.syncSeeOther(e)},t.prototype.syncName=function(e){this.hold&&this.name!=e&&this.hall.syncName(e)},t.prototype.onName=function(e){var t=this;t.name=e,t.agentInfo&&(t.agentInfo.name=e),t.guise&&t.guise.updateName()},t.prototype.syncFashionId=function(e){var t=this;t.hold&&!t.viewer&&t.fashionId!=e&&t.hall.syncFashionId(e)},t.prototype.onFashionId=function(e){this.guise&&this.guise.updateFashion()},t.prototype.syncTitleId=function(e){var t=this;t.hold&&!t.viewer&&t.titleId!=e&&t.hall.syncTitleId(e)},t.prototype.onTitleId=function(e){this.guise&&this.guise.updateTitle()},t.prototype.syncHaloId=function(e){var t=this;t.hold&&!t.viewer&&t.haloId!=e&&t.hall.syncHaloId(e)},t.prototype.onHaloId=function(e){this.guise&&this.guise.updateHalo()},t.prototype.syncWeaponId=function(e){var t=this;t.hold&&!t.viewer&&t.weaponId!=e&&t.hall.syncWeaponId(e)},t.prototype.onWeaponId=function(e){this.guise&&this.guise.updateWeapon()},t.prototype.syncWeaponRTimes=function(e){var t=this;t.hold&&!t.viewer&&t.weaponRTimes!=e&&t.hall.syncWeaponRTimes(e)},t.prototype.onWeaponRTimes=function(e){this.guise&&this.guise.updateWeaponEffect()},t.prototype.syncWeaFasId=function(e){var t=this;t.hold&&!t.viewer&&t.weaFasId!=e&&t.hall.syncWeaFasId(e)},t.prototype.onWeaFasId=function(e){this.guise&&this.guise.updateWeapon()},t.prototype.syncWingFasId=function(e){var t=this;t.hold&&!t.viewer&&t.wingFasId!=e&&t.hall.syncWingFasId(e)},t.prototype.onWingFasId=function(e){this.guise&&this.guise.updateWing()},t.prototype.syncFruitId=function(e){var t=this;t.hold&&!t.viewer&&t.fruitId!=e&&t.hall.syncFruitId(e)},t.prototype.onFruitId=function(e){e?this.createFruit():this.fruit&&this.fruit.receiveLeaveScene()},t.prototype.syncInvisibily=function(e){var t=this;t.invisibily!=e&&(t.invisibily=e,t.hall.syncInvisibily(e),t.stopMove(),e&&t.onPlayerInvisibily())},t.prototype.onInvisibily=function(e){var t=this;
t.hold&&(!t.invisibily&&t.onPlayerInvisibily(),App.dispatch("c123"))},t.prototype.onPlayerInvisibily=function(){var e=this,t=e.scene;t.guise&&(t.guise.visible=!e.invisibily),e.invisibily?PanelMgr.openPupup():t.initCamera()},t.prototype.synAgentPos=function(e,t,i,r){var n=this;n.active&&n.hall.synAgentPos(e,t,i,r),n.hold&&(n.updatePos(e,t,i,r),n.fruit&&n.fruit.updatePos(e,t,i,r),n.scene.initCamera())},t.prototype.onAgentPos=function(e,t,i,r){var n=this;n.hold||(n.updatePos(e,t,i,r),n.fruit&&n.fruit.updatePos(e,t,i,r))},t.prototype.onLocation=function(t,i,r,n){e.prototype.onLocation.call(this,t,i,r,n);var a=this;a.hold&&!a.invisibily&&a.scene&&a.scene.initCamera(),a.fruit&&a.fruit.updatePos(t,i,r,n)},t.prototype.onTapAgent=function(e){},t.prototype.reqCityConv=function(e,t){},t.prototype.onCityConv=function(e,t,i){var r=Data.getItem("CityConvData",t);if(r){var n=this,a=Data.getItem("CityConvData",t)||{},o="";if(e>0){var s=n.scene.getAgent(e)||{name:""};o=PHE.format(a.pText,{sendName:n.name,playerName:s.name})}else o=PHE.format(a.oText,{sendName:n.name});if(n.guise&&n.guise.showCityConvTalk(t,o),2==a.type)n.state.add(117,a.act);else{var l=Data.getSysValue("EMOTION_ID_CN")||{};o="["+(l[t]||t)+"]"+o}}},t.prototype.onAddFruit=function(e){this.fruiteid=e.$eid,this.fruit=e},t.prototype.onRemoveFruit=function(e){this.fruit==e&&(this.fruiteid=0,this.fruit=null)},t.prototype.onSynPos=function(t,i,r,n){e.prototype.onSynPos.call(this,t,i,r,n),this.fruit&&this.fruit.updatePos(t,i,r,n)},t.prototype.onDestroy=function(){var t=this;e.prototype.onDestroy.call(this),t.heroCfg=null,t.heroResCfg=null,t.ai=null,t.state=null,t.fruit=null},t}(Agent);__reflect(CityAgent.prototype,"CityAgent"),window.CityAgent=CityAgent;var Skill=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.onCreate=function(){var e=this;e.cds={},e.subTimes={},e.xuliTimes={},e.delayBullets={}},t.prototype.initSkills=function(e){var t=this,i=t.owner;t.clearSkills(),t.skills={};var r,n=i.heroCfg,a=i.heroId,o=n.normal;o&&(t.nskillId=o,t.addSkill(o,1,a));var s=n.dodge;s&&(t.dodgeSkillId=s,t.addSkill(s,1,a));var l=n.escape;l&&(t.escapeSkillId=l,t.addSkill(l,1,a));var u=n.prot;u&&(t.protSkillId=u,t.addSkill(u,0,a)),n.defaults&&n.defaults.forEach(function(e){t.addSkill(e,1,a)}),e.forEach(function(e){var i=t.addSkill(e.id,e.lv,a);i&&i.isEnter&&(r=e.id)}),r||(r=n.enter),r&&(t.enterSkillId=r,t.addSkill(r,1,a)),i.hold&&App.dispatch("c71",{owner:i})},t.prototype.addSkill=function(e,t,i){if(!Data.getItem("SkillData",e))return null;var r=this,n=r.skills[e];return n?n.skillLv=Math.max(n.skillLv,t):(n=ObjectPool.pop(BattleSkillInfo),n.setData(r.owner,e,t,i),r.skills[e]=n,n.hasSub&&n.cfg.sub.forEach(function(e){r.skills[e.skillId]=n})),n},t.prototype.startInitCd=function(){var e,t=this,i=t.skills;for(var r in i)e=i[r],e.cfg.pscd&&(t.cds[r]=Fixed.millisecond(e.cfg.pscd))},t.prototype.onEnterFrame=function(e){var t=this,i=t.owner;if(!i.scene.pauseTime){var r=t.cds,n=t.subTimes,a=t.xuliTimes,o=[],s=[];for(var l in r){var u=Number(l),c=Fixed.value(r[u]).sub(e).max(0).value;r[u]=c,0==c&&(o.push(u),s.push(u),delete r[u])}for(var u in n){var p=n[u],d=Fixed.value(p.time).sub(e).max(0).value;if(p.time=d,0==d){var f=t.skills[u];s.push(f.skillId),delete n[u],+u==t.nextSkillId&&(t.nextSkillId=0),f.clearSub(),t.startCD(f.skillId)}}for(var l in a){var u=Number(l),h=a[u],v=h.time,d=Fixed.value(h.time).add(e).min(h.maxTime).value,m=!1;h.time=d,v<h.xuliTime&&d>=h.xuliTime&&(m=!0,s.push(u)),i.hold&&i instanceof Avatar&&i.guise&&i.guise.updateXuliBar(h,m),d>=h.maxTime&&(s.push(u),t.stopXuli(u,!1))}s.length>0&&i.hold&&App.dispatch("c57",{skillIds:s,resetIds:o})}var y=t.delayBullets;for(var g in y){var b=y[g];b.delayFrame--,b.delayFrame<=0&&(delete y[g],t.onCreateBullet(b))}},t.prototype.canUse=function(e,t,i){void 0===t&&(t=!1),void 0===i&&(i=!1);var r=this,n=r.owner;if(n.isDead)return i&&Prompt.battleMsgId(2208),!1;var a=r.skills[e];if(!a)return!1;if(a.skillLv<=0)return i&&Prompt.battleMsgId(2001),!1;if(r.getCD(a.skillId)>0)return i&&!this.isNormal(e)&&Prompt.battleMsgId(2003),!1;if(!t){if(!n.state.canUseOther(e))return!1;if(3==a.type){if(n.state.limitMiss())return!1;if(n.state.limit(110))return!1}else if(2==a.type){if(n.state.limitEscape())return!1}else if(n.state.limit(110))return!1}return!0},t.prototype.canCombo=function(e){var t=this,i=t.owner;if(i.isDead)return!1;if(!t.curSkillInfo||!i.state.comboing(e))return!1;var r=t.skills[e];if(!r)return!1;if(i.state.canUseOther(e))return!1;if(e==r.skillId){if(r.skillLv<=0)return!1;if(t.getCD(r.skillId)>0)return!1;var n=r.cfg.utype;if(n&&i.props.gv(n)<r.mp)return!1}return!0},t.prototype.onUseTrapSkill=function(e){var t=this.owner;t.ai.stop(),t.state.remove(103,!1),t.state.interrupt(2),t.standLand(),t.ai.turnToTarget(t.ai.target),t.skill.onBeginSkill(e,!1,!1)},t.prototype.onTouchSkillBegin=function(e,t){},t.prototype.onTouchSkillEnd=function(e,t){},t.prototype.setComboSkill=function(e){var t=this,i=t.skills[e];if(t.canCombo(i.curSkillId)){t.nextSkillId=e}},t.prototype.onBeginSkill=function(e,i,r){var n=this,a=n.owner,o=a.curHeroCfg,s=o?o.id:0,l=n.skills[e];if(!l||l.heroId!=s)return void GameLog.warning("英雄 "+s+" 使用了不存在的技能id:"+e);var u=l.curSkillId,c=l.curSkillCfg,p=a instanceof Avatar&&t.skipCheck&&3==l.type;if(!n.canUse(u,p,r))return!1;if(a.moveType&&a.stopMove(),a.state.interrupt(2),a.stopInvisible(),n.curSkillInfo=l,n.curSkillId=u,n.curSkillCfg=c,a.buff.dealTrigBuff(18,0,null,a,!1,l.type),a.buff.dealTrigBuff(11,0,null,a,!1,l.skillId),a.buff.dealRmvBuff(3,null,a,l.type),a.buff.dealRmvBuff(1,null,a,l.skillId),e==u){var d=l.cfg,f=d.utype,h=l.mp;if(f&&h){var v=a.props.gv(f);a.props.setPropSlot(f,"BASE",Fixed.value(v).sub(h).value),a.agentInfo&&a.agentInfo.updateMpRate(a)}!l.isXuli&&!l.hasSub&&n.startCD(e)}l.hasSub&&(delete n.subTimes[e],l.isLast&&n.startCD(l.skillId)),l.isRelayXuli&&n.startXuli(l),c.hide&&(a.visible_ui=!1);var m=c.splash;m&&(a.hold||a instanceof Monster)&&a.scene.guise&&a.scene.guise.playSplashEffect(a.$eid,m),a.hold&&c.nameEff&&a.guise&&a.guise.addEffect(c.nameEff,0),n.onSkillBegin(l,i);var y=0;return!n.vampireRate||1!=l.type&&4!=l.type||(y=n.vampireRate,n.vampireRate=0),a.state.skill(l,u,y),a.scene.trigAI(7,a,u),!0},t.prototype.onSkillBegin=function(e,t){e.isNormal&&e.hasSub&&!e.isLast&&(this.nextSkillId=e.skillId)},t.prototype.onEndSkill=function(e,t,i,r,n){var a=this,o=a.curSkillInfo;if(o==e){var s=a.owner,l=e.skillId;a.curSkillInfo=null,a.curSkillId=0,a.curSkillCfg=null,a.owner.ai.hasSkillTrig=!1,i.spd&&s.updateSpecialSpd(0),i.hide&&(s.visible_ui=!s.heroCfg.hideUI),i.splash&&(s.hold||s instanceof Monster)&&s.scene.guise&&s.scene.guise.stopSplashEffect(s.$eid,i.splash);var u=r&&!n;if(u){a.nextSkillId=0,e.hasSub&&(a.startCD(l),delete a.subTimes[l],e.clearSub()),e.xuliing&&a.stopXuli(l,!0);var c=a.delayBullets;for(var p in c){var d=c[p];d.skillId==t&&d.breakDelay&&(delete c[p],d.dispose())}s.ai.onSkillInterrupt(),s.playSpineAction("idle",0),s.warn.clearSkillWarn(t),s.scene.clearSkillBullet(s,t)}else{var f=i.ebuff;f&&f.forEach(function(i){s.buff.addBuff(s,t,e.skillLv,i)}),s.scene.trigAI(8,s,t)}r?a.onBreakSkill(t):s.scene.stopSkillCamera(s,t),e.isEnter&&s.onEnterEffectEnd(),a.onSkillEnd(e,t,r,n),s.hold&&App.dispatch("c106",{caster:s,skillId:t})}},t.prototype.onBreakSkill=function(e){var t=this.owner;if(t.hold&&t instanceof Avatar){var i=Data.getSItem("SkillData",e);i&&i.bcamera&&t.scene.playCameraEffect(t,i.bcamera,0)}},t.prototype.startNextSubSkill=function(e,t){if(e.hasSub){var i=this,r=e.skillId,n=e.subTime;e.next(t),delete i.subTimes[r],n&&i.startSubTime(r,n),n||i.nextSkillId||i.owner.isPress&&e.isNormal||e.clearSub()}},t.prototype.onSkillEnd=function(e,t,i,r){var n=this,a=n.owner;a.buff.dealTrigBuff(19,0,null,a,!1,e.type),a.buff.dealTrigBuff(12,0,null,a,!1,e.skillId),a.buff.dealRmvBuff(4,null,a,e.type),a.buff.dealRmvBuff(2,null,a,e.skillId)},t.prototype.playComboSkill=function(){var e=this,t=e.nextSkillId;return t?(e.nextSkillId=0,e.onBeginSkill(t,!0,!1)):!1},t.prototype.stopXuli=function(e,t){var i=this,r=i.xuliTimes,n=i.skills[e];if(n.xuliing){if(!t){var a=r[e];i.owner.state.stopXuli(n.curSkillId,a.time)}n.xuliing=!1,i.owner.skill.startCD(e)}e in r&&delete r[e]},t.prototype.onTrigBullet=function(e){e.delayFrame<=0?this.onCreateBullet(e):this.delayBullets[IDUtils.genID("bulletDelayId")]=e},t.prototype.onCreateBullet=function(e){this.owner.scene.addCallLater(this.onDelayCreateBullet,this,1,!1,!0,e)},t.prototype.onDelayCreateBullet=function(e){var t,i=this;e.isvalid&&(!e.skipPos&&e.trigCfg.isDelayInit&&e.initBornPos(),t=RecordMgr.createGameEntity(i.owner.roomsn,i.owner.$channel,"Bullet",e.caster.hold,0,null,e),t.enterScene(e.caster.sceneeid,t.x,t.y,t.right))},t.prototype.startCD=function(e){var t=this,i=t.owner,r=t.skills[e],n=r.cd;if(n){var a=i.props.gv("cdDecPct");t.cds[e]=Fixed.value(1).sub(a).sub(i.getEquipProp(e,"cd")).mul(n).max(0).value,i.hold&&App.dispatch("c56",{skillId:e})}},t.prototype.changeCD=function(e){var t,i,r,n,a=this,o=a.cds,s=a.owner.props.gv("cdDecPct"),l=[],u=[];for(var c in o)i=Number(c),t=a.skills[i],n=t.cd,r=Fixed.value(s).sub(e).mul(n).value,r=Fixed.value(o[i]||0).sub(n).round().value,r=NumberUtils.limit(r,0,n),o[i]=r,l.push(i),0==r&&(u.push(i),delete o[i]);a.owner.hold&&App.dispatch("c57",{skillIds:l,resetIds:u})},t.prototype.startSubTime=function(e,t){t=Fixed.max(t,0),t&&(this.subTimes[e]={subTime:t,time:Fixed.max(t,0)},this.owner.hold&&App.dispatch("c56",{skillId:e}))},t.prototype.startXuli=function(e){var t=e.curSkillCfg.cv||[],i=Fixed.millisecond(t[0]),r=Fixed.millisecond(t[1]);i&&r&&(e.xuliing=!0,this.xuliTimes[e.skillId]={xuliTime:i,maxTime:r,time:0},this.owner.hold&&App.dispatch("c56",{skillId:e.skillId}))},t.prototype.getCD=function(e){return this.cds[e]||0},t.prototype.getSubTime=function(e){return this.subTimes[e]},t.prototype.getXuliTime=function(e){return this.xuliTimes[e]},t.prototype.getSkillInfo=function(e){return this.skills[e]},t.prototype.isNormal=function(e){var t=this.skills[e];return t&&t.isNormal},t.prototype.isDodge=function(e){var t=this.skills[e];return t&&t.isDodge},t.prototype.isEnter=function(e){var t=this.skills[e];return t&&t.isEnter},t.prototype.clearSkillCd=function(e){var t=this.skills[e];t&&e in this.cds&&(delete this.cds[e],this.owner.hold&&App.dispatch("c57",{skillIds:[e],resetIds:[e]}))},t.prototype.getRandomInCdSkill=function(e){var t=ObjectUtils.getKeys(this.cds);if(e){var i,r=this.skills;t=t.filter(function(e){return i=r[e],!i.isSpecial})}var n=t.length;return n>0?+Fixed.randGet(t,this.owner.scene.seedr)||0:0},t.prototype.getRandomInCdSpeSkill=function(){var e,t=ObjectUtils.getKeys(this.cds),i=this.skills;t=t.filter(function(t){return e=i[t],e.isSpecial});var r=t.length;return r>0?+Fixed.randGet(t,this.owner.scene.seedr)||0:0},t.prototype.clearAll=function(){var e=this,t=e.owner;e.clearAllDelayBullet(),t&&t.scene&&t.scene.removeCallLater(e),e.cds={},e.subTimes={},e.xuliTimes={}},t.prototype.clearPortalDelayBullet=function(){var e=this.delayBullets;if(e){var t=void 0;for(var i in e)t=e[i],t&&t.trigCfg&&!t.trigCfg.dhold&&t.dispose()}},t.prototype.clearAllDelayBullet=function(){var e=this.delayBullets;if(e)for(var t in e)e[t].dispose();this.delayBullets={}},t.prototype.clearBulletByTrigId=function(e){var t=this.delayBullets;if(t){var i=void 0;for(var r in t)i=t[r],i.trigId==e&&i.dispose(),delete t[r]}},t.prototype.clearSkills=function(){var e=this;e.curSkillInfo=null,e.curSkillId=0,e.curSkillCfg=null,e.vampireRate=0;var t=e.skills;if(t){for(var i in t){var r=t[i];r.dispose()}e.skills=null}},t.prototype.onDestroy=function(){var e=this;e.clearSkills(),e.clearAllDelayBullet(),e.cds=null,e.subTimes=null,e.xuliTimes=null,e.nskillId=0,e.enterSkillId=0,e.dodgeSkillId=0,e.escapeSkillId=0,e.nextSkillId=0,ObjectPool.push(e)},t.skipCheck=!1,t}(GameCom);__reflect(Skill.prototype,"Skill"),window.Skill=Skill;var AgentState=function(){function e(){}return e.prototype.initialize=function(e,t,i,r){void 0===r&&(r=null);var n=this;if(n.isvalid=!0,n.com=e,n.owner=e.owner,n.cfg=i,n.state=t,n.count=0,i.action){var a=n.action=ObjectPool.pop(AgentAction);a.initialize(n,i.action,1==i.play)}},e.prototype.add=function(){var e=this;e.count=e.cfg["super"]?1:e.count+1,e.action&&e.action.play(),e.onAdd()},e.prototype.onAdd=function(){},e.prototype.remove=function(){var e=this;e.count=Math.max(e.count-1,0),0==e.count&&e.onRemove()},e.prototype.onRemove=function(){},e.prototype.destroy=function(){var e=this;e.isvalid&&(e.isvalid=!1,e.onDestroy(),e.action&&e.action.destroy(),e.action=null,e.owner=null,e.com=null,e.state=0,e.count=0,e.cfg=null,ObjectPool.push(e))},e.prototype.onActionEnd=function(){},e.prototype.onDestroy=function(){},e}();__reflect(AgentState.prototype,"AgentState"),window.AgentState=AgentState;var BaseState=function(){function e(){}return e.prototype.initialize=function(e,t,i){var r=this;r.isvalid=!0,r.com=e,r.owner=e.owner,r.state=t,r.cfg=i,r.count=0,r.lctime=0},e.prototype.createAction=function(e,t,i,r){void 0===e&&(e=!1),void 0===t&&(t=null),void 0===i&&(i=null),void 0===r&&(r=0/0);var n=this;n.clearAction(),n.cfg.action&&(n.action=ObjectPool.pop(NormalAction),n.action.initialize(n),n.action instanceof NormalAction&&n.action.setActionInfo(t,r))},e.prototype.add=function(){var e=this;e.count=e.cfg["super"]?1:e.count+1,e.addTime=e.owner.scene.lastTime;e.onAdd(),e.action&&e.action.play()},e.prototype.onAdd=function(){},e.prototype.remove=function(){var e=this;e.count=Math.max(e.count-1,0)},e.prototype.onRemove=function(){},e.prototype.onEnterFrame=function(e){this.action&&this.action.onEnterFrame(e)},e.prototype.onActionEnd=function(){this.com.remove(this.state)},e.prototype.clearAction=function(){this.action&&(this.action.destroy(),this.action=null)},e.prototype.destroy=function(){var e=this;e.isvalid&&(e.isvalid=!1,e.onDestroy(),e.owner=null,e.com=null,e.state=0,e.count=0,e.addTime=0,e.lctime=0,e.cfg=null,e.clearAction(),ObjectPool.push(e))},e.prototype.onDestroy=function(){},e}();__reflect(BaseState.prototype,"BaseState"),window.BaseState=BaseState;var Formula;!function(e){e.AttData=[{id:1},{id:2},{id:3},{id:4},{id:5},{id:6},{id:1e3,exprts:function(e){return e.gv("maxHpBase")*(1+e.gv("maxHpPct"))},exprd:function(e){var t=e.gv("maxHpBase"),i=e.gv("maxHpPct"),r=Fixed.value(t).value;return Fixed.value(1).add(i).mul(r).value}},{id:1001},{id:1002},{id:1100,exprts:function(e){return e.gv("atkBase")*(1+e.gv("atkPct"))},exprd:function(e){var t=e.gv("atkBase"),i=e.gv("atkPct"),r=Fixed.value(t).value;return Fixed.value(1).add(i).mul(r).value}},{id:1101},{id:1102},{id:1200,exprts:function(e){return e.gv("defBase")*(1+e.gv("defPct"))},exprd:function(e){var t=e.gv("defBase"),i=e.gv("defPct"),r=Fixed.value(t).value;return Fixed.value(1).add(i).mul(r).value}},{id:1201},{id:1202},{id:1300},{id:1400},{id:1500,exprts:function(e){return e.gv("spdBase")*(1+e.gv("spdPct"))},exprd:function(e){var t=e.gv("spdBase"),i=e.gv("spdInc");return Fixed.value(1).add(i).mul(t).value}},{id:1501},{id:1502},{id:1600},{id:1700}]}(Formula||(Formula={}));var Formula;!function(e){e.FormulaData=[{id:1,exprts:function(e){var t=[229,229,229,229,229,229,229,229,229,229,229,229,229,229,229,229,229,229,229,229,229,940,976,1015,1058,1098,1138,1176,1217,1257,1299,1337,1378,1418,1457,1499,1537,1577,1617,1656,1698,1739,1780,1819,1858,1897,1937,1977,2017,2058,2099,2138,2177,2218,2257,2299,2339,2378,2419,2458];return 180*t[e-1]}},{id:2,exprts:function(e,t){var i=[45,56,67,78,90,101,112,123,135,146,157,168,180,191,202,213,225,236,247,258,270,528,551,573,596,618,641,663,686,708,731,753,776,798,821,843,866,888,911,933,956,978,1001,1023,1046,1068,1091,1113,1136,1158,1181,1203,1226,1248,1271,1293,1316,1338,1361,1383];return 50*i[e-1]*t}},{id:3,exprts:function(e){return(e-1)%4+1}},{id:4,exprts:function(e){return(e-1)%3+1}},{id:5,exprts:function(e){return(e-1)%4+1}},{id:10,exprts:function(e,t,i,r,n,a){var o=e(r,i);return 0!==o?o:(o=e(n,i),0!==o?o:(o=e(a,i),0!==o?o:0))}},{id:1101,exprts:function(e){return 100*e}},{id:1102,exprts:function(e){return 3==e?1e3:4==e?2e3:5==e?3e3:6==e?4e3:7==e?5e3:void 0}},{id:1103,exprts:function(e){return 100*e}},{id:1104,exprts:function(e){return e}},{id:1105,exprts:function(e){return 1}},{id:1111,exprts:function(e,t){return 1e4}},{id:1112,exprts:function(e,t){return 1e4}},{id:1113,exprts:function(e,t){return 1e4}},{id:2e3,exprts:function(e){var t=[-1.33,-1.33,-1.33,-1.33,-1.33,-1.33,-1.33,-1.33,-1.33,-1.33,-1.33,-1.33,-1.33,-1.33,-1.33,-1.33,-1.33,-1.33,-1.33,-1.33,-1.33,-1.33,-1.33,-1.33,-1.33,-1.33,-1.33,-1.33,-1.33,-1.33,-1.29,-1.29,-1.29,-1.28,-1.28,-1.28,-1.28,-1.28,-1.28,-1.28,-1.28,-1.28,-1.28,-1.28,-1.28,-1.27,-1.26,-1.25,-1.24,-1.23,-1.23,-1.23,-1.23,-1.23,-1.23,-1.23,-1.23,-1.23,-1.23,-1.23,-1.23,-1.13,-1.03,-.93,-.83,-.33,.67,1.67,2.67,3.67,5.67,8.67,11.67,14.67,17.67,21.67,26.67,34.67,50.67,98.67];return t[e]}},{id:2001,exprts:function(e){var t=[-1.8,-1.8,-1.8,-1.8,-1.8,-1.8,-1.8,-1.8,-1.8,-1.8,-1.8,-1.8,-1.8,-1.8,-1.8,-1.8,-1.65,-1.5,-1.5,-1.5,-.5,-.5,-.5,-.5,-.5,-.5,-.5,-.5,-.5,-.5,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,3,3,3,3,3,3,3,3,3,3,3,3,3,4,5,6,7,8,9,10,11,12,13,18,23,28,38,58,98];return t[e]}},{id:2200,exprts:function(e){return 1e4}},{id:2201,exprts:function(e){return 3e3==e?0:e%30?0:76579}},{id:2202,exprts:function(e){return 3e3==e?0:e%30?0:20421}},{id:2203,exprts:function(e){return 3e3==e?0:e%30?75314:2259}},{id:2204,exprts:function(e){return 3e3==e?0:e%30?20084:603}},{id:2205,exprts:function(e){return 3e3==e?0:e%30?4017:121}},{id:2206,exprts:function(e){return 3e3==e?1e5:e%30?585:18}},{id:4001,exprts:function(e,t,i){var r=[0,6,16,26,36,46];return(t+5)*(e?3:2)+r[Math.min(i,5)]}},{id:4002,exprts:function(e,t,i){var r=[0,6,16,26,36,46];return e?44:20+r[Math.min(i,5)]}},{id:5e3,exprts:function(e){return 10>=e?e:20>=e?15:30>=e?20:25}},{id:6101,exprts:function(e){return 13e3*e}},{id:6102,exprts:function(e){return Math.floor(e/13e3)-2}},{id:6103,exprts:function(e){return 2600*e}},{id:6104,exprts:function(e,t){return Math.min(e+10,70)},exprd:function(e,t){return Fixed.value(e).add(10).min(70).value}},{id:6105,exprts:function(e,t){return 0==t?2031*e:100==t?6094*e:24375*e*Math.min(1+e/1e3,4)},exprd:function(e,t){if(0==t)return Fixed.value(e).mul(2031).value;if(100==t)return Fixed.value(e).mul(6094).value;var i=Fixed.value(e).div(1e3).add(1).min(4).value;return Fixed.value(e).mul(24375).mul(i).value}},{id:6106,exprts:function(e,t){return 0==t?130*e:100==t?163*e:325*e},exprd:function(e,t){return 0==t?Fixed.value(e).mul(130).value:100==t?Fixed.value(e).mul(163).value:Fixed.value(e).mul(325).value}},{id:6107,exprts:function(e,t){return 0==t?130*e:100==t?130*e:130*e},exprd:function(e,t){return 0==t?Fixed.value(e).mul(130).value:100==t?Fixed.value(e).mul(130).value:Fixed.value(e).mul(130).value}},{id:6108,exprts:function(e,t){return 0==t?0:100==t?.025:.05},exprd:function(e,t){return 0==t?0:100==t?.025:.05}},{id:6109,exprts:function(e,t){return 0==t?0:100==t?.025:.05},exprd:function(e,t){return 0==t?0:100==t?.025:.05}},{id:6110,exprts:function(e,t){return 0==t?0:100==t?.01:.02},exprd:function(e,t){return 0==t?0:100==t?.01:.02}},{id:6111,exprts:function(e,t){return 0==t?0:100==t?.01:.02},exprd:function(e,t){return 0==t?0:100==t?.01:.02}},{id:6112,exprts:function(e,t){return 0},exprd:function(e,t){return 0}},{id:6113,exprts:function(e,t){return 0==t?0:100==t?.5:.85},exprd:function(e,t){return 0==t?0:100==t?.5:.85}},{id:6114,exprts:function(e,t){return 0},exprd:function(e,t){return 0}},{id:6201,exprts:function(e){return 4500*e}},{id:6202,exprts:function(e){return Math.floor(e/4500)-2}},{id:6203,exprts:function(e){return 900*e}},{id:6204,exprts:function(e,t){return Math.min(e+10,70)},exprd:function(e,t){return Fixed.value(e).add(10).min(70).value}},{id:6205,exprts:function(e,t){return 0==t?1313*e:100==t?3938*e:15750*e},exprd:function(e,t){return 0==t?Fixed.value(e).mul(1313).value:100==t?Fixed.value(e).mul(3938).value:Fixed.value(e).mul(15750).value}},{id:6206,exprts:function(e,t){return 0==t?84*e:100==t?105*e:210*e},exprd:function(e,t){return 0==t?Fixed.value(e).mul(84).value:100==t?Fixed.value(e).mul(105).value:Fixed.value(e).mul(210).value}},{id:6207,exprts:function(e,t){return 0==t?84*e:100==t?84*e:84*e},exprd:function(e,t){return 0==t?Fixed.value(e).mul(84).value:100==t?Fixed.value(e).mul(84).value:Fixed.value(e).mul(84).value}},{id:6208,exprts:function(e,t){return 0==t?0:100==t?.025:.05},exprd:function(e,t){return 0==t?0:100==t?.025:.05}},{id:6209,exprts:function(e,t){return 0==t?0:100==t?.025:.05},exprd:function(e,t){return 0==t?0:100==t?.025:.05}},{id:6210,exprts:function(e,t){return 0==t?0:100==t?.01:.02},exprd:function(e,t){return 0==t?0:100==t?.01:.02}},{id:6211,exprts:function(e,t){return 0==t?0:100==t?.01:.02},exprd:function(e,t){return 0==t?0:100==t?.01:.02}},{id:6212,exprts:function(e,t){return 0},exprd:function(e,t){return 0}},{id:6213,exprts:function(e,t){return 0==t?0:100==t?.5:.85},exprd:function(e,t){return 0==t?0:100==t?.5:.85}},{id:6214,exprts:function(e,t){return 0},exprd:function(e,t){return 0}},{id:6301,exprts:function(e){return 2230*e}},{id:6302,exprts:function(e){return Math.floor(e/2230)-2}},{id:6303,exprts:function(e){return 446*e}},{id:6304,exprts:function(e,t){return Math.min(e+10,70)},exprd:function(e,t){return Fixed.value(e).add(10).min(70).value}},{id:6305,exprts:function(e,t){return 0==t?383*e:100==t?1150*e:4599*e*Math.min(1+e/1e3,4)},exprd:function(e,t){if(0==t)return Fixed.value(e).mul(383).value;if(100==t)return Fixed.value(e).mul(1150).value;var i=Fixed.value(e).div(1e3).add(1).min(4).value;return Fixed.value(e).mul(4599).mul(i).value}},{id:6306,exprts:function(e,t){return 0==t?25*e:100==t?31*e:61*e},exprd:function(e,t){return 0==t?Fixed.value(e).mul(25).value:100==t?Fixed.value(e).mul(31).value:Fixed.value(e).mul(61).value}},{id:6307,exprts:function(e,t){return 0==t?25*e:100==t?25*e:25*e},exprd:function(e,t){return 0==t?Fixed.value(e).mul(25).value:100==t?Fixed.value(e).mul(25).value:Fixed.value(e).mul(25).value}},{id:6308,exprts:function(e,t){return 0==t?0:100==t?.025:.05},exprd:function(e,t){return 0==t?0:100==t?.025:.05}},{id:6309,exprts:function(e,t){return 0==t?0:100==t?.025:.05},exprd:function(e,t){return 0==t?0:100==t?.025:.05}},{id:6310,exprts:function(e,t){return 0==t?0:100==t?.01:.02},exprd:function(e,t){return 0==t?0:100==t?.01:.02}},{id:6311,exprts:function(e,t){return 0==t?0:100==t?.01:.02},exprd:function(e,t){return 0==t?0:100==t?.01:.02}},{id:6312,exprts:function(e,t){return 0},exprd:function(e,t){return 0}},{id:6313,exprts:function(e,t){return 0==t?0:100==t?.5:.85},exprd:function(e,t){return 0==t?0:100==t?.5:.85}},{id:6314,exprts:function(e,t){return 0},exprd:function(e,t){return 0}},{id:6401,exprts:function(e){return 4270*e}},{id:6402,exprts:function(e){return Math.floor(e/4270)-2}},{id:6403,exprts:function(e){return 854*e}},{id:6404,exprts:function(e,t){return Math.min(e+10,70)},exprd:function(e,t){return Fixed.value(e).add(10).min(70).value}},{id:6405,exprts:function(e,t){return 0==t?694*e:100==t?2082*e:8327*e*Math.min(1+e/1e3,4)},exprd:function(e,t){if(0==t)return Fixed.value(e).mul(694).value;if(100==t)return Fixed.value(e).mul(2082).value;var i=Fixed.value(e).div(1e3).add(1).min(4).value;return Fixed.value(e).mul(8327).mul(i).value}},{id:6406,exprts:function(e,t){return 0==t?44*e:100==t?56*e:111*e},exprd:function(e,t){return 0==t?Fixed.value(e).mul(44).value:100==t?Fixed.value(e).mul(56).value:Fixed.value(e).mul(111).value}},{id:6407,exprts:function(e,t){return 0==t?44*e:100==t?44*e:44*e},exprd:function(e,t){return 0==t?Fixed.value(e).mul(44).value:100==t?Fixed.value(e).mul(44).value:Fixed.value(e).mul(44).value}},{id:6408,exprts:function(e,t){return 0==t?0:100==t?.025:.05},exprd:function(e,t){return 0==t?0:100==t?.025:.05}},{id:6409,exprts:function(e,t){return 0==t?0:100==t?.025:.05},exprd:function(e,t){return 0==t?0:100==t?.025:.05}},{id:6410,exprts:function(e,t){return 0==t?0:100==t?.01:.02},exprd:function(e,t){return 0==t?0:100==t?.01:.02}},{id:6411,exprts:function(e,t){return 0==t?0:100==t?.01:.02},exprd:function(e,t){return 0==t?0:100==t?.01:.02}},{id:6412,exprts:function(e,t){return 0},exprd:function(e,t){return 0}},{id:6413,exprts:function(e,t){return 0==t?0:100==t?.5:.85},exprd:function(e,t){return 0==t?0:100==t?.5:.85}},{id:6414,exprts:function(e,t){return 0},exprd:function(e,t){return 0}},{id:6501,exprts:function(e){return 6510*e}},{id:6502,exprts:function(e){return Math.floor(e/6510)-2}},{id:6503,exprts:function(e){return 1302*e}},{id:6504,exprts:function(e,t){return Math.min(e+10,70)},exprd:function(e,t){return Fixed.value(e).add(10).min(70).value}},{id:6505,exprts:function(e,t){return 0==t?1088*e:100==t?3265*e:13061*e*Math.min(1+e/1e3,4)},exprd:function(e,t){if(0==t)return Fixed.value(e).mul(1088).value;if(100==t)return Fixed.value(e).mul(3265).value;var i=Fixed.value(e).div(1e3).add(1).min(4).value;return Fixed.value(e).mul(13061).mul(i).value}},{id:6506,exprts:function(e,t){return 0==t?70*e:100==t?87*e:174*e},exprd:function(e,t){return 0==t?Fixed.value(e).mul(70).value:100==t?Fixed.value(e).mul(87).value:Fixed.value(e).mul(174).value}},{id:6507,exprts:function(e,t){return 0==t?70*e:100==t?70*e:70*e},exprd:function(e,t){return 0==t?Fixed.value(e).mul(70).value:100==t?Fixed.value(e).mul(70).value:Fixed.value(e).mul(70).value}},{id:6508,exprts:function(e,t){return 0==t?0:100==t?.025:.05},exprd:function(e,t){return 0==t?0:100==t?.025:.05}},{id:6509,exprts:function(e,t){return 0==t?0:100==t?.025:.05},exprd:function(e,t){return 0==t?0:100==t?.025:.05}},{id:6510,exprts:function(e,t){return 0==t?0:100==t?.01:.02},exprd:function(e,t){return 0==t?0:100==t?.01:.02}},{id:6511,exprts:function(e,t){return 0==t?0:100==t?.01:.02},exprd:function(e,t){return 0==t?0:100==t?.01:.02}},{id:6512,exprts:function(e,t){return 0},exprd:function(e,t){return 0}},{id:6513,exprts:function(e,t){return 0==t?0:100==t?.5:.85},exprd:function(e,t){return 0==t?0:100==t?.5:.85}},{id:6514,exprts:function(e,t){return 0},exprd:function(e,t){return 0}},{id:6601,exprts:function(e){return 660*e}},{id:6602,exprts:function(e){return Math.floor(e/660)-2}},{id:6603,exprts:function(e){return 132*e}},{id:6604,exprts:function(e,t){return Math.min(e+10,70)},exprd:function(e,t){return Fixed.value(e).add(10).min(70).value}},{id:6605,exprts:function(e,t){return 0==t?124*e:100==t?371*e:1485*e*Math.min(1+e/1e3,4)},exprd:function(e,t){if(0==t)return Fixed.value(e).mul(124).value;if(100==t)return Fixed.value(e).mul(371).value;var i=Fixed.value(e).div(1e3).add(1).min(4).value;return Fixed.value(e).mul(1485).mul(i).value}},{id:6606,exprts:function(e,t){return 0==t?8*e:100==t?10*e:20*e},exprd:function(e,t){return 0==t?Fixed.value(e).mul(8).value:100==t?Fixed.value(e).mul(10).value:Fixed.value(e).mul(20).value}},{id:6607,exprts:function(e,t){return 0==t?8*e:100==t?8*e:8*e},exprd:function(e,t){return 0==t?Fixed.value(e).mul(8).value:100==t?Fixed.value(e).mul(8).value:Fixed.value(e).mul(8).value}},{id:6608,exprts:function(e,t){return 0==t?0:100==t?.025:.05},exprd:function(e,t){return 0==t?0:100==t?.025:.05}},{id:6609,exprts:function(e,t){return 0==t?0:100==t?.025:.05},exprd:function(e,t){return 0==t?0:100==t?.025:.05}},{id:6610,exprts:function(e,t){return 0==t?0:100==t?.01:.02},exprd:function(e,t){return 0==t?0:100==t?.01:.02}},{id:6611,exprts:function(e,t){return 0==t?0:100==t?.01:.02},exprd:function(e,t){return 0==t?0:100==t?.01:.02}},{id:6612,exprts:function(e,t){return 0},exprd:function(e,t){return 0}},{id:6613,exprts:function(e,t){return 0==t?0:100==t?.5:.85},exprd:function(e,t){return 0==t?0:100==t?.5:.85}},{id:6614,exprts:function(e,t){return 0},exprd:function(e,t){return 0}},{id:7103,exprts:function(e){return.2*e},exprd:function(e){return Fixed.value(e).mul(.2).value}},{id:7104,exprts:function(e){return Math.min(Math.floor(e/1e5)+30,70)},exprd:function(e){return Fixed.value(e).div(1e5).floor().add(30).min(70).value}},{id:7105,exprts:function(e){return 1.875*e*Math.min(1+e/75e5,4)},exprd:function(e){var t=Fixed.value(e).div(75e5).add(1).min(4).value;return Fixed.value(e).mul(1.875).mul(t).value}},{id:7106,exprts:function(e){return.025*e},exprd:function(e){return Fixed.value(e).mul(.025).value}},{id:7107,exprts:function(e){return.01*e},exprd:function(e){return Fixed.value(e).mul(.01).value}},{id:7108,exprts:function(e){return.05},exprd:function(e){return.05}},{id:7109,exprts:function(e){return.05},exprd:function(e){return.05}},{id:7110,exprts:function(e){return.1},exprd:function(e){return.1}},{id:7111,exprts:function(e){return.02},exprd:function(e){return.02}},{id:7112,exprts:function(e){return 0},exprd:function(e){return 0}},{id:7113,exprts:function(e){return.85},exprd:function(e){return.85}},{id:7114,exprts:function(e){return 0},exprd:function(e){return 0}},{id:7204,exprts:function(e){return Math.min(Math.floor(e/1e5)+30,70)},exprd:function(e){return Fixed.value(e).div(1e5).floor().add(30).min(70).value}},{id:7205,exprts:function(e){return 1*e*Math.min(1+e/75e5,4)},exprd:function(e){var t=Fixed.value(e).div(75e5).add(1).min(4).value;return Fixed.value(e).mul(1).mul(t).value}},{id:7206,exprts:function(e){return.025*e},exprd:function(e){return Fixed.value(e).mul(.025).value}},{id:7207,exprts:function(e){return.01*e},exprd:function(e){return Fixed.value(e).mul(.01).value}},{id:7208,exprts:function(e){return.05},exprd:function(e){return.05}},{id:7209,exprts:function(e){return.05},exprd:function(e){return.05}},{id:7210,exprts:function(e){return.1},exprd:function(e){return.1}},{id:7211,exprts:function(e){return.02},exprd:function(e){return.02}},{id:7212,exprts:function(e){return 0},exprd:function(e){return 0}},{id:7213,exprts:function(e){return.85},exprd:function(e){return.85}},{id:7214,exprts:function(e){return 0},exprd:function(e){return 0}},{id:8001,exprts:function(e,t,i){return e*(1+t*(i-1)/100)},exprd:function(e,t,i){return Fixed.value(i).sub(1).mul(t).div(100).add(1).mul(e).value}},{id:8004,exprts:function(e){return Math.min(Math.floor(e/1e5)+30,70)},exprd:function(e){return Fixed.value(e).div(1e5).floor().add(30).min(70).value}},{id:8005,exprts:function(e){return 4.2188*e*Math.min(1+e/75e5,4)},exprd:function(e){var t=Fixed.value(e).div(75e5).add(1).min(4).value;return Fixed.value(e).mul(4.2188).mul(t).value}},{id:8006,exprts:function(e){return.0313*e},exprd:function(e){return Fixed.value(e).mul(.0313).value}},{id:8007,exprts:function(e){return.01*e},exprd:function(e){return Fixed.value(e).mul(.01).value}},{id:8008,exprts:function(e){return.05},exprd:function(e){return.05}},{id:8009,exprts:function(e){return.05},exprd:function(e){return.05}},{id:8010,exprts:function(e){return.1},exprd:function(e){return.1}},{id:8011,exprts:function(e){return.05},exprd:function(e){return.05}},{id:8012,exprts:function(e){return 0},exprd:function(e){return 0}},{id:8013,exprts:function(e){return.85},exprd:function(e){return.85}},{id:8014,exprts:function(e){return 0},exprd:function(e){return 0}},{id:8104,exprts:function(e){return Math.min(Math.floor(e/1e5)+30,70)},exprd:function(e){return Fixed.value(e).div(1e5).floor().add(30).min(70).value}},{id:8105,exprts:function(e){return 5.625*e*Math.min(1+e/75e5,4)},exprd:function(e){var t=Fixed.value(e).div(75e5).add(1).min(4).value;return Fixed.value(e).mul(5.625).mul(t).value}},{id:8106,exprts:function(e){return.01*e},exprd:function(e){return Fixed.value(e).mul(.01).value}},{id:8107,exprts:function(e){return.01*e},exprd:function(e){return Fixed.value(e).mul(.01).value}},{id:8108,exprts:function(e){return.05},exprd:function(e){return.05}},{id:8109,exprts:function(e){return.05},exprd:function(e){return.05}},{id:8110,exprts:function(e){return.1},exprd:function(e){return.1}},{id:8111,exprts:function(e){return.05},exprd:function(e){return.05}},{id:8112,exprts:function(e){return 0},exprd:function(e){return 0}},{id:8113,exprts:function(e){return.85},exprd:function(e){return.85}},{id:8114,exprts:function(e){return 0},exprd:function(e){return 0}},{id:9004,exprts:function(e,t){return 70},exprd:function(e,t){return 70
}},{id:9005,exprts:function(e,t){return 0==t?.0688*e:100==t?.2063*e:.825*e*Math.min(1+e/75e5,4)},exprd:function(e,t){if(0==t)return Fixed.value(e).mul(.0688).value;if(100==t)return Fixed.value(e).mul(.2063).value;var i=Fixed.value(e).div(75e5).add(1).min(4).value;return Fixed.value(e).mul(.825).mul(i).value}},{id:9006,exprts:function(e,t){return 0==t?.0092*e:100==t?.011*e:.0183*e},exprd:function(e,t){return 0==t?Fixed.value(e).mul(.0092).value:100==t?Fixed.value(e).mul(.011).value:Fixed.value(e).mul(.0183).value}},{id:9007,exprts:function(e,t){return 0==t?.011*e:100==t?.011*e:.011*e},exprd:function(e,t){return 0==t?Fixed.value(e).mul(.011).value:100==t?Fixed.value(e).mul(.011).value:Fixed.value(e).mul(.011).value}},{id:9008,exprts:function(e,t){return 0==t?0:100==t?.025:.05},exprd:function(e,t){return 0==t?0:100==t?.025:.05}},{id:9009,exprts:function(e,t){return 0==t?0:100==t?.05:.1},exprd:function(e,t){return 0==t?0:100==t?.05:.1}},{id:9010,exprts:function(e,t){return.1},exprd:function(e,t){return.1}},{id:9011,exprts:function(e,t){return 0==t?0:100==t?.02:.05},exprd:function(e,t){return 0==t?0:100==t?.02:.05}},{id:9012,exprts:function(e,t){return 0},exprd:function(e,t){return 0}},{id:9013,exprts:function(e,t){return 0==t?0:100==t?.5:.85},exprd:function(e,t){return 0==t?0:100==t?.5:.85}},{id:9014,exprts:function(e,t){return 0},exprd:function(e,t){return 0}},{id:9104,exprts:function(e,t){return Math.min(Math.floor(e/1e5)+30,70)},exprd:function(e,t){return Fixed.value(e).div(1e5).floor().add(30).min(70).value}},{id:9105,exprts:function(e,t){return 4.2188*e*Math.min(1+e/75e5,4)},exprd:function(e,t){var i=Fixed.value(e).div(75e5).add(1).min(4).value;return Fixed.value(e).mul(4.2188).mul(i).value}},{id:9106,exprts:function(e,t){return.0313*e},exprd:function(e,t){return Fixed.value(e).mul(.0313).value}},{id:9107,exprts:function(e,t){return.01*e},exprd:function(e,t){return Fixed.value(e).mul(.01).value}},{id:9108,exprts:function(e,t){return.05},exprd:function(e,t){return.05}},{id:9109,exprts:function(e,t){return.1},exprd:function(e,t){return.1}},{id:9110,exprts:function(e,t){return.1},exprd:function(e,t){return.1}},{id:9111,exprts:function(e,t){return.05},exprd:function(e,t){return.05}},{id:9112,exprts:function(e,t){return 0},exprd:function(e,t){return 0}},{id:9113,exprts:function(e,t){return.85},exprd:function(e,t){return.85}},{id:9114,exprts:function(e,t){return 0},exprd:function(e,t){return 0}},{id:9204,exprts:function(e,t){return Math.min(Math.floor(e/1e5)+30,70)},exprd:function(e,t){return Fixed.value(e).div(1e5).floor().add(30).min(70).value}},{id:9205,exprts:function(e,t){return 5.625*e*Math.min(1+e/75e5,4)},exprd:function(e,t){var i=Fixed.value(e).div(75e5).add(1).min(4).value;return Fixed.value(e).mul(5.625).mul(i).value}},{id:9206,exprts:function(e,t){return.01*e},exprd:function(e,t){return Fixed.value(e).mul(.01).value}},{id:9207,exprts:function(e,t){return.01*e},exprd:function(e,t){return Fixed.value(e).mul(.01).value}},{id:9208,exprts:function(e,t){return.05},exprd:function(e,t){return.05}},{id:9209,exprts:function(e,t){return.1},exprd:function(e,t){return.1}},{id:9210,exprts:function(e,t){return.1},exprd:function(e,t){return.1}},{id:9211,exprts:function(e,t){return.05},exprd:function(e,t){return.05}},{id:9212,exprts:function(e,t){return 0},exprd:function(e,t){return 0}},{id:9213,exprts:function(e,t){return.85},exprd:function(e,t){return.85}},{id:9214,exprts:function(e,t){return 0},exprd:function(e,t){return 0}},{id:11011,exprts:function(e,t){return 80*e/1e3}},{id:11012,exprts:function(e,t){return 80*e/1e3}},{id:11013,exprts:function(e,t){return 80*e/1e3}},{id:11014,exprts:function(e,t){return 80*e/1e3}},{id:11015,exprts:function(e,t){return 10195*e/1e3}},{id:11016,exprts:function(e,t){return 510*e/1e3}},{id:11017,exprts:function(e,t){return 510*e/1e3}},{id:11021,exprts:function(e,t){return 80*e/1e3}},{id:11022,exprts:function(e,t){return 80*e/1e3}},{id:11023,exprts:function(e,t){return 80*e/1e3}},{id:11024,exprts:function(e,t){return 80*e/1e3}},{id:11025,exprts:function(e,t){return 10195*e/1e3}},{id:11026,exprts:function(e,t){return 510*e/1e3}},{id:11027,exprts:function(e,t){return 510*e/1e3}},{id:11031,exprts:function(e,t){return 80*e/1e3}},{id:11032,exprts:function(e,t){return 80*e/1e3}},{id:11033,exprts:function(e,t){return 80*e/1e3}},{id:11034,exprts:function(e,t){return 80*e/1e3}},{id:11035,exprts:function(e,t){return 10195*e/1e3}},{id:11036,exprts:function(e,t){return 510*e/1e3}},{id:11037,exprts:function(e,t){return 510*e/1e3}},{id:11041,exprts:function(e,t){return 320*e/1e3}},{id:11042,exprts:function(e,t){return 320*e/1e3}},{id:11043,exprts:function(e,t){return 320*e/1e3}},{id:11044,exprts:function(e,t){return 320*e/1e3}},{id:11045,exprts:function(e,t){return 40694*e/1e3}},{id:11046,exprts:function(e,t){return 2035*e/1e3}},{id:11047,exprts:function(e,t){return 2035*e/1e3}},{id:11211,exprts:function(e,t){return 160*e/1e3}},{id:11212,exprts:function(e,t){return 160*e/1e3}},{id:11213,exprts:function(e,t){return 160*e/1e3}},{id:11214,exprts:function(e,t){return 160*e/1e3}},{id:11215,exprts:function(e,t){return 20304*e/1e3}},{id:11216,exprts:function(e,t){return 1015*e/1e3}},{id:11217,exprts:function(e,t){return 1015*e/1e3}},{id:11221,exprts:function(e,t){return 320*e/1e3}},{id:11222,exprts:function(e,t){return 320*e/1e3}},{id:11223,exprts:function(e,t){return 320*e/1e3}},{id:11224,exprts:function(e,t){return 320*e/1e3}},{id:11225,exprts:function(e,t){return 40694*e/1e3}},{id:11226,exprts:function(e,t){return 2035*e/1e3}},{id:11227,exprts:function(e,t){return 2035*e/1e3}},{id:11231,exprts:function(e,t){return 160*e/1e3}},{id:11232,exprts:function(e,t){return 160*e/1e3}},{id:11233,exprts:function(e,t){return 160*e/1e3}},{id:11234,exprts:function(e,t){return 160*e/1e3}},{id:11235,exprts:function(e,t){return 20304*e/1e3}},{id:11236,exprts:function(e,t){return 1015*e/1e3}},{id:11237,exprts:function(e,t){return 1015*e/1e3}},{id:11241,exprts:function(e,t){return 160*e/1e3}},{id:11242,exprts:function(e,t){return 160*e/1e3}},{id:11243,exprts:function(e,t){return 160*e/1e3}},{id:11244,exprts:function(e,t){return 160*e/1e3}},{id:11245,exprts:function(e,t){return 20304*e/1e3}},{id:11246,exprts:function(e,t){return 1015*e/1e3}},{id:11247,exprts:function(e,t){return 1015*e/1e3}},{id:11251,exprts:function(e,t){return 80*e/1e3}},{id:11252,exprts:function(e,t){return 80*e/1e3}},{id:11253,exprts:function(e,t){return 80*e/1e3}},{id:11254,exprts:function(e,t){return 80*e/1e3}},{id:11255,exprts:function(e,t){return 10195*e/1e3}},{id:11256,exprts:function(e,t){return 510*e/1e3}},{id:11257,exprts:function(e,t){return 510*e/1e3}},{id:11261,exprts:function(e,t){return 320*e/1e3}},{id:11262,exprts:function(e,t){return 320*e/1e3}},{id:11263,exprts:function(e,t){return 320*e/1e3}},{id:11264,exprts:function(e,t){return 320*e/1e3}},{id:11265,exprts:function(e,t){return 40694*e/1e3}},{id:11266,exprts:function(e,t){return 2035*e/1e3}},{id:11267,exprts:function(e,t){return 2035*e/1e3}},{id:11271,exprts:function(e,t){return 320*e/1e3}},{id:11272,exprts:function(e,t){return 320*e/1e3}},{id:11273,exprts:function(e,t){return 320*e/1e3}},{id:11274,exprts:function(e,t){return 320*e/1e3}},{id:11275,exprts:function(e,t){return 40694*e/1e3}},{id:11276,exprts:function(e,t){return 2035*e/1e3}},{id:11277,exprts:function(e,t){return 2035*e/1e3}},{id:11411,exprts:function(e,t){return 320*e/1e3}},{id:11412,exprts:function(e,t){return 320*e/1e3}},{id:11413,exprts:function(e,t){return 320*e/1e3}},{id:11414,exprts:function(e,t){return 320*e/1e3}},{id:11415,exprts:function(e,t){return 40694*e/1e3}},{id:11416,exprts:function(e,t){return 2035*e/1e3}},{id:11417,exprts:function(e,t){return 2035*e/1e3}},{id:11421,exprts:function(e,t){return 160*e/1e3}},{id:11422,exprts:function(e,t){return 160*e/1e3}},{id:11423,exprts:function(e,t){return 160*e/1e3}},{id:11424,exprts:function(e,t){return 160*e/1e3}},{id:11425,exprts:function(e,t){return 20304*e/1e3}},{id:11426,exprts:function(e,t){return 1015*e/1e3}},{id:11427,exprts:function(e,t){return 1015*e/1e3}},{id:11431,exprts:function(e,t){return 160*e/1e3}},{id:11432,exprts:function(e,t){return 160*e/1e3}},{id:11433,exprts:function(e,t){return 160*e/1e3}},{id:11434,exprts:function(e,t){return 160*e/1e3}},{id:11435,exprts:function(e,t){return 20304*e/1e3}},{id:11436,exprts:function(e,t){return 1015*e/1e3}},{id:11437,exprts:function(e,t){return 1015*e/1e3}},{id:11441,exprts:function(e,t){return 320*e/1e3}},{id:11442,exprts:function(e,t){return 320*e/1e3}},{id:11443,exprts:function(e,t){return 320*e/1e3}},{id:11444,exprts:function(e,t){return 320*e/1e3}},{id:11445,exprts:function(e,t){return 40694*e/1e3}},{id:11446,exprts:function(e,t){return 2035*e/1e3}},{id:11447,exprts:function(e,t){return 2035*e/1e3}},{id:11451,exprts:function(e,t){return 160*e/1e3}},{id:11452,exprts:function(e,t){return 160*e/1e3}},{id:11453,exprts:function(e,t){return 160*e/1e3}},{id:11454,exprts:function(e,t){return 160*e/1e3}},{id:11455,exprts:function(e,t){return 20304*e/1e3}},{id:11456,exprts:function(e,t){return 1015*e/1e3}},{id:11457,exprts:function(e,t){return 1015*e/1e3}},{id:11461,exprts:function(e,t){return 320*e/1e3}},{id:11462,exprts:function(e,t){return 320*e/1e3}},{id:11463,exprts:function(e,t){return 320*e/1e3}},{id:11464,exprts:function(e,t){return 320*e/1e3}},{id:11465,exprts:function(e,t){return 40694*e/1e3}},{id:11466,exprts:function(e,t){return 2035*e/1e3}},{id:11467,exprts:function(e,t){return 2035*e/1e3}},{id:11471,exprts:function(e,t){return 320*e/1e3}},{id:11472,exprts:function(e,t){return 320*e/1e3}},{id:11473,exprts:function(e,t){return 320*e/1e3}},{id:11474,exprts:function(e,t){return 320*e/1e3}},{id:11475,exprts:function(e,t){return 40694*e/1e3}},{id:11476,exprts:function(e,t){return 2035*e/1e3}},{id:11477,exprts:function(e,t){return 2035*e/1e3}},{id:11481,exprts:function(e,t){return 320*e/1e3}},{id:11482,exprts:function(e,t){return 320*e/1e3}},{id:11483,exprts:function(e,t){return 320*e/1e3}},{id:11484,exprts:function(e,t){return 320*e/1e3}},{id:11485,exprts:function(e,t){return 40694*e/1e3}},{id:11486,exprts:function(e,t){return 2035*e/1e3}},{id:11487,exprts:function(e,t){return 2035*e/1e3}},{id:11491,exprts:function(e,t){return 320*e/1e3}},{id:11492,exprts:function(e,t){return 320*e/1e3}},{id:11493,exprts:function(e,t){return 320*e/1e3}},{id:11494,exprts:function(e,t){return 320*e/1e3}},{id:11495,exprts:function(e,t){return 40694*e/1e3}},{id:11496,exprts:function(e,t){return 2035*e/1e3}},{id:11497,exprts:function(e,t){return 2035*e/1e3}},{id:11501,exprts:function(e,t){return 320*e/1e3}},{id:11502,exprts:function(e,t){return 320*e/1e3}},{id:11503,exprts:function(e,t){return 320*e/1e3}},{id:11504,exprts:function(e,t){return 320*e/1e3}},{id:11505,exprts:function(e,t){return 40694*e/1e3}},{id:11506,exprts:function(e,t){return 2035*e/1e3}},{id:11507,exprts:function(e,t){return 2035*e/1e3}},{id:11511,exprts:function(e,t){return 160*e/1e3}},{id:11512,exprts:function(e,t){return 160*e/1e3}},{id:11513,exprts:function(e,t){return 160*e/1e3}},{id:11514,exprts:function(e,t){return 160*e/1e3}},{id:11515,exprts:function(e,t){return 20304*e/1e3}},{id:11516,exprts:function(e,t){return 1015*e/1e3}},{id:11517,exprts:function(e,t){return 1015*e/1e3}},{id:11521,exprts:function(e,t){return 80*e/1e3}},{id:11522,exprts:function(e,t){return 80*e/1e3}},{id:11523,exprts:function(e,t){return 80*e/1e3}},{id:11524,exprts:function(e,t){return 80*e/1e3}},{id:11525,exprts:function(e,t){return 10195*e/1e3}},{id:11526,exprts:function(e,t){return 510*e/1e3}},{id:11527,exprts:function(e,t){return 510*e/1e3}},{id:11531,exprts:function(e,t){return 160*e/1e3}},{id:11532,exprts:function(e,t){return 160*e/1e3}},{id:11533,exprts:function(e,t){return 160*e/1e3}},{id:11534,exprts:function(e,t){return 160*e/1e3}},{id:11535,exprts:function(e,t){return 20304*e/1e3}},{id:11536,exprts:function(e,t){return 1015*e/1e3}},{id:11537,exprts:function(e,t){return 1015*e/1e3}},{id:11811,exprts:function(e,t){return 320*e/1e3}},{id:11812,exprts:function(e,t){return 320*e/1e3}},{id:11813,exprts:function(e,t){return 320*e/1e3}},{id:11814,exprts:function(e,t){return 320*e/1e3}},{id:11815,exprts:function(e,t){return 40694*e/1e3}},{id:11816,exprts:function(e,t){return 2035*e/1e3}},{id:11817,exprts:function(e,t){return 2035*e/1e3}},{id:11821,exprts:function(e,t){return 320*e/1e3}},{id:11822,exprts:function(e,t){return 320*e/1e3}},{id:11823,exprts:function(e,t){return 320*e/1e3}},{id:11824,exprts:function(e,t){return 320*e/1e3}},{id:11825,exprts:function(e,t){return 40694*e/1e3}},{id:11826,exprts:function(e,t){return 2035*e/1e3}},{id:11827,exprts:function(e,t){return 2035*e/1e3}},{id:11831,exprts:function(e,t){return 640*e/1e3}},{id:11832,exprts:function(e,t){return 640*e/1e3}},{id:11833,exprts:function(e,t){return 640*e/1e3}},{id:11834,exprts:function(e,t){return 640*e/1e3}},{id:11835,exprts:function(e,t){return 81302*e/1e3}},{id:11836,exprts:function(e,t){return 4065*e/1e3}},{id:11837,exprts:function(e,t){return 4065*e/1e3}},{id:11841,exprts:function(e,t){return 320*e/1e3}},{id:11842,exprts:function(e,t){return 320*e/1e3}},{id:11843,exprts:function(e,t){return 320*e/1e3}},{id:11844,exprts:function(e,t){return 320*e/1e3}},{id:11845,exprts:function(e,t){return 40694*e/1e3}},{id:11846,exprts:function(e,t){return 2035*e/1e3}},{id:11847,exprts:function(e,t){return 2035*e/1e3}},{id:11851,exprts:function(e,t){return 320*e/1e3}},{id:11852,exprts:function(e,t){return 320*e/1e3}},{id:11853,exprts:function(e,t){return 320*e/1e3}},{id:11854,exprts:function(e,t){return 320*e/1e3}},{id:11855,exprts:function(e,t){return 40694*e/1e3}},{id:11856,exprts:function(e,t){return 2035*e/1e3}},{id:11857,exprts:function(e,t){return 2035*e/1e3}},{id:11861,exprts:function(e,t){return 160*e/1e3}},{id:11862,exprts:function(e,t){return 160*e/1e3}},{id:11863,exprts:function(e,t){return 160*e/1e3}},{id:11864,exprts:function(e,t){return 160*e/1e3}},{id:11865,exprts:function(e,t){return 20304*e/1e3}},{id:11866,exprts:function(e,t){return 1015*e/1e3}},{id:11867,exprts:function(e,t){return 1015*e/1e3}},{id:11871,exprts:function(e,t){return 320*e/1e3}},{id:11872,exprts:function(e,t){return 320*e/1e3}},{id:11873,exprts:function(e,t){return 320*e/1e3}},{id:11874,exprts:function(e,t){return 320*e/1e3}},{id:11875,exprts:function(e,t){return 40694*e/1e3}},{id:11876,exprts:function(e,t){return 2035*e/1e3}},{id:11877,exprts:function(e,t){return 2035*e/1e3}},{id:11891,exprts:function(e,t){return 320*e/1e3}},{id:11892,exprts:function(e,t){return 320*e/1e3}},{id:11893,exprts:function(e,t){return 320*e/1e3}},{id:11894,exprts:function(e,t){return 320*e/1e3}},{id:11895,exprts:function(e,t){return 40694*e/1e3}},{id:11896,exprts:function(e,t){return 2035*e/1e3}},{id:11897,exprts:function(e,t){return 2035*e/1e3}},{id:11901,exprts:function(e,t){return 320*e/1e3}},{id:11902,exprts:function(e,t){return 320*e/1e3}},{id:11903,exprts:function(e,t){return 320*e/1e3}},{id:11904,exprts:function(e,t){return 320*e/1e3}},{id:11905,exprts:function(e,t){return 40694*e/1e3}},{id:11906,exprts:function(e,t){return 2035*e/1e3}},{id:11907,exprts:function(e,t){return 2035*e/1e3}},{id:11911,exprts:function(e,t){return 320*e/1e3}},{id:11912,exprts:function(e,t){return 320*e/1e3}},{id:11913,exprts:function(e,t){return 320*e/1e3}},{id:11914,exprts:function(e,t){return 320*e/1e3}},{id:11915,exprts:function(e,t){return 40694*e/1e3}},{id:11916,exprts:function(e,t){return 2035*e/1e3}},{id:11917,exprts:function(e,t){return 2035*e/1e3}},{id:11941,exprts:function(e,t){return 320*e/1e3}},{id:11942,exprts:function(e,t){return 320*e/1e3}},{id:11943,exprts:function(e,t){return 320*e/1e3}},{id:11944,exprts:function(e,t){return 320*e/1e3}},{id:11945,exprts:function(e,t){return 40694*e/1e3}},{id:11946,exprts:function(e,t){return 2035*e/1e3}},{id:11947,exprts:function(e,t){return 2035*e/1e3}}]}(Formula||(Formula={}));var HashMap=function(){function e(){this._obj={},this._length=0}return e.prototype.add=function(e,t){this.hasKey(e)||this._length++,this._obj[e]=t},e.prototype.hasKey=function(e){return e in this._obj},e.prototype.getValue=function(e){return this._obj[e]},e.prototype.removeKey=function(e){var t;return this.hasKey(e)&&(t=this._obj[e],delete this._obj[e],this._length--),t},e.prototype.getMap=function(){return this._obj},Object.defineProperty(e.prototype,"valueSet",{get:function(){var e=[];for(var t in this._obj)e.push(this._obj[t]);return e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"keySet",{get:function(){return Object.keys(this._obj)},enumerable:!0,configurable:!0}),e.prototype.clear=function(){this._obj={},this._length=0},Object.defineProperty(e.prototype,"length",{get:function(){return this._length},enumerable:!0,configurable:!0}),e}();__reflect(HashMap.prototype,"HashMap"),window.HashMap=HashMap;var HurtAction=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.setActionInfo=function(e,t,i,r,n,a,o){var s=this;s.caster=e,s.bullet=t,s.dir=a,o?(s.stillType=o.type,s.stillTrig=o.trig,s.stillFrame=o.frame,s.stillShake=o.shake,s.slowFrames=o.frame,s.slowTimes=o.times,s.curSlowFrame=1,s.curSlowTimes=0):s.stillType=0},t.prototype.onDestroy=function(){var e=this;e.caster=null,e.bullet=null,e.dir=0},t}(BaseAction);__reflect(HurtAction.prototype,"HurtAction"),window.HurtAction=HurtAction;var NormalAction=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.setActionInfo=function(e,t){var i=this,r=ObjectPool.pop(SubAction);r.initialize(i,e||i.state.cfg.action,isNaN(t)?i.state.cfg.play||0:t,0,0),i.subActions.push(r)},t}(BaseAction);__reflect(NormalAction.prototype,"NormalAction"),window.NormalAction=NormalAction;var AttackAction=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.isCombo=function(e){var t=this;return t.atInfo.mustId&&t.atInfo.mustId!=e?!1:t.curFrame>=t.atInfo.ns&&t.curFrame<=t.atInfo.ne},t.prototype.isSz=function(){var e=this;return 3==e.type},t.prototype.setActionInfo=function(e){var t=this,i=t.action;t.origAction=t.actionName,t.skillInfo=i.skillInfo,t.skillId=i.skillId,t.skillCfg=i.skillCfg,t.actionId=e.id||0,t.atInfo=e,t.type=e.type||0,t.playType=e.play||0,t.bulletMaxTimes=t.bulletTimes=0,t.exchange=0,t.warnIndex=0;var r=t.playType;if(e.ctime&&(1==r||3==r||2==r||4==r)){var n=Data.getLvBaseValue(e.ctime,t.skillInfo.skillLv,e.ctimeb,0);(1==r||2==r)&&(n=Fixed.millisecond(n)),t.ctime=t.time=n}},t.prototype.play=function(){var t=this,i=t.action,r=t.owner,n=t.atInfo,a=t.skillId,o=t.skillInfo;if(t.actionId&&i.nextActionId&&i.nextActionId!=t.actionId)return void t.actionEnd(!0);if(3==t.type){if(t.action.removeBuffIdx(2),o.hasSub&&(o.isNormal&&o.isLast&&o.clearSub(),r.skill.startNextSubSkill(o,a)),r.skill.nextSkillId||r.isPress)return r.skill.onBreakSkill(a),void t.actionEnd(!0)}else if(9==t.type){var s=n.av||[],l=s[0]||0,u=!1;if(1==l){var c=r.scene,p=c.roadLeft,d=c.roadRight,f=c.roadTop,h=c.roadBottom,v=c.limitX(Fixed.value(d).sub(p).mul(s[1]||0).add(p).round().value),m=c.limitY(Fixed.value(h).sub(f).mul(s[2]||0).add(f).round().value),y=s[3]||0,g=s[4]||0;if(u=!!s[5],y){var b=Fixed.value(v).sub(y).max(p).value,x=Fixed.value(v).add(y).min(d).value,I=c.seedr.random;v=Fixed.value(x).sub(b).mul(I).add(b).round().value}if(g){var _=Fixed.value(m).sub(g).max(f).value,S=Fixed.value(m).add(g).min(h).value,I=c.seedr.random;m=Fixed.value(S).sub(_).mul(I).add(_).round().value}r.updatePos(v,m,r.z,r.right)}else if(2==l){var c=r.scene,T=c.getSkillPosTarget(r,s[3]||0,s[4]||0,s[1]||0,s[2]||0);if(!T)return void t.actionEnd(!0);var w=s[5]||0,A=s[6]||0,y=s[9]||0,g=s[10]||0,v=void 0,m=void 0;if(u=!!s[11],s[7]?(v=Fixed.value(T.x).add(w).value,m=Fixed.value(T.y).add(A).value):(v=Fixed.value(w).mul(T.multiply).add(T.x).value,m=Fixed.value(T.y).add(A).value),v=c.limitX(v),m=c.limitY(m),y){var b=Fixed.value(v).sub(y).max(c.roadLeft).value,x=Fixed.value(v).add(y).min(c.roadRight).value,I=c.seedr.random;v=Fixed.value(x).sub(b).mul(I).add(b).round().value}if(g){var P=Fixed.value(m).sub(g).max(c.roadTop).value,S=Fixed.value(m).add(g).min(c.roadBottom).value,I=c.seedr.random;m=Fixed.value(S).sub(P).mul(I).add(P).round().value}r.updatePos(v,m,r.z,s[8]?v<T.x:r.right)}else if(3==l){var c=r.scene,T=c.getSkillPosAvatar(r);if(!T)return void t.actionEnd(!0);var w=s[1]||0,A=s[2]||0,y=s[4]||0,g=s[5]||0,v=void 0,m=void 0;if(u=!!s[6],s[3]?(v=Fixed.value(T.x).add(w).value,m=Fixed.value(T.y).add(A).value):(v=Fixed.value(w).mul(T.multiply).add(T.x).value,m=Fixed.value(T.y).add(A).value),v=c.limitX(v),m=c.limitY(m),y){var b=Fixed.value(v).sub(y).max(c.roadLeft).value,x=Fixed.value(v).add(y).min(c.roadRight).value,I=c.seedr.random;v=Fixed.value(x).sub(b).mul(I).add(b).round().value}if(g){var C=Fixed.value(m).sub(g).max(c.roadTop).value,S=Fixed.value(m).add(g).min(c.roadBottom).value,I=c.seedr.random;m=Fixed.value(S).sub(C).mul(I).add(C).round().value}r.updatePos(v,m,r.z,r.right)}else if(4==l){var c=r.scene,T=c.getSkillPosTarget(r,s[3]||0,s[4]||0,s[1]||0,s[2]||0);if(!T)return void t.actionEnd(!0);var w=s[5]||0,y=s[7]||0,g=s[8]||0,v=Fixed.value(w).mul(r.x<=T.x?1:-1).add(T.x).value,m=Fixed.value(T.y).add(s[6]||0).value;if(u=!!s[9],(v<c.roadLeft||v>c.roadRight)&&(v=Fixed.value(w).mul(r.x>T.x?1:-1).add(T.x).value),v=c.limitX(v),m=c.limitY(m),y){var b=Fixed.value(v).sub(y).max(c.roadLeft).value,x=Fixed.value(v).add(y).min(c.roadRight).value,I=c.seedr.random;v=Fixed.value(x).sub(b).mul(I).add(b).round().value}if(g){var D=Fixed.value(m).sub(g).max(c.roadTop).value,S=Fixed.value(m).add(g).min(c.roadBottom).value,I=c.seedr.random;m=Fixed.value(S).sub(D).mul(I).add(D).round().value}r.updatePos(v,m,r.z,v<T.x)}u&&r.scene.master==r&&r.scene.initCamera()}var B="";if(r instanceof Avatar){var k=i.touchDir||r.touchDir,E=ActionMgr.changeDirToX(k),R=t.skillCfg,F=n.move||0;if(2==F&&R.spd&&r.updateSpecialSpd(R.spd),n.cdir){if(n.adir&&!E&&r.agent.autoBattle){var T=r.ai.target;T&&T.x!=r.x&&(E=T.x>r.x?1:-1)}E&&r.changeDirection(E>0)}if(r.isTouch)if((3==o.type||2==o.type)&&(13==k?t.exchange=-1:5==k&&(t.exchange=1)),0==F)r.moveType&&r.stopMove();else if(1==i.move&&!r.beControl)return 3==t.type&&r.skill.onBreakSkill(a),void r.startMove(1);n.mca&&(B="_"+E),1==n.rtype&&r.isTouch?(t.isOpsChange=!0,t.origAction=n.rname,t.actionName=t.origAction+B):2!=n.rtype||r.right?t.actionName=t.actionName+B:(t.isOpsChange=!0,t.origAction=n.rname,t.actionName=t.origAction+B)}else{var T=r.ai.target;n.adir&&T&&T.x!=r.x&&r.changeDirection((T.x>r.x?1:-1)>0)}e.prototype.play.call(this),t.curTotalFrame=1;var M=t.ttype=n.ttype||0,L=(t.isOpsChange?n.rtv:n.tv)||[];if(0==M)t.bulletFrame=L[0]||0,t.bulletMaxTimes=L[1]||0;else if(1==M)t.binterval=L[0]||1,t.interval=L[1]?0:t.binterval-1;else if(3==M){var U=t.trigFrames={};L.forEach(function(e,t){U[e]=t})}if(n.eff){var O=r.guise.addEffect(n.eff,n.eloop);if(O){t.effectUId=O.uid;var N=t.action;n.estill&&N.stillType&&(O.stillType=N.stillType,O.stillTrig=N.stillTrig,O.stillFrame=N.stillFrame,O.slowFrames=N.slowFrames,O.slowTimes=N.slowTimes,O.curSlowFrame=N.curSlowFrame,O.curSlowTimes=N.curSlowTimes)}}t.ctime&&(r instanceof Avatar&&r.hold||r instanceof Monster)&&(2==t.type||6==t.type)&&r.guise.showCastBar(t.type,t.ctime,t.time),t.doFrameMove(),t.doFrameAction(),n.buff&&n.buff.forEach(function(e){var i=r.buff.addBuff(r,a,o.skillLv,e);i&&t.action.addBuffIdx(n.brmove||0,i.idx)}),n.camera&&r.scene.master==r&&r.scene.playCameraEffect(r,n.camera,a),n.spineAction&&r.playSpineAction(n.spineAction,1),r.hold&&App.dispatch("c107",{caster:r,skillId:a})},t.prototype.checkEnd=function(t,i,r,n,a){e.prototype.checkEnd.call(this,t,i,r,n,a);var o=this,s=o.owner;o.ctime&&(s instanceof Avatar&&s.hold||s instanceof Monster)&&(2==o.type||6==o.type)&&s.guise.updateCastBar(o.type,o.time)},t.prototype.doAction=function(e,t,i,r,n){var a=this,o=a.atInfo,s=a.curTotalFrame;s=a.curTotalFrame=s+1,o.us&&o.ue&&s>=o.us&&s<=o.ue&&a.owner.skill.nextSkillId?a.actionEnd(!0):a.doFrameAction()},t.prototype.doMove=function(e,t,i,r,n){this.doFrameMove(r,n)},t.prototype.doFrameMove=function(e,t){void 0===e&&(e=!1),void 0===t&&(t=1);var i,r=this,n=r.owner,a=n.scene,o=n.ox,s=n.oy,l=n.oz,u=MmeUtils.getPosInfo(r.actionName,r.actionData,r.curFrame);if(u){var c=r.action.slowStatus;if(2==c||3==c||4==c){var p=MmeUtils.getPosInfo(r.actionName,r.actionData,r.curFrame+1)||u;r.exchange?s=Fixed.value(p.dx).sub(u.dx).div(t).mul(r.exchange).add(s).value:o=Fixed.value(p.dx).sub(u.dx).div(t).mul(n.multiply).add(o).value;var d=Fixed.value(p.dy).sub(u.dy).div(t).value;l=Fixed.value(l).sub(d).value,i=!0}else if(!r.isInStopLast){var f=MmeUtils.getPosInfo(r.actionName,r.actionData,r.curFrame-1),h=0,v=0;f&&(h=f.dx,v=f.dy),r.exchange?s=Fixed.value(u.dx).sub(h).mul(r.exchange).add(s).value:o=Fixed.value(u.dx).sub(h).mul(n.multiply).add(o).value,l=Fixed.value(l).sub(u.dy).add(v).value,i=!0}}2==r.action.move&&n instanceof Avatar&&n.isTouch&&(o=Fixed.value(n.speedx).div(t).add(o).value,s=Fixed.value(n.speedy).div(t).add(s).value,i=!0),i&&(o=a.limitX(o),s=a.limitY(s),n.updatePos(o,s,l,n.right))},t.prototype.doFrameAction=function(){var e=this,t=e.owner,i=e.ttype;0==i&&e.bulletFrame?e.curFrame==e.bulletFrame&&(!e.bulletMaxTimes||e.bulletTimes<e.bulletMaxTimes)&&e.onTrigBullet():1==i&&e.binterval?(e.interval--,e.interval<=0&&(e.interval=e.binterval,e.onTrigBullet())):2==e.ttype?0==e.bulletTimes&&e.onTrigBullet():3==e.ttype&&e.curFrame in e.trigFrames&&e.onTrigBullet(e.trigFrames[e.curFrame]);var r=e.atInfo,n=r.wf,a=r.wid;if(n&&a)for(var o=e.warnIndex;n[o]==e.curTotalFrame;)a[o]&&t.warn.onTrigWarn(a[o],e.skillId,t.right,t.x,t.y),e.warnIndex=o+=1},t.prototype.onTrigBullet=function(e){void 0===e&&(e=-1);var t,i,r,n,a,o,s=this,l=s.owner,u=s.atInfo,c=u.mca?s.origAction:s.actionName,p=s.skillCfg,d=0,f=s.skillId,h=s.skillInfo.skillLv;if(s.bulletTimes++,-1!=s.action.curXuliTime){var v=p.cv||[];v[3]||(d=Fixed.millisecond(v[0]),d=Fixed.value(s.action.curXuliTime).div(d).min(1).value,d=Fixed.value(v[2]||1).sub(1).max(1).mul(d).value)}s.isOpsChange?(t=u.rtid,i=u.rtids,r=u.ratids,t&&(n=u.rtdf||0),i&&(a=u.rtdfs||[]),r&&(o=u.ratdfs||[])):(t=u.tid,i=u.tids,r=u.atids,t&&(n=u.tdf||0),i&&(a=u.tdfs||[]),r&&(o=u.atdfs||[])),t&&!l.isSkillBulletUnactive(f,t)&&s.createBulletExtra(t,n,f,h,d,c,u.mca),i&&(-1!=e?(t=i[e],t&&!l.isSkillBulletUnactive(f,t)&&s.createBulletExtra(t,a[e]||0,f,h,d,c,u.mca)):i.forEach(function(e,t){e&&!l.isSkillBulletUnactive(f,e)&&s.createBulletExtra(e,a[t]||0,f,h,d,c,u.mca)})),r&&(-1!=e?(t=r[e],t&&l.isSkillBulletActive(f,t)&&s.createBulletExtra(t,o[e]||0,f,h,d,c,u.mca)):r.forEach(function(e,t){e&&l.isSkillBulletActive(f,e)&&s.createBulletExtra(e,o[t]||0,f,h,d,c,u.mca)}))},t.prototype.createBulletExtra=function(e,t,i,r,n,a,o){var s=this.owner,l=BulletExtra.create(s,s,e,t,i,r);l&&(l.damageRate=n,l.attackAction=a,l.mca=o,l.vampireRate=this.action.state.vampireRate,s.skill.onTrigBullet(l))},t.prototype.actionEnd=function(e){var t=this,i=t.owner;t.action.removeBuffIdx(0),t.removeEffect(),t.hideCastBar(),2==t.action.move&&t.skillCfg.spd&&i.updateSpecialSpd(0),5==t.type&&(i.warn.clearSkillWarn(t.skillId),i.scene.clearSkillBullet(i,t.skillId)),!e&&t.atInfo.nid&&(t.action.nextActionId=t.atInfo.nid),t.doActionEnd()},t.prototype.onActionEnd=function(){this.actionEnd(!1)},t.prototype.removeEffect=function(){var e=this;e.effectUId&&(e.owner&&e.owner.guise&&e.owner.guise.removeEffect(e.effectUId),e.effectUId=0)},t.prototype.hideCastBar=function(){var e=this.owner;!(e instanceof Avatar&&e.hold||e instanceof Monster)||2!=this.type&&6!=this.type||e.guise.hideCastBar()},t.prototype.onDestroy=function(){var e=this;e.removeEffect(),e.hideCastBar(),ObjectUtils.clearKeys(e,["origAction","skillInfo","skillCfg","atInfo","isOpsChange","trigFrames"]),ObjectUtils.clearKeysNum(e,["skillId","actionId","type","exchange","curTotalFrame","ttype","binterval","interval","bulletFrame","bulletMaxTimes","bulletTimes","warnIndex"])},t}(SubAction);__reflect(AttackAction.prototype,"AttackAction"),window.AttackAction=AttackAction;var Monster=function(e){function t(t,i,r,n){return void 0===i&&(i=0),void 0===r&&(r=null),void 0===n&&(n=null),e.call(this,t,i,r,n)||this}return __extends(t,e),Object.defineProperty(t.prototype,"aiClass",{get:function(){return MonsterAI},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"guiseClass",{get:function(){return GMonster},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isMetalPail",{get:function(){return 2==this.type},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isBoss",{get:function(){return this.type>=200},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isElite",{get:function(){return this.type>=100&&this.type<200},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isSummoned",{get:function(){return!!this.ownereid},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"serName",{get:function(){return this.params?this.params.name:""},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"element",{get:function(){var e=this.buff.element;return e?e:this.lvElement||this.heroCfg.element||0},enumerable:!0,configurable:!0}),t.prototype.setParams=function(e){if(e){var t=this,i=e;t.isClient=!0,t.side=i.side,t.heroId=t.monsterId=i.monsterId,t.right=!i.dir,t.aiId=i.ai,ObjectUtils.assignKeys(i,t,["roomsn","type","x","y","spawnId","idx","name","variants","effect","ownereid"])}},t.prototype.onCreate=function(){var t,i=this;i.variants&&i.variants.forEach(function(e){t=Data.getItem("VariantData",e),t.heroId&&(i.heroId=t.heroId)}),e.prototype.onCreate.call(this),i.onVariantData()},t.prototype.onVariantData=function(){var e,t=this,i=t.variants,r=i?i.length>0:!1,n=r||t.type>=100||3==t.type?t.name||t.heroCfg.name||"":"";r&&i.forEach(function(i){e=Data.getItem("VariantData",i),e.name&&(n=Msg.phe(2203,e.color,e.name,n)),e.ai&&(t.aiId=e.ai)}),t.isVariant=r,t.name=n},t.prototype.onEnterScene=function(){var t,i,r=this,n=r.side,a=r.scene,o=a instanceof RelayRoom?1:1==n?2:1,s=a.getFirstUnDeadAvatar(o);s?(t=s.x,i=s.y):(t=0,i=0);var l,u,c,p,d=r.params,f=d.posType,h=d.dir;if(2==f)l=Fixed.value(t).add(d.offx).add(r.x).value,u=Fixed.value(i).add(d.offy).add(r.y).value,c=r.z;else if(3==f){var v=a.seedr,m=d.radius,y=d.randomh||m,g=Fixed.value(t).add(d.offx).sub(m).max(a.roadLeft).value,b=Fixed.value(t).add(d.offx).add(m).min(a.roadRight).value,x=Fixed.value(i).add(d.offy).sub(y).max(a.roadTop).value,I=Fixed.value(i).add(d.offy).add(y).min(a.roadBottom).value,_=v.random,S=v.random;l=Fixed.value(b).sub(g).mul(_).add(g).round().value,u=Fixed.value(I).sub(x).mul(S).add(x).round().value,c=r.z}else if(4==f)l=Fixed.value(a.roadRight).sub(a.roadLeft).mul(r.x).div(100).add(a.roadLeft).round().value,u=Fixed.value(a.roadBottom).sub(a.roadTop).mul(r.y).div(100).add(a.roadTop).round().value,c=r.z;else if(5==f){var v=a.seedr,m=d.radius,y=d.randomh||m,T=Fixed.value(a.roadRight).sub(a.roadLeft).mul(r.x).div(100).add(a.roadLeft).add(d.offx).value,w=Fixed.value(a.roadBottom).sub(a.roadTop).mul(r.y).div(100).add(a.roadTop).add(d.offy).value,g=Fixed.value(T).add(d.offx).sub(m).max(a.roadLeft).value,b=Fixed.value(T).add(d.offx).add(m).min(a.roadRight).value,x=Fixed.value(w).add(d.offy).sub(y).max(a.roadTop).value,I=Fixed.value(w).add(d.offy).add(y).min(a.roadBottom).value,_=v.random,S=v.random;l=Fixed.value(b).sub(g).mul(_).add(g).round().value,u=Fixed.value(I).sub(x).mul(S).add(x).round().value,c=r.z}else l=r.x,u=r.y,c=r.z;p=2==h?t>l:3==h?l>t:r.right,r.updatePos(l,u,c,p);var A=r.heroId,P=Data.getSValue("HeroData",A,"prop"),C=Data.getSValue("HeroData",A,"skill")||[],D=d.extraSkills?d.extraSkills.concat():[],B=d.extraBuffs?d.extraBuffs.concat():[],k={},E=[],R=Fixed.value(d.propsRate).add(1).value,F=Fixed.value(R).add(d.maxHpRate||0).value;if(d.extraProps&&d.extraProps.forEach(function(e){r.addPropItem(e,k,E,R,F)}),P&&P.forEach(function(e){r.addPropItem(e,k,E,1,F)}),d.lvId){var M=Data.getItem("MonsterLevel",d.lvId),L=M.skillLv;if(M.prop&&M.prop.forEach(function(e){r.addPropItem(e,k,E,R,F)
}),M.buff&&M.buff.forEach(function(e){e.name&&e.lv&&B.push({buffId:e.name,lv:e.lv})}),L)for(var U=0,O=C.length;O>U;U++)D.push({id:C[U],lv:L[U]||1});r.level=d.level||M.lv||1,r.quality=M.quality||1,r.sbaval=M.baval||r.sbaval||0,r.sbatime=M.batime||r.sbatime||0,r.lvElement=M.element||0}else r.level=d.level||1,r.quality=1;d.eskillId&&D.push({id:d.eskillId,lv:1}),r.updateHeroInfo(E,D,B),e.prototype.onEnterScene.call(this)},t.prototype.onEnteredScene=function(){e.prototype.onEnteredScene.call(this);var t=this;t.heroCfg.enterHide&&(t.visible_guise=!1),t.skill.startInitCd();var i;t.isVariant&&t.variants.forEach(function(e){i=Data.getItem("VariantData",e),i.buff&&t.buff.addBuff(t,0,1,i.buff)})},t.prototype.playEnterSkill=function(){var e=this;return e.skill.enterSkillId?(e.skill.onBeginSkill(e.skill.enterSkillId,!1,!1),!0):!1},t.prototype.onEnterEffectEnd=function(){e.prototype.onEnterEffectEnd.call(this)},t.prototype.onLeaveScene=function(){this.scene.removeCallLater(this),e.prototype.onLeaveScene.call(this)},t.prototype.onEndDead=function(){e.prototype.onEndDead.call(this)},t.prototype.onDestroy=function(){this.variants=null,this.params&&this.params.dispose(),e.prototype.onDestroy.call(this)},t}(Role);__reflect(Monster.prototype,"Monster"),window.Monster=Monster;var PvPRoom=function(e){function t(t,i,r,n){void 0===i&&(i=0),void 0===r&&(r=null),void 0===n&&(n=null);var a=e.call(this,t,i,r,n)||this;a.hasPreWar=!1,a.prewatEndTime=0;var o=a;return o.isLockCamera=!0,o.loadShowTime=Data.getSysValue("PVP_LOAD_SHOW_TIME"),o.battleSideList={},o.battleEffect=!0,a}return __extends(t,e),Object.defineProperty(t.prototype,"petTickAI",{get:function(){return this.isPlaying},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fruitTickAI",{get:function(){return this.isPlaying},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isCanControl",{get:function(){return 4==this.status||9==this.status||10==this.status},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"playType",{get:function(){return this.playCfg.playType},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isSingleFight",{get:function(){var e=this.playType;return 1==e||3==e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"loadPanelId",{get:function(){return 161},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scenePanelId",{get:function(){var e=this.playType;return 2==e?122:3==e?123:4==e?124:121},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"resultPanelId",{get:function(){return 146},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"prepareRemainTime",{get:function(){return Math.ceil(Math.max(0,this.prewatEndTime-DateUtils.serverNow)/1e3)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hasRoundResult",{get:function(){return 3==this.playType},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hasMiniResult",{get:function(){return!0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isPlayerFight",{get:function(){var e=this;return 3==e.playType?e.blueAgent==e.player||e.redAgent==e.player:!e.player.viewer},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"preWarTime",{get:function(){return Data.getSysValue("PRE_WAR_TIME")||15},enumerable:!0,configurable:!0}),t.prototype.onCreate=function(){e.prototype.onCreate.call(this),this.buildPlayData(),PanelMgr.close(84)},t.prototype.buildPlayData=function(){this.playCfg=Data.getItem("PvPPlayData",this.playId)},t.prototype.onSceneStartedBefor=function(){e.prototype.onSceneStartedBefor.call(this);var t=this;t.setBattleData();var i=t.getSideAgentNum(1)>1||t.getSideAgentNum(2)>1;t.hasPreWar&&i?t.startPreWar():t.startFirstRound()},t.prototype.setBattleData=function(){var e=this,t=Data.getItem("BattleData",e.battleId);e.battleCfg=t,e.bgm=t.bgm,e.setMapId(t.roundMap)},t.prototype.startPreWar=function(){var e=this;if(!e.isPreWar){e.setStatus(2),e.clearPreWarTime();var t=e.preWarTime;e.prewatEndTime=1e3*t+DateUtils.serverNow,PanelMgr.open(82,{scene:e}),e.preWarTimeId=e.addCallLater(e.startFirstRound,e,t,!0,!1)}},t.prototype.startFirstRound=function(){this.roundId=1,this.totalSeconds=0,this.startRoundWait()},t.prototype.startNextRound=function(){this.roundId++,this.startRoundWait()},t.prototype.startRoundWait=function(){var e=this;e.isRoundWait||(e.setStatus(3),e.onSideAgentStart(1),e.onSideAgentStart(2),e.clearStartRoundDelay(),e.startRoundDelayId=e.addCallLater(e.onStartRoundWait,e,2,!1,!1))},t.prototype.onSideAgentStart=function(e){var t,i=this,r=i.agentInfoList.filter(function(t){return t.side==e}),n=i.roundPlayerNum,a=i.battleSideList[e]=[];ArrayUtils.sortOn(r,"order",16);for(var o=0,s=r.length;s>o&&(t=r[o],!(!t.isDead&&t.agent&&(!t.agent.avatar&&t.agent.createAvatar(),!t.agent.fruit&&t.agent.createFruit(),a.push(t),a.length>=n)));o++);},t.prototype.onStartRoundWait=function(){var e=this,t=Data.getSysValue("PVP_START_EFFECT_WAIT_TIME")||3,i=e.isSingleFight;PanelMgr.closes(83,82),e.clearStartRoundDelay();var r,n;if(e.avatarList.forEach(function(t){t.isDead||(n=e.getTeamSlotIdByRid(t.prid),r=e.getBornPos(t.side,n),t.updatePos(r.x||0,r.y||0,0,1==t.side))}),e.petList.forEach(function(t){t.isDead||(n=e.getTeamSlotIdByRid(t.prid),r=e.getBornPos(t.side,n),t.updatePos(r.x||0,r.y||0,0,1==t.side))}),e.fruitList.forEach(function(t){t.isDead||(n=e.getTeamSlotIdByRid(t.prid),r=e.getBornPos(t.side,n),t.updatePos(r.x||0,r.y||0,0,1==t.side))}),e.isLockCamera=!0,e.initCamera(),1!=e.roundId&&e.spriteList.concat().forEach(function(e){e.onStartPvPWait()}),i){var a=e.blueAgent=e.getFightAgent(1),o=e.redAgent=e.getFightAgent(2);e.blueAgentInfo=a?e.agentInfos[a.rid]:null,e.redAgentInfo=o?e.agentInfos[o.rid]:null,e.setCameraFollow()}3==e.playType?e.addOnceTimer(t,e.playStartEffect):e.playStartEffect(),App.dispatch("c85"),e.clearStartRoundWait(),e.startRoundWaitId=e.addCallLater(e.startRound,e,t,!0,!1)},t.prototype.playStartEffect=function(){RenderUtils.playSceneEffect("516",Urls.uieff(),"start",0,"M",0,-200)},t.prototype.startRound=function(){var e=this;e.isPlaying||(e.clearStartRoundWait(),e.setStatus(4),e.isLockCamera=!1,e.roundStartTime=DateUtils.serverNow,e.timeIndex=0,e.startSeconds=0,e.spriteList.forEach(function(e){e.onStartPvPRound()}),App.dispatch("c83"),e.guise&&e.guise.hidePath(),e.checkAllPlayerDead())},t.prototype.passRound=function(e){void 0===e&&(e=0);var t=this;if(t.isPlaying){t.needVerify&&1==t.roundId&&t.recordVerifyMaxTime();var i=t.agentInfoList,r=[];t.totalSeconds=t.totalSeconds+t.startSeconds,i&&i.forEach(function(e){e.agent&&!e.isDead&&-1==r.indexOf(e.side)&&r.push(e.side)}),r.length>1?t.player.syncPassRound(t.roundId,e):t.syncPvPResult(r[0]||0)}},t.prototype.onPassRound=function(t){e.prototype.onPassRound.call(this,t);var i=this;i.setStatus(6);var r=i.battleSideList;if(r){var n=void 0;for(var a in r)+a!=t&&(n=r[a],n.forEach(function(e){e.agent&&!e.isDead&&e.agent.avatar&&e.agent.avatar.dead(!0,!1,!1)}))}if(i.guise&&i.guise.hideBlindMask(),3==i.playType||1==i.playType){var o=i.blueAgent,s=i.redAgent,l=o&&s&&o.side==t?o:s;3==i.playType&&l&&l.onPvPStopRound()}i.spriteList.concat().forEach(function(e){e.onStopPvPRound(t)}),t==i.player.side&&RenderUtils.playSceneEffect("3",Urls.uieff(),"idle",0,"M"),App.dispatch("c90",{type:t==i.player.side?1:2,winSide:t}),i.addOnceTimer(Data.getSysValue("PVP_ROUND_RESULT_SHOW_TIME")||3,function(){App.dispatch("c91")}),i.onStopRound(),i.addCallLater(i.startNextRound,i,180,!1,!1)},t.prototype.onBattleTimeOut=function(){var t,i=this,r=i.battleSideList,n=i.getTimeOutWinerSide();for(var a in r)+a!=n&&(t=r[a],t.forEach(function(e){e.agent&&!e.isDead&&e.agent.avatar&&e.agent.avatar.dead(!0,!1,!1)}));e.prototype.onBattleTimeOut.call(this),i.passRound(n)},t.prototype.getTimeOutWinerSide=function(){var e,t,i,r,n,a,o,s=this,l=s.battleSideList;for(var u in l)e=l[u],r=0,n=0,a=0,o=0,e.forEach(function(e){e.agent&&!e.isDead&&r++,i=e.avatarData,i&&(n=Fixed.value(n).add(i.hpRate).value,a=Fixed.value(a).add(i.hp).value,o=Fixed.value(o).add(e.ability).value)}),(!t||r>t.liveNum||r==t.liveNum&&n>t.hpRate||n==t.hpRate&&a>t.hp||a==t.hp&&o>t.ability)&&(t={side:+u,liveNum:r,hpRate:n,hp:a,ability:o});return t.side},t.prototype.onLeaveMap=function(){e.prototype.onLeaveMap.call(this),PanelMgr.closes(83,82),SceneMgr.onLeavScene(!1)},t.prototype.onPvPRoomEnd=function(e){var t=this,i=e?1:2;1001!=t.playId&&1006!=t.playId?t.battleOver(i,t.getBattleResultParams(i)):t.player.onBattleOver(i)},t.prototype.onSyncChangeOrder=function(e,t,i,r){var n=this;n.needVerify&&RecordMgr.record(30,this.roomsn,this.$eid,e,t,i,r);var a;n.agentInfoList.forEach(function(n){a=n.rid==e?t:n.rid==i?r:-1,-1!=a&&(n.order=a,n.agent&&(n.agent.order=a,n.agent.clearReqOrder()))}),n.addOnceTimer(0,App.dispatch.bind(App,"c82"))},t.prototype.onAvatarDeadAfter=function(t,i,r){e.prototype.onAvatarDeadAfter.call(this,t,i,r);var n=this;if(i.prid!=t.prid){var a=n.agentInfos[i.prid];a&&(a.killNum+=1,a.streakNum+=1)}App.dispatch("c93",{killer:i.prid,target:t.prid})},t.prototype.syncPvPResult=function(e){var t=this;if(!t.isWaitVerify&&!t.isOver&&t.player){if(t.setStatus(8),t.player.viewer)return void t.setBattleDamages();var i=e==t.player.side,r=[];t.roleList.forEach(function(e){r.push(e.getRoleInfo())}),t.needVerify&&RecordMgr.recordRoomInfo(t),t.needVerify&&RecordMgr.record(33,t.roomsn,t.$eid,1,r,0),RecordMgr.upload(t.roomsn,!t.needVerify,i,t.onBattleOverVerify,t,e)}},t.prototype.onBattleOverVerify=function(e,t){var i=this;i.setBattleDamages(),i.syncBattleResult(JSON.stringify(i.getPvPResultExtra(e,t)))},t.prototype.setAgentBattleDamage=function(t,i){e.prototype.setAgentBattleDamage.call(this,t,i);var r,n=this.playType,a=i[t.side],o=a.totalDamage||1,s=t.getTotal("damage");if(r=i[1==t.side?2:1],3==n){var l=Fixed.value(r.totalHp).div(r.playerNum).value,u=Fixed.value(3).mul(s).div(o).pow(1.5).value;u=Fixed.value(u).mul(2).value,u=Fixed.value(1).sub(l).mul(u).value,u=Fixed.value(t.agent?t.avatarData.hpRate:0).pow(1.5).mul(1).add(u).value,u=Fixed.value(1).mul(t.killNum).add(u).add(5).value,t.score=u}else if(2==n){var l=Fixed.value(.5).add(t.deadNum).value,u=5;u=Fixed.value(2.5).mul(s).div(o).add(u).value,u=Fixed.value(t.killNum).div(l).pow(.5).mul(5.5).add(u).value,t.score=u}else 4==n?t.score=5:t.score=t.winSide==t.side?15:7.5},t.prototype.getPvPResultExtra=function(e,t){return{winSide:e,verifyKey:t,startSeconds:this.startSeconds}},t.prototype.getCameraFollow=function(){var e=this,t=e.player,i=e.master;if(3==e.playType){var r=e.blueAgent,n=e.redAgent;if(r&&n)return t.side==r.side?r.avatar:n.avatar}else{if(i&&i.hold&&!i.isDead)return i;var a=t.avatar;if(!a)return i;if(!a.isDead)return a;for(var o=0,s=e.avatarList;o<s.length;o++){var l=s[o];if(!l.isDead&&l.side==t.side)return l}}return i},t.prototype.getCurFightAgent=function(e){return this.blueAgentInfo.side==e?this.blueAgent:this.redAgent},t.prototype.getTeamList=function(e){void 0===e&&(e=0);var t=this;e=e||t.player.side;var i=t.agentInfoList.filter(function(t){return t.side==e});return ArrayUtils.sortOn(i,["order"],[16]),i},t.prototype.getAgentInfoList=function(e){var t,i=this,r=i.agentInfoList,n=i.blueAgentInfo,a=i.redAgentInfo;return 3==this.playType?(t=r.filter(function(t){return t.side==e&&t!=n&&t!=a}),ArrayUtils.sortOn(t,["order"],[16]),n&&a&&t.unshift(n.side==e?n:a)):(t=r.filter(function(t){return t.side==e}),ArrayUtils.sortOn(t,["hold","order"],[18,16])),t},t.prototype.getFightAgent=function(e){for(var t=this.avatarList,i=0,r=t;i<r.length;i++){var n=r[i];if(!n.isDead&&n.side==e)return n.agent}return null},t.prototype.getSideAgentNum=function(e){var t=0;return this.agentInfoList.forEach(function(i){i.side==e&&t++}),t},t.prototype.isNextUp=function(e){var t=this,i=t.agentRids[e];if(!i)return!1;var r=t.agentInfos[e],n=1==i.side?t.blueAgentInfo:t.redAgentInfo;if(!n)return!1;if(r.order<=n.order)return!1;for(var a,o=t.agentInfoList,s=0,l=o.length;l>s;s++)if(a=o[s],!(a.order<=n.order)&&a.agent&&a.order==r.order)return!0;return!1},t.prototype.getTeamSlotIdByRid=function(e){for(var t,i=this.agentRids[e],r=i&&i.side?i.side:1,n=this.battleSideList[r],a=0,o=n.length;o>a;a++)if(t=n[a],t.rid==e)return a+2;return 1},t.prototype.isAgentFight=function(e){var t=this;return 3==t.playType?t.blueAgent==e||t.redAgent==e:!t.player.viewer},t.prototype.checkPlayerLeaved=function(){var e=this;if(4==e.status){var t,i,r=e.battleSideList,n=[];for(var a in r)t=[],i=r[a],i&&i.forEach(function(e,i){(!e.agent||e.isDead)&&t.push(i)}),t.forEach(function(e){i.splice(e,1)}),i.length&&n.push(+a);n.length<=1&&e.passRound(n[0]||0)}},t.prototype.checkCanTickTime=function(){var e=this;return!e.isPause&&!e.pauseFrame&&!e.pauseTime&&e.isPlaying},t.prototype.clearPreWarTime=function(){var e=this.preWarTimeId;e&&(this.removeCallLaterIdx(e),this.preWarTimeId=0)},t.prototype.clearStartRoundDelay=function(){var e=this.startRoundDelayId;e&&(this.removeCallLaterIdx(e),this.startRoundDelayId=0)},t.prototype.clearStartRoundWait=function(){var e=this.startRoundWaitId;e&&(this.removeCallLaterIdx(e),this.startRoundWaitId=0)},t.prototype.onDestroy=function(){e.prototype.onDestroy.call(this),ObjectUtils.clearKeys(this,["playCfg","battleSideList","blueAgent","redAgent","blueAgentInfo","redAgentInfo"])},t}(Room);__reflect(PvPRoom.prototype,"PvPRoom"),window.PvPRoom=PvPRoom;var RCity=function(e){function t(t,i,r,n){return void 0===i&&(i=0),void 0===r&&(r=null),void 0===n&&(n=null),e.call(this,t,i,r,n)||this}return __extends(t,e),t}(City);__reflect(RCity.prototype,"RCity"),window.RCity=RCity;var RelayRoom=function(e){function t(t,i,r,n){void 0===i&&(i=0),void 0===r&&(r=null),void 0===n&&(n=null);var a=e.call(this,t,i,r,n)||this;return a.monsterIdx=0,a.killedMonsterNum=0,a.killedBossNum=0,a.overMinNum=0,a.overMaxNum=0,a.finishLinex=0,a.syncDataTime=0,a.prepareTime=0,a.scores={},a.scoreList=[],a.newmons=[],a}return __extends(t,e),Object.defineProperty(t.prototype,"petTickAI",{get:function(){return this.isPlaying||this.isPass},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fruitTickAI",{get:function(){return this.isPlaying||this.isPass},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scenePanelId",{get:function(){return 120},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"score",{get:function(){var e=this.scoreList.length;return this.scoreList.forEach(function(t){t.isMiss&&(e=Math.max(e-1,0))}),e},enumerable:!0,configurable:!0}),t.prototype.onStartSeconds=function(){e.prototype.onStartSeconds.call(this),this.changeScoreVal(1,this.startSeconds,!0)},t.prototype.onCreate=function(){e.prototype.onCreate.call(this);var t=this;if(t.playCfg=Data.getItem("GamePlayData",t.playId),t.dungeonCfg=Data.getItem("DungeonData",t.dungeonId),t.roomCfg.score){var i=t.dungeonCfg.score;if(i){var r,n=t.scores,a=t.scoreList;i.forEach(function(e,i){r={index:i+1,type:e.type,val:e.val||0,num:0},17==r.type&&(r.num=100),r.isMiss=t.isScoreMiss(r.type,r.num,r.val),n[r.index]=r,a.push(r)})}}},t.prototype.onTickTime=function(t){e.prototype.onTickTime.call(this,t);var i=this;if(i.syncDataTime--,i.syncDataTime<=0&&i.syncRoomData(),10==this.battleCfg.passType){var r=i.player;r&&r.avatar&&r.avatar.x>=i.finishLinex&&i.passRound()}},t.prototype.onSceneStartedBefor=function(){e.prototype.onSceneStartedBefor.call(this),this.startFirstRound()},t.prototype.startFirstRound=function(){var e=this;e.setRoundData(1),e.addCallLater(e.delayCreateAvatar,e,1,!1,!1),e.initAllPos()},t.prototype.initAllPos=function(){var e,t=this,i=!t.battleCfg.dir;t.avatarList.forEach(function(r){e=t.getBornPos(r.side,r.agent.teamSlotId),r.updatePos(e.x||0,e.y||0,0,i)}),t.petList.forEach(function(r){e=t.getBornPos(r.side,r.agent.teamSlotId),r.updatePos(e.x||0,e.y||0,0,i)}),t.fruitList.forEach(function(r){e=t.getBornPos(r.side,r.agent.teamSlotId),r.updatePos(e.x||0,e.y||0,0,i)})},t.prototype.delayCreateAvatar=function(){this.agentList.forEach(function(e){e.createAvatar(),e.createFruit()})},t.prototype.setRoundData=function(e){var t=this;if(!t.isPlaying){var i=t.dungeonCfg.battleList[e-1],r=Data.getItem("BattleData",i);if(r){var n=r.passType;if(t.roundId=e,t.battleId=i,t.battleCfg=r,t.maxWave=r.waveNum||0,t.bgm=r.bgm,t.setMapId(r.roundMap),6==n){var a=(r.passParam||"").split(",");t.monsterDropType=+a[0]||0,t.overMaxNum=+a[1]||1}if(8==n){var a=(r.passParam||"").split(",");t.monsterDropType=+a[0]||0,t.overMaxNum=0}else if(3==n)t.overMinNum=+(r.passParam||"");else if(7==n){var a=(r.passParam||"").split(",");t.overMinNum=+a[0]||0,t.overMaxNum=+a[1]||0}else if(10==n){var a=(r.passParam||"").split(",");t.finishLinex=+a[0]||0}}}},t.prototype.setBgmData=function(e){var t=this,i=t.dungeonCfg.battleList[e-1],r=Data.getItem("BattleData",i);t.bgm=r.bgm},t.prototype.onSceneStartedAfter=function(){e.prototype.onSceneStartedAfter.call(this);var t=this;!t.dungeonCfg.hideStart&&PanelMgr.open(200,{scene:t}),t.initControl();var i=t.battleCfg.prepare;i?t.startPrepare(i):t.onPrepareEnd()},t.prototype.onRoundStarted=function(){4==this.battleCfg.passType&&this.passRound()},t.prototype.passRound=function(e){void 0===e&&(e=0);var t=this;if(t.isPlaying){var i=t.roundId+1;t.dungeonCfg.battleList[i-1]?t.player&&t.player.syncPassRound(t.roundId,t.player.side):t.syncPvEResult(1)}},t.prototype.onPassRound=function(t){e.prototype.onPassRound.call(this,t);var i=this;i.setStatus(5),i.showPortal(),i.clearSpawns(),i.clearMonster(!1)},t.prototype.clearMonster=function(e){var t,i=this;i.monsterList.concat().forEach(function(r){r.ownereid&&(t=i.sprites[r.ownereid]),(e||0==r.side&&!r.ownereid||t&&0==t.side)&&(i.deads[r.$eid]=!0,!r.isDead&&r.dead(!0,!1,!1))})},t.prototype.onAgentNextRound=function(){for(var e=this,t=e.agentList,i=!0,r=!1,n=0,a=t;n<a.length;n++){var o=a[n];o.isDead||(o.isReadyNext?r=!0:i=!1)}i?(e.stopPortalTimeOut(),e.onStopRound()):r&&e.startPortalTimeOut()},t.prototype.startPortalTimeOut=function(){var e=this;if(!e.portalOverTime){var t=Data.getSysValue("BATTLE_PORTAL_OVER_TIME");e.portalTimeOutId=e.addCallLater(e.onStopRound,e,t,!0,!1),e.portalOverTime=DateUtils.serverNow+1e3*t,e.agentList.forEach(function(e){!e.isDead&&e.avatar&&e.avatar.guise&&e.avatar.guise.showPortalTime()})}},t.prototype.stopPortalTimeOut=function(){var e=this;e.clearPortalTime(),e.portalOverTime&&(e.portalOverTime=0,e.agentList.forEach(function(e){!e.isDead&&e.avatar&&e.avatar.guise&&e.avatar.guise.hidePortalTime()}))},t.prototype.onStopRound=function(){var e=this;e.isPass&&(e.stopPortalTimeOut(),e.clearMonster(!0),e.setStatus(7),e.hasBossDrop=!1,e.hidePortal(),e.roleList.concat().forEach(function(e){e.visible_guise=!1}),e.addCallLater(e.onPortalEffect,e,12,!1,!1),e.addCallLater(e.onPortalComplete,e,36,!1,!1))},t.prototype.onPortalEffect=function(){this.guise&&this.guise.playSplashEffect(this.$eid,1)},t.prototype.onPortalComplete=function(){var e=this;e.isOver||(e.clearPortalTime(),e.portalOverTime=0,e.deads={},e.spriteList.concat().forEach(function(e){e.onStopPvERound()}),e.onSceneStop(),e.startLoadNextRound())},t.prototype.startLoadNextRound=function(){var e=this;e.waitLoadNextRound=!0,e.loadNextRoundTimeId=e.addOnceTimer(Data.getSysValue("ROUND_LOAD_TIMEOUT"),e.onNextRoundLoaded);var t=e.roundId+1,i=e.dungeonCfg.battleList[t-1],r=PreloadUtils.getPreloadUrls(e,i,e.playerInfos);e.loader.unload(),e.loader.loadResByUrlItems(r,3,e.onNextRoundLoaded,e)},t.prototype.onNextRoundLoaded=function(){var e=this;e.waitLoadNextRound&&(e.waitLoadNextRound=!1,e.addOnceTimer(0,e.syncNextRoundLoaded))},t.prototype.syncNextRoundLoaded=function(){var e=this;e.needVerify&&RecordMgr.record(42,e.roomsn,e.$eid),e.clearNextLoadTime(),e.isRoundLoad&&e.agentList.forEach(function(e){(e.hold||e.isRobot)&&e.syncNextRoundLoaded()})},t.prototype.onAgentNextRoundLoaded=function(){for(var e=this,t=e.agentList,i=!0,r=0,n=t;r<n.length;r++){var a=n[r];a.isRoundLoaded||(i=!1)}i?(e.clearWaitNextRoundStart(),e.startNextRound()):e.waitNextRoundStarId||(e.waitNextRoundStarId=e.addCallLater(e.startNextRound,e,600,!1,!1))},t.prototype.clearNextLoadTime=function(){var e=this;e.waitLoadNextRound=!1;var t=e.loadNextRoundTimeId;t&&(e.delTimer(t),e.loadNextRoundTimeId=0)},t.prototype.clearWaitNextRoundStart=function(){var e=this,t=e.waitNextRoundStarId;t&&(e.removeCallLaterIdx(t),e.waitNextRoundStarId=0)},t.prototype.startNextRound=function(){var e=this;e.isPlaying||(e.clearNextLoadTime(),e.clearWaitNextRoundStart(),e.setRoundData(e.roundId+1),e.player.syncNextRoundStarted(e.roundId),e.createGuise(),e.resetFrameTime(),e.onSceneStart(),e.guise&&e.guise.stopSplashEffect(e.$eid,1),e.spriteList.concat().forEach(function(e){e.onNextRound()}),e.initAllPos(),e.startRound(),e.initCamera(),e.createClientSprite(),e.agentList.forEach(function(e){!e.isDead&&e.avatar&&e.avatar.guise&&e.avatar.guise.hidePortalTime()}),App.dispatch("c60"),e.addCallLater(e.onRoundStarted,e,1,!1,!1))},t.prototype.startPrepare=function(e){var t=this;t.setStatus(3),t.prepareTime=t.stepTotal+60*e,t.prepareTimeId=t.addCallLater(t.onPrepareEnd,t,e,!0,!0),App.dispatch("c112")},t.prototype.onPrepareEnd=function(){var e=this;e.addCallLater(e.startRound,e,1,!1,!1),e.addCallLater(e.onRoundStarted,e,2,!1,!1)},t.prototype.startRound=function(){var e=this;e.clearPrepareTime(),e.setStatus(4),e.monsterIdx=0,e.killedMonsterNum=0,e.killedBossNum=0,e.monsterDrops={},e.startWave(1)},t.prototype.startWave=function(e){var t=this;t.curWave=e,t.isWaveFinish=!1,t.hasCheckWaveFinish=!0,t.clearSpawns(),t.clearWaveTime();var i=t.battleCfg.waveTimes,r=i?i[0]||0:0;r>0?(t.waveTime=t.stepTotal+60*r,t.waveTimeId=t.addCallLater(t.initSpawnPoints,t,r,!0,!0,e)):(t.waveTime=0,t.initSpawnPoints(e)),App.dispatch("c109")},t.prototype.initSpawnPoints=function(e){var t=this,i=t.battleCfg,r=i.data||[],n=i.spawnTypes;if(t.waveTime=0,t.clearWaveTime(),!n){var a,o;n=i.spawnTypes={},r.forEach(function(e,t){a=e.refreshType||0,o=n[a],o||(o=n[a]=[]),o.push(t+1)})}var s,l=t.spawns;r.forEach(function(e,t){s=BattleSpawnInfo.create(t+1,e),l.push(s)});var u=i.waveEffId;if(u){var c=Data.getItem("BattleEffectData",u);if(c&&c.datas){var p=c.datas[e-1];p&&t.guise&&t.guise.playSceneEffect(p.res,p.action,p.x||0,p.y||0)}}t.trigTypeSpawnPoint(e,0),t.trigTypeSpawnPoint(e,1),t.trigRandomSpawnPoints(e),t.dealNewMonsters()},t.prototype.trigTypeSpawnPoint=function(e,t){var i=this,r=i.battleCfg,n=r.data;if(n&&r.spawnTypes){var a=r.spawnTypes[t];if(a){var o,s;a.forEach(function(t){o=n[t-1],s=o.wave||0,(0==s||0==e||s==e)&&i.triggerSpawn(t)})}}},t.prototype.trigRandomSpawnPoints=function(e){var t=this,i=t.seedr,r=t.battleCfg,n=r.data;if(n){var a=r.spawnTypes[7];if(a){var o,s;a.forEach(function(r){if(o=n[r-1],s=o.wave||0,0==s||0==e||s==e){var a=i.random;Fixed.value(a).mul(1e4).value<=+(o.refreshParam||"")&&t.triggerSpawn(r)}})}}},t.prototype.trigDeadSpawnPoints=function(e,t){var i=this,r=i.battleCfg,n=r.data;if(n){var a=r.spawnTypes[7];if(a){var o,s;a.forEach(function(r){o=n[r-1],s=o.wave||0,0!=s&&0!=e&&s!=e||t!=+(o.refreshParam||"")||i.triggerSpawn(r)})}}},t.prototype.trigTimeSpawnPoints=function(e){var t=this;if(t.isPlaying){var i=t.spawns;if(i.length){var r,n,a=t.stepTotal;i.forEach(function(i){if(i.enable&&!i.isok&&!i.pause&&i.refreshTime&&i.time+i.refreshTime<=a&&(r=i.spawnCfg,n=r.wave||0,0==n||0==e||n==e)){var o=i.addnum,s=(r.refreshNum||0)+o,l=(r.maxRefreshNum||0)+o;(0==s||i.count<s)&&i.num<l&&t.spawnMonster(i)}})}}},t.prototype.triggerSpawn=function(e){var t=this.spawns[e-1];t&&!t.enable&&(t.enable=!0,t.isok=!1,t.pause=!1,this.spawnMonster(t))},t.prototype.spawnMonster=function(e){var t=this,i=e.spawnId,r=e.spawnCfg,n=e.addnum,a=(r.refreshNum||0)+n,o=(r.maxRefreshNum||0)+n;if((0==a||e.count<a)&&e.num<o&&(!e.refreshTime||!e.time||e.time+e.refreshTime<=t.stepTotal)){var s=0==a?999:a-e.count,l=Math.min(o-e.num,s,e.timesnum),u=t.newmons,c=void 0;e.time=t.stepTotal;for(var p=0;l>p;p++)t.monsterIdx++,c=t.createSpawnMonsterInfo(i,t.monsterIdx,r),u.push(c),e.count++,e.num++}},t.prototype.createSpawnMonsterInfo=function(e,t,i){var r=this,n=ObjectPool.pop(SpawnMonsterInfo);if(n.init(),n.roomsn=r.roomsn,n.ownereid=0,n.side=0,n.spawnId=e,n.idx=t,n.monsterId=i.monsterId||0,n.type=i.monsterType||0,n.name=i.name||"",n.posType=i.posType||1,n.x=i.x||0,n.y=i.y||0,n.offx=i.offx||0,n.offy=i.offy||0,n.radius=i.radius||0,n.randomh=i.randomh||0,n.dir=i.dir||0,n.lvId=i.monsterLevel||0,n.ai=i.ai||0,n.eskillId=i.enter||0,n.effect=i.effect,n.propsRate=i.monsterRate||0,n.refreshType=i.refreshType||0,n.refreshParam=i.refreshParam||"",n.extraBuffs=void 0,i.sRate&&i.vGroupId){var a=r.seedr.random;Fixed.value(a).mul(1e4).value<=i.sRate?n.variants=DropUtils.dropVariant(i.vGroupId,r.seedr):n.variants=[]}else n.variants=[];return n},t.prototype.dealNewMonsters=function(){var e=this;if(!e.pauseFrame){var t=e.newmons;if(t.length){var i=t.concat();t.length=0,i.forEach(function(t){var i=0==t.refreshType?+t.refreshParam||4:4;e.delayMonsterCount+=i,e.addCallLater(e.createMonster,e,e.delayMonsterCount,!1,!0,t,!1)})}}},t.prototype.onMonsterDeadBegin=function(t,i,r){e.prototype.onMonsterDeadBegin.call(this,t,i,r);var n=this,a=n.spawns[t.spawnId-1];a.num=Math.max(0,a.num-1),r&&(n.killedMonsterNum++,t.isBoss&&(n.killedBossNum++,n.syncDataDirty=!0),t.isMetalPail&&(n.changeScoreVal(18,1,!1),App.dispatch("c93",{killer:i,target:t.$eid})))},t.prototype.onMonsterDeadAfter=function(t,i,r){e.prototype.onMonsterDeadAfter.call(this,t,i,r);var n=this,a=n.battleCfg,o=a.passType||1,s=!1;1==o?t.isBoss&&(s=!0):3==o?n.killedMonsterNum>=+(a.passParam||"")&&(s=!0):5==o?n.killedBossNum>=+(a.passParam||"")&&(s=!0):7==o&&n.killedMonsterNum>=n.overMaxNum&&(s=!0),s?n.passRound():(n.trigDeadSpawnPoints(n.curWave,t.monsterId),n.spawnNextMonster())},t.prototype.spawnNextMonster=function(){var e=this;if(e.isPlaying){var t,i=e.spawns;i.forEach(function(i){if(i.enable&&!i.isok&&!i.pause){t=i.spawnCfg;var r=i.addnum,n=(t.refreshNum||0)+r,a=(t.maxRefreshNum||0)+r;(0==n||i.count<n)&&i.num<a&&!i.refreshTime&&e.spawnMonster(i),0!=n&&i.count==n&&0==i.num&&(i.isok=!0,e.hasCheckWaveFinish=!0)}}),e.dealNewMonsters(),e.hasCheckWaveFinish&&(e.hasCheckWaveFinish=!1,e.checkRoomWave())}},t.prototype.checkRoomWave=function(){var e=this;if(!e.isWaveFinish){var t=e.spawns;if(0!=t.length){var i=0;if(t.forEach(function(e){e.enable&&!e.isok&&(i+=1)}),0==i){var r=e.battleCfg,n=r.passType||1,a=r.bossPos||e.maxWave+1;2==n&&a==e.curWave?e.passRound():e.startNextWave()}}}},t.prototype.startNextWave=function(){var e=this;e.isWaveFinish=!0,e.curWave=Math.min(e.curWave+1,e.maxWave),e.startWave(e.curWave)},t.prototype.doEnterFrame=function(){e.prototype.doEnterFrame.call(this);var t=this,i=t.curWave;t.trigTypeSpawnPoint(i,1),t.trigTimeSpawnPoints(i),t.dealNewMonsters()},t.prototype.checkPlayerLeaved=function(){for(var e=this,t=!0,i=0,r=e.agentInfoList;i<r.length;i++){var n=r[i];if(n.agent&&!n.isDead){t=!1;break}}t?e.checkAllowRelive()?e.waitReliveTimeId||(e.waitReliveTimeId=e.addCallLater(e.syncPvEResult,e,Data.getSysValue("BATTLE_RELIVE_TIME"),!0,!1,2)):e.syncPvEResult(2):e.clearReliveTime()},t.prototype.clearReliveTime=function(){var e=this.waitReliveTimeId;e&&(this.removeCallLaterIdx(e),this.waitReliveTimeId=0)},t.prototype.onWin=function(t,i,r,n){for(var a=[],o=4;o<arguments.length;o++)a[o-4]=arguments[o];e.prototype.onWin.apply(this,[t,i,n].concat(a));var s=this;this.agentInfos[s.player.rid];s.exp=t,s.battleOver(1,this.getBattleResultParams(1))},t.prototype.onFail=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];e.prototype.onFail.apply(this,t),this.battleOver(2,this.getBattleResultParams(2))},t.prototype.battleOver=function(t,i){void 0===i&&(i=null);var r=this;r.clearPortalTime(),r.clearSpawns(),r.clearMonster(!1),e.prototype.battleOver.call(this,t,i)},t.prototype.onLeaveMap=function(){e.prototype.onLeaveMap.call(this);var t=this;if(t.resultPanelId instanceof Array)for(var i=0,r=t.resultPanelId;i<r.length;i++){var n=r[i];PanelMgr.close(n)}else PanelMgr.close(t.resultPanelId);PanelMgr.close(200),Player["in"]&&SceneMgr.onLeavScene(!1)},t.prototype.changeScoreVal=function(e,t,i){var r=this;if(r.roomCfg&&r.roomCfg.score&&!r.isOver){for(var n,a=!1,o=r.player,s=0,l=r.scoreList;s<l.length;s++){var u=l[s];u.type==e&&(n=u.isMiss,u.num=i?t:u.num+t,u.isMiss=r.isScoreMiss(e,u.num,u.val),o&&n!=u.isMiss&&(a=!0,o.syncChangeScore(u.index,u.num)))}a&&App.dispatch("c54")}},t.prototype.showDrawCard=function(){},t.prototype.onTrigDrop=function(e,t,i,r,n){},t.prototype.onBattleTimeOut=function(){e.prototype.onBattleTimeOut.call(this);var t=this,i=t.battleCfg,r=i.passType||1;8==r?t.syncPvEResult(1):7==r?t.syncPvEResult(t.killedMonsterNum>=t.overMinNum?1:2):9==r?t.syncPvEResult(1):t.syncPvEResult(2)},t.prototype.onBattNpcDead=function(t,i,r){e.prototype.onBattNpcDead.call(this,t,i,r);var n=this;n.isProtNpcDead||t.battNpcId!=n.battleCfg.pNpcId||(n.isProtNpcDead=!0,n.syncPvEResult(2))},t.prototype.syncPvEResult=function(e){var t=this;if(!t.isWaitVerify&&!t.isOver&&t.player){var i=t.playId;(13==i||17==i||15==i||16==i||24==i)&&(e=1),t.setStatus(8);var r=[];t.roleList.forEach(function(e){r.push(e.getRoleInfo())}),0==t.startSeconds&&(t.startSeconds=1,t.changeScoreVal(1,t.startSeconds,!0)),t.syncRoomData();var n=13==i||24==i?t.selfDamage:0;t.needVerify&&RecordMgr.recordRoomInfo(t),t.needVerify&&RecordMgr.record(33,t.roomsn,t.$eid,1,r,n),t.onBattleOverVerify(e,"")}},t.prototype.syncRoomData=function(){var e=this;if(e.syncDataDirty){var t=e.monsterDrops,i=e.smonsterDrops,r=void 0,n=void 0;for(var a in t)i||(i=e.smonsterDrops={}),r=t[a]||0,n=i[a]||0,r>n&&(i[a]=r,e.player.syncMonsterSpecialDrop(+a,r-n))}e.syncDataDirty=!1,e.syncDataTime=60},t.prototype.onBattleOverVerify=function(e,t){var i=this;i.clearPrepareTime(),i.clearWaveTime(),1==e&&i.changeScoreVal(4,i.startSeconds,!0),i.setBattleDamages(),i.syncBattleResult(JSON.stringify(i.getPvEResultExtra(e,t)))},t.prototype.setAgentBattleDamage=function(t,i){e.prototype.setAgentBattleDamage.call(this,t,i),t.score=5},t.prototype.getPvEResultExtra=function(e,t){return{type:e,verifyKey:t,startSeconds:this.startSeconds}},t.prototype.getMonsterDropNum=function(e){return this.monsterDrops?this.monsterDrops[e]||0:0},t.prototype.getRaceDistance=function(){var e=this,t=e.player,i=0;if(t&&t.avatar)for(var r=e.dungeonCfg.battleList,n=e.roundId,a=r.length,o=e.getBornPos(t.side,t.teamSlotId),s=o.x||0,l=void 0,u=void 0,c=1;a>=c;c++)if(l=Data.getItem("BattleData",r[c-1]),u=l.maxRace||0,n>c)i=Fixed.value(i).add(u).value;else if(n==c){i=n==a&&t.avatar.x>=e.finishLinex?Fixed.value(i).add(u).value:Fixed.value(t.avatar.x).sub(s).max(0).min(u).add(i).value;break}return i},t.prototype.getPlotParamData=function(e){return{dungeonId:this.dungeonId,win:1===e,fail:2===e}},t.prototype.getProtNpc=function(){for(var e=this.battleCfg.pNpcId,t=0,i=this.battNpcList;t<i.length;t++){var r=i[t];if(r.battNpcId==e)return r}return null},t.prototype.getBattleResultParams=function(t){var i=this,r=e.prototype.getBattleResultParams.call(this,t);return r.exp=i.exp||0,r.score=i.score,r.scoreList=i.scoreList,r.dungeonId=i.dungeonId,r.firstFlag=i.player.firstFlag,r},t.prototype.checkSpecialItem=function(){},t.prototype.openSpecialResult=function(e){UI.open("ResultSpecialItemUI",e)},t.prototype.isScoreMiss=function(e,t,i){switch(e){case 1:case 2:case 5:case 9:case 10:case 11:case 13:case 14:case 15:case 16:case 3:return t>i;case 4:case 12:case 17:case 18:return i>t;case 6:case 7:case 8:return t>=i;default:return!0}},t.prototype.checkCanTickTime=function(){var e=this;return!(e.isPause||e.pauseFrame||e.pauseTime||e.isWaitVerify||e.isOver||e.isRoundWait)},t.prototype.getEquipScore=function(){return this.dungeonCfg.equipScore||0},t.prototype.getVerifyPower=function(){return this.dungeonCfg.verifyPower||0},t.prototype.isLimitVerifyPower=function(e){var t=this,i=t.getVerifyPower();if(!i)return!1;t.playCfg.isParty&&(i=Fixed.value(t.agentInfoList.length).mul(i).value);var r=0,n=18==t.playId;return t.agentInfoList.forEach(function(t){t.side==e&&(r=n?Fixed.value(r).add(t.petAbility||0).value:Fixed.value(r).add(t.ability||0).value)
}),i>r},t.prototype.updateAbilityVerify=function(){var e=this,t=e.agentList;if(t)for(var i=e.player,r=i?e.isLimitVerifyPower(i.side):!1,n=0,a=t;n<a.length;n++){var o=a[n];r?(o.abilityVerifyInc=.5,o.abilityVerifyDec=.85):(o.abilityVerifyInc=0,o.abilityVerifyDec=0)}},t.prototype.clearSpawns=function(){var e=this,t=e.spawns;t&&t.forEach(function(e){e.dispose()}),e.spawns=[];var i=e.newmons;i&&i.forEach(function(e){e.dispose()}),e.newmons=[]},t.prototype.clearWaveTime=function(){var e=this.waveTimeId;e&&(this.removeCallLaterIdx(e),this.waveTimeId=0)},t.prototype.clearPrepareTime=function(){var e=this.prepareTimeId;e&&(this.removeCallLaterIdx(e),this.prepareTimeId=0)},t.prototype.onDestroy=function(){var t=this;t.clearSpawns(),ObjectUtils.clearKeys(t,["playCfg","dungeonCfg","spawns","newmons","scores","scoreList","monsterDrops","smonsterDrops"]),e.prototype.onDestroy.call(this)},t}(Room);__reflect(RelayRoom.prototype,"RelayRoom"),window.RelayRoom=RelayRoom;var GuisePlayerInfo=function(e){function t(){return e.call(this)||this}return __extends(t,e),Object.defineProperty(t.prototype,"body",{get:function(){if(this.fashionId){var e=Data.getItem("ClothData",this.fashionId);return e.res}var t=Data.getItem("JobData",this.job);return t.dragonBones},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"title",{get:function(){if(this.titleId){var e=Data.getItem("TitleData",this.titleId);return e.res}return null},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"titleName",{get:function(){if(this.titleId){var e=Data.getItem("TitleData",this.titleId);return e.name}return null},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"weapon",{get:function(){return null},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"wing",{get:function(){if(this.wingFasId){var e=Data.getItem("WingSkinData",this.wingFasId);return e.exteriorRes+"_"+this.job}return""},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"halo",{get:function(){return null},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"spineParts",{get:function(){var e={},t=this.weapon,i=this.wing;return e[1]={part:1,resId:this.body,url:Urls.spine()},t&&(e[2]={part:2,resId:t,url:Urls.spine()}),i&&(e[3]={part:3,resId:i,url:Urls.spine()}),e},enumerable:!0,configurable:!0}),t.prototype.onDispose=function(){ObjectUtils.clearKeys(this,["titleId","fashionId","weaponId","weaFasId","wingFasId","haloId"])},t}(BasePlayerInfo);__reflect(GuisePlayerInfo.prototype,"GuisePlayerInfo",["IGuisePlayerInfo"]),window.GuisePlayerInfo=GuisePlayerInfo;var BaseAI=function(e){function t(){var t=e.call(this)||this;return t.aistate=0,t.actionIndex=-1,t}return __extends(t,e),t.regAction=function(e,t){this.actionClss[e]=t},t.getActionCls=function(e){return this.actionClss[e]},t.regTrig=function(e,t){this.trigClss[e]=t},t.getTrigCls=function(e){return this.trigClss[e]},Object.defineProperty(t.prototype,"canTickAI",{get:function(){var e=this.owner,t=e.scene;return this.aiId&&!this.hasSkillTrig&&e&&!e.isDead&&t&&!t.isPause&&t.isControl&&t.isPlaying&&!e.beControl&&e.state.hasState(112)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"canTrig",{get:function(){return!0},enumerable:!0,configurable:!0}),t.prototype.onCreate=function(){var e=this;e.trigList=[],e.trigs={};var t=e.owner.aiId||e.owner.heroCfg.ai;t&&e.changeAI(t,!1)},t.prototype.changeAI=function(e,t){var i=this;i.stop(),i.aiId=e;var r=i.aiCfg=Data.getOppItem("AIData",e);i.idleCfg=Data.getOppItem("AIActionData",r.idle),i.battleCfg=Data.getOppItem("AIActionData",r.battle),t&&i.clearTrigs(),i.owner.scene&&r.trig&&i.addTrig(r.trig)},t.prototype.changeBattleAction=function(e){this.stop(),this.battleCfg=Data.getOppItem("AIActionData",e)},t.prototype.addTrig=function(e){var i,r,n=this,a=n.owner.scene,o=n.trigList,s=n.trigs,l=n.attTrigs,u=Data.getItem("AITrigData",e);u.datas&&u.datas.forEach(function(u){r=Data.getItem("AISubTrigData",u.subId),!n.checkTrigInitAct(r,!0)||s[e]&&r.id in s[e]||(i=ObjectPool.pop(t.getTrigCls(r.type)),i.initialize(n,e,r),o.push(i),s[e]||(s[e]={}),s[e][i.subId]=i,i.isAllEffect&&a&&a.addAITrig(i),37==i.type&&i instanceof AITrig_PropChange&&(l||(l=n.attTrigs={}),i.attName1&&(l[i.attName1]=!0),i.attName2&&(l[i.attName2]=!0)))})},t.prototype.checkTrigInitAct=function(e,t){var i=this.owner,r=i.scene;switch(e.actType){case 1:return!0;case 2:return t?!1:!0;case 3:return r instanceof MainTimeLimitRoom?!0:r instanceof InfernalHellRoom?r.isTimeLimit:!1;case 4:return r.isAllPetUp||r.isPetSally;case 5:return!0;case 6:var n=e.actVal;return n&&r instanceof RelayRoom&&r.dungeonId?-1!=n.indexOf(r.dungeonId):!1;case 7:var n=e.actVal||[],a=n[0]||0;if(!a)return!1;for(var o=i.svrBuffs,s=0,l=o;s<l.length;s++){var u=l[s];if(u.lv>0&&a==u.buffId)return!0}return!1;case 8:var n=e.actVal||[],c=n[0]||0;return i.agent&&i.agent.hellLvId>=c;case 9:var n=e.actVal||[],p=i.skill.getSkillInfo(n[0]);return p&&p.skillLv>=(n[1]||0);case 10:var n=e.actVal;return n?-1!=n.indexOf(r.playId):!1;case 11:return r instanceof RelayRoom;case 12:return r instanceof PvPRoom;case 13:if(i.scene.roomCfg.ability&&i.scene instanceof RelayRoom&&r.player){var d=i.scene.getEquipScore();return 18==i.scene.playId?r.player.petAbility>d:r.player.ability>d}return!1;case 14:var n=e.actVal,f=n?n[0]:0;return f&&i.agent&&i.agent.equipSkills?!!i.agent.equipSkills[f]:!1;case 15:var n=e.actVal;return n&&r instanceof FairyLandTrialsRoom&&-1!=n.indexOf(r.trialsCfg.t);default:return!0}},t.prototype.activeTrigs=function(e,i){var r,n,a=this,o=a.owner.scene,s=a.trigList,l=a.trigs,u=a.attTrigs,c=l[e],p=Data.getItem("AITrigData",e),d=!1;i.forEach(function(f){if(d=!1,p.datas)for(var h=0,v=p.datas;h<v.length;h++){var m=v[h];if(-1!=i.indexOf(m.subId)){d=!0;break}}d&&(n=Data.getItem("AISubTrigData",f),!n.skipAct&&!a.checkTrigInitAct(n,!1)||c&&c[f]||(r=ObjectPool.pop(t.getTrigCls(n.type)),r.initialize(a,e,n),s.push(r),c||(l[e]=c={}),c[f]=r,r.isAllEffect&&o&&o.addAITrig(r),37==r.type&&r instanceof AITrig_PropChange&&(u||(u=a.attTrigs={}),r.attName1&&(u[r.attName1]=!0),r.attName2&&(u[r.attName2]=!0))))})},t.prototype.onHalfSecond=function(e){this.curAction&&this.curAction.onHalfSecond(e)},t.prototype.onEnterFrame=function(e){var t=this;this.tickAI(),t.owner.scene.isControl&&t.trigList.forEach(function(t){t.onEnterFrame(e)}),t.curAction&&t.curAction.onEnterFrame(e)},t.prototype.onEnterScene=function(){var e=this.owner.scene,t=this.aiCfg;e&&t&&t.trig&&this.addTrig(t.trig)},t.prototype.tickAI=function(){var e=this,t=e.aistate;if(e.canTickAI)if(0==t)e.enterIdleState();else if(1==t){var i=e.target;i||(i=e.owner.scene.findViewEnemy(e.owner,e.aiCfg.sight||0,e.aiCfg.priorSign),i&&e.changeTarget(i)),i&&e.enterBattleState()}else if(2==t){if(!e.target){var i=e.owner.scene.findViewEnemy(e.owner,e.aiCfg.sight||0,e.aiCfg.priorSign);i&&e.changeTarget(i)}!e.curAction&&e.battleCfg.actions&&e.gotoNextAction(e.battleCfg,e.actionIndex)}},t.prototype.changeTarget=function(e){var t=this,i=t.target,r=t.owner;i!=e&&(i&&(i.removeListener("onDead",t.onTargetDead,t),i.removeListener("onLeaveScene",t.onTargetDead,t),i.removeListener("onPetFuse",t.onTargetDead,t),i.removeListener("onPetHide",t.onTargetDead,t),i.removeListener("onInvisible",t.onTargetDead,t),r&&r.signEffId&&i.onStopSign(r.signEffId)),t.target=e,e?(e.addListener("onDead",t.onTargetDead,t),e.addListener("onLeaveScene",t.onTargetDead,t),e.addListener("onPetFuse",t.onTargetDead,t),e.addListener("onPetHide",t.onTargetDead,t),e.addListener("onInvisible",t.onTargetDead,t),r&&r.signEffId&&e.onStartSign(r.signEffId)):r&&!r.$isRemoved&&2==r.moveType&&r.stopMove())},t.prototype.onTargetDead=function(){var e=this;if(e.changeTarget(null),e.aiId){var t=e.owner,i=!e.aiCfg.isMissIdle&&t&&t.scene?t.scene.findViewEnemy(t,e.aiCfg.sight||0,e.aiCfg.priorSign):null;i?(e.changeTarget(i),e.canTickAI&&(2!=e.aistate?e.enterBattleState():e.battleCfg.actions&&e.gotoNextAction(e.battleCfg,e.actionIndex))):(e.stop(),e.tickAI())}},t.prototype.turnToTarget=function(e){if(e){var t=this.owner;t.x==e.x&&t.right!=!e.right?t.changeDirection(!e.right):t.right&&t.x>e.x?t.changeDirection(!1):!t.right&&t.x<e.x&&t.changeDirection(!0)}},t.prototype.enterIdleState=function(){var e=this;e.aistate=1,e.idlex=e.owner.x,e.idley=e.owner.y,e.actionIndex=-1,e.curSubAICfg=null,e.curSkillIndex=-1,e.idleCfg.actions&&e.gotoNextAction(e.idleCfg,e.actionIndex)},t.prototype.enterBattleState=function(){var e=this;e.aistate=2,e.actionIndex=-1,e.battleCfg.actions&&e.gotoNextAction(e.battleCfg,e.actionIndex)},t.prototype.gotoNextAction=function(e,i){var r=this;r.clearAction(),r.actionIndex=r.getNextIndex(e.closeToIndex,e.closeToItem,e.type||0,e.weight,e.actions,r.actionIndex);var n=e.actions[r.actionIndex];r.curAction=ObjectPool.pop(t.getActionCls(n.type||0)),r.curAction.play(r,n)},t.prototype.getNextIndex=function(e,t,i,r,n,a){var o=this,s=o.owner,l=o.target,u=o.aiCfg,c=-1,p=n.length,d=!1;if(t&&l&&u.fax>0&&u.fay&&Fixed.value(s.x).sub(l.x).abs().value<=u.fax&&Fixed.value(s.y).sub(l.y).abs().value<=u.fay&&(d=!0,r-=t.weight),0==i)for(var f=o.owner.scene.seedr.random,h=Fixed.value(f).mul(r).value,v=p-1;v>=0;v--){var m=n[v];if((!d||v!=e)&&h>=m.total-(d&&m.total>t.total?t.weight:0)){c=v;break}}else if(1==i)for(;-1==a&&0>c||-1!=a&&(0>c||a==c);)for(var f=o.owner.scene.seedr.random,h=Fixed.value(f).mul(r).value,v=p-1;v>=0;v--){var m=n[v];if((!d||v!=e)&&h>=m.total-(d&&m.total>t.total?t.weight:0)){c=v;break}}else 2==i&&(c=a+1,c>=p&&(c=0),d&&p>1&&c==e&&(c++,c>=p&&(c=0)));return Math.max(0,c)},t.prototype.getAutoUseSkill=function(){var e,t=this,i=t.owner,r=t.target,n=t.curSubAICfg,a=-1,o=-1;if(!r)return t.curSubAICfg=null,t.curSkillIndex=-1,e;if(n&&(a=n.type||0,(1==a||2==a)&&(o=t.curSkillIndex+1,o>=n.skillList.length&&(o=-1))),-1==o&&(n=t.getSubAI()))if(a=n.type||0,0==a)for(var s=n.skillList||[],l=s.length,u=i.scene.seedr.random,c=Fixed.value(u).mul(n.weight).value,p=l-1;p>=0;p--){var d=s[p];if(c>=d.total){o=p;break}}else if(1==a)o=0;else if(2==a)o=0;else if(3==a)for(var s=n.skillList||[],l=s.length,d=void 0,f=void 0,h=void 0,p=0;l>p;p++)if(d=s[p],f=Fixed.value(r.x).sub(i.x).abs().value,h=Fixed.value(r.y).sub(i.y).abs().value,(!d.x||f<=d.x)&&(!d.minx||f>=d.minx)&&(!d.y||h<=d.y)&&(!d.miny||h>=d.miny)&&i.scene.seedr.random<d.rate){o=p;break}if(n&&-1!=o){var v=n.skillList[o];if(v){var f=Fixed.value(r.x).sub(i.x).abs().value,h=Fixed.value(r.y).sub(i.y).abs().value;if((!v.x||f<=v.x)&&(!v.minx||f>=v.minx)&&(!v.y||h<=v.y)&&(!v.miny||h>=v.miny)){var m=i.getChangeSkillId(v.skillId),y=i.skill.getSkillInfo(m);!y||y.isSpecial&&i.agent&&!i.agent.isAutoSpeSkill||!i.skill.canUse(m)||(e=y)}}}return e&&n&&(1==a||2==a)?(t.curSubAICfg=n,t.curSkillIndex=o):(t.curSubAICfg=null,t.curSkillIndex=-1),e},t.prototype.getSubAI=function(){for(var e=this,t=e.aiCfg.subs||[],i=t.length,r=e.owner.scene.seedr.random,n=Fixed.value(r).mul(e.aiCfg.weight).value,a=i-1;a>=0;a--){var o=t[a];if(n>=o.total)return Data.getOppItem("SubAIData",o.subId)}return null},t.prototype.autoUseSkill=function(e){var t=this;!t.aiCfg.unturn&&t.turnToTarget(t.target),t.owner.skill.onBeginSkill(e.skillId,!1,!1)},t.prototype.onSkillInterrupt=function(){var e=this;e.curSubAICfg&&2==e.curSubAICfg.type&&(e.curSubAICfg=null,e.curSkillIndex=-1)},t.prototype.onStateFree=function(e){var t=this;if(t.canTickAI)if(103==e&&2!=t.aistate){if(!t.target){var i=t.owner.scene.findViewEnemy(t.owner,t.aiCfg.sight||0,t.aiCfg.priorSign);i&&t.changeTarget(i)}t.target?t.enterBattleState():t.tickAI()}else if(t.curSubAICfg&&2==t.curSubAICfg.type){var r=t.getAutoUseSkill();r?t.autoUseSkill(r):(t.curSubAICfg=null,t.curSkillIndex=-1,t.tickAI())}else t.tickAI()},t.prototype.onActionEnd=function(e){var t=this;if(t.clearAction(),e)t.autoUseSkill(e);else if(3!=t.aistate&&t.canTickAI){var i=1==t.aistate?t.idleCfg:t.battleCfg;i.actions&&t.gotoNextAction(i,t.actionIndex)}},t.prototype.onSelectEnemy=function(e){var t=this;t.target!=e&&(t.stop(),t.changeTarget(e),t.canTickAI&&t.enterBattleState())},t.prototype.stop=function(){this.clearAction(),this.aistate=0,this.actionIndex=-1},t.prototype.beHurt=function(e,t){var i=this;t?i.canTickAI&&2!=i.aistate&&!i.target&&e&&!e.isDead&&(i.changeTarget(e),i.enterBattleState()):2==i.aistate?i.clearAction():i.stop()},t.prototype.onNextRound=function(){var e=this;3==e.aistate&&e.owner.stopMove(),e.stop(),e.changeTarget(null)},t.prototype.trig=function(e){for(var t=[],i=1;i<arguments.length;i++)t[i-1]=arguments[i];this.trigList.forEach(function(i){i.type==e&&i.trig.apply(i,t)})},t.prototype.resetTrig=function(e){this.trigList.forEach(function(t){t.type==e&&t.resetTrig()})},t.prototype.trigDamage=function(e,t,i){this.trigList.forEach(function(r){r.isDamageEffect&&(i?19==r.type&&r.trig(t,e):r.trig(t,e))})},t.prototype.trigProp=function(e){var t=this.attTrigs;t&&e in t&&this.trigList.forEach(function(t){37==t.type&&t instanceof AITrig_PropChange&&(t.attName1==e||t.attName2==e)&&t.trig(e)})},t.prototype.showTrigTimeBar=function(){this.trigList.forEach(function(e){e instanceof AITrig_IntervalTime&&e.showTimeBar()})},t.prototype.removeTrig=function(e){var t=this,i=t.trigList,r=i.indexOf(e);if(r>=0){i.splice(r,1);var n=t.trigs,a=n[e.trigId];a&&(delete a[e.subId],ObjectUtils.isEmpty(a)&&delete n[e.trigId]),t.owner.scene.removeAITrig(e),e.dispose()}},t.prototype.removeTrigs=function(e,t){var i=this,r=i.trigs[e];r&&t.forEach(function(e){r[e]&&i.removeTrig(r[e])})},t.prototype.removeAITrigs=function(e){var t=this,i=Data.getOppItem("AIData",e);if(i.trig){var r=Data.getItem("AITrigData",i.trig);if(r&&r.datas){for(var n=[],a=0,o=r.datas;a<o.length;a++){var s=o[a];n.push(s.subId)}t.removeTrigs(i.trig,n)}}},t.prototype.clearTrigs=function(){var e=this;e.trigList.forEach(function(t){e.owner.scene&&e.owner.scene.removeAITrig(t),t.dispose()}),e.trigList=[],e.trigs={},e.attTrigs=null},t.prototype.clearAction=function(){this.curAction&&(this.curAction.destroy(),this.curAction=null)},t.prototype.clearAll=function(){this.stop(),this.changeTarget(null),this.clearTrigs()},t.prototype.onDestroy=function(){var t=this;t.clearAll(),ObjectUtils.clearKeys(t,["aiCfg","idleCfg","battleCfg","curSubAICfg","hasSkillTrig","attTrigs"]),ObjectUtils.clearKeysNum(t,["aiId","aistate","actionIndex","idlex","idley","curSkillIndex"]),e.prototype.onDestroy.call(this)},t.actionClss={},t.trigClss={},t}(GameCom);__reflect(BaseAI.prototype,"BaseAI"),window.BaseAI=BaseAI;var RoomAgent=function(e){function t(t,i,r,n){void 0===i&&(i=0),void 0===r&&(r=null),void 0===n&&(n=null);var a=e.call(this,t,i,r,n)||this;a.sit=0,a.order=0,a.svrId=0,a.ability=0,a.petAbility=0,a.laddersLv=0,a.hellLvId=0,a.haloId=0,a.fashionId=0,a.titleId=0,a.weaponId=0,a.weaponRTimes=0,a.weaFasId=0,a.wingFasId=0,a.loadProgress=0,a.isReadyNext=!1,a.isRoundLoaded=!1,a.mainPetName="",a.usedPetNum=0,a.abilityDmgInc=0,a.abilityDmgDec=0,a.abilityVerifyInc=0,a.abilityVerifyDec=0;var o=a;return o.equipSkills={},o.skills={},o.skillSlots={},o.skillList=[],o.items={},o.itemSlots={},o.itemList=[],o.itemPubCds={},o.itemCds={},o.itemNums={},o.moneys={},o.upPets=[],o.petInfoList=[],o.petInfos={},o.helpSkills={},o.helpSkillList=[],o.helpSkillCd=0,a}return __extends(t,e),Object.defineProperty(t.prototype,"isDead",{get:function(){return this.avatar&&this.avatar.isDead},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fuseing",{get:function(){var e=this.curPetInfo;return e&&e.calling&&3==e.pet.battleType&&!e.pet.isDead},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"needSync",{get:function(){var e=this;return e.scene.isLockStep&&e.active&&!e.isRobot},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"autoBattle",{get:function(){return!0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"autoSpeSkill",{get:function(){return this.scene&&!this.scene.roomCfg.autoBattle?!1:this.isAutoBattle&&this.isAutoSpeSkill},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"autoCallPet",{get:function(){return this.scene&&!this.scene.roomCfg.autoBattle?!1:this.isAutoBattle&&this.isAutoCallPet},enumerable:!0,configurable:!0}),t.prototype.on_ability=function(e){var t=this;t.agentInfo&&(t.agentInfo.ability=this.ability),t.scene instanceof RelayRoom&&(t.updateAbilityDmg(),t.scene.updateAbilityVerify())},t.prototype.on_petAbility=function(e){var t=this;t.agentInfo&&(t.agentInfo.petAbility=this.petAbility),t.scene instanceof RelayRoom&&(t.updateAbilityDmg(),t.scene.updateAbilityVerify())},t.prototype.onAddRecord=function(){var e=this;RecordMgr.record(1,e.roomsn,e.$className,e.active,e.$eid,e.init_props,e.params)},t.prototype.onRemoveRecord=function(){RecordMgr.record(2,this.roomsn,this.$eid)},t.prototype.onPropChange=function(t,i){RecordMgr.record(12,this.roomsn,this.$eid,t,this[t]),e.prototype.onPropChange.call(this,t,i)},t.prototype.createCom=function(){this.combo=ServiceMgr.createGameCom(Combo,this,!1,!0)},t.prototype.openScene=function(t){RecordMgr.record(3,this.roomsn,this.$eid,t),e.prototype.openScene.call(this,t)},t.prototype.closeScene=function(t){RecordMgr.record(4,this.roomsn,this.$eid,t),e.prototype.closeScene.call(this,t)},t.prototype.enterScene=function(t,i,r,n){RecordMgr.record(5,this.roomsn,this.$eid,t,i,r,n),e.prototype.enterScene.call(this,t,i,r,n)},t.prototype.updateAbilityDmg=function(){var e=this,t=e.scene;if(t.roomCfg.ability&&t instanceof RelayRoom){var i=t.getEquipScore(),r=t.playCfg.isParty,n=t.playId,a=e.ability;if(18!=n&&5!=n)a>i?(e.abilityDmgInc=r?.2:2,e.abilityDmgDec=r?.4:.95):(e.abilityDmgInc=0,e.abilityDmgDec=0);else{var o=Data.getSysValue("BATTLE_ABILITY_DMG")||[];a=18==n?e.petAbility:a,a-=i;for(var s=void 0,l=void 0,u=void 0,c=0,p=o;c<p.length;c++){var d=p[c];if(l=d.min||0,u=d.max||0,a>=l&&(!u||u>a)){s=d;break}}s?(e.abilityDmgInc=s.inc||0,e.abilityDmgDec=s.dec||0):(e.abilityDmgInc=0,e.abilityDmgDec=0)}}},t.prototype.onEnteredScene=function(){e.prototype.onEnteredScene.call(this);var t=this,i=t.scene;t.agentInfo&&(t.agentInfo.isRobot=t.isRobot,t.agentInfo.ability=t.ability,t.agentInfo.petAbility=t.petAbility),i instanceof RelayRoom&&(t.updateAbilityDmg(),i.updateAbilityVerify()),(i instanceof MainRandomBuffRoom||i instanceof InfernalHellRoom)&&(t.maxRandTimes=i.dungeonCfg.maxRandTimes||0),t.addOnceTimer(0,App.dispatch.bind(App,"c86",{rid:t.rid,agent:t}))},t.prototype.leaveScene=function(){var e=this;RecordMgr.record(6,e.roomsn,e.$eid);var t=e.scene;t&&t.addCallLater(e.receiveLeaveScene,e,1,!1,!1)},t.prototype.receiveLeaveScene=function(){var t=this,i=t.scene;if(i&&!i.isOver){var r=t.avatar;r&&(i.clearRoleBullet(r),!r.isDead&&r.dead(!0,!1,!1));var n=t.fruit;n&&(i.clearRoleBullet(n),!n.isDead&&n.receiveLeaveScene()),t.petInfoList.forEach(function(e){e.pet&&(i.clearRoleBullet(e.pet),!e.pet.isDead&&e.pet.exeuntScene(!1))})}e.prototype.receiveLeaveScene.call(this)},t.prototype.onLeftScene=function(){var t=this;t.clearReliveTime(),t.scene.removeCallLater(t),t.combo.stop(),t.equipSkills={},t.skills={},t.skillSlots={},t.skillList.length=0,t.items={},t.itemSlots={},t.itemList.length=0,t.itemPubCds={},t.itemCds={},App.dispatch("c87",{rid:t.rid,agent:t}),e.prototype.onLeftScene.call(this)},t.prototype.syncSceneLoaded=function(){var e=this;e.active&&!e.viewer&&e.gateway.syncSceneLoaded()},t.prototype.syncPassRound=function(e,t){var i=this;i.scene.isPlaying&&!i.viewer&&(i.needSync?i.gateway.syncPassRound(e,t):i.scene.onPassRound(t))},t.prototype.syncNextRoundReady=function(e){var t=this;if(!t.viewer){var i=t.scene;t.isReadyNext!=e&&i.isPass&&(i.isLockStep?i.player.gateway.syncNextRoundReady(t.sit,e):t.addOnceTimer(0,t.onDelayNextRoundReady,e?1:0))}},t.prototype.onDelayNextRoundReady=function(e){this.scene.cmd_nextRoundReady(this.sit,this.sit,e)},t.prototype.onNextRoundReady=function(e){var t=this;t.isReadyNext!=e&&(t.isReadyNext=e,t.scene.onAgentNextRound())},t.prototype.syncNextRoundLoaded=function(){var e=this;e.scene;e.viewer||(e.needSync?e.gateway.syncNextRoundLoaded():e.isRobot?e.isRoundLoaded=!0:e.addOnceTimer(0,e.onDelayNextRoundLoaded))},t.prototype.onDelayNextRoundLoaded=function(){this.scene&&this.scene.cmd_nextRoundLoaded(this.sit)},t.prototype.onNextRoundLoaded=function(){this.isRoundLoaded=!0,this.scene.onAgentNextRoundLoaded()},t.prototype.reqQuit=function(){this.active&&this.gateway.reqQuit()},t.prototype.reqGiveUp=function(){this.active&&!this.viewer&&this.gateway.reqGiveUp()},t.prototype.reqCallPet=function(e,t){void 0===t&&(t=!0);var i=this;i.viewer||i.checkCallPet(e,t)&&(i.gateway.reqCallPetCYLog(e),i.needSync?i.gateway.reqCallPet(e):i.scene.cmd_callPet(i.sit,e))},t.prototype.onCallPet=function(e,t){var i=this;if(i.checkCallPet(e,!1)){var r=i.scene,n=i.getPetInfoBySlotId(e);n.called=!0,r&&(r.isAllPetUp?i.callingAllPet=!0:(i.curPetInfo=n,!i.isRobot&&t&&i.hold&&i.active&&i.gateway.reqCallPetCYLog(e)),r.addCallLater(i.createPet,i,1,!1,!1,n))}},t.prototype.createPet=function(e){var t,i=this,r=e.petCfg,n=PetExtra.create(i.roomsn,i.side,i.rid,e.petId,e.heroId);r.isMain&&i.mainPetName&&(n.name=r.isMain&&i.mainPetName?i.mainPetName:r.name||""),t=RecordMgr.createGameEntity(i.roomsn,i.$channel,"Pet",!1,0,null,n),t.updateHeroInfo(e.props,e.skills,e.buffs),t.enterScene(i.scene.$eid,0,0,!0)},t.prototype.callAllPet=function(e){void 0===e&&(e=!0);var t=this;if(!t.viewer){var i=t.getFirstPetSlotId(),r=t.avatar,n=t.scene;if(r&&!r.isDead&&n.isControl&&n.isAllPetUp){if(r.state.hasState(19))return void(e&&Prompt.msgId(2071));if(!t.petInfoList.length)return void(e&&Prompt.msgId(2226));if(t.hasPetInBattle())return void(e&&Prompt.msgId(2225));var a=t.getPetInfoBySlotId(i);!a||a.called||a.isEnd||(t.gateway.reqCallPetCYLog(i),t.needSync?t.gateway.reqCallPet(i):t.scene.cmd_callPet(t.sit,i))}}},t.prototype.getPetInfoBySlotId=function(e){for(var t=this.petInfoList,i=0,r=t;i<r.length;i++){var n=r[i];if(n.slotId==e)return n}return null},t.prototype.onNextRound=function(){e.prototype.onNextRound.call(this);var t=this;t.isReadyNext=!1,t.isRoundLoaded=!1,t.callingAllPet&&t.autoCallNextPet()},t.prototype.hasPetInBattle=function(){for(var e=0,t=this.petInfoList;e<t.length;e++){var i=t[e];if(i.calling)return!0}return!1},t.prototype.checkAllPetDead=function(){for(var e=0,t=this.petInfoList;e<t.length;e++){var i=t[e];if(!i.isEnd)return!1}return!0},t.prototype.checkCallPet=function(e,t){void 0===t&&(t=!0);var i=this,r=i.avatar,n=i.scene;if(!r||!n)return!1;if((i.isFirstPet(e)||!n.isAllPetUp)&&!n.isControl)return!1;if(n instanceof AvatarAdvRoom||n instanceof PartyWarRRoom)return!1;if(r.isDead)return t&&Prompt.msgId(2208),!1;if((i.isFirstPet(e)||!n.isAllPetUp)&&r.state.hasState(19))return t&&Prompt.msgId(2071),!1;var a=i.getPetInfoBySlotId(e);if(!a)return!1;if(a.calling)return t&&Prompt.msgId(2070),!1;if(!n.isAllPetUp){var o=i.curPetInfo;if(o&&o.called&&!o.isEnd)return t&&Prompt.msgId(2065),!1}return a.isEnd?(t&&Prompt.msgId(2231),!1):a.called?!1:!0},t.prototype.getCanCallPet=function(e){var t=this,i=t.petInfoList;if(!i)return 0;var r=i.length;if(!r)return 0;for(var n,a=0;r>a;a++)if(n=i[a],!n.called&&t.checkCallPet(n.slotId,e))return n.slotId;return 0},t.prototype.isFirstPet=function(e){var t=this.petInfoList;if(!t||!t.length)return!1;var i=t[0];return i?i.slotId==e:!1},t.prototype.getFirstPetSlotId=function(){var e=this.petInfoList;if(!e||!e.length)return 0;var t=e[0];return t?t.slotId:0},t.prototype.getKillPetId=function(){var e=this.petInfoList.filter(function(e){return e.slotId<=2}),t=e.length;if(!t)return 0;var i;return i=1==t?e[0]:Fixed.randGet(e,this.scene.seedr),i.petId},t.prototype.getCanCallPetNum=function(){var e=this,t=0,i=e.petInfoList;if(!i)return t;var r=i.length;if(!r)return t;for(var n,a=0;r>a;a++)n=i[a],n.called||t++;return t},t.prototype.onAvatarDead=function(e,t){var i=this,r=i.agentInfo;if(i.scene.isAllPetUp)i.petInfoList.forEach(function(e){e.pet&&!e.pet.isDead&&e.pet.exeuntScene(t)});else{var n=i.pet;n&&!n.isDead&&n.exeuntScene(t)}r.isDead=!0,r.deadNum+=1,r.streakNum=0;var a=i.scene;t&&a&&a.player&&!a.player.viewer&&a.player.gateway.syncAvatarDead(e.prid,i.prid,r.deadNum),App.dispatch("c67",{rid:i.rid,target:i})},t.prototype.onPetDead=function(e,t,i){var r=this;if(r.scene){var n=r.avatar?r.avatar.props.gv("petCallCd"):0,a=r.petInfos[e.petId];a.onCallEnd(!r.scene.isAllPetUp,n),r.curPetInfo&&r.curPetInfo.pet==e&&(r.curPetInfo=null);var o=r.scene;i&&o&&o.isLockStep&&o.player&&!o.player.viewer&&o.player.gateway.syncPetDead(r.prid,a.slotId),r.hold&&App.dispatch("c74",{pet:r})}},t.prototype.onPvPStopRound=function(){var e=this,t=e.pet;t&&!t.isDead&&t.exeuntScene(!0);var i=e.avatar;i&&!i.isDead&&i.onPvPStopRound()},t.prototype.syncMonsterDead=function(e,t,i){var r=this;i&&r.active&&!r.viewer&&r.scene.isPlaying&&r.gateway.syncMonsterDead(e.prid,t.spawnId,t.idx,Math.floor(t.x),Math.floor(t.y))},t.prototype.syncBattleResult=function(e){var t=this;t.active&&!t.viewer&&App.dispatch("c96",e)},t.prototype.onEnterFrame=function(t){e.prototype.onEnterFrame.call(this,t);var i=this;if(i.hold||i.isRobot){var r=!1,n=i.itemPubCds,a=[];for(var o in n){var s=Fixed.value(n[o]).sub(t).max(0).value;n[o]=s,0==s&&a.push(Number(o))}a.length>0&&(r=!0,a.forEach(function(e){delete n[e]}));var l=i.itemCds,u=[];for(var c in l){var s=Fixed.value(l[c]).sub(t).max(0).value;l[c]=s,0==s&&u.push(Number(c))}u.length>0&&(r=!0,u.forEach(function(e){delete l[e]}));for(var p=0,d=i.itemList;p<d.length;p++){var f=d[p];f.slotId>1&&f.cVal>0&&i.checkAutoUseItem(f.slotId)}r&&App.dispatch("c65",{itemIds:u,pubIds:a}),i.helpSkillCd>0&&(i.helpSkillCd=Fixed.value(i.helpSkillCd).sub(t).max(0).value)}i.combo.onEnterFrame(t),i.scene.isAllPetUp||i.petInfoList.forEach(function(e){e.callCd&&(e.callCd=Fixed.value(e.callCd).sub(1).value,e.callCd<=0&&(e.resetCallStatus(),i.checkAutoCallPet(),i.hold&&App.dispatch("c115",{petId:e.petId})))})},t.prototype.afterEnterFrame=function(){this.combo.afterEnterFrame()},t.prototype.onAgentStartGame=function(e,t,i,r,n,a,o,s,l,u,c){var p=this;p.scene.needVerify&&RecordMgr.record(11,p.roomsn,p.$eid,e,t,i,r,n,a,o,s,l,u,c),p.petInfos={},p.petInfoList=[],p.equipSkills={},p.skills={},p.skillSlots={},p.skillList.length=0,p.items={},p.itemSlots={},p.itemList.length=0,p.itemNums={},p.moneys={},p.isAutoBattle=e,p.isAutoSpeSkill=t,p.isAutoCallPet=i,p.usedPetNum=r,p.clearHelpSkill();var d;if(c){var f,h=p.equipSkills;c.forEach(function(e){h[e.id]=e,f=Data.getItem("SkillForceData",e.id),f.sId&&f.nId&&(d||(d={}),d[f.sId]=f.nId)})}p.avatarInfos=n;var v,m,y=p.items,g=p.itemSlots,b=p.itemList,x=p.itemNums;o.forEach(function(e){v=Functor.parse(e.extra),m={eid:p.$eid,slotId:e.slotId,cVal:v.cVal,itemId:e.itemId,itemCfg:Data.getItem("ItemData",e.itemId)},m.useCfg=Data.getItem("RoomItemUseData",m.itemCfg.bUseEff),y[m.itemId]=m,g[m.slotId]=m,b.push(m),x[e.itemId]=v.num}),ArrayUtils.sortOn(p.itemList,"slotId",16);var I,_,S=p.skills,T=p.skillSlots,w=p.skillList;s.forEach(function(e){_=e.skillId,d&&d[_]&&(_=d[_]),I={slotId:e.slotId,skillId:_,skillCfg:Data.getItem("SkillData",_)},S[I.skillId]=I,T[I.slotId]=I,w.push(I)}),ArrayUtils.sortOn(p.skillList,"slotId",16);var A;l.forEach(function(e){e?(A=ObjectPool.pop(BattleHelpSkillInfo),A.parse(e),p.helpSkills[e]=A,p.helpSkillList.push(A)):p.helpSkillList.push(null)});var P,C=p.agentInfo,D=p.scene.isAllPetUp,B=p.petInfoList,k=p.petInfos;a.forEach(function(e){(D||e.slotId<=2)&&(P=ObjectPool.pop(BattlePetInfo),P.parse(e),B.push(P),k[e.petId]=P,C&&C.createPetData(e.petId))}),p.upPets=a,ArrayUtils.sortOn(p.petInfoList,"slotId",16),ArrayUtils.sortOn(p.upPets,"slotId",16),p.fruitInfo=u,p.hold&&p.addOnceTimer(0,App.dispatch.bind(App,"c70"))},t.prototype.createAvatar=function(){var e=this,t=e.avatar,i=e.scene,r=e.getNextAvatarInfo(t?t.petId:0);if(e.agentInfo&&(e.agentInfo.ability=e.ability,e.agentInfo.petAbility=e.petAbility),r){var n,a,o;if(t)n=t.x,a=t.y,o=t.right,e.onRemoveAvatar(t);else{var s=i.getBornPos(e.side,e.teamSlotId);n=s.x||0,a=s.y||0,o=i instanceof PvPRoom?1==e.side:!i.battleCfg.dir}var l=AvatarExtra.create(e.roomsn,e.side,e.rid,r.heroId,r.petId);e instanceof RobotAgent&&(l.aiId=e.aiid),t=RecordMgr.createGameEntity(e.roomsn,e.$channel,"Avatar",!1,0,null,l),t.updateHeroInfo(r.props,r.skills,r.buffs),t.updateEquipSkill(e.equipSkills),t.enterScene(i.$eid,n,a,o)}},t.prototype.createFruit=function(){var e=this,t=e.scene;if(t.roomCfg.fruit){var i=e.fruitInfo;if(i&&i.fruitId&&i.heroId){var r,n=FruitExtra.create(e.roomsn,e.side,e.rid,i.fruitId,i.heroId);r=RecordMgr.createGameEntity(e.roomsn,e.$channel,"Fruit",!1,0,null,n),r.updateHeroInfo(i.props,i.skills,i.buffs),r.enterScene(t.$eid,0,0,!0)}}},t.prototype.addItem=function(e,t){e in this.itemNums&&(this.itemNums[e]+=t,App.dispatch("c64",{itemId:e}))},t.prototype.reqChangeAutoBattle=function(e){var t=this;t.isAutoBattle!=e&&t.active&&!t.viewer&&t.gateway.reqChangeAutoBattle(e)},t.prototype.onChangeAutoBattle=function(e){var t=this;t.isAutoBattle=e,t.autoCallPet&&t.checkAutoCallPet(),t.autoBattle&&(t.autoPetHideFuse(),t.avatar&&t.avatar.ai.trig(40))},t.prototype.reqChangeAutoSpeSkill=function(e){var t=this;t.isAutoSpeSkill!=e&&t.active&&!t.viewer&&t.gateway.reqChangeAutoSpeSkill(e)},t.prototype.onChangeAutoSpeSkill=function(e){this.isAutoSpeSkill=e},t.prototype.reqChangeAutoCallPet=function(e){var t=this;t.isAutoCallPet!=e&&t.active&&!t.viewer&&t.gateway.reqChangeAutoCallPet(e)},t.prototype.onChangeAutoCallPet=function(e){this.isAutoCallPet=e,this.autoCallPet&&this.checkAutoCallPet()},t.prototype.reqChangeHelpSkill=function(){},t.prototype.onChangeHelpSkill=function(e){var t=this;t.scene.needVerify&&RecordMgr.record(25,t.roomsn,t.$eid,e),t.clearHelpSkill();var i;e.forEach(function(e){e?(i=ObjectPool.pop(BattleHelpSkillInfo),i.parse(e),t.helpSkills[e]=i,t.helpSkillList.push(i)):t.helpSkillList.push(null)}),App.dispatch("c84")},t.prototype.checkRelive=function(){var e=this;if(!e.isDead)return Prompt.msgId(2010),!1;var t=e.scene.roomCfg.reliveNum||0;return t&&e.agentInfo.reliveNum>=t?(Prompt.msgId(2072),!1):e.checkItemNum(Data.getSysValue("RELIVE_ITEM_ID"),1)?!0:(Prompt.msgId(2036),!1)},t.prototype.reqRelive=function(){var e=this;!e.viewer&&e.checkRelive()&&e.active&&e.gateway.reqRelive()},t.prototype.onRelive=function(e){if(e)return void Prompt.msgId(e);var t=this,i=t.scene,r=t.avatar,n=t.agentInfo.randomBuffs;if(t.clearReliveTime(),t.agentInfo.isDead=!1,t.agentInfo.reliveNum+=1,r&&(i.onRelive(r.$eid),r.relive(),n.length&&n.forEach(function(e){r.buff.addBuff(r,0,e.buffLv,e.buffId,0,e.grade)})),t.hold&&i instanceof RelayRoom&&i.changeScoreVal(3,1,!1),t.hold&&i.checkAllowRelive()&&1005!=i.playId){var a=Data.getSysValue("RELIVE_ITEM_ID");t.itemNums[a]=t.getItemNum(a)-1}i.isAllPetUp&&t.petInfoList.forEach(function(e){e.called&&e.resetCallStatus()}),i.checkAllPlayerDead(),t.hold&&i.setCameraFollow(),App.dispatch("c68",{rid:t.rid,target:t})},t.prototype.clearReliveTime=function(){var e=this.waitReliveTimeId;e&&(this.scene&&this.scene.removeCallLaterIdx(e),this.waitReliveTimeId=0)},t.prototype.canUseSkill=function(e,t){var i=Data.getItem("SkillData",e),r=i.type||0;return 0==r||3==r||2==r||5==r?!0:e in this.skills?!0:(t&&Prompt.msgId(2030),!1)},t.prototype.canUseItem=function(e,t){void 0===t&&(t=!1);var i=this,r=i.items[e];if(!r||!i.scene.isControl)return!1;if(!i.scene.canUseItem)return!1;if(!i.avatar||i.avatar.isDead)return t&&Prompt.msgId(2009),!1;if(!i.checkItemNum(e,1))return t&&Prompt.msgId(2037),!1;var n=i.getPubCD(r.useCfg.cdId);if(n>0)return t&&Prompt.msgId(2014),!1;var a=i.getItemCD(r.itemId);return a>0?(t&&Prompt.msgId(2008),!1):!0},t.prototype.checkAutoUseItem=function(e){var t=this,i=t.itemSlots[e];if(i){var r=egret.getTimer();if(!(r-t.lastAutoUseItem<100)&&(t.lastAutoUseItem=r,!t.isSendAutoUseItem&&t.canUseItem(i.itemId))){var n=t.avatar.props;if(2==e){var a=Fixed.value(i.cVal).div(100).value,o=n.gv("hp"),s=n.gv("maxHp"),l=Fixed.value(o).div(s).value;if(l>a)return}else if(3==e){var a=Fixed.value(i.cVal).div(100).value,u=n.gv("mp"),c=n.gv("maxMp"),p=Fixed.value(u).div(c).value;if(p>a)return}t.isSendAutoUseItem=!0,t.scene.player.gateway.reqUseItem(t.rid,i.itemId)
}}},t.prototype.reqUseItem=function(e,t){void 0===t&&(t=!1);var i=this;i.viewer||i.isSendUseItem||i.canUseItem(e,t)&&(i.isSendUseItem=!0,i.scene.player.gateway.reqUseItem(i.rid,e))},t.prototype.onUseItem=function(e,t){var i=this,r=i.items[t];if(r&&(2==r.slotId||3==r.slotId?i.isSendAutoUseItem=!1:i.isSendUseItem=!1),e)return void Prompt.msgId(e);var n=i.getItemNum(t),a=Data.getItem("ItemData",t),o=Data.getSItem("RoomItemUseData",a.bUseEff);i.itemNums[t]=n-1,i.hold&&(o.cdId&&i.addPubCD(o.cdId),o.cd&&i.addItemCD(t,Fixed.millisecond(o.cd))),n>0&&(o.buff&&o.buff.forEach(function(e){e.id&&i.avatar.buff.addBuff(i.avatar,0,e.lv||0,e.id)}),i.scene instanceof RelayRoom&&i.scene.changeScoreVal(2,1,!1)),i.hold&&App.dispatch("c63",{itemId:t})},t.prototype.addPubCD=function(e){var t=Data.getSysValue("CD_GROUP"),i=Fixed.millisecond(t[e]);this.itemPubCds[e]=Fixed.max(i,0)},t.prototype.addItemCD=function(e,t){this.itemCds[e]=Fixed.max(t,0)},t.prototype.getPubCD=function(e){return this.itemPubCds[e]||0},t.prototype.getItemCD=function(e){return this.itemCds[e]||0},t.prototype.onAddAvatar=function(e){var t=this;if(t.avatareid=e.$eid,t.avatar=e,t.hold){var i=!0,r=t.scene;r instanceof RelayRoom&&r.dungeonCfg.hideStart&&(i=!1),t.scene.setCameraFollow(i)}},t.prototype.onRemoveAvatar=function(e){this.avatar==e&&(this.avatareid=0,this.avatar=null)},t.prototype.onAddPet=function(e){var t=this;t.petId=e.petId,t.peteid=e.$eid,t.pet=e;var i=t.petInfos[e.petId];i.called=!0,i.pet=e,t.curPetInfo=i},t.prototype.onRemovePet=function(e){var t=this;if(t.petInfos){var i=t.petInfos[e.petId];i.pet=null}e==t.pet&&(t.petId=0,t.peteid=0,t.pet=null),t.checkAutoCallPet()},t.prototype.onAddFruit=function(e){this.fruiteid=e.$eid,this.fruit=e},t.prototype.onRemoveFruit=function(e){this.fruit==e&&(this.fruiteid=0,this.fruit=null)},t.prototype.checkAutoCallPet=function(){var e=this;e.scene instanceof RelayRoom&&!e.scene.isOver&&e.autoCallPet&&!e.isDead&&e.avatar&&e.avatar.ai.trig(14)},t.prototype.autoCallNextPet=function(){var e=this;e.scene&&e.scene.isAllPetUp&&!e.scene.isOver&&!e.isDead&&e.avatar&&e.avatar.ai.trig(24)},t.prototype.autoPetHideFuse=function(){var e=this;e.scene&&!e.scene.isOver&&e.autoBattle&&!e.isDead&&e.pet&&e.pet.ai.trig(15)},t.prototype.canPetHide=function(e){var t=this.curPetInfo;return this.scene.isControl&&t&&t.slotId==e&&t.calling&&1==t.pet.battleType&&!t.pet.isDead&&!this.scene.isAllPetUp},t.prototype.reqPetHide=function(){var e=this;if(!e.viewer){var t=e.curPetInfo;t&&e.canPetHide(t.slotId)&&(e.gateway.reqPetHideCYLog(t.slotId),e.needSync?e.gateway.reqPetHide(t.slotId):e.scene.cmd_petHide(e.sit,t.slotId))}},t.prototype.onPetHide=function(e,t,i){if(e)Prompt.msgId(e);else{var r=this,n=r.curPetInfo;if(!n||n.slotId!=t||!n.calling||1!=n.pet.battleType||n.pet.isDead||r.scene.isAllPetUp)return;!r.isRobot&&i&&r.hold&&r.active&&r.gateway.reqPetHideCYLog(t),n.pet.onPetHide(),r.hold&&App.dispatch("c78",{petId:n.petId})}},t.prototype.canPetFuse=function(e){var t=this.curPetInfo;return this.scene.isControl&&t&&t.slotId==e&&t.calling&&1==t.pet.battleType&&!t.pet.isDead&&!this.scene.isAllPetUp},t.prototype.reqPetFuse=function(){var e=this;if(!e.viewer){var t=e.curPetInfo;t&&e.canPetFuse(t.slotId)&&(e.gateway.reqPetFuseCYLog(t.slotId),e.needSync?e.gateway.reqPetFuse(t.slotId):e.scene.cmd_petFuse(e.sit,t.slotId))}},t.prototype.onPetFuse=function(e,t,i){if(e)Prompt.msgId(e);else{var r=this,n=r.curPetInfo;if(!n||n.slotId!=t||!n.calling||1!=n.pet.battleType||n.pet.isDead||r.scene.isAllPetUp)return;!r.isRobot&&i&&r.hold&&r.active&&r.gateway.reqPetFuseCYLog(t),n.pet.onPetFuse(),r.hold&&App.dispatch("c79",{petId:n.petId})}},t.prototype.reqChangeOrder=function(e,t,i){void 0===i&&(i=!0);var r=this;if(!r.viewer){if(!r.scene.isPreWar)return i&&Prompt.msgId(2046),!1;var n=r.scene.getAgentInfo(e);return n.order==r.order?(i&&Prompt.msgId(20062),!1):(r.active&&r.gateway.reqChangeOrder(r.order,t,e),!0)}},t.prototype.onChangeOrderFail=function(e,t,i){App.dispatch("c80",{trid:t,torder:i})},t.prototype.onChangeOrderSucc=function(e,t,i){this.reqAgentInfo=this.scene.getAgentInfo(i),this.reqTorder=t,this.reqSorder=e,App.dispatch("c81",{rid:this.rid,torder:t})},t.prototype.agreeChangeOrder=function(e){void 0===e&&(e=!0);var t=this;t.viewer||(t.reqAgentInfo.order!=t.reqTorder||t.order!=t.reqSorder?e&&Prompt.msgId(20063):t.scene.isPreWar&&t.gateway.agreeChangeOrder(t.reqSorder,t.reqTorder,t.reqAgentInfo.rid),t.clearReqOrder())},t.prototype.rejectChangeOrder=function(){var e=this;if(!e.viewer){var t=e.reqAgentInfo;t&&e.gateway.rejectChangeOrder(t.rid),e.clearReqOrder()}},t.prototype.onRejectChangeOrder=function(e){var t=this.scene.getAgentInfo(e);t&&Prompt.msgId(2074,t.name)},t.prototype.clearReqOrder=function(){this.reqAgentInfo=null,this.reqSorder=0,this.reqTorder=0},t.prototype.reqPraise=function(e){var t=this,i=t.scene.getAgentInfo(e);return i&&!i.hold?i.praised?(Prompt.msgId(2059),!1):(i.isRobot?t.onPraise(0,e):t.gateway.reqPraise(e),!0):void 0},t.prototype.onPraise=function(e,t){if(e)Prompt.msgId(e);else if(this.scene){var i=this.scene.getAgentInfo(t);i&&(i.praised=!0)}App.dispatch("c94",{ret:e,rid:t})},t.prototype.bePraised=function(e){if(this.scene){var t=this.scene.getAgentInfo(e);t&&Prompt.msgId(2066,t.name)}this.agentInfo&&(this.agentInfo.praiseNum+=1),App.dispatch("c95",{rid:e})},t.prototype.onName=function(e){var t=this;t.name=e,t.agentInfo&&(t.agentInfo.name=e),t.avatar&&t.avatar.guise&&t.avatar.guise.updateName(),t.hold&&App.dispatch("c104",{rid:t.rid})},t.prototype.getSkillSlot=function(e){return this.skills?this.skills[e]:null},t.prototype.getSkillSlotId=function(e){return this.skillSlots[e]},t.prototype.getItemSlotId=function(e){return this.itemSlots[e]},t.prototype.getItemNum=function(e){return this.itemNums[e]||0},t.prototype.checkItemNum=function(e,t){return(this.itemNums[e]||0)>=t},t.prototype.getMoneyNum=function(e){return this.moneys[e]||0},t.prototype.checkMoneyNum=function(e,t){return(this.moneys[e]||0)>=t},t.prototype.onBattleOver=function(e){},t.prototype.checkUseHelpSkill=function(e,t){void 0===t&&(t=!0);var i=this;if(i.viewer)return!1;if(i.isReqHelpSkill)return!1;var r=i.helpSkills[e];return i.scene.isPlaying?r?i.helpSkillCd>0?(t&&Prompt.msgId(2003),!1):r.times<=0?(t&&Prompt.msgId(2048),!1):!0:(t&&Prompt.msgId(2047),!1):!1},t.prototype.reqUseHelpSkill=function(e,t){void 0===t&&(t=!0);var i=this;i.checkUseHelpSkill(e,t)&&(i.isReqHelpSkill=!0,i.needSync?i.gateway.reqUseHelpSkill(e):i.scene.cmd_useHelpSkill(i.sit,e))},t.prototype.onUseHelpSkill=function(e){var t=this;t.isReqHelpSkill=!1,t.helpSkillCd=Fixed.millisecond(Data.getSysValue("HELP_SKILL_PUBLIC_CD"));var i=t.helpSkills[e];i.times-=1;var r=t.scene;if(r instanceof PvPRoom){var n=r.getCurFightAgent(t.side);if(n&&n.avatar){var a=n.avatar,o=n.side==r.player.side?i.cfg.ctid:i.cfg.ttid;if(o){var s=BulletExtra.create(a,a,o,0,0,1,t.rid);s&&a.skill.onTrigBullet(s)}i.cfg.buff&&a.buff.addBuff(a,0,0,i.cfg.buff,0,0,t.rid)}}App.dispatch("c92",{agent:t,skillInfo:i})},t.prototype.clearHelpSkill=function(){var e=this.helpSkillList;e?(e.forEach(function(e){e&&e.dispose()}),e.length=0):this.helpSkillList=[],this.helpSkills={}},t.prototype.onRandomBuffList=function(e){var t=this;if(t.curRandomBuffs=e,t.isRobot){var i=t.scene.seedr.random;t.onAgentSelectBuff(Fixed.value(i).mul(3).ceil().value)}t.hold&&App.dispatch("c97")},t.prototype.reqSelectRandomBuff=function(e){var t=this;if(!t.viewer){var i=t.scene;return i instanceof MainRandomBuffRoom||i instanceof InfernalHellRoom&&i.isRandomBuff?t.curRandomBuffs?void(t.needSync?t.gateway.reqSelectRandomBuff(e):t.scene.cmd_selectRandomBuff(t.sit,e)):void Prompt.msgId(6017):void Prompt.msgId(6018)}},t.prototype.onAgentSelectBuff=function(e){this.scene&&this.scene.onAgentSelectBuff(this.rid,e)},t.prototype.onSelectRandomBuff=function(e,t,i,r){var n=this;e?n.hold&&Prompt.msgId(e):(n.curRandomBuffs=null,n.onAddRandomBuff(i,r),n.scene.showPortal()),n.hold&&App.dispatch("c98",{ret:e,slotId:t,rid:n.rid})},t.prototype.reqRandomBuffAgain=function(){var e=this;return e.viewer?!1:e.maxRandTimes<=0?(Prompt.msgId(2076),!1):(e.needSync?e.gateway.reqRandomBuffAgain():e.addOnceTimer(0,e.onDelayRandomBuffAgain),!0)},t.prototype.onDelayRandomBuffAgain=function(){this.scene&&this.scene.cmd_randomBuffAgain(this.sit)},t.prototype.onRandomBuffAgain=function(e,t){var i=this;e?i.hold&&Prompt.msgId(e):(i.maxRandTimes--,i.curRandomBuffs=t,i.hold&&App.dispatch("c97"))},t.prototype.onAddRandomBuff=function(e,t){var i=this.avatar,r=this.agentInfo.randomBuffs,n=ArrayUtils.find(r,e,"buffId");if(-1!=n){var a=r[n];a.grade+=1}else r.push({buffId:e,buffLv:t,grade:1});i&&i.buff.addBuff(i,0,t,e)},t.prototype.onPickupTrap=function(e,t){var i=this,r=i.pickupTraps,n=i.pickupTrapList;if(r||(r=i.pickupTraps={}),n||(n=i.pickupTrapList=[]),n.length>=3){var a=n.shift();delete r[a.idx],a.dispose()}var o=PickupTrapInfo.create(e,t?t.$eid:0);n.push(o),r[o.idx]=o,this.hold&&App.dispatch("c113")},t.prototype.checkUsePickupTrap=function(e){var t=this.pickupTraps;if(!t)return null;var i=t[e];return i?i:null},t.prototype.reqUsePickupTrap=function(e){var t=this;return t.viewer?!1:t.checkUsePickupTrap(e)?(t.needSync?t.gateway.reqUsePickupTrap(e):t.scene.cmd_usePickupTrap(t.sit,e),!0):!1},t.prototype.onUsePickupTrap=function(e){var t=this,i=t.checkUsePickupTrap(e);if(i){var r=t.avatar;if(r){var n=t.pickupTrapList.indexOf(i);n>=0&&t.pickupTrapList.splice(n,1),delete t.pickupTraps[e],r.scene.onTrigTrap(i.castereid?t.scene.getRoleByEid(i.castereid):null,i.trapCfg,r,r,r),i.dispose()}t.hold&&App.dispatch("c114")}},t.prototype.syncTouchBegin=function(e){var t=this;t.viewer||(t.needSync?t.gateway.syncTouchBegin(e):t.scene.cmd_touchMoveBegin(t.sit,e))},t.prototype.onTouchBegin=function(e){this.avatar&&this.avatar.onTouchBegin(e)},t.prototype.syncTouchEnd=function(){var e=this;e.viewer||(e.needSync?e.gateway.syncTouchEnd():e.scene.cmd_touchMoveEnd(e.sit))},t.prototype.onTouchEnd=function(){this.avatar&&this.avatar.onTouchEnd()},t.prototype.syncTouchChange=function(e){var t=this;t.viewer||(t.needSync?t.gateway.syncTouchChange(e):t.scene.cmd_touchMoveChange(t.sit,e))},t.prototype.onTouchChange=function(e){this.avatar&&this.avatar.onTouchChange(e)},t.prototype.syncChangePress=function(e){var t=this;t.viewer||(t.needSync?t.gateway.syncChangePress(e):t.scene.cmd_changePress(t.sit,e))},t.prototype.onChangePress=function(e){this.avatar&&this.avatar.onChangePress(e)},t.prototype.reqUseAvatarSkill=function(e){var t=this;t.viewer||(t.needSync?t.gateway.reqUseAvatarSkill(e):t.scene.cmd_useAvatarSkill(t.sit,e))},t.prototype.onUseAvatarSkill=function(e){this.avatar&&this.avatar.onUseSkill(e)},t.prototype.reqComboAvatarSkill=function(e){var t=this;t.viewer||(t.needSync?t.gateway.reqComboAvatarSkill(e):t.scene.cmd_comboAvatarSkill(t.sit,e))},t.prototype.onComboAvatarSkill=function(e){this.avatar&&this.avatar.onSetComboSkill(e)},t.prototype.reqBreakAvatarXuli=function(e){var t=this;t.viewer||(t.needSync?t.gateway.reqBreakAvatarXuli(e):t.scene.cmd_breakAvatarXuli(t.sit,e))},t.prototype.onBreakAvatarXuli=function(e){this.avatar&&this.avatar.onInterruptXuli(e)},t.prototype.reqUsePetSkill=function(e,t){var i=this;i.viewer||(i.needSync?i.gateway.reqUsePetSkill(e,t):i.scene.cmd_usePetSkill(i.sit,e,t))},t.prototype.onUsePetSkill=function(e,t){var i=this.pet;i&&i.petId==e&&i.onUseSkill(t)},t.prototype.reqComboPetSkill=function(e,t){var i=this;i.viewer||(i.needSync?i.gateway.reqComboPetSkill(e,t):i.scene.cmd_comboPetSkill(i.sit,e,t))},t.prototype.onComboPetSkill=function(e,t){var i=this.pet;i&&i.petId==e&&i.onSetComboSkill(t)},t.prototype.reqBreakPetXuli=function(e,t){var i=this;i.viewer||(i.needSync?i.gateway.reqBreakPetXuli(e,t):i.scene.cmd_breakPetXuli(i.sit,e,t))},t.prototype.onBreakPetXuli=function(e,t){var i=this.pet;i&&i.petId==e&&i.onInterruptXuli(t)},t.prototype.reqUsePetKillSkill=function(e){var t=this;if(!t.viewer){var i=t.avatar;i&&i.canUsePetKillSkill(e,!0)&&(t.needSync?t.gateway.reqUsePetKillSkill(e):t.scene.cmd_usePetKillSkill(t.sit,e))}},t.prototype.reqNpcTransBegin=function(e){var t=this;if(!t.viewer){var i=t.avatar;if(!i||i.heroId==e.battNpcCfg.trans.heroId||i.isDead)return!1;if(i.transNpc&&i.transNpc.battNpcId==e.battNpcId||i.transHeroId==e.battNpcCfg.trans.heroId)return Prompt.msgId(2241),!1;var r=e.battNpcId;return t.needSync?t.gateway.reqNpcTransBegin(r):t.addOnceTimer(0,t.onDelayNpcTransBegin,r),!0}},t.prototype.onDelayNpcTransBegin=function(e){this.scene&&this.scene.cmd_npcTransBegin(this.sit,e)},t.prototype.onNpcTransBegin=function(e){var t=this,i=t.scene.getBattNpcByNpcId(e);if(i){var r=i.battNpcCfg.trans;if(r){var n=r.heroId,a=t.avatar;!a||a.transNpc&&a.transNpc.battNpcId==e||a.transHeroId==n||a.heroId==n||a.isDead||(t.scene.battNpcList.forEach(function(t){t.isTransNpc&&t.onNpcTransBegin(e)}),a.onNpcTransBegin(i))}}},t.prototype.reqNpcTransStop=function(){var e=this,t=e.avatar;return!t||!t.transHeroId||t.isDead||e.viewer?!1:(e.needSync?e.gateway.reqNpcTransStop():e.addOnceTimer(0,e.onDelayNpcTransStop),!0)},t.prototype.onDelayNpcTransStop=function(){this.scene&&this.scene.cmd_npcTransStop(this.sit)},t.prototype.onNpcTransStop=function(){var e=this,t=e.avatar;e.scene.battNpcList.forEach(function(e){e.isTransNpc&&e.onNpcTransStop()}),t&&t.transHeroId&&!t.isDead&&t.onNpcTransStop()},t.prototype.getFirstPetElement=function(){var e=this.upPets[0];if(!e)return 0;var t=Data.getItem("PetData",e.petId);return t?t.element||0:0},t.prototype.getNextAvatarInfo=function(e){var t=this.avatarInfos;if(!t)return null;if(!e)return t[0];for(var i,r=0,n=t.length;n>r;r++)if(i=t[r],i.petId==e)return t[r+1];return null},t.prototype.getShowAvatarInfo=function(){var e=this.avatar;if(!e)return null;for(var t,i=this.avatarInfos,r=i.length,n=-1,a=0;r>a;a++)if(t=i[a],t.petId==e.petId){n=a;break}return-1==n?null:n==r-1?i[n-1]:i[n+1]},t.prototype.checkHasNextAvatar=function(e){var t=this.avatarInfos,i=t[t.length-1];return i&&i.petId!=e},t.prototype.checkPetAvatarDead=function(e){var t=this.avatar;if(!t)return!0;if(t&&t.petId==e)return t.isDead;for(var i,r=this.avatarInfos,n=-1,a=-1,o=0,s=r.length;s>o;o++)i=r[o],i.petId==t.petId&&(n=o),i.petId==e&&(a=o);return n>a},t.prototype.getPickupTrapList=function(){return this.pickupTrapList?this.pickupTrapList.concat():[]},t.prototype.onDestroy=function(){var t=this;t.scene&&t.scene.removeCallLater(t),e.prototype.onDestroy.call(this);var i=t.petInfoList;i.forEach(function(e){e.dispose()}),t.pickupTrapList&&t.pickupTrapList.forEach(function(e){e.dispose()}),t.pickupTrapList=null,t.pickupTraps=null,t.clearHelpSkill(),t.combo=null,t.avatar=null,t.pet=null,t.fruit=null,t.avatarInfos=null,t.equipSkills=null,t.skills=null,t.skillSlots=null,t.skillList=null,t.items=null,t.itemSlots=null,t.itemList=null,t.itemPubCds=null,t.itemCds=null,t.itemNums=null,t.moneys=null,t.upPets=null,t.petInfoList=null,t.petInfos=null,t.curPetInfo=null,t.curRandomBuffs=null},t}(Agent);__reflect(RoomAgent.prototype,"RoomAgent"),window.RoomAgent=RoomAgent;var FuncItem=function(e){function t(){return e.call(this)||this}return __extends(t,e),t}(BaseItem);__reflect(FuncItem.prototype,"FuncItem"),window.FuncItem=FuncItem;var AIAction_CloseTo=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.onPlay=function(){var e=this,t=e.cfg.vals||[];e.skillx=t[0]||0,e.skilly=t[1]||0,e.speedRate=Fixed.value(t[2]||0).sub(1).max(-1).value,e.endx=t[3]||0,e.endy=t[4]||0,e.skillRate=t[5]||0,e.isTurnDest=!!t[6],e.closeToTarget()},t.prototype.closeToTarget=function(){var e=this;e.owner.startMove(2,e.ai.target,e.isTurnDest?null:e.ai.target,e.moveToDestEnd.bind(e),e.speedRate,!0,e.endx,e.endy)},t.prototype.moveToDestEnd=function(){this.checkUseSkill(),this.isEnd=!0},t.prototype.doEnterFrame=function(e){this.checkUseSkill()},t.prototype.checkUseSkill=function(){var e=this,t=e.owner,i=e.ai;if(t&&i){var r=i.target;if(r&&t.scene.seedr.random<e.skillRate){var n=Fixed.value(r.x).sub(t.x).abs().value,a=Fixed.value(r.y).sub(t.y).abs().value;if(n<=e.skillx&&a<=e.skilly){var o=i.getAutoUseSkill();o&&(e.skillInfo=o,e.isEnd=!0)}}}},t.prototype.onActionEnd=function(){this.owner.stopMove(),e.prototype.onActionEnd.call(this)},t.prototype.onDestroy=function(){this.owner&&this.owner.stopMove(),ObjectUtils.clearKeysNum(this,["skillx","skilly","endx","endy","speedRate","skillRate"])},t}(AIAction_Base);__reflect(AIAction_CloseTo.prototype,"AIAction_CloseTo"),window.AIAction_CloseTo=AIAction_CloseTo;var AIAction_FarAway=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.onPlay=function(){var e=this,t=e.cfg.vals||[];e.skillx=t[0]||0,e.skilly=t[1]||0,e.speedRate=Fixed.value(t[2]||0).sub(1).max(-1).value,e.hasNext=!t[3],e.skillRate=t[4]||0,e.farAwayTarget()},t.prototype.farAwayTarget=function(){},t.prototype.moveToDestEnd=function(){this.hasNext?this.farAwayTarget():(this.checkUseSkill(),this.isEnd=!0)},t.prototype.doEnterFrame=function(e){this.checkUseSkill()},t.prototype.checkUseSkill=function(){var e=this,t=e.owner,i=e.ai;if(t&&i){var r=i.target;if(r&&t.scene.seedr.random<e.skillRate){var n=Fixed.value(r.x).sub(t.x).abs().value,a=Fixed.value(r.y).sub(t.y).abs().value;if(n<=e.skillx&&a<=e.skilly){var o=i.getAutoUseSkill();o&&(e.skillInfo=o,e.isEnd=!0)}}}},t.prototype.onActionEnd=function(){this.owner.stopMove(),e.prototype.onActionEnd.call(this)},t.prototype.onDestroy=function(){var e=this;e.owner&&e.owner.stopMove(),ObjectUtils.clearKeyBool(e,["hasNext"]),ObjectUtils.clearKeysNum(e,["skillx","skilly","dx","dy","speedRate","skillRate"])},t}(AIAction_Base);__reflect(AIAction_FarAway.prototype,"AIAction_FarAway"),window.AIAction_FarAway=AIAction_FarAway;var GMonster=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.getHpBarCls=function(){return MonsterHpBar},t.prototype.updateName=function(){var e=this;e.nameTxt.textFlow=StringUtils.rich(e.owner.name),e.nameTxt.visible=e.owner.visible_name,e.updateUIPos()},t.prototype.updateTopVisible=function(){var e=this,t=e.owner,i=e.topGrp;i.visible=t.visible_top&&t.visible_ui&&t.visible_undead&&!DebugStatic.isVideo,i.alpha=1,egret.Tween.removeTweens(i)},t}(GRole);__reflect(GMonster.prototype,"GMonster"),window.GMonster=GMonster;var AI_PatrolAction=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.onPlay=function(){var e=this,t=e.owner,i=e.cfg.vals||[];1==i[0]?(e.centerx=t.bornx,e.centery=t.borny):(e.centerx=e.ai.idlex,e.centery=e.ai.idley),e.speedRate=Fixed.value(i[1]||0).sub(1).max(-1).value,e.range=i[2]||0,e.moveToPartolPos()},t.prototype.moveToPartolPos=function(){},t.prototype.moveToDestEnd=function(){this.moveToPartolPos()},t.prototype.onActionEnd=function(){this.owner.stopMove(),e.prototype.onActionEnd.call(this)},t.prototype.onDestroy=function(){this.owner&&this.owner.stopMove(),ObjectUtils.clearKeysNum(this,["centerx","centery","speedRate","dx","dy","range"])},t}(AIAction_Base);__reflect(AI_PatrolAction.prototype,"AI_PatrolAction"),window.AI_PatrolAction=AI_PatrolAction;var TimeBar=function(e){function t(){var t=e.call(this)||this;return t.width=123,t.height=10,t.anchorOffsetX=61,t}return __extends(t,e),t}(MaskBar);__reflect(TimeBar.prototype,"TimeBar"),window.TimeBar=TimeBar;var PanelBaseLine=function(){function e(){this._lineUIs=[]}return e.prototype.onCreate=function(){this._lineUIs=[],this._paramsMap=new HashMap,this.addEvents()},e.prototype.open=function(e,t,i,r){if(this.checkAdd(e,t,i,r)){var n=Data.getItem("PanelData",e),a=LineUIData.create();a.id=e,a.cfg=n,a.params=t,a.lineParam=r,a.closeUI=i,a.oid=this.id,a.st=n.st||0,this._lineUIs.push(a);var o=this._lineUIs;o.sort(function(e,t){return t.st-e.st}),this._timeId||(this._timeId=Functor.delay(this.onDelay,100,this))}},e.prototype.onDelay=function(){this._timeId=0,this.openPupup()},e.prototype.clearLineUIs=function(){this._lineItem&&LineUIData.recover(this._lineItem),this._lineItem=null,this._lineView=null;for(var e=this._lineUIs.concat(),t=e.length;t--;)LineUIData.recover(e[t]);this._lineUIs.length=0},e.prototype.getLineUI=function(e,t){for(var i=this._lineUIs,r=i.length;r--;){var n=i[r];if(n.id===e&&ObjectUtils.checkSimpleSame(n.params,t))return n}},e.prototype.getLineUIs=function(){return this._lineUIs.concat()},e.prototype.removeLineUI=function(e){for(var t=this._lineUIs,i=t.length;i--;){var r=t[i];r.id===e&&(t.splice(i,1),LineUIData.recover(r))}},e.prototype.removeLineUIData=function(e){var t=this._lineUIs,i=t.indexOf(e);i>-1&&(t.splice(i,1),LineUIData.recover(e))},e.prototype.addEvents=function(){App.addL("app_ui_hide",this.onHideUI,this)},e.prototype.checkAdd=function(e){for(var t=[],i=1;i<arguments.length;i++)t[i-1]=arguments[i];return!0},e.prototype.checkPopupType=function(e){return!0},e.prototype.openPupup=function(){this._timeId&&(clearTimeout(this._timeId),this._timeId=0);var e=this._lineUIs;if(!(e.length<1)){var t=this.getNextLineUI();if(t){var i=this._lineItem,r=!0;if(i){if(r=!1,t.closeUI)for(var n=PanelMgr.getUIKey(i.id),a=0,o=t.closeUI;a<o.length;a++){var s=o[a];if(n===s){r=!0;break}}var l=t.lineParam;l&&l.nextSameClose&&t.id===i.id&&(r=!0)}r&&(CommonUtils.arrayRemove(this._lineUIs,t),this._lineItem=t,this._lineView=UI.open(PanelMgr.getUIKey(t.id),t.params,t.closeUI),this._lineView||(this._lineItem=null,GameLog.error("Please add name to pid == "+t.id)))}}},e.prototype.getNextLineUI=function(){for(var e,t,i=this._lineUIs,r=0,n=i.length;n>r;r++)if(t=i[r],this.checkPopupType(t.id)){e=t;break}return e},e.prototype.onHideUI=function(e){var t=e.data,i=t.vo;if(i){var r=this._lineItem;r&&i.view===this._lineView&&(CommonUtils.arrayRemove(this._lineUIs,r),this._lineItem&&LineUIData.recover(this._lineItem),this._lineItem=null,this._lineView=null);var n=!this.hasEnableLineUI()&&r;n?App.dispatch("c13",r):0===UI.closeNum&&this.openPupup()}},e.prototype.hasEnableLineUI=function(){return!!this.getNextLineUI()},e.prototype.clear=function(){this.clearLineUIs(),App.removeL("app_ui_hide",this.onHideUI,this)},e}();__reflect(PanelBaseLine.prototype,"PanelBaseLine"),window.PanelBaseLine=PanelBaseLine;var RecordBaseData=function(){function e(e){this.type=e}return e.prototype.initialize=function(e){this.isvalid=!0,this.parent=e,this.entityMgr=e.entityMgr},e.prototype.set_eid=function(e){return RecordMgr.set_eid(this.parent.roomsn,e,this.parent)},e.prototype.get_eid=function(e){return RecordMgr.get_eid(this.parent.roomsn,e,this.parent)},e.prototype.set_sit=function(e){return RecordMgr.set_sit(this.parent.roomsn,e,this.parent)},e.prototype.get_sit=function(e){return RecordMgr.get_sit(this.parent.roomsn,e,this.parent)},e.prototype.record=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t]},e.prototype.add=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return!1},e.prototype.recover=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t]},e.prototype.destroy=function(){var e=this;e.isvalid&&(e.isvalid=!1,e.parent=null,e.data=null,ObjectPool.push(e))},e}();__reflect(RecordBaseData.prototype,"RecordBaseData"),window.RecordBaseData=RecordBaseData;var BaseMap=function(e){function t(){var t=e.call(this)||this,i=t,r=i.scaleContent=new eui.Component;return r.touchEnabled=!1,i.addChild(r),i.content=new eui.Component,i.content.touchEnabled=!1,r.addChild(i.content),t}return __extends(t,e),t.prototype.initialize=function(e){var t=this;t.isvalid=!0,t.owner=e,t.touchEnabled=!1,t.width=App.battleWidth,t.height=e.height,t.refreshFrame=0,t.scrollRect=egret.Rectangle.create(),t.updateSize(),t.scaleX=t.scaleY=App.battleScale,t.layers={},t.layerList=[];for(var i=0,r=13;r>i;i++){var n=ObjectPool.pop(MapLayer);n.initialize(e,i),n.touchEnabled=t.layerTouchEnabled(i),n.touchChildren=t.layerTouchChildren(i),t.content.addChild(n),t.layers[i]=n,t.layerList.push(n),(7==i||11==i)&&(n.sortableChildren=!0)}},t.prototype.updateSize=function(){this.scrollRect.setTo(0,0,App.battleWidth,App.battleHeight),this.scrollRect=this.scrollRect},t.prototype.onHalfSecond=function(e){},t.prototype.onEnterFrame=function(e){this.layerList&&this.layerList.forEach(function(e){e.update()}),this.onUpdateDepth()},t.prototype.onUpdateDepth=function(){if(this.visible){var e=this.layers[7],t=e.$children;ArrayUtils.sortOn(t,["layouty","depth","hashCode"],[16,16,16]),e=this.layers[11],t=e.$children,ArrayUtils.sortOn(t,["y","depth","hashCode"],[16,16,16])}},t.prototype.onUpdateVisible=function(){var e=this;if(e.visible&&(e.refreshFrame--,!(e.refreshFrame>0))){for(var t,i=e.layers[7],r=i.$children,n=(e.owner.camera,0),a=r.length;a>n;n++)t=r[n],t.zIndex=n;e.refreshFrame=1}},t.prototype.updateRectShape=function(){},t.prototype.addGuise=function(e){return!1},t.prototype.layerTouchEnabled=function(e){return!1},t.prototype.layerTouchChildren=function(e){return!1},t.prototype.getLayer=function(e){return this.layers[e]},t.prototype.destroy=function(){var e=this;if(e.isvalid){e.isvalid=!1,e.onDestroy(),e.layerList.forEach(function(e){e.destroy()}),egret.Rectangle.release(e.scrollRect),e.content.removeChildren(),e.owner=null,e.layers=null,e.layerList=null,e.scrollRect=null,e.parent&&e.parent.removeChild(e);var t=e.scaleContent;t.anchorOffsetX=t.anchorOffsetY=t.x=t.y=0,ObjectPool.push(e)}},t.prototype.onDestroy=function(){this.refreshFrame=0},t}(eui.Component);__reflect(BaseMap.prototype,"BaseMap"),window.BaseMap=BaseMap;var BaseMenu=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.setPos=function(e,t){var i=this,r=i.params;i.px=e,i.py=t,r&&(void 0!==r.left&&(i.pleft=r.left),void 0!==r.bottom&&(i.pbottom=r.bottom),void 0!==r.horizontalCenter&&(i.horizontalCenter=r.horizontalCenter),void 0!==r.verticalCenter&&(i.verticalCenter=r.verticalCenter)),i.upPos(),isNaN(i.pleft)&&isNaN(i.pbottom)||i.addL(i,Evt.resize,i.upPos)},t.prototype.setData=function(e,t){this.menuData=e,this.params=t,this.onDataChange()},t.prototype.onOpen=function(){var e=this;e.stage&&e.addL(e.stage,Evt.touchTap,e.onStageClick),e.stage&&e.addL(e,Evt.touchTap,e.__onTapSelf)},t.prototype.onClose=function(){this.close()},t.prototype.close=function(){this.parent&&this.parent.removeChild(this)},t.prototype.onDataChange=function(){},t.prototype.onStageClick=function(e){this.close()},t.prototype.__onTapSelf=function(e){e.stopPropagation()},t.prototype.upPos=function(){var e=this,t=App.stage.stageWidth,i=App.stage.stageHeight,r=e.width,n=e.height,a=e.px,o=e.py;"number"==typeof e.pleft&&(a-=e.pleft+e.width),"number"==typeof e.pbottom&&(o-=e.pbottom+e.height);var s=a+10,l=o-10;s+r>t&&(s=t-r-10),l+n>i&&(l=i-n),e.x=s,e.y=l},t}(BaseView);__reflect(BaseMenu.prototype,"BaseMenu"),window.BaseMenu=BaseMenu;var BaseSliderBar=function(e){function t(){var t=e.call(this)||this;return t._labelFunction=null,t._countFunction=null,t._direction=eui.Direction.LTR,t._thumbPercent=0,t._fadePercent=0,t.maxCount=1,t.count=1,t.sslowSpeed=.1,t.squickSpeed=.3,t.sfadeSpeed=.1,t.aslowSpeed=.03,t.aquickSpeed=.05,t.afadeSpeed=.02,t.quickSpeed=0,t.fadeSpeed=0,t.speed=0,t.thumbValue=0,t.barIndex=0,t.beginIndex=0,t.endIndex=0,t.barColors=[0],t.oneBarValue=1,t.prefix="",t}return __extends(t,e),Object.defineProperty(t.prototype,"labelFunction",{get:function(){return this._labelFunction},set:function(e){this._labelFunction!=e&&(this._labelFunction=e,this.invalidateDisplayList())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"countFunction",{get:function(){return this._countFunction},set:function(e){this._countFunction!=e&&(this._countFunction=e,this.invalidateDisplayList())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"direction",{get:function(){return this._direction},set:function(e){var t=this;t._direction!=e&&(t._direction=e,t.invalidateDisplayList())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"thumbPercent",{get:function(){return this._thumbPercent},set:function(e){var t=this;t._thumbPercent!=e&&(t._thumbPercent=NumberUtils.limit(e,0,1))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fadePercent",{get:function(){return this._fadePercent},set:function(e){var t=this;t._fadePercent!=e&&(t._fadePercent=NumberUtils.limit(e,0,1))},enumerable:!0,configurable:!0}),t.prototype.setWidth=function(e){var t=this;t.width=e,t.fadeMask.width=e,t.thumbMask.width=e,t.next.width=e,t.fade.width=e,t.thumb.width=e},t.prototype.init=function(e,t,i,r,n,a,o,s,l){void 0===r&&(r=.1),void 0===n&&(n=.3),void 0===a&&(a=.1),void 0===o&&(o=.03),void 0===s&&(s=.05),void 0===l&&(l=.2);var u=this;u.clear(),u._initialized=!0,u.beginIndex=e,u.endIndex=t,u.barColors=i,u.sslowSpeed=r,u.squickSpeed=n,u.sfadeSpeed=a,u.aslowSpeed=o,u.aquickSpeed=s,u.afadeSpeed=l,u.shake&&(u.shake.visible=!1),u.oneBarValue=u.getOneBarValue(),u.thumbValue=u.getThumbValue(u.value),u.thumbPercent=u.thumbValue/u.oneBarValue;var c=u.thumb;c instanceof eui.Image&&(c.source=u.count>0?u.prefix+u.getColorIndex(u.count):null);var p=u.next;p&&(p.visible=u.count>1,p instanceof eui.Image&&(p.source=u.count>1?u.prefix+u.getColorIndex(u.count-1):null)),u.fade.visible=!1,u.labelDisplay&&(u.labelDisplay.text=u.valueToLabel(u.value,u.maximum)),u.countDisplay&&(u.countDisplay.text=u.countToLabel(u.count,u.maxCount)),u.updateMask(c,u.thumbMask,u.thumbPercent)},t.prototype.getOneBarValue=function(){return 1},t.prototype.getThumbValue=function(e){return e},t.prototype.getValueToPercent=function(e,t,i){return e/this.maximum},t.prototype.getTickValue=function(){return this.value},t.prototype.clear=function(){this._initialized=!1,TimerManager.removeTask(this.hashCode)},t.prototype.valueToLabel=function(e,t){return null!=this.labelFunction?this._labelFunction(e,t):e+" / "+t},t.prototype.countToLabel=function(e,t){return null!=this.countFunction?this._countFunction(e,t):"x"+e},t.prototype.change=function(e){var t=this;e=NumberUtils.limit(e,t.minimum,t.maximum);var i=e-t.value;if(0!=i){var r=t.thumbValue;if(t.value=e,t.thumbStop=!1,t.fadeStop=!1,t.thumbValue+=i,t.thumbToPercent=t.getValueToPercent(t.thumbValue,r,e),TimerManager.addFrameTask(t.onSlideTick,t),i>0?(t.speed=t.quickSpeed=t.aquickSpeed,t.fadeSpeed=t.afadeSpeed):(t.speed=t.quickSpeed=t.squickSpeed,t.fadeSpeed=t.sfadeSpeed),t.fadePercent=t.thumbPercent,t.fade.visible=!0,t.next){var n=t.next.parent;n.setChildIndex(t.fade,n.getChildIndex(t.next)+1)}t.updateMask(t.fade,t.fadeMask,t.fadePercent),t.fadeToPercent=t.thumbToPercent}},t.prototype.onSlideTick=function(){var e=this;if(e.onSliderThumb(),e.onSliderFade(),e.updateMask(e.thumb,e.thumbMask,e.thumbPercent),e.updateMask(e.fade,e.fadeMask,e.fadePercent),e.labelDisplay){var t=e.getTickValue();e.labelDisplay.text=e.valueToLabel(t,e.maximum)}e.countDisplay&&(e.countDisplay.text=e.countToLabel(e.count,e.maxCount)),e.thumbStop&&e.fadeStop&&(e.fade.visible=!1,TimerManager.removeTask(e.hashCode))},t.prototype.onSliderThumb=function(){var e=this;e.thumbStop||(e.thumbPercent=NumberUtils.lerp(e.thumbPercent,e.thumbToPercent,e.speed),Math.abs(e.thumbPercent-e.thumbToPercent)<=.01&&(e.thumbPercent=e.thumbToPercent,e.thumbStop=!0),e.thumbPercent>=e.thumbToPercent?e.subBar():e.addBar(),e.next&&(e.next.visible=e.count>1))},t.prototype.onSliderFade=function(){var e=this;if(!e.fadeStop)if(e.speed==e.quickSpeed){if(e.fadePercent=NumberUtils.lerp(e.fadePercent,e.fadeToPercent,e.fadeSpeed),e.fadePercent>e.fadeToPercent){if(Math.abs(e.fadePercent)<=.01){if(e.next){var t=e.next.parent;t.setChildIndex(e.fade,t.getChildIndex(e.next)+1)}e.fadePercent=1,e.fadeToPercent++}}else if(Math.abs(e.fadePercent)>=1){if(e.next){var i=e.next.parent;i.setChildIndex(e.fade,i.getChildIndex(e.next)+1)}e.fadePercent=0,e.fadeToPercent--}Math.abs(e.fadePercent-e.fadeToPercent)<=.01&&(e.fadePercent=e.fadeToPercent,e.fadeStop=!0)}else e.fadeStop=!0},t.prototype.addBar=function(){var e=this,t=Math.abs(e.thumbPercent-1);0>=t&&(e.count++,e.thumbPercent=0,e.thumbToPercent-=1,e.thumbValue-=e.oneBarValue,e.oneBarValue=e.getOneBarValue(),e.next&&e.next instanceof eui.Image&&(e.next.source=e.count>1?e.prefix+e.getColorIndex(e.count-1):null),e.thumb instanceof eui.Image&&(e.thumb.source=e.count>0?e.prefix+e.getColorIndex(e.count):null),e.countDisplay&&(e.countDisplay.text=e.countToLabel(e.count,e.maxCount)))
},t.prototype.subBar=function(){var e=this,t=Math.abs(e.thumbPercent);if(0>=t){if(e.next){var i=e.next.parent;i.setChildIndex(e.fade,i.getChildIndex(e.next)+1)}if(e.count<=0)return void(e.fade.visible=!1);e.count--,e.thumbPercent=1,e.thumbToPercent+=1,e.oneBarValue=e.getOneBarValue(),e.thumbValue+=e.oneBarValue,e.next&&e.next instanceof eui.Image&&(e.next.source=e.count>1?e.prefix+e.getColorIndex(e.count-1):null),e.thumb instanceof eui.Image&&(e.thumb.source=e.count>0?e.prefix+e.getColorIndex(e.count):null),e.countDisplay&&(e.countDisplay.text=e.countToLabel(e.count,e.maxCount))}},t.prototype.updateMask=function(e,t,i){var r=this,n=e.x,a=e.y,o=e.width,s=e.height;switch(r._direction){case eui.Direction.LTR:t.width=Math.round(o*i),t.height=s,t.x=n,t.y=a;break;case eui.Direction.RTL:t.width=Math.round(o*i),t.height=s,t.x=n+o-t.width,t.y=a;break;case eui.Direction.TTB:t.width=o,t.height=Math.round(s*i),t.x=n,t.y=a;break;case eui.Direction.BTT:t.width=o,t.height=Math.round(s*i),t.x=n,t.y=a+s-t.height}},t.prototype.getColorIndex=function(e){var t=this,i=t.maxCount;if(e==i)return t.beginIndex;if(1==e)return t.endIndex;var r=t.barColors,n=r.length;return r[(e-i%n)%n]},t}(eui.Range);__reflect(BaseSliderBar.prototype,"BaseSliderBar"),window.BaseSliderBar=BaseSliderBar;var TabBarImgItem=function(e){function t(){var t=e.call(this)||this;return t.isNotchTab=!1,t}return __extends(t,e),t.prototype.update=function(){e.prototype.update.call(this),this.upSelect()},t.prototype.initUI=function(){},t.prototype.addUI=function(){e.prototype.addUI.call(this),this.updateNotch()},t.prototype.removeUI=function(){},t.prototype.upSelect=function(){var e,t,i=this,r=i.data;i.unSelectedBg&&(i.unSelectedBg.source=e),i.selectedBg&&(i.selectedBg.source=t),i.unSelectedImg&&(i.unSelectedImg.source=r.up),i.selectedImg&&(i.selectedImg.source=r.down),i.lineBg&&(i.lineBg.source=r.line);var n=r.scale9Grid;if(n){var a=n.split(",");i.unSelectedBg&&(i.unSelectedBg.scale9Grid=egret.Rectangle.create().setTo(+a[0],+a[1],+a[2],+a[3])),i.selectedBg&&(i.selectedBg.scale9Grid=egret.Rectangle.create().setTo(+a[0],+a[1],+a[2],+a[3]))}},t.prototype.updateNotch=function(){!this.isNotchTab},t}(TabBarItemBase);__reflect(TabBarImgItem.prototype,"TabBarImgItem"),window.TabBarImgItem=TabBarImgItem;var AITrig_Base=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.initialize=function(e,t,i){var r=this;r.isvalid=!0,r.ai=e,r.owner=e.owner,r.trigId=t,r.subId=i.id,r.cfg=i,r.isAllEffect=!1,r.isDamageEffect=!1,r.type=i.type,r.ttimes=r.ctimes=i.times||0,r.interval=Fixed.millisecond(i.interval),r.curTime=Fixed.millisecond(i.start)},t.prototype.onEnterFrame=function(e){this.curTime>0&&(this.curTime=Fixed.value(this.curTime).sub(e).value)},t.prototype.trig=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return this.checkTrig.apply(this,e)?(this.onTrig(),!0):!1},t.prototype.checkTrig=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var i=this,r=i.ai,n=i.cfg;if(!r.canTrig)return!1;var a=i.owner,o=a.scene;if(!n.skipdead&&a.isDead)return!1;if(!o||!n.skippause&&o.isPause||!n.skipops&&!o.isPlaying&&!o.isPass)return!1;if(!n.skipops&&!o.isControl)return!1;if(n.trans&&a instanceof Avatar&&a.transHeroId)return!1;if(i.ttimes&&i.ctimes<=0)return!1;if(i.curTime>0)return!1;var s=n.rate||1;if(s>0&&1>s){if(n.rateAtt){var l=a.props.gv(n.rateAtt);s=Fixed.value(s).add(l).value}if(o.seedr.random>s)return!1}var u=n.skillId;return u&&!n.cover&&r.hasSkillTrig?!1:i.checkSpecial.apply(i,e)&&(!n.auto||a.agent&&a.agent.autoBattle)?u&&!a.skill.canUse(u,n.direct)?!1:!0:!1},t.prototype.checkSpecial=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return!0},t.prototype.onTrig=function(){var e=this,t=e.ai,i=e.owner,r=i.scene,n=e.cfg,a=n.skillId,o=n.clearSubs,s=n.actSubs;e.ttimes&&e.ctimes--,e.interval&&(e.curTime=e.interval),n.datas&&n.datas.forEach(function(a){switch(a.type){case 2:var o=BulletExtra.create(i,i,a.val[0],0,0,1);o&&i.skill.onTrigBullet(o);break;case 3:var s;a.val&&a.val.forEach(function(e){s=BulletExtra.create(i,i,e,0,0,1),s&&i.skill.onTrigBullet(s)});break;case 4:var l=a.val,u=l[1]||0;u?(l[2]&&e.delayAddBuffId&&r.removeCallLaterIdx(e.delayAddBuffId),e.delayAddBuffId=r.addCallLater(e.onDelayAddBuff,e,u,!1,!1,l[0])):i.buff.addBuff(i,0,1,l[0]);break;case 5:a.val&&a.val.forEach(function(e){i.buff.addBuff(i,0,1,e)});break;case 6:r.playCameraEffect(i,a.val[0],0);break;case 7:r.addCallLater(e.onDelayChangeAI,e,1,!1,!1,a.val[0],!!a.val[1]);break;case 8:t.changeBattleAction(a.val[0]);break;case 9:i.showBubble(a.val[0]);break;case 10:var c=String(a.val[0]).split(":"),p=a.val[1],d=[];c.forEach(function(e){d.push(+e)}),1==p?i.showBubble(d[0]):2==p?i.showBubble(Fixed.randGet(d,r.seedr)):i.showBubbles(d);break;case 11:var f=!!a.val[0];f!=i.unselect&&(i.unselect=f);break;case 12:var l=a.val||[],h=[],v=[],m=l[0]?String(l[0]).split(":"):null;m&&m.forEach(function(e){h.push(+e)}),m=l[1]?String(l[1]).split(":"):null,m&&m.forEach(function(e){v.push(+e)}),r.resetMachine(i,h,v,l[2]);break;case 13:a.val&&(i.visible_undead=!a.val[0]),i.state.normal(118,!1);break;case 14:r.onTrigCreateTrap(TrapExtra.createByTrigger(i,a.val[0],i),1);break;case 15:e.onChangeEnemy(a);break;case 16:var l=a.val,y=l[1]||0,g=l[2],b=l[3],x=l[15]||0,I=l[16]||0,_=l[17]||1,S=l[18]||0,T=l[19]?String(l[19]).split(":"):null,w=void 0;if(3==g){if(w=r.getSumAvatar(i,y),!w)return;y=w.heroId,b=w.agent.name}i.hasCalled=!0;var A=ObjectPool.pop(SpawnMonsterInfo);if(A.init(),A.roomsn=i.roomsn,A.ownereid=i.$eid,A.side=0==S?i.side:r instanceof PvPRoom?1==i.side?2:1:1==i.side?0:1,A.spawnId=0,A.monsterId=y,A.name=b,A.type=g,A.posType=l[4],A.x=l[5],A.y=l[6],A.offx=l[7],A.offy=l[8],A.radius=l[9],A.randomh=l[14],A.dir=l[10],A.lvId=l[0]||0,A.ai=l[12],A.eskillId=l[11],A.effect=l[13],A.variants=[],A.propsRate=0,w){var P=w.agent;A.job=P.job,A.haloId=P.haloId,A.fashionId=P.fashionId,A.titleId=P.titleId,A.weaponId=P.weaponId,A.weaponRTimes=P.weaponRTimes,A.weaFasId=P.weaFasId,A.wingFasId=P.wingFasId,A.extraSkills=w.svrSkills.concat()}if(i&&_&&!A.lvId){var C=[],D=i.getSvrProps();D.forEach(function(e){C.push({name:e.name,val:Fixed.value(e.val||0).mul(_).value})}),A.extraProps=C,A.level=i.level}if(i&&i.buff&&T)for(var B=A.extraBuffs=[],k=0,E=T;k<E.length;k++){var R=E[k],F=i.buff.getBuffLv(+R,0);F&&B.push({buffId:+R,lv:F})}if(I&&(x=Math.min(x,I-r.getCallMonsterNum(i.side,y))),1==x)r.createMonster(A,!0);else if(x>1)for(;x>0;)r.createMonster(A,!0),x--;break;case 17:Prompt.battleMsg(String(n.val[0]));break;case 18:if(12!==n.type)break;break;case 19:var M=a.val[0]||0;(14==M||15==M||16==M)&&r instanceof RelayRoom&&r.roomCfg.score&&r.changeScoreVal(M,1,!1);break;case 20:var L=i.right,U=Fixed.value(i.x).sub(r.roadLeft).abs().value,O=Fixed.value(i.x).sub(r.roadRight).abs().value;U>O&&L?i.changeDirection(!1):O>U&&!L&&i.changeDirection(!0);break;case 21:var l=a.val;i.startMove(3,{x:l[0]||0,y:l[1]||0},null,null,0,!l[2]);break;case 22:var N=Fixed.millisecond(a.val[0]);N>=0&&r.onStopTick(N);break;case 23:var H=Fixed.millisecond(a.val[0]);H>0&&i.startInvisible(H);break;case 24:var l=a.val,j=l[0]||0,V=l[1]||0,H=Fixed.millisecond(l[2]);j&&V&&i.startHitTransHeal(j,V,H);break;case 25:var l=a.val,j=l[0]||0,V=l[1]||0,G=l[3]||0;if(j&&V&&G){var z,K=r.getAITrigBulletTargets(i,j,V,!!l[2]);K&&K.forEach(function(e){z=BulletExtra.create(i,e,G,0,0,1),z&&i.skill.onTrigBullet(z)})}break;case 26:var l=a.val,W=l[0];i.skill.clearBulletByTrigId(W),r.removeBulletByTrigId(i,W,!!l[1]);break;case 27:var l=a.val,X=l[0];X&&i.startSignTarget(X,Fixed.millisecond(l[1]));break;case 28:var X=a.val[0];X&&i.stopSignTarget(X);break;case 29:var l=a.val,q=l[0]||0,$=l[1]||0;r.roleList.forEach(function(e){!e.isDead&&e.heroId==q&&e.buff.addBuff(i,0,0,$)});break;case 30:var Y=a.val,Q=Y[0]||0;Q&&r.avatarList.forEach(function(e){e.side!=i.side&&e.startSignType(Q,Y[1]?String(Y[1]).split(":"):null,Fixed.millisecond(Y[2]),Y[3]||0,Fixed.millisecond(Y[4]))});break;case 31:var J=a.val[0]||0;J&&r.avatarList.forEach(function(e){e.side!=i.side&&e.stopSignType(J)});break;case 32:var l=a.val,w=r.getRandomEnemyAvatar(i.side);w&&w.setSignTypeStatu(l[0]||0,Fixed.millisecond(l[1]));break;case 33:var l=a.val,Z=l[0]||0,et=l[1]||0;if(Z&&et){var tt=l[2]||0,it=l[3]||0,rt=l[4],K=r.getSignDeadTargets(i.side,Z,et);K.length&&(tt&&K.forEach(function(e){e.buff.addBuff(i,0,0,tt)}),it&&i.buff.addBuff(i,0,0,it),rt&&Prompt.battleMsg(rt))}break;case 34:i.visible_undead=!0,i.state.remove(118);break;case 35:var nt,l=a.val,at=r.getUndeadNum(l[0]),ot=l[1]||0,st=l[2]||0,lt=e.undeadBulletPos;lt||(lt=e.undeadBulletPos={}),nt=lt[ot],nt||(nt=lt[ot]={});var ut,ct=l[3]?String(l[3]).split("&"):null;if(ct&&ct.forEach(function(e){ut=e.split(":"),nt[ut[0]]={x:+ut[1],y:+ut[2]}}),st&&ot&&at in nt){var pt=nt[at];r.bulletList.forEach(function(e){e.trigId==ot&&e.moveToDest(pt,st)})}break;case 36:var l=a.val,W=l[0]||0,dt=l[1]||0,ft=l[2]||0,ht=l[3]?String(l[3]):null;if(ht){var vt=i.props.gv(ht);ft=Fixed.value(ft).add(vt).value}if(W&&ft>0&&!r.checkBulletNumLimit(i,W,dt)&&r.seedr.random<=ft){var o=BulletExtra.create(i,i,W,0,0,1);if(o&&i.skill.onTrigBullet(o),i.hold){var mt=l[4],yt=l[5];mt&&yt&&r.showFetterTip(mt,yt)}}break;case 37:var l=a.val,R=l[0]||0,F=i.buff.getBuffLv(R);if(F>0){var u=l[1]||0,ft=l[2]||0,ht=l[3]?String(l[3]):null;if(ht){var vt=i.props.gv(ht);ft=Fixed.value(ft).add(vt).value}if(ft>0&&r.seedr.random<=ft&&(u?r.addCallLater(e.onDelayAddBuff,e,u,!1,!1,R,F):i.buff.addBuff(i,0,F,R),i.hold)){var mt=l[4],yt=l[5];mt&&yt&&r.showFetterTip(mt,yt)}}break;case 38:if(i.hold){var l=a.val,mt=l[0],yt=l[1];mt&&yt&&r.showFetterTip(mt,yt)}break;case 39:e.onDropSpecial(a);break;case 40:e.onAddBulletToTrigger(a);break;case 41:var gt=a.val,bt=gt[0]||0,xt=gt[1]||0;if(bt!=xt){var It=r.getSignEnemyAvatar(i.side,bt);It&&It.forEach(function(e){e&&e.setSignTypeStatu(xt,Fixed.millisecond(gt[2]))})}break;case 42:var l=a.val,_t=l[0]||0;i instanceof Avatar&&_t&&(i.transNpc&&i.agent&&i.onNpcTransStop(),i.onTransBegin(_t,l[1]||0));break;case 43:var l=a.val,St=i.props.gv(l[0]),Tt=l[1],ft=Tt?Fixed.value(St).div(Tt).value:0;ft=l[2]?Fixed.ceil(ft):Fixed.floor(ft);var wt=l[3],At=l[4]||0,Pt=l[5],Ct=l[6]||0;if(Pt){var Dt=i.props.gv(Pt);At=Fixed.value(At).add(Dt).value}At=PropUtils.getAttrFixedValue(Fixed.value(ft).mul(At).value,wt),Ct&&(At=Fixed.min(At,Ct)),i.props.setPropSlot(wt,"slot_ai_trig",At);break;case 44:var l=a.val,Bt=l[0]||0,kt=l[1];if(kt){var Et=i.props.gv(kt);Bt=Fixed.value(Bt).add(Et).value}i.skill.vampireRate=Fixed.max(i.skill.vampireRate,Bt);break;case 45:e.onAddBuffToTrigger(a);break;case 46:var Rt=Fixed.millisecond(a.val[0]);if(i.agent&&i instanceof Avatar&&Rt>0){var Ft=i.agent.getKillPetId();Ft&&i.startPetKill(Ft,Rt)}break;case 47:var Mt=Fixed.millisecond(a.val[0]);if(i instanceof Boss){i.canBeKill=!0;var Lt,It=r.getAllUndeadAvatar();It.forEach(function(e){Lt=e.agent.getKillPetId(),Lt&&e.startPetKill(Lt,Mt)})}}}),a&&(t.stop(),n.direct&&(i.state.remove(103,!1),i.state.interrupt(2),i.standLand()),!t.aiCfg.unturn&&t.turnToTarget(t.target),t.hasSkillTrig=i.skill.onBeginSkill(a,!1,!1)),e.doTrig(),o&&o.length&&r.addCallLater(e.onDelayRemoveTrigs,e,1,!1,!1,o),s&&s.length&&r.addCallLater(e.onDelayActiveTrigs,e,1,!1,!1,s),e.checkRemove()&&r.addCallLater(e.onDelayRemoveTrig,e,e.cfg.delay||1,!1,!1)},t.prototype.onDelayChangeAI=function(e,t){this.ai&&this.ai.changeAI(e,t)},t.prototype.onDelayRemoveTrigs=function(e){this.ai&&this.ai.removeTrigs(this.trigId,e)},t.prototype.onDelayActiveTrigs=function(e){this.ai&&this.ai.activeTrigs(this.trigId,e)},t.prototype.onDelayRemoveTrig=function(){this.ai&&this.ai.removeTrig(this)},t.prototype.onDelayAddBuff=function(e,t){void 0===t&&(t=1);var i=this,r=i.owner;i.delayAddBuffId=0,r&&r.buff&&r.buff.addBuff(r,0,t,e)},t.prototype.onChangeEnemy=function(e){var t=this.owner.scene.getAISelectTarget(this.owner,e.val[0],e.val[1],null);t&&this.ai.onSelectEnemy(t)},t.prototype.onDropSpecial=function(e){var t=e.val,i=Data.getItem("MonsterDropData",t[0]);this.maxDropNum||(this.maxDropNum=t[1]),this.doDropSpecial(i,i.num)},t.prototype.doDropSpecial=function(e,t){var i=this;if(e.type){var r=Math.floor(Math.random()*(e.maximum-e.minimum)+e.minimum);if(!i.maxDropNum||(t=Math.min(i.maxDropNum-i.curDropNum,t))){r=Math.min(t,r);for(var n=i.owner,a=Math.floor(t/r),o=t-(r-1)*a,s=[],l=0;r>l;l++)s.push({idx:0,id:e.itemId,num:l==r-1?o:a,extra:""});i.curDropNum+=t,n.scene instanceof RelayRoom&&n.scene.onTrigDrop(e.type,t,n,s,e.untotal)}}},t.prototype.onAddBulletToTrigger=function(e){},t.prototype.onAddBuffToTrigger=function(e){},t.prototype.doTrig=function(){},t.prototype.resetTrig=function(){},t.prototype.checkRemove=function(){return!this.cfg.unremove&&this.ttimes&&!this.ctimes},t.prototype.checkOwnerType=function(e,t,i){return 0==i?t==e:1==i?t!=e&&t.side==e.side:2==i?t.side==e.side:3==i?t.side!=e.side:4==i?t.side==e.side&&e.agent&&t==e.agent.avatar:5==i?t.side==e.side&&e.agent&&t.prid==e.prid&&t instanceof Pet:!1},t.prototype.dispose=function(){var e=this;if(e.isvalid){e.isvalid=!1,e.onDestroy();var t=e.owner;t&&t.scene&&t.scene.removeCallLater(e),ObjectUtils.clearKeys(e,["ai","owner","cfg","isAllEffect","isDamageEffect","undeadBulletPos"]),ObjectUtils.clearKeysNum(e,["type","ttimes","ctimes","interval","curTime","delayAddBuffId","maxDropNum","curDropNum"]),ObjectPool.push(e)}},t.prototype.onDestroy=function(){},t}(egret.HashObject);__reflect(AITrig_Base.prototype,"AITrig_Base"),window.AITrig_Base=AITrig_Base;var RoleBattleData=function(){function e(){}return e.prototype.init=function(){var e=this;e.isvalid=!0,e.hp=0,e.hpRate=1,e.mpRate=1,e.damage=0,e.heal=0,e.beHurt=0},e.prototype.dispose=function(){var e=this;e.isvalid&&(e.isvalid=!1,ObjectUtils.clearKeys(e,["hpRate","mpRate","damage","heal","beHurt"]),e.onDestroy(),ObjectPool.push(e))},e.prototype.onDestroy=function(){},e}();__reflect(RoleBattleData.prototype,"RoleBattleData"),window.RoleBattleData=RoleBattleData;var PvEBattleUI=function(e){function t(){return e.call(this)||this}return __extends(t,e),t}(BaseBattleUI);__reflect(PvEBattleUI.prototype,"PvEBattleUI"),window.PvEBattleUI=PvEBattleUI;var UpAction=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.checkEnd=function(e,t,i,r,n){if(!i){var a=this,o=a.owner,s=a.action,l=s.nspy;if(0>l)return void(a.status=2);var u=Fixed.value(2).mul(60).mul(n).value,c=Fixed.value(160).div(n).value,p=Fixed.value(l).mul(2).sub(c).div(u).add(o.oz).max(0).value;s.nspy=Fixed.value(l).sub(c).value,o.updatePos(o.ox,o.oy,p,o.right),s.nspy<0&&(a.status=2)}},t}(SubAction);__reflect(UpAction.prototype,"UpAction"),window.UpAction=UpAction;var UpLandAction=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.play=function(){e.prototype.play.call(this);var t=this.owner;t&&t.buff&&t.heroCfg&&t.heroCfg.upBuff&&t.buff.addBuff(t,0,0,t.heroCfg.upBuff)},t}(SubAction);__reflect(UpLandAction.prototype,"UpLandAction"),window.UpLandAction=UpLandAction;var AgentAI=function(e){function t(){return e.call(this)||this}return __extends(t,e),Object.defineProperty(t.prototype,"canTickPortal",{get:function(){var e=this.owner;return e.hold&&e.scene.isOpen},enumerable:!0,configurable:!0}),t.prototype.onHalfSecond=function(e){this.tickPortal()},t.prototype.onEnterFrame=function(e){var t=this,i=t.owner;1==i.moveType?t.onTouchMove():2==i.moveType?t.onMoveToPos():3==i.moveType&&t.onMoveToPos()},t.prototype.tickPortal=function(){},t.prototype.changeTarget=function(e){var t=this;t.target!=e&&(t.target=e)},t.prototype.turnToTarget=function(e){if(e){var t=this.owner;t.right&&t.x>=e.x?t.changeDirection(!1):!this.owner.right&&t.x<=e.x&&t.changeDirection(!0)}},t.prototype.moveToTarget=function(e){var t=this,i=t.owner;t.changeTarget(e),t.dx=e.x,t.dy=e.y,i.startMove(2),i.syncMoveToPos(e.x,e.y,e.z,i.right)},t.prototype.moveToPos=function(e,t){var i=this,r=i.owner;i.dx=e,i.dy=t,r.startMove(3),r.syncMoveToPos(e,t,0,r.right)},t.prototype.onTouchMove=function(){var e=this.owner,t=e.speedx;e.updatePos(e.scene.limitX(e.ox+t),e.scene.limitY(e.oy+e.speedy),e.z,t?t>0:e.right)},t.prototype.onMoveToPos=function(){var e=this,t=e.owner;if(t.x==e.dx&&t.y==e.dy)e.onMoveEnd();else{t.updateSpdByPos(t.x,t.y,e.dx,e.dy);var i=t.ox,r=t.speedx;r>0?i=Math.min(t.ox+r,e.dx):0>r&&(i=Math.max(t.ox+r,e.dx));var n=t.oy,a=t.speedy;a>0?n=Math.min(t.oy+a,e.dy):0>a&&(n=Math.max(t.oy+a,e.dy)),t.updatePos(t.scene.limitX(i),t.scene.limitY(n),t.z,r?r>0:t.right)}},t.prototype.onMoveEnd=function(){var e=this;e.owner.stopMove();var t=e.target;t instanceof Npc&&t.onTrigNpc(),e.target=null,e.dx=0,e.dy=0},t.prototype.onDestroy=function(){var e=this;e.target=null,e.owner=null,ObjectPool.push(e)},t}(GameCom);__reflect(AgentAI.prototype,"AgentAI"),window.AgentAI=AgentAI;var AvatarAI=function(e){function t(){return e.call(this)||this}return __extends(t,e),Object.defineProperty(t.prototype,"canTickAI",{get:function(){var e=this.owner;return this.aiId&&!this.hasSkillTrig&&e&&!e.isDead&&e.agent&&e.agent.autoBattle&&e.scene&&!e.scene.isPause&&e.scene.isControl&&e.scene.isPlaying&&!e.beControl&&e.state.hasState(112)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"canTrig",{get:function(){return!(!this.owner||!this.owner.agent)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"canTickPortal",{get:function(){var e=this.owner,t=e.scene;return!this.hasSkillTrig&&e&&!e.isDead&&t&&t.canShowPortal()},enumerable:!0,configurable:!0}),t.prototype.tickAI=function(){this.canTickPortal?3!=this.aistate&&this.enterPortalState():e.prototype.tickAI.call(this)},t.prototype.enterPortalState=function(){var e=this;e.aistate=3,e.actionIndex=-1,e.curSubAICfg=null,e.curSkillIndex=-1,e.clearAction();var t={type:99};e.curAction=ObjectPool.pop(BaseAI.getActionCls(t.type||0)),e.curAction.play(e,t)},t}(BaseAI);__reflect(AvatarAI.prototype,"AvatarAI"),window.AvatarAI=AvatarAI;var Game=function(){function e(){}return e.prototype.startGame=function(){e.IN_GAME=!0,this.hasInit||(this.hasInit=!0,Data.init(),RegisterClass.registerClass(),RenderUtils.initManager(NameMgr,FuncMgr,RedMgr,TipMgr,SoundUtils,GuideMgr),PanelMgr.initialize(),SysAlertMgr.initialize(),RecordMgr.initialize(),SoundUtils.initialize(),CommonBtnEffMgr.init(),TonPayMgr.initialize(),NativeCon["in"].initialize());var t={};t.svrId=1,t.roomSn=1,t.rid=1,t.job=1,t.level=1,t.speed=0;var i=ServiceMgr.createEntity(0,"Player",!0,0,null,t);i.enterScene(0,0,0,!0),i.enterSceneOK()},e.prototype.onRelogin=function(){e.IN_GAME=!1,this.hasInit=!1,GameStatic.battleWait.clear(!0),UI.closeOpenedUI(!1,!0),ServiceMgr.removeAllEntities(),GameSDK.SDKStopVideo(),SceneMgr.clearScene(),PanelMgr.onRelogin(),UI.forcedClose()},e.SetFullScreen=function(){var e=document.documentElement,t=e.requestFullScreen||e.webkitRequestFullScreen||e.mozRequestFullScreen||e.msRequestFullscreen;"undefined"!=typeof t&&t&&t.call(e)},e.ExitFullScreen=function(){var e=document;e.exitFullscreen?e.exitFullscreen():e.webkitCancelFullScreen?e.webkitCancelFullScreen():e.msExitFullscreen()},e}();__reflect(Game.prototype,"Game"),window.Game=Game;var BattNpcAI=function(e){function t(){return e.call(this)||this}return __extends(t,e),t}(BaseAI);__reflect(BattNpcAI.prototype,"BattNpcAI"),window.BattNpcAI=BattNpcAI;var FruitAI=function(e){function t(){return e.call(this)||this}return __extends(t,e),Object.defineProperty(t.prototype,"canTickAI",{get:function(){var e=this,t=e.owner;return e.aiId&&!e.hasSkillTrig&&t&&t.agent&&!t.agent.isDead&&!t.isDead&&t.scene&&!t.scene.isPause&&t.scene.isControl&&t.scene.fruitTickAI&&!t.beControl&&(t.state.hasState(112)||t.state.hasState(101))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"canTrig",{get:function(){var e=this.owner;return e&&e.agent&&!e.agent.isDead},enumerable:!0,configurable:!0}),t}(BaseAI);__reflect(FruitAI.prototype,"FruitAI"),window.FruitAI=FruitAI;var MonsterAI=function(e){function t(){return e.call(this)||this}return __extends(t,e),Object.defineProperty(t.prototype,"canTickAI",{get:function(){if(!DebugStatic.isOpenMonsterAI)return!1;var e=this.owner,t=e.scene;return this.aiId&&!this.hasSkillTrig&&e&&!e.isDead&&t&&!t.isPause&&t.isControl&&t.isPlaying&&!e.beControl&&(e.state.hasState(112)||e.state.hasState(101))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"canTrig",{get:function(){return DebugStatic.isOpenMonsterTrig?!0:!1},enumerable:!0,configurable:!0}),t.prototype.onEnterScene=function(){e.prototype.onEnterScene.call(this);var t,i=this;i.owner.isVariant&&i.owner.variants.forEach(function(e){t=Data.getItem("VariantData",e),t.trig&&i.addTrig(t.trig)})},t}(BaseAI);__reflect(MonsterAI.prototype,"MonsterAI"),window.MonsterAI=MonsterAI;var PetAI=function(e){function t(){return e.call(this)||this}return __extends(t,e),Object.defineProperty(t.prototype,"canTickAI",{get:function(){if(!DebugStatic.isOpenPetAI)return!1;var e=this,t=e.owner;return e.aiId&&!e.hasSkillTrig&&t&&!t.isDead&&t.scene&&!t.scene.isPause&&t.scene.isControl&&t.scene.petTickAI&&!t.beControl&&(t.state.hasState(112)||t.state.hasState(101))?1==t.battleType||t.agent.autoBattle&&2==t.battleType&&t.heroCfg.hide&&t.heroCfg.hide.ai==e.aiId:!1},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"canTrig",{get:function(){return DebugStatic.isOpenPeTrig?1==this.owner.battleType||3==this.owner.battleType:!1},enumerable:!0,configurable:!0}),t}(BaseAI);__reflect(PetAI.prototype,"PetAI"),window.PetAI=PetAI;var BeatBackAction=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.setActionInfo=function(t,i,r,n,a,o,s){e.prototype.setActionInfo.call(this,t,i,r,n,a,o,s);var l,u=this,c=u.owner,p=u.subActions;u.ctime=Fixed.millisecond(a[0]),u.ttime=Fixed.millisecond(a[2]),u.time=u.lastDis=0,u.useWeight=!a[3],u.endStill=!!a[4];var d;d=1==o?c.x>=Fixed.value(a[5]||0).mul(i.multiply).add(i.x).value?1:-1:3==o?Fixed.value(c.multiply).neg().value:i.multiply,u.dis=Fixed.value(a[1]||0).mul(d).value,l=ObjectPool.pop(BackAction),l.initialize(u,n||"behit_stand",r?90:2,u.ttime||u.ctime,c.isAir?114:0),p.push(l)},t.prototype.onDestroy=function(){var t=this;t.ctime=0,t.time=0,t.dis=0,t.lastDis=0,t.useWeight=!1,e.prototype.onDestroy.call(this)},t}(HurtAction);__reflect(BeatBackAction.prototype,"BeatBackAction"),window.BeatBackAction=BeatBackAction;var AIAction_BattleStand=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.onPlay=function(){var e=this,t=e.owner,i=e.cfg.vals||[];e.rangex=i[0]||0,e.rangey=i[1]||0,e.skillRate=i[2]||0,e.isTurnDest=!!i[3],!t.isDead&&!t.state.hasState(112)&&t.state.normal(112,!1)},t.prototype.doEnterFrame=function(e){var t=this;if(!t.isEnd){var i=t.owner,r=t.ai.target;if(r){!t.isTurnDest&&t.ai.turnToTarget(r);var n=Fixed.value(r.x).sub(i.x).abs().value,a=Fixed.value(r.y).sub(i.y).abs().value;if(n<=t.rangex&&a<=t.rangey&&i.scene.seedr.random<t.skillRate){var o=t.ai.getAutoUseSkill();o&&(t.skillInfo=o,t.isEnd=!0)}}}},t.prototype.onDestroy=function(){ObjectUtils.clearKeysNum(this,["rangex","rangey","skillRate"])},t}(AIAction_Base);__reflect(AIAction_BattleStand.prototype,"AIAction_BattleStand"),window.AIAction_BattleStand=AIAction_BattleStand;var BulletLineAction=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.setActionInfo=function(t,i,r,n,a,o,s){e.prototype.setActionInfo.call(this,t,i,r,n,a,o,s);var l=this,u=Fixed.millisecond(a[1]),c=!a[2];l.dis=a[0]||0,u||(c=!0),l.depend=c,c&&i.addListener("onRemoved",l.onBulletRemoved,l);var p=ObjectPool.pop(SubAction);p.initialize(l,n||"behit_stand",r?90:2,u,0),l.subActions.push(p)},t.prototype.doFrame=function(e,t,i,r,n){if(!i){var a=this,o=a.owner,s=a.bullet,l=Fixed.value(a.dis).mul(s.multiply).add(s.ox).value;(s.right&&o.ox<l||!s.right&&o.ox>l)&&o.updatePos(o.scene.limitX(l),o.y,o.z,o.right)}},t.prototype.onBulletRemoved=function(){this.onAllSubActionEnd()},t.prototype.onDestroy=function(){var t=this;t.depend&&t.bullet.removeListener("onRemoved",t.onBulletRemoved,t),t.dis=0,t.depend=!1,e.prototype.onDestroy.call(this)},t}(HurtAction);__reflect(BulletLineAction.prototype,"BulletLineAction"),window.BulletLineAction=BulletLineAction;var AIAction_CloseToPortal=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.onHalfSecond=function(e){var t=this,i=this.owner,r=i.scene.checkHitPortal(i);if(i.agent.autoBattle&&i.state.hasState(112)&&!r&&(t.portal||(t.portal=i.scene.findFirstPortal()),i.startMove(3,t.portal,t.portal,t.moveToDestEnd.bind(t))),i.hold||i.agent.isRobot){var n=i.agent.isReadyNext;r&&!n?i.agent.syncNextRoundReady(!n):!r&&n&&i.agent.syncNextRoundReady(!n)}},t.prototype.moveToDestEnd=function(){this.owner.stopMove()},t.prototype.onDestroy=function(){this.owner&&this.owner.stopMove(),this.portal=null},t}(AIAction_Base);__reflect(AIAction_CloseToPortal.prototype,"AIAction_CloseToPortal"),window.AIAction_CloseToPortal=AIAction_CloseToPortal;var AIAction_CloseToY=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.closeToTarget=function(){var e=this;e.owner.startMove(2,{x:e.owner.x,y:e.ai.target.y},e.isTurnDest?null:e.ai.target,e.moveToDestEnd.bind(e),e.speedRate,!0,e.endx,e.endy)},t}(AIAction_CloseTo);__reflect(AIAction_CloseToY.prototype,"AIAction_CloseToY"),window.AIAction_CloseToY=AIAction_CloseToY;var DeadAction=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.setActionInfo=function(e,t){var i=this;if(e){var r=ObjectPool.pop(SpecialDeadAction);r.initialize(i,t,91,60,0),i.subActions.push(r)}else{var r=ObjectPool.pop(NormalDeadAction);r.initialize(i,t,4,51,0),i.subActions.push(r)}},t}(BaseAction);__reflect(DeadAction.prototype,"DeadAction"),window.DeadAction=DeadAction;var AIAction_FarAwayBorder=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.onPlay=function(){var t=this,i=t.cfg.vals||[];t.rangex=i[5]||0,t.rangey=i[6]||0,t.offx=i[7]||0,t.reverse=i[8]||0,t.isTurnDest=!!i[9],e.prototype.onPlay.call(this)},t.prototype.farAwayTarget=function(){var e=this,t=e.ai.target;if(t){var i,r=e.owner,n=e.owner.scene,a=void 0,o=void 0,s=void 0,l=void 0;a=r.x<t.x?Fixed.value(t.x).sub(e.offx).sub(e.reverse).value>n.roadLeft:Fixed.value(t.x).add(e.offx).add(e.reverse).value>n.roadRight,a?(o=Fixed.value(t.x).sub(e.offx).sub(e.rangex).max(n.roadLeft).value,s=Fixed.value(t.x).sub(e.offx).sub(o).value):(o=Fixed.value(t.x).add(e.offx).value,s=Fixed.value(t.x).add(e.offx).add(e.rangex).min(n.roadRight).sub(o).value),i=Fixed.value(t.y).sub(e.rangey).max(n.roadTop).value,l=Fixed.value(t.y).add(e.rangey).min(n.roadBottom).sub(i).value;var u=n.seedr.random,c=n.seedr.random;e.dx=n.limitX(Fixed.value(u).mul(s).add(o).round().value),e.dy=n.limitY(Fixed.value(c).mul(l).add(i).round().value),e.owner.startMove(3,{x:e.dx,y:e.dy},e.isTurnDest?null:t,e.moveToDestEnd.bind(e),e.speedRate,!0,0,0)}else e.isEnd=!0},t.prototype.onDestroy=function(){ObjectUtils.clearKeysNum(this,["rangex","rangey","offx","reverse"]),e.prototype.onDestroy.call(this)},t}(AIAction_FarAway);__reflect(AIAction_FarAwayBorder.prototype,"AIAction_FarAwayBorder"),window.AIAction_FarAwayBorder=AIAction_FarAwayBorder;var AIAction_FarAwayCircle=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.onPlay=function(){var t=this.cfg.vals||[];this.rangex=t[5]||0,this.isTurnDest=!!t[6],e.prototype.onPlay.call(this)},t.prototype.farAwayTarget=function(){var e=this,t=e.ai.target;if(t){var i=e.owner.scene,r=i.seedr.random,n=i.seedr.random,a=Fixed.value(r).mul(e.rangex).value,o=Fixed.value(n).mul(360).value,s=Fixed.value(o).mul(Fixed.PI).div(180).value;e.dx=i.limitX(Fixed.value(s).sin().mul(a).floor().add(t.x).round().value),e.dy=i.limitY(Fixed.value(s).cos().mul(a).floor().add(t.y).round().value),e.owner.startMove(3,{x:e.dx,y:e.dy},e.isTurnDest?null:t,e.moveToDestEnd.bind(e),e.speedRate,!0,0,0)}else e.isEnd=!0},t.prototype.onDestroy=function(){ObjectUtils.clearKeysNum(this,["rangex"]),e.prototype.onDestroy.call(this)},t}(AIAction_FarAway);__reflect(AIAction_FarAwayCircle.prototype,"AIAction_FarAwayCircle"),window.AIAction_FarAwayCircle=AIAction_FarAwayCircle;var AIAction_FarAwayRect=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.onPlay=function(){var t=this,i=t.cfg.vals||[];t.rangex=i[5]||0,t.rangey=i[6]||0,t.isTurnDest=!!i[7],e.prototype.onPlay.call(this)},t.prototype.farAwayTarget=function(){var e=this,t=e.ai.target;if(t){var i=e.owner.scene,r=i.seedr.random,n=i.seedr.random;e.dx=i.limitX(Fixed.value(r).mul(e.rangex).mul(2).add(t.x).sub(e.rangex).round().value),e.dy=i.limitY(Fixed.value(n).mul(e.rangey).mul(2).add(t.y).sub(e.rangey).round().value),e.owner.startMove(3,{x:e.dx,y:e.dy},e.isTurnDest?null:t,e.moveToDestEnd.bind(e),e.speedRate,!0,0,0)}else e.isEnd=!0},t.prototype.onDestroy=function(){ObjectUtils.clearKeysNum(this,["rangex","rangey"]),e.prototype.onDestroy.call(this)},t}(AIAction_FarAway);__reflect(AIAction_FarAwayRect.prototype,"AIAction_FarAwayRect"),window.AIAction_FarAwayRect=AIAction_FarAwayRect;var AIAction_FollowAvatar=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.onPlay=function(){var e=this,t=e.cfg.vals||[];e.endx=t[0]||0,e.endy=t[1]||0,e.followTick=Fixed.millisecond(t[2]),e.curTick=0;var i=e.getFollowAvatar();i?e.onStartFollow(i):e.onStopFollow()},t.prototype.getFollowAvatar=function(){var e=this.owner,t=e.agent?e.agent.avatar:null;return t&&(Fixed.value(e.x).sub(t.x).abs().value>this.endx||Fixed.value(e.y).sub(t.y).abs().value>this.endy)?t:null},t.prototype.onStartFollow=function(e){var t=this;t.curTick=0,t.owner.startMove(2,e,null,t.moveToDestEnd.bind(t),0,!0,t.endx,t.endy)},t.prototype.onStopFollow=function(){var e=this,t=e.owner;e.curTick=e.followTick,t&&!t.isDead&&t.state&&!t.state.hasState(112)&&t.state.normal(112,!1)},t.prototype.moveToDestEnd=function(){this.onStopFollow()},t.prototype.doEnterFrame=function(e){var t=this;if(!t.isEnd&&t.curTick&&(t.curTick=Fixed.value(t.curTick).sub(e).value,t.curTick<=0)){var i=t.getFollowAvatar();i?t.onStartFollow(i):t.curTick=t.followTick}},t.prototype.onDestroy=function(){this.owner&&this.owner.stopMove(),ObjectUtils.clearKeysNum(this,["endx","endy","followTick","curTick"])},t}(AIAction_Base);__reflect(AIAction_FollowAvatar.prototype,"AIAction_FollowAvatar"),window.AIAction_FollowAvatar=AIAction_FollowAvatar;var AIAction_IdleStand=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.onPlay=function(){var e=this.owner;!e.isDead&&!e.state.hasState(112)&&e.state.normal(112,!1)},t}(AIAction_Base);__reflect(AIAction_IdleStand.prototype,"AIAction_IdleStand"),window.AIAction_IdleStand=AIAction_IdleStand;var AIAction_MoveToDest=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.onPlay=function(){var e=this,t=e.cfg.vals||[];e.dx=t[0]||0,e.dy=t[1]||0,e.speedRate=Fixed.value(t[2]||0).sub(1).max(-1).value,e.adjust=!t[3],e.exeType=t[4]||0,e.exeVal1=t[5]||0,e.exeVal2=t[6]||0,e.closeToTarget()},t.prototype.closeToTarget=function(){var e=this;e.owner.startMove(2,{x:e.dx,y:e.dy},null,e.moveToDestEnd.bind(e),e.speedRate,e.adjust)},t.prototype.moveToDestEnd=function(){var e=this,t=e.owner,i=e.exeType;if(1==i)t.scene.onRoleDead(t,t,!1,!0),t.receiveLeaveScene();else if(2==i){var r=e.exeVal2,n=e.exeVal1;if(r&&n){var a=t.scene.getBattNpcByNpcId(r);a&&a.buff.addBuff(t,0,0,n)}t.scene.onRoleDead(t,t,!1,!0),t.receiveLeaveScene()}e.isEnd=!0},t.prototype.onActionEnd=function(){this.owner.stopMove(),e.prototype.onActionEnd.call(this)},t.prototype.onDestroy=function(){var e=this.owner;e&&(e.stopMove(),e.scene&&e.scene.removeCallLater(this)),ObjectUtils.clearKeysNum(this,["dx","dy","speedRate","adjust","exeType","exeVal1","exeVal2"])},t}(AIAction_Base);__reflect(AIAction_MoveToDest.prototype,"AIAction_MoveToDest"),window.AIAction_MoveToDest=AIAction_MoveToDest;var ExeuntAction=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.setActionInfo=function(e){var t=ObjectPool.pop(SubExeuntAction);
t.initialize(this,e||"idle",1,1e3,0),this.subActions.push(t)},t}(BaseAction);__reflect(ExeuntAction.prototype,"ExeuntAction"),window.ExeuntAction=ExeuntAction;var AIAction_PatrolDir=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.moveToPartolPos=function(){var e=this,t=e.owner,i=t.scene.seedr.random;e.dx=t.scene.limitX(Fixed.value(i).mul(e.range).add(e.centerx).round().value),e.dy=t.y,t.startMove(3,{x:e.dx,y:e.dy},null,e.moveToDestEnd.bind(e),e.speedRate)},t}(AI_PatrolAction);__reflect(AIAction_PatrolDir.prototype,"AIAction_PatrolDir"),window.AIAction_PatrolDir=AIAction_PatrolDir;var AIAction_PatrolRange=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.moveToPartolPos=function(){var e=this,t=e.owner,i=t.scene.seedr.random,r=t.scene.seedr.random,n=Fixed.value(i).mul(e.range).value,a=Fixed.value(r).mul(360).value,o=Fixed.value(a).mul(Fixed.PI).div(180).value;e.dx=t.scene.limitX(Fixed.value(o).sin().mul(n).floor().add(e.centerx).round().value),e.dy=t.scene.limitY(Fixed.value(o).cos().mul(n).floor().add(e.centery).round().value),t.startMove(3,{x:e.dx,y:e.dy},null,e.moveToDestEnd.bind(e),e.speedRate)},t}(AI_PatrolAction);__reflect(AIAction_PatrolRange.prototype,"AIAction_PatrolRange"),window.AIAction_PatrolRange=AIAction_PatrolRange;var AIAction_Special=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.onPlay=function(){this.index=-1,this.next()},t.prototype.next=function(){var e=this,t=e.cfg.vals;if(e.index++,!t||e.index>=t.length)return void(e.isEnd=!0);var i=e.owner,r=t[e.index],n=r.split(":"),a=n[0];if(e.playType=+n[1],1==e.playType){var o=i.actionCfg.dic[a];Functor.assert(!!o,"AI播放特殊动作时，模型动作资源："+i.actionCfg.res+" 缺少动作配置动作数据:"+a);var s=Fixed.value(1e3).div(60).value;e.playTime=Fixed.value(o.total||1).mul(s).value}else e.playTime=Fixed.millisecond(+n[2]);"idle"==a&&i.state.hasState(112)||!i.isDead&&i.state.normal(112,!1,a)},t.prototype.doEnterFrame=function(e){var t=this;t.isEnd||(t.playTime=Fixed.value(t.playTime).sub(e).value,t.playTime<=0&&t.next())},t.prototype.onDestroy=function(){ObjectUtils.clearKeysNum(this,["index","playType","playTime"])},t}(AIAction_Base);__reflect(AIAction_Special.prototype,"AIAction_Special"),window.AIAction_Special=AIAction_Special;var AITrig_AddBuff=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.initialize=function(t,i,r){e.prototype.initialize.call(this,t,i,r);var n=this;n.isAllEffect=!0;var a=r.val,o=n.buffIds=[],s=a[0]?String(a[0]).split(":"):null;n.ownerType=a[1]||0,s&&s.forEach(function(e){o.push(+e)})},t.prototype.checkSpecial=function(e,t){var i=this;return e&&i.checkOwnerType(i.owner,e,i.ownerType)?-1!=i.buffIds.indexOf(t):!1},t.prototype.onDestroy=function(){ObjectUtils.clearKeys(this,["buffIds","ownerType"])},t}(AITrig_Base);__reflect(AITrig_AddBuff.prototype,"AITrig_AddBuff"),window.AITrig_AddBuff=AITrig_AddBuff;var AITrig_AfterMachineActive=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.initialize=function(t,i,r){e.prototype.initialize.call(this,t,i,r);var n=this;n.isAllEffect=!0;var a,o=r.val,s=n.maxMachines={},l=n.activeMachines={},u=o[0]?String(o[0]).split("&"):null;u&&u.forEach(function(e){a=e.split(":"),s[+a[0]]=+a[1],l[+a[0]]=0})},t.prototype.checkSpecial=function(e){var t=this,i=t.maxMachines,r=t.activeMachines;if(e.heroId in r){if(e.isActivated){r[e.heroId]+=1;var n=!0;for(var a in r)if(r[a]<i[a]){n=!1;break}return n}r[e.heroId]-=1}return!1},t.prototype.onDestroy=function(){ObjectUtils.clearKeys(this,["maxMachines","activeMachines"])},t}(AITrig_Base);__reflect(AITrig_AfterMachineActive.prototype,"AITrig_AfterMachineActive"),window.AITrig_AfterMachineActive=AITrig_AfterMachineActive;var AITrig_AfterTargetDead=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.initialize=function(t,i,r){e.prototype.initialize.call(this,t,i,r),this.isAllEffect=!0;var n=r.val,a=this.heroIds=[],o=n[0]?String(n[0]).split(":"):null;o&&o.forEach(function(e){a.push(+e)}),this.curHeroIds=a.concat()},t.prototype.checkSpecial=function(e){var t=this.curHeroIds;if(!t.length)return!1;if(e&&e!=this.owner&&e.side==this.owner.side){var i=t.indexOf(e.heroId);i>=0&&t.splice(i,1)}return!t.length},t.prototype.doTrig=function(){this.curHeroIds=this.heroIds.concat()},t.prototype.onDestroy=function(){ObjectUtils.clearKeys(this,["heroIds","curHeroIds"])},t}(AITrig_Base);__reflect(AITrig_AfterTargetDead.prototype,"AITrig_AfterTargetDead"),window.AITrig_AfterTargetDead=AITrig_AfterTargetDead;var AITrig_AutoUsePetKill=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.checkSpecial=function(){var e=this.owner;return e.agent&&e instanceof Avatar&&e.killPetId?!0:!1},t.prototype.doTrig=function(){var e=this.owner;e instanceof Avatar&&e.onUsePetKillSkill(e.killPetId,!1)},t}(AITrig_Base);__reflect(AITrig_AutoUsePetKill.prototype,"AITrig_AutoUsePetKill"),window.AITrig_AutoUsePetKill=AITrig_AutoUsePetKill;var AITrig_AvatarBeHurt=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.initialize=function(t,i,r){e.prototype.initialize.call(this,t,i,r);var n=this,a=r.val;n.isAllEffect=!0,n.w=a[0]||0,n.h=a[1]||0,n.offx=a[2]||0,n.offy=a[3]||0,n.waitFrame=a[4]||0},t.prototype.checkSpecial=function(e,t){var i=this.owner,r=this.w,n=this.h;return i instanceof Pet&&1==i.battleType&&!i.scene.isAllPetUp&&!(t instanceof NorMonster)&&(!r||Fixed.value(e.x).sub(t.x).abs().value<=r)&&(!n||Fixed.value(e.y).sub(t.y).abs().value<=n)},t.prototype.trig=function(e,t){var i=this;if(!i.checkTrig(e,t))return!1;if(i.waitFrame)if(i.waiting){var r=i.caster,n=void 0;r?r instanceof Pet?t instanceof Avatar&&(n=t):r instanceof Monster&&(t instanceof Avatar||t instanceof Pet?n=t:t instanceof Monster&&t.type>r.type&&(n=t)):n=t,n&&(i.caster=n)}else i.waiting=!0,i.remainFrame=i.waitFrame,i.trigger=e,i.caster=t;else i.trigger=e,i.caster=t,i.onTrig();return!0},t.prototype.onEnterFrame=function(t){e.prototype.onEnterFrame.call(this,t);var i=this;i.waiting&&(i.remainFrame-=1,i.remainFrame<=0&&(i.owner instanceof Pet&&1==i.owner.battleType?i.onTrig():i.waiting=!1))},t.prototype.onTrig=function(){var t=this,i=t.owner,r=t.trigger,n=t.caster;if(t.waiting=!1,t.remainFrame=0,r&&n){var a=i.scene.limitX(Fixed.value(t.offx).mul(n.x>r.x?1:-1).add(r.x).value),o=i.scene.limitY(Fixed.value(r.y).add(t.offy).value);t.owner.updatePos(a,o,i.z,a<n.x)}t.trigger=null,t.caster=null,e.prototype.onTrig.call(this)},t.prototype.onDestroy=function(){ObjectUtils.clearKeysNum(this,["w","h","waitFrame","waiting","remainFrame","trigger","caster"])},t}(AITrig_Base);__reflect(AITrig_AvatarBeHurt.prototype,"AITrig_AvatarBeHurt"),window.AITrig_AvatarBeHurt=AITrig_AvatarBeHurt;var FlyAction=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.setActionInfo=function(t,i,r,n,a,o,s){e.prototype.setActionInfo.call(this,t,i,r,n,a,o,s);var l,u,c=this,p=c.owner,d=c.subActions,f=a[0]||0,h=a[1]||0,v=!!a[2],m=a[3]||0,y=p.props.gv("weight")||1,g=p.isAir,b=p.heroCfg.isNewAir;if(1==o){var x=Fixed.value(a[4]||0).mul(i.multiply).add(i.x).value;u=v&&p.x==x&&p.y==i.y?p.scene.seedr.random<.5?1:-1:p.x>=x?1:-1}else u=3==o?Fixed.value(p.multiply).neg().value:i.multiply;c.px=f,c.py=h,c.dir=o,c.nspy=c.spy=Fixed.value(h).div(y).mul(130).value,c.adjust=u,c.spx=Fixed.value(f).div(y).mul(c.adjust).mul(65).div(60).value,c.canSpin=!b||0>=m?!1:m>=1?!0:p.scene.seedr.random<=m,c.spyRate=1,b?c.canSpin?(l=ObjectPool.pop(TransUpAction),l.initialize(c,n||(g?"land_air_1":"land_air"),3,1,114),d.push(l),l=ObjectPool.pop(SpinUpAction1),l.initialize(c,"air_spin",r?90:1,0,114,c.onSpring),d.push(l),l=ObjectPool.pop(SpinUpAction2),l.initialize(c,"air_spin",r?90:1,0,114),d.push(l)):(l=ObjectPool.pop(TransUpAction),l.initialize(c,n||(g?"land_air_1":"land_air"),0,0,114),d.push(l),l=ObjectPool.pop(UpAction),l.initialize(c,g?"land_air_1":"behit_air",r?90:2,0,114),d.push(l),l=ObjectPool.pop(DownAction),l.initialize(c,"air_down",0,0,114),d.push(l),l=ObjectPool.pop(DownAction),l.initialize(c,"behit_down",2,0,114,c.onSpring),d.push(l),l=ObjectPool.pop(UpAction),l.initialize(c,"behit_air",2,0,114),d.push(l),l=ObjectPool.pop(DownAction),l.initialize(c,"behit_down",2,0,114),d.push(l)):((n||!p.isAir)&&(l=ObjectPool.pop(TransUpAction),l.initialize(c,n||"land_air",0,0,114),d.push(l)),l=ObjectPool.pop(UpAction),l.initialize(c,"behit_air",r?90:2,0,114),d.push(l),l=ObjectPool.pop(DownAction),l.initialize(c,"behit_down",2,0,114,c.onSpring),d.push(l),l=ObjectPool.pop(UpAction),l.initialize(c,"behit_air",2,0,114),d.push(l),l=ObjectPool.pop(DownAction),l.initialize(c,"behit_down",2,0,114),d.push(l));var I=c.state.lctime||Fixed.millisecond(Data.getSValue("HeroData",p.heroId,"lct"));l=ObjectPool.pop(UnderLandAction),l.initialize(c,"behit_land",I?2:0,I,115),d.push(l),l=ObjectPool.pop(UpLandAction),l.initialize(c,"behit_up",0,0,115),d.push(l)},t.prototype.play=function(){e.prototype.play.call(this),this.owner.buff.dealTrigBuff(25,0,this.owner,this.caster)},t.prototype.doFrame=function(e,t,i,r,n){var a=this,o=a.owner;i||a.state.com.hasState(115)||o.updatePos(o.scene.limitX(Fixed.value(a.spx).div(n).add(o.ox).value),o.y,o.z,o.right)},t.prototype.doSubFrame=function(e,t,i,r,n){var a=this,o=a.spyRate&&a.nspy>=0&&a.nspy<=Fixed.value(a.spy).mul(.1).value?6:1;o=Fixed.value(o).mul(n).value,a.subAction&&a.subAction.onEnterFrame(e,t,i,r,o)},t.prototype.next=function(){var e=this;e.subActions.length>0?(e.subAction=e.subActions.shift(),0==e.subActions.length&&e.owner.isDead?e.onAllSubActionEnd():e.subAction.play()):e.onAllSubActionEnd()},t.prototype.onSpring=function(){var e=this;e.nspy=Fixed.value(e.nspy).neg().mul(.6).value,e.spyRate=0},t.prototype.onDestroy=function(){var t=this,i=t.owner;t.canSpin&&i&&i.updateRotation(0),t.canSpin=!1,ObjectUtils.clearKeysNum(t,["px","py","spx","spy","nspy","adjust","spyRate"]),e.prototype.onDestroy.call(this)},t}(HurtAction);__reflect(FlyAction.prototype,"FlyAction"),window.FlyAction=FlyAction;var AITrig_BeHurtCount=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.initialize=function(t,i,r){e.prototype.initialize.call(this,t,i,r);var n=this;n.isDamageEffect=!0,n.total=r.val[0]||0,n.count=0},t.prototype.onChangeEnemy=function(e){var t=this.owner.scene.getAISelectTarget(this.owner,e.val[0],e.val[1],this.caster);t&&this.ai.onSelectEnemy(t)},t.prototype.doTrig=function(){this.count=0},t.prototype.checkSpecial=function(e,t){var i=this;return i.total?(i.count++,i.count>=i.total?(i.caster=t,!0):!1):!1},t.prototype.onDestroy=function(){ObjectUtils.clearKeysNum(this,["total","count","caster"])},t}(AITrig_Base);__reflect(AITrig_BeHurtCount.prototype,"AITrig_BeHurtCount"),window.AITrig_BeHurtCount=AITrig_BeHurtCount;var AITrig_BeHurtEnd=function(e){function t(){return e.call(this)||this}return __extends(t,e),t}(AITrig_Base);__reflect(AITrig_BeHurtEnd.prototype,"AITrig_BeHurtEnd"),window.AITrig_BeHurtEnd=AITrig_BeHurtEnd;var AITrig_BeingHurt=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.initialize=function(t,i,r){e.prototype.initialize.call(this,t,i,r),this.ttime=Fixed.millisecond(r.val[0]),this.dtime=0,this.isStart=!1},t.prototype.onEnterFrame=function(t){e.prototype.onEnterFrame.call(this,t);var i=this;i.isStart&&(i.dtime=Fixed.value(i.dtime).add(t).value,i.dtime>=i.ttime&&i.trig())},t.prototype.doTrig=function(){this.isStart=!1,this.dtime=0},t.prototype.resetTrig=function(){this.isStart=!1,this.dtime=0},t.prototype.checkSpecial=function(){var e=this;return e.ttime?(e.isStart||(e.isStart=!0),e.dtime>=e.ttime):!1},t.prototype.onDestroy=function(){ObjectUtils.clearKeysNum(this,["ttime","dtime"]),this.isStart=!1},t}(AITrig_Base);__reflect(AITrig_BeingHurt.prototype,"AITrig_BeingHurt"),window.AITrig_BeingHurt=AITrig_BeingHurt;var AITrig_BloodPercent=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.initialize=function(t,i,r){e.prototype.initialize.call(this,t,i,r),this.isDamageEffect=!0,this.percent=r.val[0]||0},t.prototype.checkSpecial=function(){var e=this.owner.props,t=e.gv("hp"),i=e.gv("maxHp");return Fixed.value(t).div(i).value<=this.percent},t.prototype.onDestroy=function(){ObjectUtils.clearKeysNum(this,["percent"])},t}(AITrig_Base);__reflect(AITrig_BloodPercent.prototype,"AITrig_BloodPercent"),window.AITrig_BloodPercent=AITrig_BloodPercent;var AITrig_BloodReduce=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.initialize=function(t,i,r){e.prototype.initialize.call(this,t,i,r);var n=this;n.isDamageEffect=!0,n.percent=r.val[0]||0,n.hp=0},t.prototype.doTrig=function(){this.hp=0},t.prototype.checkSpecial=function(e){var t=this;if(!t.percent)return!1;var i=t.owner.props.gv("maxHp");return t.hp=Fixed.value(e).abs().add(t.hp).value,Fixed.value(t.hp).div(i).value>=t.percent},t.prototype.onDestroy=function(){ObjectUtils.clearKeysNum(this,["percent","hp"])},t}(AITrig_Base);__reflect(AITrig_BloodReduce.prototype,"AITrig_BloodReduce"),window.AITrig_BloodReduce=AITrig_BloodReduce;var AITrig_BloodReduceTimes=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.initialize=function(t,i,r){e.prototype.initialize.call(this,t,i,r);var n=this;n.isDamageEffect=!0,n.percent=r.val[0]||0,n.lastHp=-1},t.prototype.checkSpecial=function(){var e=this,t=e.owner;if(!e.percent)return!1;var i=t.props.gv("maxHp"),r=t.props.gv("hp"),n=-1==e.lastHp?i:e.lastHp;if(!n||r>=n)return!1;var a=Fixed.value(e.percent).mul(i).value,o=Fixed.value(r).div(a).value,s=Fixed.value(n).div(a).ceil().sub(o).floor().value;return e.dropTimes=s,e.lastHp=r,s>0},t.prototype.onDropSpecial=function(e){var t=this,i=e.val,r=t.dropTimes,n=Data.getItem("MonsterDropData",i[0]),a=0,o=n.num;if(r&&o)for(var s=0;r>s;s++)a+=o;t.maxDropNum||(t.maxDropNum=i[1]),t.doDropSpecial(n,a)},t.prototype.onDestroy=function(){ObjectUtils.clearKeysNum(this,["lastHp","percent","dropTimes"])},t}(AITrig_Base);__reflect(AITrig_BloodReduceTimes.prototype,"AITrig_BloodReduceTimes"),window.AITrig_BloodReduceTimes=AITrig_BloodReduceTimes;var AITrig_BuffCollide=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.initialize=function(t,i,r){e.prototype.initialize.call(this,t,i,r);var n=this,a=n.collides=[],o=r.val,s=o[0]?String(o[0]).split(":"):[];n.buffId=+s[0]||0,n.range=+s[1]||0,n.w=+s[2]||0,n.h=+s[3]||0;var l,u=o[1]?String(o[1]).split("&"):null;u.forEach(function(e){l=(e||"").split(":"),a.push({buffId:+l[0]||0,w:+l[1]||0,h:+l[2]||0})}),n.damageBuffId=r.val[2]||0,n.bulletTrigId=r.val[3]||0,n.srect=egret.Rectangle.create(),n.trect=egret.Rectangle.create()},t.prototype.onEnterFrame=function(t){e.prototype.onEnterFrame.call(this,t),this.trig()},t.prototype.checkSpecial=function(){var e=this,t=e.buffId;if(!t)return!1;var i=e.owner,r=i.buff;if(!r.hasBuffById(t))return!1;var n,a=e.w,o=e.h,s=e.srect,l=e.trect,u=e.collides,c=Fixed.value(a).mul(.5).value;s.setTo(Fixed.value(i.x).sub(c).value,Fixed.value(i.y).sub(o).value,a,o);for(var p=0,d=u;p<d.length;p++){var f=d[p];if(f.buffId&&(n=i.scene.getBuffCollideTarget(i,e.range,s,l,f)))return e.target=n,e.collideInfo=f,!0}return!1},t.prototype.doTrig=function(){var e=this,t=e.target,i=e.collideInfo;if(t&&i){var r=e.owner,n=e.buffId,a=r.buff,o=t.buff,s=a.getBuffById(n),l=s.caster,u=s.skillId,c=s.skillLv,p=e.damageBuffId;if(a.removeId(n,1),o.removeId(i.buffId,1),!l.isDead&&(p&&(r instanceof Monster?(o.addBuff(l,u,c,p),a.addBuff(l,u,c,p)):(a.addBuff(l,u,c,p),o.addBuff(l,u,c,p))),e.bulletTrigId)){var d=BulletExtra.create(l,l,e.bulletTrigId,0,0,1,0,!0);if(d){var f=Fixed.min(r.x,t.x),h=Fixed.min(r.y,t.y);d.x=Fixed.value(r.x).sub(t.x).abs().mul(.5).add(f).round().value,d.y=Fixed.value(r.y).sub(t.y).abs().mul(.5).add(h).round().value,d.z=0,r.skill.onTrigBullet(d)}}}},t.prototype.onDestroy=function(){egret.Rectangle.release(this.srect),egret.Rectangle.release(this.trect),ObjectUtils.clearKeys(this,["buffId","range","w","h","collides","damageBuffId","srect","trect"])},t}(AITrig_Base);__reflect(AITrig_BuffCollide.prototype,"AITrig_BuffCollide"),window.AITrig_BuffCollide=AITrig_BuffCollide;var AITrig_BuffElementLink=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.initialize=function(t,i,r){e.prototype.initialize.call(this,t,i,r);var n=this;n.isAllEffect=!0;var a=r.val;n.buffId=a[0]||0,n.buffSign=a[1]||0,n.signOwner=a[2]||0,n.w=a[3]||0,n.h=a[4]||0},t.prototype.checkSpecial=function(e,t){var i=this,r=i.owner;return e&&r.buff.hasBuffById(i.buffId)&&i.checkOwnerType(r,e,i.signOwner)?i.buffSign!=t?!1:i.w&&Fixed.value(r.x).sub(e.x).abs().value>i.w||i.h&&Fixed.value(r.y).sub(e.y).abs().value>i.h?!1:!0:!1},t.prototype.onDestroy=function(){ObjectUtils.clearKeys(this,["buffId","buffSign","signOwner","w","h"])},t}(AITrig_Base);__reflect(AITrig_BuffElementLink.prototype,"AITrig_BuffElementLink"),window.AITrig_BuffElementLink=AITrig_BuffElementLink;var AITrig_Bullet=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.initialize=function(t,i,r){e.prototype.initialize.call(this,t,i,r);var n=this;n.isAllEffect=!0;var a=r.val,o=n.bulletIds=[],s=a[0]?String(a[0]).split(":"):null;n.ownerType=a[1]||0,s&&s.forEach(function(e){o.push(+e)})},t.prototype.checkSpecial=function(e,t){var i=this,r=i.owner;if(!e)return!1;if(!i.checkOwnerType(r,e,i.ownerType))return!1;var n=i.bulletIds;return-1!=n.indexOf(0)||-1!=n.indexOf(t)},t.prototype.onDestroy=function(){ObjectUtils.clearKeys(this,["bulletIds","ownerType"])},t}(AITrig_Base);__reflect(AITrig_Bullet.prototype,"AITrig_Bullet"),window.AITrig_Bullet=AITrig_Bullet;var AITrig_BulletElementLink=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.initialize=function(t,i,r){e.prototype.initialize.call(this,t,i,r);var n=this;n.isAllEffect=!0;var a=r.val;n.buffId=a[0]||0,n.bulletSign=a[1]||0,n.signOwner=a[2]||0,n.w=a[3]||0,n.h=a[4]||0},t.prototype.checkSpecial=function(e,t,i){var r=this,n=r.owner;return e&&t&&n.buff.hasBuffById(r.buffId)&&r.checkOwnerType(n,e,r.signOwner)?r.bulletSign!=i?!1:r.w&&Fixed.value(n.x).sub(t.x).abs().value>r.w||r.h&&Fixed.value(n.y).sub(t.y).abs().value>r.h?!1:!0:!1},t.prototype.onDestroy=function(){ObjectUtils.clearKeys(this,["buffId","bulletSign","signOwner","w","h"])},t}(AITrig_Base);__reflect(AITrig_BulletElementLink.prototype,"AITrig_BulletElementLink"),window.AITrig_BulletElementLink=AITrig_BulletElementLink;var AITrig_CallNextPet=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.checkSpecial=function(){var e=this,t=this.owner;return t instanceof Avatar&&t.scene.isAllPetUp?(e.slotId=t.agent.getCanCallPet(!1),!!e.slotId):!1},t.prototype.doTrig=function(){var e=this.slotId;e&&(this.owner.agent.onCallPet(e,!1),this.slotId=0)},t.prototype.onDestroy=function(){ObjectUtils.clearKeys(this,["slotId"])},t}(AITrig_Base);__reflect(AITrig_CallNextPet.prototype,"AITrig_CallNextPet"),window.AITrig_CallNextPet=AITrig_CallNextPet;var AITrig_CallPet=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.initialize=function(t,i,r){e.prototype.initialize.call(this,t,i,r),this.hideRate=r.val?r.val[0]||0:0},t.prototype.onEnterFrame=function(t){e.prototype.onEnterFrame.call(this,t);var i=this;i.interval&&i.curTime<=0&&(i.trig()||(i.curTime=i.interval))},t.prototype.checkSpecial=function(){var e=this,t=this.owner;if(!(t instanceof Avatar))return!1;var i=!1;if(t.scene instanceof RelayRoom){var r=t.agent.isAutoCallPet,n=t.agent.getCanCallPetNum();i=0==n?!1:1==n?r&&t.scene.hasBoss():r&&t.scene.hasMonster()}else i=1005!=t.scene.playId;return i?(e.slotId=t.agent.getCanCallPet(!1),t.scene.isAllPetUp?t.agent.isFirstPet(e.slotId):!!e.slotId):!1},t.prototype.doTrig=function(){var e=this,t=e.slotId;t&&(e.owner.agent.onCallPet(t,!0),e.slotId=0)},t.prototype.onDestroy=function(){ObjectUtils.clearKeys(this,["slotId"])},t}(AITrig_Base);__reflect(AITrig_CallPet.prototype,"AITrig_CallPet"),window.AITrig_CallPet=AITrig_CallPet;var AITrig_ComboCount=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.initialize=function(t,i,r){e.prototype.initialize.call(this,t,i,r),this.count=r.val[0]||0,this.curCount=0},t.prototype.checkSpecial=function(e){return this.curCount+=e,this.curCount>=this.count},t.prototype.doTrig=function(){this.curCount=this.curCount%this.count},t.prototype.resetTrig=function(){this.curCount=0},t.prototype.onDestroy=function(){ObjectUtils.clearKeys(this,["count","curCount"])},t}(AITrig_Base);__reflect(AITrig_ComboCount.prototype,"AITrig_ComboCount"),window.AITrig_ComboCount=AITrig_ComboCount;var AITrig_DeadActiveMachine=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.initialize=function(t,i,r){e.prototype.initialize.call(this,t,i,r);var n=this;n.isAllEffect=!0,n.heroId=r.val[0]||0,n.radius=r.val[1]||0},t.prototype.checkSpecial=function(e){if(e.heroId==this.heroId){var t=this.radius,i=this.owner;return!t||Fixed.distance(e.x,e.y,i.x,i.y)<=t}return!1},t.prototype.doTrig=function(){this.owner.changeActivated(!0)},t.prototype.onDestroy=function(){ObjectUtils.clearKeys(this,["heroId"])},t}(AITrig_Base);__reflect(AITrig_DeadActiveMachine.prototype,"AITrig_DeadActiveMachine"),window.AITrig_DeadActiveMachine=AITrig_DeadActiveMachine;var AITrig_EnteredScene=function(e){function t(){return e.call(this)||this}return __extends(t,e),t}(AITrig_Base);__reflect(AITrig_EnteredScene.prototype,"AITrig_EnteredScene"),window.AITrig_EnteredScene=AITrig_EnteredScene;var AITrig_EnterScene=function(e){function t(){return e.call(this)||this}return __extends(t,e),t}(AITrig_Base);__reflect(AITrig_EnterScene.prototype,"AITrig_EnterScene"),window.AITrig_EnterScene=AITrig_EnterScene;var AITrig_IntervalTime=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.initialize=function(t,i,r){e.prototype.initialize.call(this,t,i,r);var n=this;n.interval&&r.val?(n.barType=r.val[0],n.barOwnerType=r.val[1],n.fierceTime=Fixed.millisecond(r.val[2])):(n.barType=0,n.barOwnerType=0,n.fierceTime=0),n.barType&&n.showTimeBar()},t.prototype.showTimeBar=function(){var e=this,t=e.barType;if(t){var i=e.owner,r=i.scene.getRoleTimeBarOwner(i,e.barOwnerType);r&&!r.isDead&&r.guise&&r.guise.showTimeBar(t,3==t?e.curTime:e.interval-e.curTime,e.interval)}},t.prototype.onEnterFrame=function(t){var i=this,r=i.curTime;e.prototype.onEnterFrame.call(this,t);var n=i.curTime,a=i.barType;if(a){var o=i.owner,s=o.scene.getRoleTimeBarOwner(o,i.barOwnerType);s&&!s.isDead&&s.guise&&s.guise.updateTimeBar(3==a?i.curTime:i.interval-i.curTime)}var l=i.fierceTime;l>0&&r>l&&l>=n&&App.dispatch("c117",{remainTime:n}),0>=n&&i.trig()},t.prototype.onDestroy=function(){var e=this,t=e.barType,i=e.owner;if(t&&i&&i.scene){var r=i.scene.getRoleTimeBarOwner(i,e.barOwnerType);r&&!r.isDead&&r.guise&&r.guise.hideTimeBar()}ObjectUtils.clearKeysNum(this,["barType","barOwnerType","fierceTime"])},t}(AITrig_Base);__reflect(AITrig_IntervalTime.prototype,"AITrig_IntervalTime"),window.AITrig_IntervalTime=AITrig_IntervalTime;var AITrig_OpenPetKill=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.checkSpecial=function(){var e=this,t=e.owner;if(!t.scene||t.scene.isPetSally||t.scene.isAllPetUp)return!1;if(!(t.agent&&t instanceof Avatar))return!1;var i=t.agent.getFirstPetSlotId();return 0>=i||i>2?!1:!0},t}(AITrig_Base);__reflect(AITrig_OpenPetKill.prototype,"AITrig_OpenPetKill"),window.AITrig_OpenPetKill=AITrig_OpenPetKill;var AITrig_PetEnter=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.initialize=function(t,i,r){e.prototype.initialize.call(this,t,i,r);var n=this;n.isAllEffect=!0;var a=r.val;n.petId=a[0]||0,n.ownerType=a[1]||0},t.prototype.checkSpecial=function(e){var t=this;return e&&e.petId==t.petId&&t.checkOwnerType(t.owner,e,t.ownerType)?!0:!1},t.prototype.onDestroy=function(){ObjectUtils.clearKeys(this,["petId"])},t}(AITrig_Base);__reflect(AITrig_PetEnter.prototype,"AITrig_PetEnter"),window.AITrig_PetEnter=AITrig_PetEnter;var AITrig_PetExeunt=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.initialize=function(t,i,r){e.prototype.initialize.call(this,t,i,r);var n=this;n.isAllEffect=!0;var a=r.val;n.petId=a[0]||0,n.ownerType=a[1]||0},t.prototype.checkSpecial=function(e){var t=this;return e&&e.petId==t.petId&&t.checkOwnerType(t.owner,e,t.ownerType)?!0:!1},t.prototype.onDestroy=function(){ObjectUtils.clearKeys(this,["petId"])},t}(AITrig_Base);__reflect(AITrig_PetExeunt.prototype,"AITrig_PetExeunt"),window.AITrig_PetExeunt=AITrig_PetExeunt;var AITrig_PetFuse=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.initialize=function(t,i,r){e.prototype.initialize.call(this,t,i,r),this.isAllEffect=!0,this.ownerType=r.val?r.val[0]||0:0},t.prototype.checkSpecial=function(e){var t=this;return e&&t.checkOwnerType(t.owner,e,t.ownerType)?(t.trigTarget=e,!0):!1},t.prototype.onAddBuffToTrigger=function(e){var t=e.val[0],i=this.trigTarget;t&&i&&i.buff.addBuff(this.owner,0,1,t)},t.prototype.doTrig=function(){this.trigTarget=null},t.prototype.onDestroy=function(){ObjectUtils.clearKeys(this,["ownerType","trigTarget"])},t}(AITrig_Base);__reflect(AITrig_PetFuse.prototype,"AITrig_PetFuse"),window.AITrig_PetFuse=AITrig_PetFuse;var AITrig_PetHide=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.initialize=function(t,i,r){e.prototype.initialize.call(this,t,i,r),this.isAllEffect=!0,this.ownerType=r.val?r.val[0]||0:0},t.prototype.checkSpecial=function(e){var t=this;return e&&t.checkOwnerType(t.owner,e,t.ownerType)?(t.trigTarget=e,!0):!1},t.prototype.onAddBuffToTrigger=function(e){var t=e.val[0],i=this.trigTarget;t&&i&&i.buff.addBuff(this.owner,0,1,t)},t.prototype.doTrig=function(){this.trigTarget=null},t.prototype.onDestroy=function(){ObjectUtils.clearKeys(this,["ownerType","trigTarget"])},t}(AITrig_Base);__reflect(AITrig_PetHide.prototype,"AITrig_PetHide"),window.AITrig_PetHide=AITrig_PetHide;var AITrig_PetHideFuse=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.initialize=function(t,i,r){e.prototype.initialize.call(this,t,i,r),this.hideRate=r.val?r.val[0]||0:0},t.prototype.onEnterFrame=function(t){e.prototype.onEnterFrame.call(this,t);var i=this;!i.isTimeTrig&&i.curTime<=0&&(i.isTimeTrig=!0,i.trig())},t.prototype.checkSpecial=function(){var e=this,t=this.owner;if(e.isTimeTrig&&t instanceof Pet&&t.scene.isControl&&!t.scene.isAllPetUp){var i=t.agent.curPetInfo;return i&&i.calling&&1==i.pet.battleType&&!i.pet.isDead}return!1},t.prototype.doTrig=function(){var e=this,t=e.owner.scene,i=e.owner.agent;t.seedr.random>=e.hideRate?i.onPetFuse(0,i.curPetInfo.slotId,!0):i.onPetHide(0,i.curPetInfo.slotId,!0)},t.prototype.onDestroy=function(){ObjectUtils.clearKeys(this,["hideRate","isTimeTrig"])},t}(AITrig_Base);__reflect(AITrig_PetHideFuse.prototype,"AITrig_PetHideFuse"),window.AITrig_PetHideFuse=AITrig_PetHideFuse;var AITrig_PropChange=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.initialize=function(t,i,r){e.prototype.initialize.call(this,t,i,r);var n=this;n.attName1=(r.val[0]||"")+"",n.attName2=(r.val[1]||"")+"",n.trig(n.attName1)},t.prototype.checkSpecial=function(e){return this.attName1==e||this.attName2==e},t.prototype.onDestroy=function(){this.attName1=null,this.attName2=null},t}(AITrig_Base);__reflect(AITrig_PropChange.prototype,"AITrig_PropChange"),window.AITrig_PropChange=AITrig_PropChange;var AITrig_RemoveBuff=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.initialize=function(t,i,r){e.prototype.initialize.call(this,t,i,r);var n=this;n.isAllEffect=!0;var a=r.val,o=n.buffIds=[],s=a[0]?String(a[0]).split(":"):null;n.ownerType=a[1]||0,s&&s.forEach(function(e){o.push(+e)}),n.deleteType=a[2]||0},t.prototype.checkSpecial=function(e,t,i){var r=this;return r.deleteType&&r.deleteType!=i?!1:e&&r.checkOwnerType(r.owner,e,r.ownerType)&&-1!=r.buffIds.indexOf(t)?(r.removeTarget=e,!0):!1},t.prototype.onAddBulletToTrigger=function(e){var t=e.val[0],i=this.removeTarget;if(t&&i){var r=BulletExtra.create(this.owner,i,t,0,0,1);r&&this.owner.skill.onTrigBullet(r)}},t.prototype.doTrig=function(){this.removeTarget=null},t.prototype.onDestroy=function(){ObjectUtils.clearKeys(this,["buffIds","ownerType","removeTarget"])},t}(AITrig_Base);__reflect(AITrig_RemoveBuff.prototype,"AITrig_RemoveBuff"),window.AITrig_RemoveBuff=AITrig_RemoveBuff;var AITrig_Skill=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.initialize=function(t,i,r){e.prototype.initialize.call(this,t,i,r);var n=this;n.isAllEffect=!0;var a=r.val,o=n.skillIds=[],s=a[0]?String(a[0]).split(":"):null;n.ownerType=a[1]||0,n.isAllSkill=!!a[2],s&&s.forEach(function(e){o.push(+e)})},t.prototype.checkSpecial=function(e,t){var i=this;return e&&i.checkOwnerType(i.owner,e,i.ownerType)?i.isAllSkill?!0:-1!=i.skillIds.indexOf(t):!1},t.prototype.onDestroy=function(){ObjectUtils.clearKeys(this,["skillIds","ownerType"])},t}(AITrig_Base);__reflect(AITrig_Skill.prototype,"AITrig_Skill"),window.AITrig_Skill=AITrig_Skill;var AITrig_TargetCollide=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.initialize=function(t,i,r){e.prototype.initialize.call(this,t,i,r),this.heroId=r.val[0]||0,this.rangey=r.val[1]||0},t.prototype.onEnterFrame=function(t){e.prototype.onEnterFrame.call(this,t),this.trig()},t.prototype.checkSpecial=function(){var e=this,t=e.owner,i=e.heroId;return i?t.scene.checkCollideTarget(t,e.heroId,e.rangey):!1},t.prototype.onDestroy=function(){ObjectUtils.clearKeys(this,["heroId","rangey"])},t}(AITrig_Base);__reflect(AITrig_TargetCollide.prototype,"AITrig_TargetCollide"),window.AITrig_TargetCollide=AITrig_TargetCollide;var AITrig_TargetUndeadChange=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.initialize=function(t,i,r){e.prototype.initialize.call(this,t,i,r);var n=this;n.isAllEffect=!0,n.heroId=r.val[0]||0},t.prototype.checkSpecial=function(e){return e.heroId==this.heroId},t.prototype.onDestroy=function(){ObjectUtils.clearKeys(this,["heroId"])},t}(AITrig_Base);__reflect(AITrig_TargetUndeadChange.prototype,"AITrig_TargetUndeadChange"),window.AITrig_TargetUndeadChange=AITrig_TargetUndeadChange;var AITrig_UnderLandCount=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.initialize=function(t,i,r){e.prototype.initialize.call(this,t,i,r),this.total=r.val[0]||0,this.count=0},t.prototype.doTrig=function(){this.count=0},t.prototype.checkSpecial=function(){return this.total?(this.count++,this.count>=this.total):!1},t.prototype.onDestroy=function(){ObjectUtils.clearKeysNum(this,["total","count"])},t}(AITrig_Base);__reflect(AITrig_UnderLandCount.prototype,"AITrig_UnderLandCount"),window.AITrig_UnderLandCount=AITrig_UnderLandCount;var AvatarBattleData=function(e){function t(){return e.call(this)||this}return __extends(t,e),t}(RoleBattleData);__reflect(AvatarBattleData.prototype,"AvatarBattleData"),window.AvatarBattleData=AvatarBattleData;var AvatarExtra=function(){function e(){}return e.create=function(t,i,r,n,a){var o=ObjectPool.pop(e);return o.init(t,i,r,n,a),o},e.prototype.init=function(e,t,i,r,n){var a=this;a.isvalid=!0,a.roomsn=e,a.side=t,a.prid=i,a.heroId=r,a.petId=n,a.aiId=0},e.prototype.dispose=function(){this.isvalid&&(ObjectUtils.clearKeys(this,["isvalid","side","prid","heroId","petId","aiId"]),ObjectPool.push(this))},e}();__reflect(AvatarExtra.prototype,"AvatarExtra"),window.AvatarExtra=AvatarExtra;var BattleFetterInfo=function(){function e(){}return e.create=function(t,i){var r=ObjectPool.pop(e);return r.init(t,i),r},e.prototype.init=function(e,t){var i=this;i.isvalid=!0,i.icon=t,i.name=e},e.prototype.dispose=function(){this.isvalid&&(ObjectUtils.clearKeys(this,["isvalid","icon","name"]),ObjectPool.push(this))
},e}();__reflect(BattleFetterInfo.prototype,"BattleFetterInfo"),window.BattleFetterInfo=BattleFetterInfo;var BattleHelpSkillInfo=function(){function e(){}return e.prototype.parse=function(e){var t=this,i=Data.getItem("HelpSkillData",e);t.isvalid=!0,t.skillId=e,t.cfg=i,t.times=i.times||0},e.prototype.dispose=function(){var e=this;e.isvalid&&(e.isvalid=!1,ObjectUtils.clearKeys(e,["skillId","times","cfg"]),ObjectPool.push(e))},e}();__reflect(BattleHelpSkillInfo.prototype,"BattleHelpSkillInfo"),window.BattleHelpSkillInfo=BattleHelpSkillInfo;var BattlePetInfo=function(){function e(){}return Object.defineProperty(e.prototype,"calling",{get:function(){return this.called&&this.pet&&!this.isEnd},enumerable:!0,configurable:!0}),e.prototype.parse=function(e){var t=this;t.isvalid=!0,t.slotId=e.slotId,t.petId=e.petId,t.heroId=e.heroId,t.props=e.props,t.skills=e.skills,t.buffs=e.buffs,t.callCd=0,t.maxCd=Fixed.value(Data.getSysValue("BATTLE_CALL_PET_CD")).mul(60).value,t.petCfg=Data.getItem("PetData",e.petId),t.heroCfg=Data.getItem("HeroData",e.heroId)},e.prototype.onCallEnd=function(e,t){if(this.isEnd=!0,e){var i=Fixed.value(t).mul(60).value;this.callCd=Fixed.value(this.maxCd).sub(i).max(0).value}},e.prototype.resetCallStatus=function(){var e=this;e.called=!1,e.isEnd=!1,e.callCd=0,e.pet=null},e.prototype.dispose=function(){this.isvalid&&(ObjectUtils.clearKeys(this,["isvalid","slotId","petId","heroId","props","skills","buffs","petCfg","heroCfg","called","isEnd","pet"]),ObjectPool.push(this))},e}();__reflect(BattlePetInfo.prototype,"BattlePetInfo"),window.BattlePetInfo=BattlePetInfo;var BattleSkillInfo=function(){function e(){}return Object.defineProperty(e.prototype,"isLast",{get:function(){return this.hasSub?this.subIndex==this.maxSubNum-1:!1},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"cd",{get:function(){var e=Data.getSValue("SkillData",this.cfg.id,"cd")||[],t=Data.getSValue("SkillData",this.cfg.id,"cdb")||0,i=Data.getLvBaseValue(e,this.skillLv,t,0);return Fixed.millisecond(i)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"mp",{get:function(){return Data.getLvBaseValue(this.cfg.mp,this.skillLv,this.cfg.mpb,0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"subTime",{get:function(){return this.hasSub?Fixed.millisecond(this.subCfg.time):0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isNormal",{get:function(){return 0==this.type},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isEnter",{get:function(){return 5==this.type},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isDodge",{get:function(){return 3==this.type},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isSpecial",{get:function(){return 4==this.type},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isXuli",{get:function(){return 2==this.cfg.cast},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isRelayXuli",{get:function(){return 2==this.curSkillCfg.cast},enumerable:!0,configurable:!0}),e.prototype.setData=function(e,t,i,r){var n=this,a=Data.getSItem("SkillData",t);Functor.assert(!!a,"技能模版数据不存在"+t),n.isvalid=!0,n.owner=e,n.skillId=t,n.skillLv=i,n.heroId=r,n.cfg=a,n.type=a.type||0,n.hasSub=a.hasSub,n.subIndex=0,n.maxSubNum=0,n.hasSub&&(n.subSkillCfgs={},n.maxSubNum=a.sub.length,a.sub.forEach(function(e){n.subSkillCfgs[e.skillId]=Data.getSItem("SkillData",e.skillId)})),n.updateCurSkill()},e.prototype.updateCurSkill=function(){var e=this;if(e.hasSub){var t=e.subCfg=e.cfg.sub[e.subIndex];e.curSkillId=t.skillId,e.curSkillCfg=e.subSkillCfgs[t.skillId]}else e.subCfg=null,e.curSkillId=e.skillId,e.curSkillCfg=e.cfg},e.prototype.next=function(e){var t=this;return t.hasSub&&e==t.curSkillId?(t.subIndex++,t.subIndex>=t.maxSubNum&&(t.subIndex=0),void t.updateCurSkill()):!1},e.prototype.clearSub=function(){this.subIndex=0,this.updateCurSkill()},e.prototype.dispose=function(){var e=this;e.isvalid&&(e.isvalid=!1,e.owner=null,e.skillId=0,e.skillLv=0,e.heroId=0,e.cfg=null,e.type=0,e.hasSub=!1,e.subSkillCfgs=null,e.subIndex=0,e.maxSubNum=0,e.subCfg=null,e.curSkillId=0,e.curSkillCfg=null,e.xuliing=!1,ObjectPool.push(e))},e}();__reflect(BattleSkillInfo.prototype,"BattleSkillInfo"),window.BattleSkillInfo=BattleSkillInfo;var BattleSound=function(){function e(){}return e.prototype.parse=function(e,t,i,r,n,a,o,s){var l=this;l.isvalid=!0,l.channel=e,l.castereid=t,l.totalFrame=i,l.soundId=r,l.actionName=n,l.frame=a,l.name=o,l.url=Urls.sound(o),l.playType=s},e.prototype.dispose=function(){var e=this;e.isvalid&&(e.isvalid=!1,ObjectUtils.clearKeys(e,["channel","castereid","totalFrame","soundId","actionName","frame","name","url","playType"]),ObjectPool.push(e))},e}();__reflect(BattleSound.prototype,"BattleSound"),window.BattleSound=BattleSound;var BattleSpawnInfo=function(){function e(){this.spawnId=0,this.count=0,this.num=0,this.refreshTime=0,this.time=0,this.addnum=0,this.timesnum=0}return e.create=function(t,i){var r=ObjectPool.pop(e);return r.init(t,i),r},e.prototype.init=function(e,t){var i=this;i.isvalid=!0,i.spawnId=e,i.spawnCfg=t,i.refreshTime=Fixed.value(t.refreshTime||0).mul(60).value,i.timesnum=1==t.refreshType?1:t.maxRefreshNum},e.prototype.dispose=function(){var e=this;e.isvalid&&(ObjectUtils.clearKeysNum(e,["spawnId","count","num","time","addnum","refreshTime","timesnum"]),ObjectUtils.clearKeys(e,["isok","enable","pause","spawnCfg"]),ObjectPool.push(e))},e}();__reflect(BattleSpawnInfo.prototype,"BattleSpawnInfo"),window.BattleSpawnInfo=BattleSpawnInfo;var BattleWarnInfo=function(){function e(){}return e.prototype.setData=function(e,t,i,r,n){var a=this,o=Data.getItem("WarnData",e);Functor.assert(!!o,"预警配置不存在："+e),a.isvalid=!0,a.id=IDUtils.genID("battleWarnInfo"),a.warnId=e,a.skillId=t,a.cfg=o,a.right=i,a.x=r,a.y=n,a.delay=o.delay||0,a.time=Fixed.millisecond(o.time)},e.prototype.dispose=function(){var e=this;e.isvalid&&(e.isvalid=!1,e.id=0,e.warnId=0,e.skillId=0,e.cfg=null,e.right=!1,e.x=0,e.y=0,e.delay=0,e.time=0,e.guise&&(e.callback&&e.guise.removeEventListener("action_play_end",e.callback,e.thisArg),e.guise.dispose(),e.guise=null),e.callback=null,e.thisArg=null,ObjectPool.push(e))},e}();__reflect(BattleWarnInfo.prototype,"BattleWarnInfo"),window.BattleWarnInfo=BattleWarnInfo;var BattNpcExtra=function(){function e(){}return e.create=function(t,i,r){var n=ObjectPool.pop(e);return n.init(t,i,r),n},e.prototype.init=function(e,t,i){var r=this;r.isvalid=!0,r.battNpcId=e,r.roomsn=t,r.side=i},e.prototype.dispose=function(){var e=this;e.isvalid&&(e.isvalid=!1,ObjectUtils.clearKeysNum(e,["battNpcId","roomsn","side"]),ObjectPool.push(e))},e}();__reflect(BattNpcExtra.prototype,"BattNpcExtra"),window.BattNpcExtra=BattNpcExtra;var BulletExtra=function(){function e(){}return e.create=function(t,i,r,n,a,o,s,l){if(void 0===s&&(s=0),void 0===l&&(l=!1),!t||!t.scene)return null;var u=Data.getItem("BulletTrigData",r);if(Functor.assert(!!u,"Bullet 子弹触发配置不存在ID："+r),!u)return null;if(u.allPetBreak&&(t.scene.isAllPetUp||t.scene.isPetSally||t instanceof BattNpc))return null;var c=ObjectPool.pop(e);return c.init(t,i,u,n,a,o,s,l),c},e.prototype.init=function(e,t,i,r,n,a,o,s){void 0===o&&(o=0),void 0===s&&(s=!1);var l=this;l.isvalid=!0,l.caster=e,l.depend=t,l.trigId=i.id,l.trigCfg=i,l.delayFrame=r,l.skillId=n,l.skillLv=a,l.helpRid=o,l.skipPos=s,l.breakDelay=Data.getSValue("BulletTrigData",l.trigId,"breakd"),ObjectUtils.clearKeysNum(l,["x","y","z","damageRate","angle"]),!s&&!i.isDelayInit&&l.initBornPos()},e.prototype.initBornPos=function(){var t,i,r,n,a=this,o=0,s=a.caster,l=a.depend||s,u=s.scene,c=a.trigCfg,p=c.ptype,d=l.multiply;if(1==p){var f=c.pv||[],h=f[0]||0,v=f[1]||0,m=f[3]||0,y=f[4]||0,g=void 0,b=void 0,x=void 0,I=void 0;f[6]?(0>m*d?(b=Fixed.value(h).mul(d).add(l.x).min(u.roadRight).value,g=Fixed.value(m).mul(d).add(b).max(u.roadLeft).value):(g=Fixed.value(h).mul(d).add(l.x).max(u.roadLeft).value,b=Fixed.value(m).mul(d).add(g).min(u.roadRight).value),0>y?(I=Fixed.value(l.y).add(v).min(u.roadBottom).value,x=Fixed.value(I).add(y).max(u.roadTop).value):(x=Fixed.value(l.y).add(v).max(u.roadTop).value,I=Fixed.value(x).add(y).min(u.roadBottom).value)):(Fixed.value(m).mul(d).value<0?(b=Fixed.value(h).mul(d).add(l.x).value,g=Fixed.value(m).mul(d).add(b).value):(g=Fixed.value(h).mul(d).add(l.x).value,b=Fixed.value(m).mul(d).add(g).value),0>y?(x=Fixed.value(l.y).add(v).value,I=Fixed.value(x).add(y).value):(I=Fixed.value(l.y).add(v).value,x=Fixed.value(I).add(y).value));var _=u.seedr.random,S=u.seedr.random,T=u.seedr.random;t=Fixed.value(b).sub(g).mul(_).add(g).round().value,i=Fixed.value(I).sub(x).mul(S).add(x).round().value,r=Fixed.value(T).mul(f[5]||0).round().add(f[2]||0).value,n=l.right}else if(2==p){var f=c.pv||[],w=f[2]||0,A=u.getBulletDropTarget(s,a.skillId,a.skillLv,f[3]||0)||l;t=Fixed.value(f[0]||0).mul(f[5]?1:d).add(A.x).value,i=Fixed.value(A.y).add(f[1]||0).value,r=f[4]?Fixed.value(A.z).add(w).value:w,n=l.right}else if(3==p){var f=c.pv||[],h=f[0]||0,v=f[1]||0,P=s.getAttackPos(a.attackAction,1);P?(t=Fixed.value(P.dx).mul(d).add(l.x).value,i=Fixed.value(l.y).add(h?0:P.dy).value,r=Fixed.value(v?0:l.z).add(h?P.dy:0).value):(t=l.x,i=l.y,r=v?0:l.z),n=l.right}else if(4==p){var f=c.pv||[],w=f[2]||0,m=f[3]||0,A=u.getCanHitAvatar(s.side)||s,g=void 0,b=void 0,x=void 0,I=void 0;t=u.limitX(Fixed.value(f[0]||0).mul(A.multiply).add(A.x).value),i=u.limitY(Fixed.value(A.y).add(f[1]||0).value),b=Fixed.value(t).add(w).min(u.roadRight).value,g=Fixed.value(t).sub(w).max(u.roadLeft).value,I=Fixed.value(i).add(m).min(u.roadBottom).value,x=Fixed.value(i).sub(m).max(u.roadTop).value;var _=u.seedr.random,S=u.seedr.random;t=Fixed.value(b).sub(g).mul(_).round().add(g).value,i=Fixed.value(I).sub(x).mul(S).round().add(x).value,r=0,n=A.x>=t,o=Fixed.atan2_pos(t,i,A.x,A.y),o=Fixed.value(o).div(Fixed.PI).mul(180).round().value}else if(5==p){var f=c.pv||[],h=f[0]||0;1==s.side?(t=Fixed.value(u.roadLeft).add(h).value,n=!0):(t=Fixed.value(u.roadRight).sub(h).value,n=!1),i=Fixed.value(s.y).add(f[1]||0).value,r=f[2]||0}else if(6==p){var f=c.pv||[],C=f[1],D=u.roadLeft,B=u.roadRight;t=Fixed.value(B).sub(D).mul(f[0]||0).add(D).round().value,i=s.y,r=0,f[2]&&(t=u.limitX(t),i=u.limitX(i)),n=1==C?!1:2==C?!0:3==C?!l.right:l.right}else if(7==p){var f=c.pv||[],C=f[3];t=f[0]||0,i=f[1]||0,r=f[2]||0,n=1==C?!1:2==C?!0:3==C?!l.right:l.right}else if(8==p){var f=c.pv||[],h=f[0]||0,v=f[1]||0,w=f[2]||0,m=f[3]||0,y=f[4],k=f[5]||0,E=u.getBulletDropTargets(s,m),R=E[0]||l;t=Fixed.value(h).mul(k?1:R.multiply).add(R.x).value,i=Fixed.value(R.y).add(v).value,r=y?Fixed.value(R.z).add(w).value:w,n=R.right;for(var F=void 0,A=void 0,M=1,L=E.length;L>M;M++)A=E[M],F=e.create(s,A,a.trigId,c.isDelayInit?0:a.delayFrame,a.skillId,a.skillLv,a.helpRid,!0),F&&(F.damageRate=a.damageRate,F.attackAction=a.attackAction,F.mca=a.mca,F.x=Fixed.value(h).mul(k?1:R.multiply).add(A.x).value,F.y=Fixed.value(A.y).add(v).value,F.z=y?Fixed.value(A.z).add(w).value:w,F.right=A.right,s.skill.onTrigBullet(F))}else if(9==p){var f=c.pv||[],U=f[1]||0,C=f[2];t=f[0]?Fixed.value(u.roadLeft).add(U).value:Fixed.value(u.roadRight).add(U).value,i=l.y,r=0,n=1==C?!1:2==C?!0:3==C?!l.right:l.right}else{var f=c.pv||[],C=f[4];n=1==C?!1:2==C?!0:3==C?!l.right:l.right,t=Fixed.value(f[0]||0).mul(n?1:-1).add(l.x).value,i=Fixed.value(l.y).add(f[1]||0).value,r=Fixed.value(f[3]?0:l.z).add(f[2]||0).value}a.x=t,a.y=i,a.z=r,a.right=n,a.angle=o},e.prototype.dispose=function(){var e=this;e.isvalid&&(e.isvalid=!1,ObjectUtils.clearKeys(e,["depend","caster","attackAction","breakDelay","mca","right","skipPos"]),ObjectUtils.clearKeysNum(e,["delayFrame","trigId","skillId","skillLv","x","y","z","damageRate","helpRid","angle"]),ObjectPool.push(e))},e}();__reflect(BulletExtra.prototype,"BulletExtra"),window.BulletExtra=BulletExtra;var DelayCallbackInfo=function(e){function t(){var t=e.call(this)||this;return t.idx=0,t.delayFrame=0,t}return __extends(t,e),t.create=function(e,i,r,n,a){for(var o=[],s=5;s<arguments.length;s++)o[s-5]=arguments[s];var l=ObjectPool.pop(t);return l.isvalid=!0,l.idx=IDUtils.genID("battleCallback"),l.callback=e,l.thisObject=i,l.delayFrame=n?Fixed.millisecond(r):r,l.isTime=n,l.stopClear=a,l.args=o,l},t}(CallbackInfo);__reflect(DelayCallbackInfo.prototype,"DelayCallbackInfo"),window.DelayCallbackInfo=DelayCallbackInfo;var FruitExtra=function(){function e(){}return e.create=function(t,i,r,n,a){var o=ObjectPool.pop(e);return o.init(t,i,r,n,a),o},e.prototype.init=function(e,t,i,r,n){var a=this;a.isvalid=!0,a.roomsn=e,a.side=t,a.prid=i,a.fruitId=r,a.heroId=n},e.prototype.dispose=function(){this.isvalid&&(ObjectUtils.clearKeys(this,["isvalid","side","prid","fruitId","heroId"]),ObjectPool.push(this))},e}();__reflect(FruitExtra.prototype,"FruitExtra"),window.FruitExtra=FruitExtra;var PartyAgentExtra=function(){function e(){}return e.create=function(t){var i=ObjectPool.pop(e);return i.init(t),i},e.prototype.init=function(e){var t=this;t.isvalid=!0,t.invisibily=!1,t.right=!!e.dir,ObjectUtils.assignKeys(e,t,["rid","job","head","level","name","svrId","ability","seeOther","x","y","titleId","fashionId","weaponId","weaFasId","wingFasId","haloId","fruitId"])},e.prototype.dispose=function(){this.isvalid&&(ObjectUtils.clearKeys(this,["isvalid","rid","job","head","level","name","svrId","ability","seeOther","x","y","right","titleId","fashionId","weaponId","weaFasId","wingFasId","haloId","fruitId","invisibily"]),ObjectPool.push(this))},e}();__reflect(PartyAgentExtra.prototype,"PartyAgentExtra"),window.PartyAgentExtra=PartyAgentExtra;var PartyCityExtra=function(){function e(){}return e.create=function(t){var i=ObjectPool.pop(e);return i.init(t),i},e.prototype.init=function(e){var t=this;t.isvalid=!0,t.svrType=0,t.sn=0,t.cityId=e,t.roomsn=0,t.tag="",t.roomId=302,t.seed=DateUtils.secondNow,t.isLockStep=!1;var i=Data.getItem("CityData",e);t.mapId=i.roundMap||0},e.prototype.dispose=function(){this.isvalid&&(ObjectUtils.clearKeys(this,["isvalid","svrType","sn","cityId","roomsn","tag","roomId","mapId","seed","isLockStep"]),ObjectPool.push(this))},e}();__reflect(PartyCityExtra.prototype,"PartyCityExtra"),window.PartyCityExtra=PartyCityExtra;var PetBattleData=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.onDestroy=function(){ObjectUtils.clearKeys(this,["petId"])},t}(RoleBattleData);__reflect(PetBattleData.prototype,"PetBattleData"),window.PetBattleData=PetBattleData;var PetExtra=function(){function e(){}return e.create=function(t,i,r,n,a){var o=ObjectPool.pop(e);return o.init(t,i,r,n,a),o},e.prototype.init=function(e,t,i,r,n){var a=this;a.isvalid=!0,a.roomsn=e,a.side=t,a.prid=i,a.petId=r,a.heroId=n},e.prototype.dispose=function(){this.isvalid&&(ObjectUtils.clearKeys(this,["isvalid","side","prid","petId","heroId"]),ObjectPool.push(this))},e}();__reflect(PetExtra.prototype,"PetExtra"),window.PetExtra=PetExtra;var PickupTrapInfo=function(){function e(){}return e.create=function(t,i){var r=ObjectPool.pop(e);return r.init(t,i),r},e.prototype.init=function(e,t){var i=this;i.isvalid=!0,i.idx=IDUtils.genID("pickupTrap"),i.trapCfg=e,i.castereid=t,i.looked=!1},e.prototype.look=function(){this.looked=!0},e.prototype.dispose=function(){this.isvalid&&(ObjectUtils.clearKeys(this,["isvalid","idx","trapCfg","castereid","looked"]),ObjectPool.push(this))},e}();__reflect(PickupTrapInfo.prototype,"PickupTrapInfo"),window.PickupTrapInfo=PickupTrapInfo;var FlyDownAction=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.setActionInfo=function(e){var t,i=this,r=i.owner,n=i.subActions,a=r.props.gv("weight")||1;i.py=e,i.nspy=i.spy=Fixed.value(i.py).div(a).mul(130).value,t=ObjectPool.pop(DownAction),t.initialize(i,"behit_down",2,0,114),n.push(t);var o=i.state.lctime||Fixed.millisecond(Data.getSValue("HeroData",r.heroId,"lct"));t=ObjectPool.pop(UnderLandAction),t.initialize(i,"behit_land",o?2:0,o,115),n.push(t),t=ObjectPool.pop(UpLandAction),t.initialize(i,"behit_up",0,0,115),n.push(t)},t.prototype.next=function(){var e=this;e.subActions.length>0?(e.subAction=e.subActions.shift(),0==e.subActions.length&&e.owner.isDead?e.onAllSubActionEnd():e.subAction.play()):e.onAllSubActionEnd()},t.prototype.onDestroy=function(){var e=this;e.py=0,e.spy=0,e.nspy=0},t}(BaseAction);__reflect(FlyDownAction.prototype,"FlyDownAction"),window.FlyDownAction=FlyDownAction;var RoomAgentInfo=function(e){function t(){return e.call(this)||this}return __extends(t,e),Object.defineProperty(t.prototype,"agent",{get:function(){return this.scene?this.scene.getAgent(this.rid):null},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"avatar",{get:function(){var e=this.agent;return e?e.avatar:null},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isWin",{get:function(){return this.side==this.winSide},enumerable:!0,configurable:!0}),t.prototype.parse=function(t){var i=this;i.ability=0,i.petAbility=0,e.prototype.parse.call(this,t),i.killNum=i.streakNum=i.deadNum=i.praiseNum=i.reliveNum=0,i.score=5,i.isDead=!1,i.isRobot=!1,i.randomBuffs=[],i.avatarData||(i.avatarData=ObjectPool.pop(AvatarBattleData),i.avatarData.init()),i.petDatas={}},t.prototype.createPetData=function(e){var t=this.petDatas[e];t||(t=ObjectPool.pop(PetBattleData),t.init(),t.petId=e,this.petDatas[e]=t)},t.prototype.onBuffEffect=function(e,t,i,r,n){var a=this;if(e.prid==a.rid&&(r||n)){var o=e instanceof Pet?a.petDatas[e.petId]:a.avatarData;o&&(1&i?(o.heal+=r,a.updateHpRate(e)):o.damage+=n-r)}if(t.prid==a.rid&&(0>r||n)){var o=void 0;t instanceof Pet?o=a.petDatas[t.petId]:(o=a.avatarData,a.hold&&a.scene instanceof RelayRoom&&a.scene.roomCfg.score&&a.scene.changeScoreVal(13,Math.abs(r),!1)),o&&(o.beHurt+=n+Math.abs(r),a.updateHpRate(t))}},t.prototype.updateHpRate=function(e){if(e.prid==this.rid){var t=e instanceof Pet?this.petDatas[e.petId]:this.avatarData;if(t){var i=e.props.gv("maxHp");t.hp=e.props.gv("hp"),t.hpRate=e.isDead?0:Fixed.value(t.hp).div(i).toFixed(2).value}}},t.prototype.updateMpRate=function(e){if(e.prid==this.rid){var t=e instanceof Pet?this.petDatas[e.petId]:this.avatarData;if(t){var i=e.props.gv("mp"),r=e.props.gv("maxMp");t.mpRate=e.isDead?0:Fixed.value(i).div(r).toFixed(2).value}}},t.prototype.getTotal=function(e){var t=this.avatarData,i=0;i+=t?t[e]||0:0;for(var r in this.petDatas){var n=this.petDatas[r];i+=n[e]||0}return i},t.prototype.onDispose=function(){var e=this;e.avatarData&&e.avatarData.dispose();for(var t in e.petDatas)e.petDatas[t].dispose();ObjectUtils.clearKeys(e,["scene","side","petId","avatarSkills","totalDamage","totalHeal","totalBeHurt","isMvp","score","avatarData","petDatas","order","winSide","randomBuffs","lastDamage","praised","isRobot"])},t}(BasePlayerInfo);__reflect(RoomAgentInfo.prototype,"RoomAgentInfo",["IRoomAgentInfo"]),window.RoomAgentInfo=RoomAgentInfo;var SpawnMonsterInfo=function(){function e(){}return e.prototype.init=function(){this.isvalid=!0},e.prototype.dispose=function(){this.isvalid&&(ObjectUtils.clearKeys(this,["isvalid","roomsn","spawnId","monsterId","posType","offx","offy","radius","randomh","x","y","dir","lvId","type","eskillId","ai","refreshType","refreshParam","name","variants","propsRate","maxHpRate","level","job","effect","ownereid","side","extraProps","extraProps","extraBuffs","idx","haloId","fashionId","titleId","weaponId","weaponRTimes","weaFasId","wingFasId"]),ObjectPool.push(this))},e}();__reflect(SpawnMonsterInfo.prototype,"SpawnMonsterInfo"),window.SpawnMonsterInfo=SpawnMonsterInfo;var TrapExtra=function(){function e(){}return e.createByTrigger=function(t,i,r){var n=ObjectPool.pop(e);return n.init(i,t.x,t.y,t.scene.roomsn,t.prid,t.side,r),n},e.createByPos=function(t,i,r,n,a,o,s){void 0===s&&(s=null);var l=ObjectPool.pop(e);return l.init(t,i,r,n,a,o,s),l},e.createById=function(t,i,r){var n=ObjectPool.pop(e);return n.init(t,0,0,i,0,r),n},e.prototype.init=function(e,t,i,r,n,a,o){void 0===o&&(o=null);var s=this;s.isvalid=!0,s.trapId=e,s.roomsn=r,s.prid=n,s.side=a,s.caster=o,s.x=t,s.y=i},e.prototype.dispose=function(){var e=this;e.isvalid&&(e.isvalid=!1,ObjectUtils.clearKeys(e,["caster","right"]),ObjectUtils.clearKeysNum(e,["trapId","x","y","roomsn","prid","side"]),ObjectPool.push(e))},e}();__reflect(TrapExtra.prototype,"TrapExtra"),window.TrapExtra=TrapExtra;var AgentStates=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.add=function(e,t){void 0===t&&(t=null);var i=this,r=i.curState;if(r){if(r.state==e)return;i.remove(r.state)}117==e?(i.curState=ObjectPool.pop(CityPoseState),i.curState.initialize(i,e,Data.getItem("StateData",e),t)):(i.curState=ObjectPool.pop(AgentState),i.curState.initialize(i,e,Data.getItem("StateData",e))),i.curState.add()},t.prototype.remove=function(e){var t=this.curState;t&&t.state==e&&(t.remove(),t.count<=0&&t.destroy())},t.prototype.onDestroy=function(){var e=this;e.curState&&(e.curState.destroy(),e.curState=null),ObjectPool.push(e)},t}(GameCom);__reflect(AgentStates.prototype,"AgentStates"),window.AgentStates=AgentStates;var AvatarSkill=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.initEquipSkills=function(e){var t,i,r,n,a,o=this,s=o.owner.heroId;for(var l in e)t=e[l],i=Data.getItem("SkillForceData",t.id),i.sId&&i.nId&&(n=i.nId,r=o.getSkillInfo(i.sId),r&&(o.addSkill(n,r.skillLv,s),a=r.type,0==a?o.nskillId=n:3==a?o.dodgeSkillId=n:2==a&&(o.escapeSkillId=n)))},t.prototype.onTransBegin=function(){var e=this,t=e.owner.transHeroCfg,i=t.id,r=t.normal||0;e.nskillId=r,r&&e.addSkill(r,1,i);var n=t.dodge||0;e.dodgeSkillId=n,n&&e.addSkill(n,1,i);var a=t.escape||0;e.escapeSkillId=a,a&&e.addSkill(a,1,i);var o=t.prot||0;e.protSkillId=o,o&&e.addSkill(o,0,i),t.defaults&&t.defaults.forEach(function(t){e.addSkill(t,1,i)})},t.prototype.onTransStop=function(){var e=this,t=e.owner.heroCfg;e.nskillId=t.normal||0,e.dodgeSkillId=t.dodge||0,e.escapeSkillId=t.escape||0,e.protSkillId=t.prot||0},t.prototype.canUse=function(t,i,r){void 0===i&&(i=!1),void 0===r&&(r=!1);var n=this.owner;return n.transNpc&&!n.transNpc.checkSpecialSkill(t,r)?!1:e.prototype.canUse.call(this,t,i,r)},t.prototype.canCombo=function(t){var i=this.owner;return i.transNpc&&!i.transNpc.checkSpecialSkill(t,!1)?!1:e.prototype.canCombo.call(this,t)},t.prototype.onSkillBegin=function(e,t){var i=this,r=i.owner,n=ActionMgr.changeDirToX(r.touchDir);if(r.isTouch&&n&&r.changeDirection(n>0),r.agent.autoBattle&&e.isNormal&&e.hasSub&&!e.isLast&&(i.nextSkillId=e.skillId),e.isNormal){var a=r.agent.pet;a&&a.onMasterBeginSkill(e.subIndex)}r.transNpc&&r.transNpc.onSpecialSkillBegin(e.skillId)},t.prototype.onSkillEnd=function(t,i,r,n){if(e.prototype.onSkillEnd.call(this,t,i,r,n),t.isNormal&&r){var a=this.owner.agent.pet;a&&a.onMasterInterruptSkill()}},t.prototype.onTouchSkillBegin=function(e,t){var i=this,r=i.owner;if(r.scene.isPetSally||r.transHeroId||r.agent.canUseSkill(e,t)){var n=i.skills[e],a=n.curSkillId,o=r.agent,s=Skill.skipCheck&&3==n.type;i.canUse(a,s,t)?o.reqUseAvatarSkill(e):i.nextSkillId!=e&&i.canCombo(a)&&o.reqComboAvatarSkill(e)}},t.prototype.onTouchSkillEnd=function(e,t){this.owner.agent.reqBreakAvatarXuli(e)},t.prototype.startXuli=function(t){e.prototype.startXuli.call(this,t),this.owner.hold&&this.owner.guise&&this.owner.guise.showXuliBar(t.skillId)},t.prototype.stopXuli=function(t,i){e.prototype.stopXuli.call(this,t,i),this.owner.hold&&this.owner.guise&&this.owner.guise.hideXuliBar()},t}(Skill);__reflect(AvatarSkill.prototype,"AvatarSkill"),window.AvatarSkill=AvatarSkill;var Buff=function(e){function t(){var t=e.call(this)||this;return t.damages={},t.behurts={},t.maxDamages={},t}return __extends(t,e),t.prototype.onCreate=function(){var e=this;e.buffIdx=0,e.slotIdx=0,e.buffs={},e.buffMap={},e.shields={},e.halos={},e.trigs={},e.rmvs={},e.svrBuffs={},e.passiveBuffs={},e.tempRunList=[],e.tempRemoveList=[],e.elementBuffs=[]},Object.defineProperty(t.prototype,"element",{get:function(){var e=this.elementBuffs[0];return e&&e.buffCfg?e.buffCfg.element:0},enumerable:!0,configurable:!0}),t.prototype.initBuffs=function(e){var t,i,r=this,n=r.svrBuffs={},a=r.passiveBuffs={};e.forEach(function(e){e.lv>0&&(n[e.buffId]=e.lv,i=Data.getSValue("BuffData",e.buffId,"ptype")||0,t=a[i],t||(t=a[i]=[]),t.push(e.buffId))})},t.prototype.trigPassiveBuff=function(e){var t,i,r=this,n=r.owner,a=r.svrBuffs,o=r.passiveBuffs[e];if(o&&o.forEach(function(r){t=Data.getSValue("BuffData",r,"ptype")||0,t==e&&(i=n.scene.getPassiveBuffTarget(n,Data.getSValue("BuffData",r,"ptarget")||0),i.length&&i.forEach(function(e){e.buff.addBuff(n,0,a[r],r)}))}),1==e){var s=r.xianMoXBuff;s&&s.caster&&!s.caster.isDead&&r.addBuff(s.caster,s.skillId,s.skillLv,s.buffId)}},t.prototype.canAdd=function(e){var t=this,i=t.owner;if(!i.isCanBeHit)return 1;var r=(Data.getSValue("BuffData",e.buffId,"type")||1,Data.getSValue("BuffData",e.buffId,"state"));if(r)for(var n=0,a=r;n<a.length;n++){var o=a[n];if(i.state.limit(o))return 3}if(i instanceof Avatar&&e.caster instanceof Boss&&i.scene.seedr.random<=.2)return 2;if(e.buffCfg.debuff){var s=Data.getLvBaseValue(e.buffCfg.derate,e.buffLv,e.buffCfg.debase,0);if(e.buffCfg.deatt){var l=e.cprops.gv(e.buffCfg.deatt);s=Fixed.value(s).add(l).value}e.skillId&&(s=Fixed.value(s).add(e.caster.getEquipProp(e.skillId,"bhr")).value);var u=e.tprops.gv("debuffRes"),c=Fixed.value(s).sub(u).value;if(0>=c&&0>=s)return 5;if(i.scene.seedr.random>c)return 5}return t.isImmune(e)?3:0},t.prototype.isImmune=function(e){var t=e.buffId,i=Data.getSValue("BuffData",t,"immune"),r=Data.getSValue("BuffData",t,"type")||1,n=Data.getSValue("BuffData",t,"subType")||0;for(var a in this.buffs){var o=this.buffs[a],s=Data.getSValue("BuffData",o.buffId,"immune");if(s&&(3==s.rtype||4==s.rtype)){if(s.rbuff&&-1!=s.rbuff.indexOf(t))return!0;if(s.rbtype&&-1!=s.rbtype.indexOf(r))return!0;if(s.retype&&-1!=s.retype.indexOf(n))return!0;if(i&&i.etype&&s.retype&&(s.relevel||0)>=(i.elevel||0)&&-1!=s.retype.indexOf(i.etype))return!0}}return!1},t.prototype.addBuff=function(e,t,i,r,n,a,o,s,l,u){void 0===n&&(n=0),void 0===a&&(a=0),void 0===o&&(o=0),void 0===s&&(s=!1),void 0===l&&(l=0),void 0===u&&(u=0);var c=this,p=c.owner,d=Data.getItem("BuffData",r),f=i||1,h=Data.getSValue("BuffData",r,"duration"),v=Data.getSValue("BuffData",r,"durbase"),m=Data.getLvBaseValue(h,f,v,0);m=Fixed.millisecond(m);var y={buffId:r,buffLv:f,buffCfg:d,skillId:t,skillLv:i,duration:m,totalTime:m>0?m:0,caster:e,target:p,helpRid:o,isHaloTrig:s,addTime:p.scene.stepTotal,sortTime:p.scene.stepTotal};if(!s&&d.isHalo&&0!=m)return void c.addHaloBuff(y);var g=Data.getSValue("BuffData",r,"igrade")||1,b=Data.getSValue("BuffData",r,"interval")||0;b=Fixed.millisecond(b),y.cprops=e.props,y.tprops=p.props,y.damageRate=n,y.grade=a||g,y.interval=b,y.ticktime=b||100,y.buffdt=0,y.trigTimes=0,y.maxShield=0,y.shield=0,y.comboExtraNum=l,y.vampireRate=u;var x=c.canAdd(y);if(2==x)return p.onBuffEffect(y,16,0,0,0,0),c.dealTrigBuff(4,r,p,e,!1),null;if(4==x)return p.onBuffEffect(y,524288,0,0,0,0),null;if(3==x)return d.state&&c.dealTrigBuff(13,r,p,e,!1,d.state),d.damage&&1==d.damage.etype&&(p.state.hasState(21)||p.state.hasState(9))?p.onBuffEffect(y,32768,0,0,0,0):p.onBuffEffect(y,32,0,0,0,0),null;if(5==x)return null;if(2==c.dealTrigBuff(9,y.buffId,y.target,y.caster,!0,r)||2==c.dealTrigBuff(7,y.buffId,y.target,y.caster,!0,d.type))return p.onBuffEffect(y,32,0,0,0,0),null;if(c.removeConflictBuff(y),0==m){if(y.damage=c.dealDamage(y),d.aeffect&&p.guise){var I=p.guise.addBuffEffect(e,d.aeffect,0);I&&(y.aeffectUId=I.uid,I.xbuff=y)}c.dealTrigBuff(10,r,p,e,!1,r),c.dealTrigBuff(8,r,p,e,!1,d.type),d.state&&c.dealTrigBuff(17,r,p,e,!1,d.state)}else{y=c.addDuationBuff(y);var _=Data.getSValue("BuffData",r,"instant");if(_&&(y.damage=c.dealEffect(y,!0)),d.aeffect&&!y.aeffectUId&&p.guise){var I=p.guise.addBuffEffect(e,d.aeffect,0);I&&(y.aeffectUId=I.uid,I.xbuff=y)}else if(!d.aeffect&&d.ceffect&&!y.ceffectUId&&p.guise){var S=p.guise.addBuffEffect(e,d.ceffect,1);S&&(y.ceffectUId=S.uid,S.xbuff=y)}var T=p.heroCfg.ba;T&&T.buff==r&&(c.protectXbuff=y,p.guise&&p.guise.showProtectBar()),d.shield&&(c.shieldXbuff=y,p.guise&&p.guise.showShieldBar()),(30==d.subType||31==d.subType)&&(c.xianMoXBuff=y),d.element&&-1==c.elementBuffs.indexOf(y)&&(c.elementBuffs.push(y),p.guise&&p.guise.updateElementImg()),c.dealTrigBuff(10,r,p,e,!1,r),d.state&&c.dealTrigBuff(17,r,p,e,!1,d.state)}var w=p.scene;return p.hold&&w.roomCfg.score&&(1==d.type||3==d.type)&&p instanceof Avatar&&w instanceof RelayRoom&&w.changeScoreVal(9,1,!1),w.trigAI(12,p,r),w.trigAI(30,p,d.sign||0),y},t.prototype.removeConflictBuff=function(e){var t=this,i=[],r=Data.getSValue("BuffData",e.buffId,"immune");if(r){var n=r.rtype||0;if(4!=n){for(var a in t.buffs){var o=t.buffs[a],s=Data.getSValue("BuffData",o.buffId,"immune")||{};r.retype&&-1!=r.retype.indexOf(s.etype)&&(r.relevel||0)>=(s.elevel||0)?i.push(o):r.rbuff&&-1!=r.rbuff.indexOf(o.buffId)?i.push(o):r.rbtype&&-1!=r.rbtype.indexOf(Data.getSValue("BuffData",o.buffId,"type")||1)?i.push(o):r.retype&&-1!=r.retype.indexOf(Data.getSValue("BuffData",o.buffId,"subType")||0)&&i.push(o)}if(i.length>0)if(ArrayUtils.sortOn(i,"idx",16),0==n){var l=i[0],u=l.target,c=l.caster;t.changeBuffList(l.idx,l,-1),t.dealTrigBuff(28,l.buffId,u,c,!1,l.buffId),t.dealTrigBuff(31,l.buffId,u,c,!1,[l.buffId,e.skillId])}else if(1==n){var l=i[0],p=l.buffCfg,u=l.target,c=l.caster;t.removeIdx(l.idx,64,1),p.state&&t.dealTrigBuff(13,l.buffId,u,c,!1,p.state)}else if(5==n){var l=i[0],d=Fixed.value(l.grade).mul(.5).floor().value;d>0&&t.changeBuffList(l.idx,l,d)}else i.forEach(function(e){var i=e.buffCfg,r=e.target,n=e.caster;t.removeIdx(e.idx,64,1),i.state&&t.dealTrigBuff(13,e.buffId,r,n,!1,i.state)});i=null}}},t.prototype.addDuationBuff=function(e){var t=this,i=e.buffId,r=t.buffMap[i]||{},n=ObjectUtils.getCount(r),a=Data.getSValue("BuffData",i,"gtype")||0;if(3==a){var o=Data.getSValue("BuffData",i,"exist");if(!o||o>n)return t.addBuffList(e),e}if(0>=n)return t.addBuffList(e),e;var s=0,l=[];for(var u in r)r[u]&&l.push(r[u]);ArrayUtils.sortOn(l,"sortTime",16);for(var c=Data.getSValue("BuffData",i,"gdiff"),p=0,d=l.length;d>p;p++){var f=r[l[p].idx];if(f&&c||f.caster.$eid==e.caster.$eid||3==a)return s=f.idx,t.changeBuffList(s,e),f}return 0==s&&t.addBuffList(e),e},t.prototype.addBuffList=function(e){var t=this,i=e.idx,r=e.buffId;i||(t.buffIdx++,i=e.idx=t.buffIdx),t.buffs[i]=e,t.buffMap[r]=t.buffMap[r]||{},t.buffMap[r][i]=e;var n=Data.getSValue("BuffData",r,"isTrig");if(n){var a=Data.getSValue("BuffData",r,"trig")||{},o=a.event||0;if(o>0){var s=t.trigs;s[o]=s[o]||{},s[o][i]=e}}var l=Data.getSValue("BuffData",r,"isRmv");if(l){var u=Data.getSValue("BuffData",r,"rmv")||{},c=u.event||0;if(c>0){var p=t.rmvs;p[c]=p[c]||{},p[c][i]=e}}var d=Data.getSValue("BuffData",r,"state");d&&d.forEach(function(t){e.target.state.normal(t,!0)}),t.onBuffAdd_props(e);var f=t.owner;!e.buffCfg.unfloat&&f.scene.guise&&f.scene.guise.onBuffAdd(e),e.buffCfg.show&&(f instanceof Avatar||f==GameStatic.target)&&(f.guise.updateBuff(),App.dispatch("c103",{rid:f.prid,eid:f.$eid})),e.buffCfg.hpeff&&f==GameStatic.target&&App.dispatch("c118",{rid:f.prid,eid:f.$eid})},t.prototype.changeBuffList=function(e,t,i){void 0===i&&(i=0);var r=this,n=r.buffs,a=n[e];if(a){var o=r.owner,s=t.buffId,l=Data.getSValue("BuffData",s,"gtype")||0,u=Data.getSValue("BuffData",s,"mgrade")||1;if(i=i||Data.getSValue("BuffData",s,"agrade")||1,1==l){var c=a.grade;if(t.grade=Math.min(Math.max(c+i,0),u),t.grade<=0){var p=t.buffCfg,d=t.target,f=t.caster;return r.removeIdx(e,64,1),void(p.state&&r.dealTrigBuff(13,t.buffId,d,f,!1,p.state))}if(t.grade==u&&u>1&&c<t.grade){var h=Data.getSValue("BuffData",t.buffCfg.id,"gbuff")||0;h&&(t.buffCfg.gdelay?o.scene.addCallLater(r.onDelayAddBuff,r,1,!1,!1,o,t.caster,t.skillId,t.skillLv,h,1):r.addBuff(t.caster,t.skillId,t.skillLv,h,0,1)),t.buffCfg.grem&&o.scene.addCallLater(r.removeIdx,r,1,!1,!1,e,0,1)}}else if(2==l){if(a.duration>=0&&t.duration>=0&&(t.totalTime=Fixed.value(a.totalTime).add(t.duration).value,t.totalTime<=0)){var p=t.buffCfg,d=t.target,f=t.caster;return r.removeIdx(e,64,1),void(p.state&&r.dealTrigBuff(13,t.buffId,d,f,!1,p.state))
}}else if(0==l&&0>i){var p=t.buffCfg,d=t.target,f=t.caster;return r.removeIdx(e,64,1),void(p.state&&r.dealTrigBuff(13,t.buffId,d,f,!1,p.state))}a.buffId=t.buffId,a.buffLv=t.buffLv,a.damageRate=t.damageRate,a.grade=t.grade,a.totalTime=t.totalTime,a.buffdt=Data.getSValue("BuffData",s,"reset")?t.buffdt:a.buffdt,a.caster=t.caster,a.cprops=t.cprops,a.damage=t.damage,a.sortTime=t.sortTime,r.onBuffDel_props(a),r.onBuffAdd_props(a),a.buffCfg.show&&(o instanceof Avatar||o==GameStatic.target)&&(o.guise.updateBuff(),App.dispatch("c103",{rid:o.prid,eid:o.$eid}))}},t.prototype.onEffectPlayEnd=function(e){var t=e.xbuff;if(t&&t.aeffectUId==e.uid&&t.buffCfg.ceffect&&!t.ceffectUId&&this.owner.guise){var i=this.owner.guise.addBuffEffect(t.caster,t.buffCfg.ceffect,1);i&&(t.ceffectUId=i.uid,i.xbuff=t)}},t.prototype.removeAll=function(){var e=this;if(this.buffs){var t=[];for(var i in this.buffs)t.push(+i);t.forEach(function(t){e.removeIdx(t,0,1)})}},t.prototype.removeId=function(e,t,i){var r=this;void 0===i&&(i=!1);var n=Data.getItem("BuffData",e);if(!i&&n.isHalo)return void this.removeHaloBuff(e,t);var a=this.buffMap[e];if(a){var o=[];for(var s in a)o.push(+s);o.forEach(function(e){r.removeIdx(e,0,t)})}},t.prototype.removeIdx=function(e,t,i){var r=this,n=r.buffs,a=r.buffMap,o=n[e];if(e in n&&delete n[e],o){var s=o.buffId,l=o.buffCfg,u=r.owner,c=u.scene;if(delete a[s][e],ObjectUtils.isEmpty(a[s])&&delete a[s],u.guise){o.aeffectUId&&u.guise.removeEffect(o.aeffectUId),o.ceffectUId&&u.guise.removeEffect(o.ceffectUId);var p=3==i?l.seffect||l.reffect:l.reffect;p&&u.guise.addBuffEffect(o.caster,p,0)}if(Data.getSValue("BuffData",s,"isTrig")){var d=Data.getSValue("BuffData",s,"trig")||{},f=d.event||0;f>0&&r.trigs[f]&&delete r.trigs[f][e]}if(Data.getSValue("BuffData",s,"isRmv")){var h=Data.getSValue("BuffData",s,"rmv")||{},v=h.event||0;v>0&&r.rmvs[v]&&delete r.rmvs[v][e]}var m=Data.getSValue("BuffData",s,"state");m&&m.forEach(function(e){o.target.state.remove(e)}),r.onBuffDel_props(o),delete r.shields[e],r.protectXbuff==o&&(r.protectXbuff=null,u.guise&&u.guise.hideProtectBar()),r.shieldXbuff==o&&(r.shieldXbuff=null,u.guise&&u.guise.hideShieldBar());var y=r.elementBuffs.indexOf(o);y>=0&&(r.elementBuffs.splice(y,1),u.guise&&u.guise.updateElementImg()),c.guise&&c.guise.onBuffRemove(o,t),64&t&&u.onBuffEffect(o,t,0,0,0,0),u.buff.dealTrigBuff(24,s,o.target,o.caster,!1,s),r.clearXbuff(o),u.buff.dealRmvBuff(5,null,u,s),c.trigAI(13,u,s,i),l.show&&(u instanceof Avatar||u==GameStatic.target)&&(u.guise.updateBuff(),App.dispatch("c103",{rid:u.prid,eid:u.$eid})),l.hpeff&&u==GameStatic.target&&App.dispatch("c118",{rid:u.prid,eid:u.$eid})}},t.prototype.addHaloBuff=function(e){var t=this,i=t.owner,r=t.halos,n=r[e.buffId];if(n){n.totalTime=e.totalTime;var a=void 0,o=void 0;if(n.haloRoles)for(var s in n.haloRoles)a=i.scene.getRoleByEid(+s),a&&(o=a.buff.getBuffById(n.buffId),o&&(o.totalTime=e.totalTime));return void t.clearXbuff(e)}if(r[e.buffId]=e,e.buffCfg.hceffect&&i.guise){var l=i.guise.addBuffEffect(e.caster,e.buffCfg.hceffect,1);l&&(e.hceffectUId=l.uid,l.xbuff=e)}i.scene.addHaloBuff(e)},t.prototype.removeHaloBuff=function(e,t){var i=this.halos,r=this.owner;if(i&&r&&r.scene){var n=i[e];n&&(delete i[e],r.guise&&n.hceffectUId&&r.guise.removeEffect(n.hceffectUId),r.scene.removeHaloBuff(n,t),this.clearXbuff(n))}},t.prototype.clearAllHaloBuff=function(){var e=this.halos;if(e){for(var t in e)this.removeHaloBuff(+t,1);this.halos={}}},t.prototype.clearXbuff=function(e){e.buffCfg=null,e.caster=null,e.cprops=null,e.target=null,e.tprops=null,e.slots=null,e.aeffectUId=0,e.ceffectUId=0,e.reffectUId=0},t.prototype.onEnterFrame=function(e){var t,i=this,r=i.halos,n=i.tempRunList,a=i.tempRemoveList;for(var o in r)t=r[o],t.duration>0&&(t.totalTime=Fixed.value(t.totalTime).sub(e).value,t.totalTime<=0&&i.removeHaloBuff(t.buffId,1));for(var s in i.buffs)t=i.buffs[s],t.trigCd&&(t.trigCd=Fixed.value(t.trigCd).sub(e).max(0).value),t.duration>0&&(t.totalTime=Fixed.value(t.totalTime).sub(e).value,t.totalTime<=0&&a.push(t)),t.totalTime>=0&&t.interval>0&&(t.buffdt=Fixed.value(t.buffdt).add(e).value,t.buffdt>=t.ticktime&&(t.buffdt=Fixed.value(t.buffdt).sub(t.ticktime).value,n.push(t)));!i.owner.isDead&&n.length>0&&n.forEach(function(e){i.dealEffect(e,!1)}),a.length>0&&a.forEach(function(e){i.removeIdx(e.idx,0,2)}),n.length=a.length=0;var l=i.owner.guise;l&&(i.protectXbuff&&l.updateProtectBar(),i.shieldXbuff&&l.updateShieldTime())},t.prototype.dealEffect=function(e,t){var i=this,r=i.owner,n=e.buffCfg;if(!n)return 0;var a=0,o=Data.getSValue("BuffData",e.buffId,"damage");if(o)if(n.reattack){var s=e.caster;s&&!s.isDead&&s.valid&&!s.$isRemoved&&(a=i.dealDamage(e))}else if(e.dotDmage){var l=o.etype,u=0;1==l?i.isImmune(e)?a=i.decreaseHp(e,32768,0):(3==(o.type||0)&&(u=8|u),a=i.decreaseHp(e,u,-e.dotDmage)):2==l&&(u=1|u,i.decreaseHp(e,u,e.dotDmage),a=0)}else{var s=e.caster;s&&!s.isDead&&s.valid&&!s.$isRemoved&&(a=i.dealDamage(e))}var c=Data.getSValue("BuffData",e.buffId,"btid");if(c&&!r.scene.checkBulletNumLimit(r,c,n.bmax)){var p=BulletExtra.create(r,r,c,t?1:0,e.skillId,e.skillLv);p&&r.skill.onTrigBullet(p)}var d=Data.getSValue("BuffData",e.buffId,"sbuff");return d&&(t?r.scene.addCallLater(i.onDelayAddBuff,i,1,!1,!1,r,r,e.skillId,e.skillLv,d,0):i.onDelayAddBuff(r,r,e.skillId,e.skillLv,d,0)),r.hold&&n.fname&&n.ficon&&r.scene.showFetterTip(n.fname,n.ficon),a||0},t.prototype.recordDamage=function(e,t,i,r){var n=this,a=n.damages;a||(a=n.damages={});var o=a[e];o||(o=a[e]={}),o[t]=i;var s=n.maxDamages;s||(s=n.maxDamages={});var l=s[e];l||(l=s[e]={}),l[t]=r},t.prototype.recordBehurt=function(e,t,i){var r=this.behurts;r||(r=this.behurts={});var n=r[e];n||(n=r[e]={}),n[t]=i},t.prototype.resetDamage=function(){this.damages=null,this.maxDamages=null},t.prototype.resetBehurt=function(){this.behurts=null},t.prototype.reattack=function(e,t){var i=this.damages;if(!i)return 0;var r=i[e];return r?r[t]:0},t.prototype.redefense=function(e,t){var i=this.behurts;if(!i)return 0;var r=i[e];return r?r[t]:0},t.prototype.getMaxDamage=function(e,t){var i=this.maxDamages;if(!i)return 0;var r=i[e];return r?r[t]:0},t.prototype.dealDamage=function(e){var t=this;e.caster;return e.buffCfg.reattack?t.dealNewDamage(e):t.dealNewDamage(e)},t.prototype.dealNewDamage=function(e){var i=this,r=i.owner,n=e.buffId,a=Data.getSValue("BuffData",n,"damage");if(!a||!a.etype)return 0;var o=e.caster,s=r.scene,l=0,u=(e.buffCfg,e.target),c=e.tprops,p=e.cprops,d=e.skillId,f=e.buffLv,h=a.etype,v=(a.type||0,a.dtype||0),m=a.dattr,y=m?1==v?c.gv(m):p.gv(m):0,g=Data.getLvBaseValue(a.drate,f,a.dbase,0),b=Data.getLvBaseValue(a.dratemax,f,a.dbase,0),x=Fixed.value(y).mul(g).value,I=Fixed.value(y).mul(b).value;if(1==h){var _=t.DEF_CONST,S=0,T=!1,w=p.gv("crit"),A=1,P=c.gv("def"),C=x+(I>0?Fixed.value(s.seedr.random*(I-x)).round().value:0);o instanceof Avatar&&o.skill.isNormal(d)&&r.scene.seedr.random<=.15?(l=4194304|l,A=p.gv("pojiaRate")):(r.scene.seedr.random<=w||u instanceof Monster&&u.buff.hasBuffById(23))&&(T=!0,l=4|l,A=p.gv("critRate")),S=C*(1-P/(P+_))*A,S=e.dotDmage=Math.max(1,Math.floor(S));var D=i.decreaseHp(e,l,-S);return D}if(2==h){var S=0,T=!1,w=p.gv("crit"),B=p.gv("critRate");return S=x+(I>0?Fixed.value(s.seedr.random*(I-x)).round().value:0),r.scene.seedr.random<=w&&(T=!0,l=4|l),T&&(S*=B),S=e.dotDmage=Math.max(1,Math.floor(S)),l=1|l,i.decreaseHp(e,l,S),0}},t.prototype.decreaseHp=function(e,t,i){var r=this,n=r.owner;if(0>i){var a=e.tprops,o=a.gv("hp"),s=a.gv("shield"),l=a.gv("maxHp"),u=Math.min(Math.max(o+s+i,0),l),c=0;if(s=r.decreaseShield(-i),s>0&&(t=4096|t,i+=s),n instanceof Avatar&&!n.scene.isAllPetUp){var p=n.agent.curPetInfo;if(p&&p.calling){var d=n.agent.curPetInfo.pet;if(!d.isDead&&1==d.battleType){var f=ObjectUtils.clone(e),h=d.props.gv("hurtShare"),v=d.props.gv("hp");v=Fixed.value(v).neg().value,c=Fixed.value(h).mul(i).floor().max(i).max(v).value,i=Fixed.value(i).sub(c).value,f.target=d,t=8192|t,d.buff.decreaseHp(f,8192|t,c),n.guise&&n.guise.addEffect(7108,0),d.guise&&d.guise.addEffect(7108,0)}}}n.onBuffEffect(e,t,i,s,0,c),r.dealTrigBuff(1,e.buffId,e.target,e.caster),0>=u&&r.dealTrigBuff(2,e.buffId,e.target,e.caster,!1,e.skillId)}else n.onBuffEffect(e,t,i,0,0,0);return i},t.prototype.getDmgExtraState=function(e){var t=e.target,i=e.caster,r=i.props,n=t.props,a=t.state,o=e.skillId,s=0;if(i.agent&&o){var l,u,c=i.agent.equipSkills,p=i.skill.getSkillInfo(o),d=void 0,f=void 0;for(var h in c)l=c[h],d=Data.getItem("SkillForceData",h),(d.sId==p.skillId||d.nId==p.skillId)&&(f=d.damage,f&&f.forEach(function(t){(!t.state||a.hasState(t.state))&&(u=Data.getLvListValue(t.value,l.lv,0),s=Fixed.value(u).mul(t.grade?e.grade:1).add(s).value)}))}if(a.hasState(114)){var v=r.gv("dmgExtraFloat"),m=n.gv("dmgDecFloat");s=Fixed.value(s).add(v).sub(m).value}if(a.hasState(20)){var y=r.gv("dmgExtraPoison");s=Fixed.value(s).add(y).value}if(a.hasState(30)){var g=r.gv("dmgExtraThunder");s=Fixed.value(s).add(g).value}if(a.hasState(31)){var b=r.gv("dmgExtraBlood");s=Fixed.value(s).add(b).value}if(a.hasState(32)){var x=r.gv("dmgExtraFire");s=Fixed.value(s).add(x).value}if(a.hasState(6)){var I=r.gv("dmgExtraStone");s=Fixed.value(s).add(I).value}if(a.hasState(34)){var _=r.gv("dmgExtraSeal");s=Fixed.value(s).add(_).value}var S=n.gv("hp"),T=n.gv("maxHp");if(S==T){var w=r.gv("dmgExtraUnhurted");s=Fixed.value(s).add(w).value}if(Fixed.value(S).div(T).value<.3){var A=r.gv("dmgExtraHurted");s=Fixed.value(s).add(A).value}if(t.buff.hasShieldBuff()){var y=r.gv("dmgExtraPoison");s=Fixed.value(s).add(y).value}if(i.prid&&t.prid){var P=r.gv("dmgExtraPvp"),C=n.gv("dmgDecPvp");s=Fixed.value(s).add(P).sub(C).value}var D=r.gv("dmgExtraAll"),B=n.gv("dmgDecAll");return s=Fixed.value(s).add(D).sub(B).value},t.prototype.decreaseShield=function(e){var t=this,i=t.shields;if(ObjectUtils.isEmpty(i))return 0;var r=t.buffs,n=0,a=[],o=[],s=[],l=t.shieldXbuff,u=t.owner.guise;for(var c in i){var p=Number(c),d=r[p];d.duration<0?s.push(p):o.push(d)}ArrayUtils.sortOn(o,"duration",16),o.forEach(function(e){a.push(e.idx)}),a=a.concat(s);for(var f=0,h=a.length;h>f;f++){if(0>=e)return n;var p=a[f],v=i[p];if(v>e){var m=v-e;i[p]=m,n+=e,e=0;var d=r[p];if(r){var y=d.slots;for(var g in y){var b=y[g];"shield"==b.name&&(b.value=m,d.shield=m,d.tprops.setPropSlot(b.name,b.slotName,m),l==d&&u&&u.updateShieldBar())}}}else e-=v,n+=v,t.removeIdx(p,0,3)}return n},t.prototype.onBuffAdd_props=function(e){var t=Data.getSValue("BuffData",e.buffId,"added");if(t){var i=this,r={},n=e.buffLv,a=Data.getSValue("BuffData",e.buffCfg.id,"adtarget")||0,o=Data.getSValue("BuffData",e.buffCfg.id,"atype")||0;t.forEach(function(t){var s=t.attr;if(s){var l=t.dattr||"",u=Data.getLvBaseValue(t.value,n,t.base,0),c=0,p=0,d=t.eattr||"",f=t.ungrade?1:e.grade;if(u=Fixed.value(u).mul(f).value,u=PropUtils.getAttrFixedValue(u,s),l){if(c=1==a?e.tprops.gv(l):e.cprops.gv(l),p=Data.getLvBaseValue(t.drate,n,t.dbase,0),d){var h=e.cprops.gv(d);p=Fixed.value(p).add(h).value}1==o?(u=Fixed.value(1).add(p).pow(f).mul(c).add(u).sub(c).value,u=PropUtils.getAttrFixedValue(u,l)):(u=Fixed.value(c).mul(p).mul(f).add(u).value,u=PropUtils.getAttrFixedValue(u,l))}i.slotIdx++;var v="buff"+i.slotIdx;r[s]={name:s,slotName:v,value:u},e.tprops.setPropSlot(s,v,u),e.tprops.gv("maxHp"),"shield"==s&&(e.maxShield=u,e.shield=u,i.shields[e.idx]=u,i.owner.guise.updateShieldBar())}}),e.slots=r}},t.prototype.onBuffDel_props=function(e){if(e.slots){for(var t in e.slots){var i=e.slots[t];this.owner.props.delPropSlot(i.name,i.slotName)}e.slots=null}e.maxShield&&this.owner.guise.updateShieldBar()},t.prototype.dealTrigBuff=function(e,t,i,r,n,a){void 0===n&&(n=!1),void 0===a&&(a=null);var o=r&&r.buff&&r.buff.onDealTrigBuff(e,1,t,i,r,n,a),s=i&&i.buff&&i.buff.onDealTrigBuff(e,0,t,i,r,n,a);return o||s},t.prototype.onDealTrigBuff=function(e,t,i,r,n,a,o){void 0===o&&(o=null);var s=this,l=0,u=s.trigs[e];if(!u)return l;var c=s.owner,p=[],d=function(d){var f=u[d],h=Data.getSValue("BuffData",f.buffId,"trig")||{},v=h.buff,m=h.dbuff,y=h.btid,g=h.batid;if((h.source||0)!=t||(f.trigCd||0)>0||i==f.buffId||v&&-1!=v.indexOf(i)||m&&-1!=m.indexOf(i))return"continue";var b=!1;switch(e){case 2:var x=h.param||[];(x.length<=0||x.indexOf(o)>=0)&&(b=!0);break;case 5:var I=Data.getLvListValue(h.param,f.buffLv,0);I>o&&(b=!0);break;case 27:var I=Data.getLvListValue(h.param,f.buffLv,0);o>=I&&(b=!0);break;case 7:case 8:var _=h.param||[];_.length>0&&-1!=_.indexOf(o)&&(b=!0);break;case 13:case 17:var S=h.param||[];if(S.length>0&&o)for(var T=0,w=o;T<w.length;T++){var A=w[T];if(-1!=S.indexOf(A)){b=!0;break}}break;case 11:case 12:case 9:case 10:case 24:var x=h.param||[];x.length>0&&-1!=x.indexOf(o)&&(b=!0);break;case 18:case 19:var P=h.param||[];P.length>0&&-1!=P.indexOf(o)&&(b=!0);break;case 23:case 26:var C=h.param;if(C&&C.length>0)if(C.indexOf(-1)>=0)b=!0;else{var D=Data.getItem("SkillData",o);D&&C.indexOf(D.type||0)>=0&&(b=!0)}break;case 28:var B=h.param;B&&B.length>0&&-1!=B.indexOf(o)&&(b=!0);break;case 29:case 30:var k=h.param;k&&k.length>0&&(k.indexOf(-1)>=0||k.indexOf(o)>=0)&&(b=!0);break;case 31:var k=h.param;!(k&&k.length>0)||k[0]&&k[0]!=o[0]||k[1]&&k[2]&&k[1]!=o[1]&&k[2]!=o[1]||(b=!0);break;default:b=!0}if(!b)return"continue";var E=Data.getLvListValue(h.times,f.buffLv,-1);if(-1!=E&&f.trigTimes>=E)return"continue";var R=Data.getLvListValue(h.rate,f.buffLv,0);if(h.rateAtt){var F=c.props.gv(h.rateAtt);R=Fixed.value(R).add(F).value}if(c.scene.seedr.random>R)return"continue";f.trigTimes++;var M=Data.getLvListValue(h.cd,f.buffLv,0);if(f.trigCd=Fixed.millisecond(M),v||m){var L=c.scene.getBuffTirgCaster(f,r,n,h.caster||0),U=c.scene.getBuffTirgTarget(f,r,n,h.target||0);L&&U&&L.buff&&U.buff&&(v&&v.forEach(function(e){var t=h.lv?f.buffLv:L.buff.getBuffLv(e,1);h.buffDelay?c.scene.addCallLater(s.onDelayAddBuff,s,1,!1,!1,U,L,0,t,e,h.grade?f.grade:0):U.buff.addBuff(L,0,t,e,0,h.grade?f.grade:0)}),m&&m.forEach(function(e){var t=h.lv?f.buffLv:L.buff.getBuffLv(e,1);c.scene.addCallLater(s.onDelayAddBuff,s,1,!1,!1,U,L,0,t,e,h.grade?f.grade:0)}))}if(y&&!c.isBulletUnactive(y)&&!c.scene.checkBulletNumLimit(c,y,h.bmax)){var O=c.scene.getBuffTirgCaster(f,r,n,h.bdepend||0),N=BulletExtra.create(c,O,y,0,0,f.buffLv);N&&(h.buffDelay?c.scene.addCallLater(s.onDelayTrigBullet,s,1,!1,!0,N):c.skill.onTrigBullet(N))}if(g&&c.isBulletActive(g)&&!c.scene.checkBulletNumLimit(c,g,h.bamax)){var O=c.scene.getBuffTirgCaster(f,r,n,h.bdepend||0),N=BulletExtra.create(c,O,g,0,0,f.buffLv);N&&(h.buffDelay?c.scene.addCallLater(s.onDelayTrigBullet,s,1,!1,!0,N):c.skill.onTrigBullet(N))}var H=h.rmcd;switch(H){case 1:h.cdVal&&h.cdVal.forEach(function(e){c.skill.clearSkillCd(e)});break;case 2:var j=c.skill.getRandomInCdSkill(h.cdVal?h.cdVal[0]:0);j&&c.skill.clearSkillCd(j);break;case 3:var j=c.skill.getRandomInCdSpeSkill();j&&c.skill.clearSkillCd(j)}c.hold&&h.fetterName&&h.fetterIcon&&c.scene.showFetterTip(h.fetterName,h.fetterIcon),a&&h.immune&&2!=l&&(l=2),h.adel&&-1!=E&&f.trigTimes>=E&&p.push(f.idx),2!=l&&(l=1)};for(var f in u)d(f);return p.forEach(function(e){s.removeIdx(e,0,1)}),l},t.prototype.onDelayAddBuff=function(e,t,i,r,n,a){e&&e.buff&&e.buff.addBuff(t,i,r,n,0,a)},t.prototype.onDelayTrigBullet=function(e){var t=this.owner;t&&t.skill&&t.skill.onTrigBullet(e)},t.prototype.dealRmvBuff=function(e,t,i,r){void 0===r&&(r=null);var n=i&&i.buff.onDealRmvBuff(e,1,t,i,r),a=t&&t.buff.onDealRmvBuff(e,0,t,i,r);return n&&a},t.prototype.onDealRmvBuff=function(e,t,i,r,n){void 0===n&&(n=null);var a=this,o=!0,s=a.rmvs[e];if(!s)return o;var l=[];for(var u in s){var c=s[u],p=Data.getSValue("BuffData",c.buffId,"rmv")||{},d=!1;switch(e){case 1:case 2:var f=p.param||[];f.length>0&&-1!=f.indexOf(n)&&(d=!0);break;case 3:case 4:var f=p.param||[];f.length>0&&-1!=f.indexOf(n)&&(d=!0);break;case 5:var h=p.param||[];h.length>0&&-1!=h.indexOf(n)&&(d=!0);break;case 6:c.caster==r&&(d=!0);default:d=!0}d&&l.push(c.idx)}return l.forEach(function(e){a.removeIdx(e,0,1)}),o},t.prototype.hasBuffById=function(e){return this.buffMap&&e in this.buffMap},t.prototype.hasShieldBuff=function(){for(var e in this.shields)return!0;return!1},t.prototype.hasHaloBuff=function(e){return this.halos&&e in this.buffMap},t.prototype.getHaloBuff=function(e){return this.halos?this.halos[e]:null},t.prototype.getBuffById=function(e){var t=this.buffMap[e];if(t)for(var i in t)return t[i];return null},t.prototype.getShowBuffs=function(){var e,t=this,i=t.owner,r=t.buffs,n=[];if(i&&i.agent&&i.agent.usedPetNum>0){var a=t.usedPetXbuff;if(!a){var o=5;a=t.usedPetXbuff={idx:0,buffId:o,buffLv:1,damageRate:0,grade:0,duration:0,interval:0,totalTime:0,ticktime:0,buffdt:0,trigTimes:0,maxShield:0,shield:0,buffCfg:Data.getItem("BuffData",o),skillId:0,skillLv:1,caster:i,cprops:i.props,target:i,tprops:i.props,helpRid:0,addTime:0}}n.push(a)}for(var s in r)e=r[s],e.buffCfg.show&&n.push(e);return ArrayUtils.sortOn(n,["addTime","idx"],[16,16]),n},t.prototype.hasFierceBuff=function(){var e,t=this,i=t.buffs;for(var r in i)if(e=i[r],e.buffCfg.hpeff)return!0;return!1},t.prototype.getBuffLv=function(e,t){return void 0===t&&(t=1),this.svrBuffs?this.svrBuffs[e]||t:t},t.prototype.clearStates=function(){var e=this,t=e.owner,i=e.buffs;if(i&&t&&t.state){var r=void 0;for(var n in i)r=i[n],r&&r.buffCfg&&r.buffCfg.state&&r.buffCfg.state.forEach(function(e){t.state.remove(e,!1)})}},t.prototype.clearAll=function(){var e=this,t=e.buffs;if(t)for(var i in t)e.clearXbuff(t[i]);e.clearAllHaloBuff(),e.protectXbuff=null,e.shieldXbuff=null,e.xianMoXBuff=null,e.buffs={},e.buffMap={},e.shields={},e.trigs={},e.rmvs={}},t.prototype.onDestroy=function(){var e=this,t=e.owner;t&&t.scene&&t.scene.removeCallLater(e),e.usedPetXbuff&&e.clearXbuff(e.usedPetXbuff),ObjectUtils.clearKeys(e,["buffIdx","slotIdx","buffs","buffMap","shields","trigs","damages","maxDamages","behurts","protectXbuff","shieldXbuff","tempRunList","tempRemoveList","xianMoXBuff","elementBuffs","usedPetXbuff","svrBuffs","passiveBuffs"]),ObjectPool.push(e)},t.DEF_CONST=100,t}(GameCom);__reflect(Buff.prototype,"Buff"),window.Buff=Buff;var Combo=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.initialize=function(t){e.prototype.initialize.call(this,t);var i=this;i.curLvCfg=null,i.stopTime=0,i.buffId=0,i.maxLv=0,i.curLv=0,i.total=0,i.maxNum=0,i.isPlaying=!1},t.prototype.onCreate=function(){e.prototype.onCreate.call(this);var t=Data.getData("ComboData");this.maxLv=t.length},t.prototype.add=function(e){var t=this;t.isPlaying||t.start(),t.total=Fixed.value(t.total).add(e).value;var i=t.calNewLv();if(!i)return void t.stop();var r=t.owner;t.total>t.maxNum&&(t.maxNum=t.total,r.hold&&r.scene instanceof RelayRoom&&r.scene.roomCfg.score&&r.scene.changeScoreVal(12,t.maxNum,!0));var n=t.curLvCfg.id,a=Data.getSValue("ComboData",n,"time");t.stopTime=Fixed.millisecond(a,1);var o=t.buffId,s=Data.getSValue("ComboData",n,"buff")||0;if(s!=o&&s){var l=t.owner.avatar;l&&!l.isDead&&(o&&l.buff.removeId(o,1),l.buff.addBuff(l,0,0,s),t.buffId=s)}r.avatar&&r.avatar.ai.trig(31,e),t.owner.hold&&(t.isDirty=!0)},t.prototype.calNewLv=function(){for(var e,t,i=this,r=i.maxLv,n=1;n<=i.maxLv;n++)if(e=Data.getOppItem("ComboData",n),t=Data.getSValue("ComboData",e.id,"total"),t&&i.total<=t){r=n;break}return i.curLv=r,i.curLvCfg=Data.getOppItem("ComboData",r),i.curLv&&i.curLvCfg?!0:!1},t.prototype.start=function(){var e=this;e.isPlaying||(e.isPlaying=!0,e.total=0,e.curLv=0,e.curLvCfg=null,e.stopTime=0)},t.prototype.stop=function(){var e=this;if(e.isPlaying){var t=e.owner;e.buffId&&!t.avatar.isDead&&t.avatar.buff.removeId(e.buffId,1),e.isPlaying=!1,e.total=0,e.curLv=0,e.curLvCfg=null,e.stopTime=0,e.buffId=0,t.avatar&&t.avatar.ai.resetTrig(31),e.owner.hold&&(e.isDirty=!0)}},t.prototype.onEnterFrame=function(e){var t=this;t.stopTime>0&&(t.stopTime=Fixed.value(t.stopTime).sub(e).max(0).value,0==t.stopTime&&t.stop())},t.prototype.afterEnterFrame=function(){this.isDirty&&(this.isDirty=!1,App.dispatch("c55"))},t.prototype.onDestroy=function(){this.curLvCfg=null},t}(GameCom);__reflect(Combo.prototype,"Combo"),window.Combo=Combo;var FruitSkill=function(e){function t(){return e.call(this)||this}return __extends(t,e),t}(Skill);__reflect(FruitSkill.prototype,"FruitSkill"),window.FruitSkill=FruitSkill;var GroupProps=function(e){function t(){var t=e.call(this)||this;return t.init(),t}return __extends(t,e),t.prototype.init=function(){this._propMap=new HashMap},t.prototype.setProps=function(e,t){var i=this._propMap.getValue(e);i||(i=ObjectPool.pop(SimpleProps),i.clear(),this._propMap.add(e,i)),i.setProps(t)},t.prototype.getProps=function(){var e=[];this._propMap.valueSet.forEach(function(t){e.push.apply(e,t.getProps())});var t=PropUtils.mergeProps(e);return t},t}(egret.EventDispatcher);__reflect(GroupProps.prototype,"GroupProps"),window.GroupProps=GroupProps;var PetSkill=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.initSkills=function(t){e.prototype.initSkills.call(this,t);var i=this,r=i.owner.heroCfg.fuse;if(r&&r.normal){var n=i.owner.heroId;r.normal.forEach(function(e){i.addSkill(e,1,n)})}},t.prototype.onSkillBegin=function(e,t){var i=this,r=i.owner;if(1==r.battleType)e.isNormal&&e.hasSub&&!e.isLast&&(i.nextSkillId=e.skillId);else if(2==r.battleType){var n=r.agent.avatar,a=r.scene.getPetHideSkillTarget(r),o=void 0,s=void 0,l=void 0;if(a){var u=e.curSkillCfg.aw||0;l=a.x>=n.x,o=l?Fixed.value(a.x).sub(u).value:Fixed.value(a.x).add(u).value,s=a.y}else o=n.x,s=n.y,l=n.right;r.updatePos(o,s,r.z,l),r.visible_guise=!0,r.onHideSkillBegin()}},t.prototype.onTouchSkillBegin=function(e,t){var i=this,r=i.owner;if(2==r.battleType){var n=i.skills[e],a=n.curSkillId,o=r.agent;i.canUse(a,!1,t)?o.reqUsePetSkill(r.petId,e):i.nextSkillId!=e&&i.canCombo(a)&&o.reqComboPetSkill(r.petId,e)}},t.prototype.onTouchSkillEnd=function(e,t){var i=this.owner;2==i.battleType&&i.agent.reqBreakPetXuli(i.petId,e)},t}(Skill);__reflect(PetSkill.prototype,"PetSkill"),window.PetSkill=PetSkill;var Props=function(e){function t(){var t=e.call(this)||this;return t.delayTime=.2,t}return __extends(t,e),t.prototype.expr_add=function(e,t){var i,r=0;for(var n in t)i=this.getYihuo(e,n,t[n]),r=Fixed.value(r).add(i).value;return r},t.prototype.expr_multiply=function(e,t){var i,r=1;for(var n in t)i=this.getYihuo(e,n,t[n]),r=Fixed.value(r).mul(i).value;return r},t.prototype.expr_submultiply=function(e,t){var i,r=0;for(var n in t)i=this.getYihuo(e,n,t[n]),r=Fixed.value(1).sub(r).mul(i).add(r).value;return r},t.prototype.expr_addmultiply=function(e,t){var i,r="BASE"in t?this.getYihuo(e,"BASE",t.BASE)||1:1;for(var n in t)"BASE"!==n&&(i=this.getYihuo(e,n,t[n]),r=Fixed.value(1).add(i).mul(r).value);return r},t.prototype.initialize=function(t){e.prototype.initialize.call(this,t);var i=this;i.clear(),i.exprs={},i.changedKeys={},i.changeTimer=0,i.yihuos={},i.props={},i.exprs.add=i.expr_add,i.exprs.multiply=i.expr_multiply,i.exprs.submultiply=i.expr_submultiply,i.exprs.addmultiply=i.expr_addmultiply,i.attCfgs=Data.getOppData("AttDouble"),Functor.assert(i.attCfgs,"AttData反表不存在"),i.attMaxValue=Data.getOppData("AttMaxValue"),Functor.assert(i.attMaxValue,"AttMaxValue反表不存在"),i.initAttMaxValue()},t.prototype.setYihuo=function(e,t,i){var r=Fixed.value(i||0).mul(22e4).round().value,n=7259,a=1,o=i;r>1073741824?(o=Functor.yihuo(r,n),a=2):(o=r^n,a=1);var s=this.yihuos,l=s[e]||{};return s[e]=l,l[t]=a,o},t.prototype.getYihuo=function(e,t,i){var r,n=this.yihuos[e]||{},a=n[t]||1,o=i||0,s=7259;return r=1==a?o^s:Functor.yihuo(o,s),Fixed.value(r).div(22e4).value},t.prototype.initAttMaxValue=function(){var e=this;for(var t in e.attMaxValue)for(var i=e.attMaxValue[t],r=0,n=i;r<n.length;r++){var a=n[r];e.setPropSlot(a,"BASE",e.gv(t))}},t.prototype.createProp=function(e,t){var i=this,r={name:e,value:i.setYihuo(e,"value",t.defaultValue||0),valid:!1,maxValue:i.setYihuo(e,"maxValue",t.minValue||0),minValue:i.setYihuo(e,"minValue",t.minValue||0),valuelist:{}};return t.maxKey&&(r.maxValue=i.setYihuo(e,"maxValue",i.gv(t.maxKey)||0)),r},t.prototype.gv=function(e){var t=this,i=t.attCfgs[e];if(Functor.assert(i,e+"属性不存在"),!i)return 0;e=i.name;var r=t.props,n=r[e],a=t.attCfgs[i.maxKey]||{},o=a.name||"",s=Data.getOppItem("AttExprData",i.id);if(!n&&s&&s.exprd&&(n=r[e]=t.createProp(e,i)),!n)return i.defaultValue||0;var l=0;if(n.valid)l=t.getYihuo(e,"value",n.value);else{var u=t.exprs[i.combineType],c=n.valuelist=n.valuelist||{},p="BASE",d="EXPR",f=p in c?t.getYihuo(e,p,c[p]):0,h=0;if(f&&o){var v=t.getYihuo(e,"maxValue",n.maxValue),m=t.gv(o);0!=v&&(f=Fixed.value(f).mul(m).div(v).value,f=PropUtils.getFixedValue(f,i.accuracy)),h=m,n.maxValue=t.setYihuo(e,"maxValue",h),c[p]=t.setYihuo(e,p,f)}delete c[d];var y=u.apply(t,[e,c]);if(y=PropUtils.getFixedValue(y,i.accuracy),s.exprd){var g=Data.expr_d(i.id,t);g=PropUtils.getFixedValue(g,i.accuracy),c[d]=t.setYihuo(e,d,g)}var b=u.apply(t,[e,c]);b=PropUtils.getFixedValue(b,i.accuracy);var x=i.propAdd||"";if(x){var I=t.attCfgs[x],_=t.gv(I.name);b=Fixed.value(1).add(_).mul(b).value}var S=i.minValue||0;S>b&&(b=S),o&&b>h&&(b=h),l=b,n.baseValue=t.setYihuo(e,"baseValue",y),n.value=t.setYihuo(e,"value",b),n.valid=!0}return l},t.prototype.setValidList=function(e){var t=this;for(var i in e){var r=t.attCfgs[i],n=t.props[i];if(n){var a=t.getYihuo(i,"value",n.value);n.valid=!1,t.changeValue(i,a,r)}}},t.prototype.setPropSlot=function(e,t,i){var r=this,n=r.attCfgs[e];if(Functor.assert(!!n,"setPropSlot attCfg["+e+"]不存在"),n){e=n.name;var a=r.props[e];if(n.affects)for(var o in n.affects)r.props[o]||r.gv(o);if(a||(a=r.props[e]=r.createProp(e,n)),i=PropUtils.getFixedValue(i,n.accuracy),r.getYihuo(e,t,a.valuelist[t]||0)!=i){a.valuelist[t]=r.setYihuo(e,t,i);var s=r.getYihuo(e,"value",a.value);a.valid=!1,r.changeValue(e,s,n)}}},t.prototype.delPropSlot=function(e,t){var i=this,r=i.attCfgs[e];if(Functor.assert(!!r,"delPropSlot attCfg["+e+"]不存在"),r){e=r.name;var n=i.props[e];if(n){delete n.valuelist[t];var a=i.yihuos[e];if(a&&delete a[t],n.valid){var o=i.getYihuo(e,"value",n.value);n.valid=!1,i.changeValue(e,o,r)}}}},t.prototype.clearPropSlots=function(e,t){var i=this,r=i.attCfgs[e];Functor.assert(!!r,"clearPropSlots attCfg["+e+"]不存在"),e=r.name;var n=i.props[e];if(n){var a=n.valuelist,o="BASE";if(a[o]){var s=i.getYihuo(e,o,a[o]);n.valuelist={BASE:i.setYihuo(e,o,s)}}else n.valuelist={};if(i.yihuos[e]={},n.valid){var l=i.getYihuo(e,"value",n.value);n.valid=!1,i.changeValue(e,l,r)}}},t.prototype.changeValue=function(e,t,i){var r=this,n=r.owner;r.setValidList(i.affects),r.isBattle&&i.atkAttr&&n.resetDamage(),r.isBattle&&i.defAttr&&n.resetBehurt(),e in r.changedKeys||(r.changedKeys[e]=t),"cdDecPct"==e?n instanceof Role&&n.skill.changeCD(r.changedKeys[e]):"spd"==e&&n instanceof Avatar&&n.isTouch&&n.updateSpdByDir(n.touchDir),n instanceof Role&&n.ai&&n.ai.trigProp(e),r.changeTimer||(r.changeTimer=r.addOnceTimer(this.delayTime,r.delayChangeValue))},t.prototype.delayChangeValue=function(){var e=this,t=e.owner,i=e.changedKeys,r=e.notice;if(e.changeTimer=0,!r&&t instanceof Player)for(var n in i){var a=Data.getOppItem("AttDouble",n);if(a&&a.isUIShow){r=!0;break}}if(r){var o={};for(var n in i)i[n]!=e.gv(n)&&(o[n]=i[n]);t.onAttPropChange(o,e)}e.changedKeys={}},t.prototype.initProps=function(e){var t=this,i=[];t.delTimer(t.changeTimer),t.changedKeys={},t.changeTimer=0,t.yihuos={},t.props={},e&&(e.forEach(function(e){var r=t.attCfgs[e.name];r&&(r.maxKey?i.push(e):t.setPropSlot(e.name,e.slot||"BASE",e.val))}),t.initAttMaxValue(),i.forEach(function(e){t.setPropSlot(e.name,"BASE",e.val)}))},t.prototype.getFilterProps=function(e){void 0===e&&(e=!1);for(var i,r,n=t.showAttrs,a=[],o=n.length,s=this;o--;)i=n[o],r=s.gv(i.name),e&&0==r||a.push(Data.getAttVo(i.id,r));return a},t.prototype.getAllProps=function(e){void 0===e&&(e=!1);for(var t,i,r=Data.getData("AttData"),n=[],a=r.length,o=this;a--;)t=r[a],i=o.gv(t.name),e&&0==i||n.push(Data.getAttVo(t.id,i));return n},t.prototype.getAttrs=function(){var e,t=[],i=this,r=i.props;for(var n in r)e=r[n],t.push({name:e.name,val:i.gv(e.name)});return t},t.initShowAttrs=function(){if(!t.showAttrs){var e=Data.getData("AttData").concat();t.showAttrs=e.filter(function(e){return e.isUIShow}),t.showAttrs.sort(function(e,t){return e.showSort-t.showSort||e.id-t.id})}},t.prototype.clear=function(){var e=this;e.exprs=null,e.attCfgs=null,e.attMaxValue=null,e.changedKeys=null,e.delTimer(e.changeTimer),e.changeTimer=0,e.yihuos=null,e.props=null,e.notice=!1,e.isBattle=!1},t.prototype.onDestroy=function(){this.clear(),ObjectPool.push(this)},t}(GameCom);__reflect(Props.prototype,"Props"),window.Props=Props;var Rect=function(){function e(){this.vertexes=[];var e=this;e._A1=new Vec2d,e._A2=new Vec2d,e._A3=new Vec2d,e._A4=new Vec2d,e._axisX=new Vec2d,e._axisY=new Vec2d,e._CA1=new Vec2d,e._CA2=new Vec2d,e._CA3=new Vec2d,e._CA4=new Vec2d,e.C=new Vec2d,e.A1=new Vec2d,e.A2=new Vec2d,e.A3=new Vec2d,e.A4=new Vec2d,e.axisX=new Vec2d,e.axisY=new Vec2d}return e.prototype.reset=function(e,t,i,r,n){var a=this;a.vertexes.length=0,a.x=e,a.y=t,a.width=i,a.height=r,a.cw=Fixed.value(i).mul(.5).value,a.ch=Fixed.value(r).mul(.5).value,a.rotation=n,a.angle=Fixed.value(n).div(180).mul(Fixed.PI).value,a.nonrotation=0===Fixed.value(n).mod(360).value;var o=a.nonrotation,s=a.angle,l=a.cw,u=a.ch,c=a._A1,p=a._A2,d=a._A3,f=a._A4,h=a._axisX,v=a._axisY,m=a._CA1,y=a._CA2,g=a._CA3,b=a._CA4,x=a.C,I=a.A1,_=a.A2,S=a.A3,T=a.A4,w=a.axisX,A=a.axisY,P=Fixed.value(e).sub(l).value,C=Fixed.value(e).add(l).value,D=Fixed.value(t).sub(u).value,B=Fixed.value(t).add(u).value;x.reset(e,t),c.reset(P,D),p.reset(C,D),d.reset(C,B),f.reset(P,B),h.reset(1,0),v.reset(0,1),c.sub(a.C,m),p.sub(a.C,y),d.sub(a.C,g),f.sub(a.C,b),o?(c.clone(I),p.clone(_),d.clone(S),f.clone(T),h.clone(w),v.clone(A)):(m.rotate(s,I),y.rotate(s,_),g.rotate(s,S),b.rotate(s,T),x.add(I,I),x.add(_,_),x.add(S,S),x.add(T,T),h.rotate(s,w),v.rotate(s,A)),a.vertexes.push(a.A1,a.A2,a.A3,a.A4)},e.prototype.intersects=function(e){return this.nonrotation?this.intersects_AABB(e):this.intersects_OBB(e)},e.prototype.intersects_AABB=function(e){var t=this,i=e.C,r=t.C,n=t.x;n=Fixed.value(t.width).mul(.5).add(n).value,n=Fixed.value(e.width).mul(.5).add(n).sub(r.x).value,n=Fixed.value(i.x).sub(r.x).abs().sub(n).max(0).value,n=Fixed.value(n).pow(2).value;var a=t.y;return a=Fixed.value(t.height).mul(.5).add(a).value,a=Fixed.value(e.height).mul(.5).add(a).sub(r.y).value,a=Fixed.value(i.y).sub(r.y).abs().sub(a).max(0).value,a=Fixed.value(a).pow(2).value,0===Fixed.value(n).add(a).value},e.prototype.intersects_OBB=function(e){var t=this;return t.cross(t,e,t.axisX)&&t.cross(t,e,t.axisY)&&t.cross(t,e,e.axisX)&&t.cross(t,e,e.axisY)},e.prototype.hitTestPoint=function(e,t){var i=this;return e>=Fixed.value(i.x).sub(i.cw).value&&e<=Fixed.value(i.x).add(i.cw).value&&t>=Fixed.value(i.y).sub(i.ch).value&&t<=Fixed.value(i.y).add(i.ch).value},e.prototype.cross=function(e,t,i){var r=e.vertexes.map(function(e){return e.dot(i)}).sort(function(e,t){return Fixed.value(e).sub(t).value}),n=t.vertexes.map(function(e){return e.dot(i)}).sort(function(e,t){return Fixed.value(e).sub(t).value});return r[3]>=n[0]&&n[3]>=r[0]},e.prototype.destroy=function(){ObjectPool.push(this)},e}();__reflect(Rect.prototype,"Rect"),window.Rect=Rect;var SimpleProps=function(e){function t(){var t=e.call(this)||this;return t.init(),t}return __extends(t,e),t.prototype.init=function(){this._propMap=new HashMap},t.prototype.setProps=function(e){for(var t=e.length;t--;)this.setProp(e[t])},t.prototype.setProp=function(e){var t=e.name,i=this._propMap.getValue(t);i?i.val=e.val:(i={val:e.val,name:t},this._propMap.add(t,i))},t.prototype.getProps=function(){return this._propMap.valueSet},t.prototype.clear=function(){this._propMap.clear()},t}(egret.EventDispatcher);__reflect(SimpleProps.prototype,"SimpleProps"),window.SimpleProps=SimpleProps;var FollowBulletAction=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.setActionInfo=function(t,i,r,n,a,o,s){e.prototype.setActionInfo.call(this,t,i,r,n,a,o,s);var l=this,u=Fixed.millisecond(a[0]),c=!a[1];u||(c=!0),l.depend=c,l.lastx=i.ox,l.lasty=i.oy,c&&i.addListener("onRemoved",l.onBulletRemoved,l);
var p=ObjectPool.pop(SubAction);p.initialize(l,n||"behit_stand",r?90:2,u,0),l.subActions.push(p)},t.prototype.doFrame=function(e,t,i,r,n){if(!i){var a=this,o=a.owner,s=a.bullet,l=o.scene,u=l.limitX(Fixed.value(s.ox).sub(a.lastx).add(o.ox).value),c=l.limitY(Fixed.value(s.oy).sub(a.lasty).add(o.oy).value);o.updatePos(u,c,o.z,o.right),a.lastx=s.ox,a.lasty=s.oy}},t.prototype.onBulletRemoved=function(){this.onAllSubActionEnd()},t.prototype.onDestroy=function(){var t=this;t.depend&&t.bullet.removeListener("onRemoved",t.onBulletRemoved,t),t.depend=!1,t.lastx=0,t.lasty=0,e.prototype.onDestroy.call(this)},t}(HurtAction);__reflect(FollowBulletAction.prototype,"FollowBulletAction"),window.FollowBulletAction=FollowBulletAction;var State=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.regHurtAction=function(e,t){this.hurtActionClss[e]=t},t.getHurtAction=function(e){return this.hurtActionClss[e]},Object.defineProperty(t.prototype,"canSkillRun",{get:function(){return this.owner.skill.curSkillInfo&&this.actionState instanceof SkillState?0!=this.actionState.move:!1},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"skillMoveType",{get:function(){return this.owner.skill.curSkillInfo&&this.actionState instanceof SkillState?this.actionState.move:0},enumerable:!0,configurable:!0}),t.prototype.canUseOther=function(e){return this.owner.skill.curSkillInfo&&this.actionState instanceof SkillState?this.actionState.canUseOther(e):!0},t.prototype.comboing=function(e){return this.actionState instanceof SkillState?this.actionState.comboing(e):!1},t.prototype.szing=function(){return this.actionState instanceof SkillState?this.actionState.szing():!1},t.prototype.onCreate=function(){this.states={},this.mutuals={},this.delayTrigAIId=0},t.prototype.addState=function(e){var t=this,i=e.cfg;i.inte&&t.actionState instanceof SkillState&&t.interrupt(4),i.move&&(t.owner.stopMove(),t.owner.ai.stop()),i.mutual&&t.updateMutual(e),i.add&&i.add.forEach(function(e){t.remove(e,!1)}),i.pri&&t.updateAction(e),e.add(),103==e.state&&t.owner.setBalanceTime()},t.prototype.normal=function(e,t,i,r,n){void 0===i&&(i=null),void 0===r&&(r=!1),void 0===n&&(n=0/0);var a=this;if(!t||!a.limit(e)){var o=a.owner.beControl,s=a.createState(e);s.createAction(r,i,null,n),a.addState(s),a.onControlChange(e,o)}},t.prototype.move=function(e,t,i,r,n,a,o,s){void 0===t&&(t=null),void 0===i&&(i=null),void 0===r&&(r=null),void 0===n&&(n=0),void 0===a&&(a=!0),void 0===o&&(o=0),void 0===s&&(s=0);var l=this;if(!e||!l.limit(101)){var u=l.owner.beControl,c=l.createState(101);c.setActionInfo(t,i,r,n,a,o,s),c.createAction(),l.addState(c),l.onControlChange(101,u)}},t.prototype.skill=function(e,t,i){var r=this,n=r.owner.beControl,a=r.createState(110);a.setActionInfo(e,t,i),a.createAction(),r.addState(a),r.onControlChange(110,n)},t.prototype.hurt=function(e,t,i,r,n,a,o,s,l,u){if(e&&!e.$isRemoved&&6!=r){var c=this,p=c.owner,d=103;if(p instanceof MetalPail&&(r=3,o=[.3,100,.3,0,0]),c.limit(d,e))return p.ai.beHurt(e,!0),!1;if(u){var f=c.states[d];if(f instanceof HurtState&&f.type==r)return p.ai.beHurt(e,!0),!1}var h,v=p.beControl,m=c.hasState(103);if(1==r?h=104:2==r?h=105:3==r?h=106:4==r||9==r||10==r?h=107:5==r&&(h=108),h&&c.limit(h,e))return!1;if(c.remove(d,!1),e&&!e.isDead&&e.state&&e.state.hasState(16)&&c.hasState(8)){p.scene;!m&&p.guise&&p.guise.addEffect(7147,0)}var y=c.createState(d);return y.setActionInfo(e,t,i,r,o,s,l),y.createAction(n,null,a),c.addState(y),p.ai.beHurt(e,!1),c.onControlChange(d,v,e),!0}},t.prototype.flyDown=function(e){var t=this,i=113,r=t.owner.beControl,n=t.createState(i);n.setActionInfo(e),n.createAction(),t.addState(n),t.onControlChange(i,r)},t.prototype.onControlChange=function(e,t,i){void 0===i&&(i=null);var r=this,n=r.owner,a=n.beControl;r.isControlState(e)&&(n.buff.dealTrigBuff(16,0,n,i),r.clearDelayTrigAI(),r.delayTrigAIId=n.scene.addCallLater(r.onDelayTrigAI,r,1,!1,!1)),n.hold&&n instanceof Avatar&&(t&&!a||!t&&a)&&App.dispatch("c72")},t.prototype.onDelayTrigAI=function(){var e=this.owner;e&&e.ai&&this.owner.ai.trig(32)},t.prototype.clearDelayTrigAI=function(){var e=this;e.delayTrigAIId&&(e.owner.scene.removeCallLaterIdx(e.delayTrigAIId),e.delayTrigAIId=0)},t.prototype.isControlState=function(e){var t=Data.getItem("StateData",e);return t&&t.isControl},t.prototype.remove=function(e,t){void 0===t&&(t=!0);var i=this,r=i.states[e];if(r){var n=i.owner;if(r.remove(),r.count<=0){var a=r.cfg,o=r.lctime;delete i.states[e],r.onRemove(),r.destroy(),a.mutual&&delete i.mutuals[a.type||0],103==e&&n.setBalanceTime(),a.remove&&a.remove.forEach(function(e){i.remove(e,!1)}),i.actionState==r&&(i.actionState=i.getNewAction()),t&&!i.actionState?n.onFree(e,o):n.hold&&33==e&&!n.beControl&&App.dispatch("c72")}}},t.prototype.updateMutual=function(e){var t=e.cfg.type||0,i=this.mutuals[t];i&&i.state!=e.state&&this.remove(i.state,!1),this.mutuals[t]=e},t.prototype.updateAction=function(e){var t=this.actionState,i=e.cfg.pri||0;i&&(!t||t.cfg.pri<i)&&(this.actionState=e)},t.prototype.onEnterFrame=function(e){this.actionState&&this.actionState.onEnterFrame(e)},t.prototype.stopXuli=function(e,t){this.actionState instanceof SkillState&&this.actionState.stopXuli(e,t)},t.prototype.interrupt=function(e){this.actionState instanceof SkillState&&this.actionState.interrupt(e)},t.prototype.createState=function(e,t){void 0===t&&(t=null);var i=this.states[e];if(!i){var r=Data.getItem("StateData",e),n=t||(r.clsName?egret.getDefinitionByName(r.clsName):null);i=this.states[e]=ObjectPool.pop(n||BaseState),i.initialize(this,e,r)}return i},t.prototype.setTemptInfo=function(e,t){var i=this.states[17];i instanceof TemptState&&i.setActionInfo(e,t)},t.prototype.getState=function(e){return this.states[e]},t.prototype.getNewAction=function(){var e,t=this.states;for(var i in t){var r=t[i];r.cfg.pri&&(!e||r.cfg.pri>e.cfg.pri||r.cfg.pri==e.cfg.pri&&r.addTime>e.addTime)&&(e=r)}return e},t.prototype.hasState=function(e){return!!this.states[e]},t.prototype.limit=function(e,t){void 0===t&&(t=null);var i=Data.getOppItem("StateData",e);if(!i)return!1;for(var r,n=t&&!t.isDead&&t.state?t.state.hasState(16):!1,a=0,o=i;a<o.length;a++){var s=o[a];if((!n||(r=Data.getItem("StateData",s),!r.skip))&&this.hasState(s))return!0}return!1},t.prototype.limitEscape=function(){var e,t=this.states;for(var i in t)if(e=t[i],e.cfg.escape)return!0;return!1},t.prototype.limitMiss=function(){var e,t=this.states;for(var i in t)if(e=t[i],e.cfg.miss)return!0;return!1},t.prototype.clearAll=function(){var e=this,t=[];for(var i in e.states)t.push(e.states[i]);e.states={},t.forEach(function(e){e.destroy()}),e.actionState=null,e.mutuals={}},t.prototype.onDestroy=function(){var e=this;e.owner&&e.owner.scene&&e.owner.scene.removeCallLater(e),e.states&&e.clearAll(),e.states=null,e.mutuals=null,ObjectPool.push(e)},t.hurtActionClss={},t}(GameCom);__reflect(State.prototype,"State"),window.State=State;var Vec2d=function(){function e(){}return e.prototype.reset=function(e,t){this.x=e,this.y=t},e.prototype.length=function(){var e=Fixed.value(this.x).pow(2).value,t=Fixed.value(this.y).pow(2).value;return Fixed.value(e).add(t).sqrt().value},e.prototype.add=function(e,t){var i=Fixed.value(this.x).add(e.x).value,r=Fixed.value(this.y).add(e.y).value;t.reset(i,r)},e.prototype.sub=function(e,t){var i=Fixed.value(this.x).sub(e.x).value,r=Fixed.value(this.y).sub(e.y).value;t.reset(i,r)},e.prototype.dot=function(e){var t=Fixed.value(this.x).mul(e.x).value,i=Fixed.value(this.y).mul(e.y).value;return Fixed.value(t).add(i).value},e.prototype.rotate=function(e,t){var i=this,r=Fixed.cos(e),n=Fixed.sin(e),a=Fixed.value(i.y).mul(n).value,o=Fixed.value(i.y).mul(r).value,s=Fixed.value(i.x).mul(r).sub(a).value,l=Fixed.value(i.x).mul(n).add(o).value;t.reset(s,l)},e.prototype.clone=function(e){e.reset(this.x,this.y)},e}();__reflect(Vec2d.prototype,"Vec2d"),window.Vec2d=Vec2d;var Warn=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.onCreate=function(){var e=this;e.delays={},e.warns={}},t.prototype.onEnterFrame=function(e){var t,i=this,r=i.warns;for(var n in r)t=r[n],t.cfg.time&&t.time<=0?i.onRemoveWarn(t):(t.cfg.time&&(t.time=Fixed.value(t.time).sub(e).value),t.guise&&t.guise.manualEnterFrame());var a=i.delays;for(var n in a)t=a[n],t.delay--,t.delay<=0&&(delete a[n],i.onCreateWarn(t))},t.prototype.onTrigWarn=function(e,t,i,r,n){var a=ObjectPool.pop(BattleWarnInfo);a.setData(e,t,i,r,n),this.warns[a.id]=a,a.delay?this.delays[a.id]=a:this.onCreateWarn(a)},t.prototype.onCreateWarn=function(e){var t=this,i=e.cfg,r=!!i.time,n=e.guise=ObjectPool.pop(MmeRender,"BattleMmeRender");n.load(e.cfg.guise,Urls.effect(),null,null,3),r||(e.callback=t.onRemoveWarn.bind(t,e),e.thisArg=t,n.addEventListener("action_play_end",e.callback,t)),n.playAction(e.cfg.action,e.right?3:7,1,r),n.x=Fixed.value(i.x||0).mul(e.right?1:-1).add(e.x).value,n.y=Fixed.value(e.y).add(i.y||0).value,n.rotation=Fixed.value(i.r||0).mul(e.right?1:-1).value,n.scaleX=i.sx||1,n.scaleY=i.sy||1,t.owner.scene.guise&&t.owner.scene.guise.addWarn(n)},t.prototype.onRemoveWarn=function(e){delete this.warns[e.id],e.dispose()},t.prototype.clearSkillWarn=function(e){var t,i=this.warns,r=this.delays;for(var n in i)t=i[n],t.skillId==e&&t.cfg.clear&&(delete i[n],t.dispose());for(var n in r)t=r[n],t.skillId==e&&t.cfg.clear&&(delete r[n],t.dispose())},t.prototype.clearAllWarn=function(){var e,t=this.warns,i=this.delays;for(var r in t)e=t[r],e.cfg.clear&&(delete t[r],e.dispose());for(var r in i)e=i[r],e.cfg.clear&&(delete i[r],e.dispose())},t.prototype.onDestroy=function(){var e=this,t=e.warns;for(var i in t)t[i].dispose();var r=e.delays;for(var i in r)r[i].dispose();e.warns=null,e.delays=null},t}(GameCom);__reflect(Warn.prototype,"Warn"),window.Warn=Warn;var HitDownAction=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.setActionInfo=function(t,i,r,n,a,o,s){e.prototype.setActionInfo.call(this,t,i,r,n,a,o,s);var l,u,c=this,p=c.owner,d=c.subActions,f=p.props.gv("weight")||1;u=1==o?p.x>=Fixed.value(a[4]||0).mul(i.multiply).add(i.x).value?1:-1:3==o?Fixed.value(p.multiply).neg().value:i.multiply,c.caster=t,c.bullet=i,c.px=a[0]||0,c.py=a[1]||0,c.ctime=Fixed.millisecond(a[2]),c.isSpring=!!a[3],c.dir=o,c.nspy=c.spy=Fixed.value(c.py).div(f).mul(65).value,c.adjust=u,c.spx=Fixed.value(c.px).div(f).mul(c.adjust).mul(65).div(60).value,c.owner.isAir?(l=ObjectPool.pop(DownAction),l.initialize(c,n||"behit_down",r?90:2,0,114,c.isSpring?c.onSpring:null),d.push(l)):n&&(l=ObjectPool.pop(DownAction),l.initialize(c,n,0,0,115,c.isSpring?c.onSpring:null),d.push(l)),c.isSpring&&(c.owner.isAir||c.onSpring(),l=ObjectPool.pop(UpAction),l.initialize(c,"behit_air",2,0,114),d.push(l),l=ObjectPool.pop(DownAction),l.initialize(c,"behit_down",2,0,114),d.push(l));var h=c.state.lctime||c.ctime||Fixed.millisecond(Data.getSValue("HeroData",p.heroId,"lct"));l=ObjectPool.pop(UnderLandAction),l.initialize(c,"behit_land",h?2:0,h,115),d.push(l),l=ObjectPool.pop(UpLandAction),l.initialize(c,"behit_up",0,0,115),d.push(l)},t.prototype.doFrame=function(e,t,i,r,n){var a=this,o=a.owner;i||a.state.com.hasState(115)||o.updatePos(o.scene.limitX(Fixed.value(a.spx).div(n).add(o.ox).value),o.y,o.z,o.right)},t.prototype.next=function(){var e=this;e.subActions.length>0?(e.subAction=e.subActions.shift(),0==e.subActions.length&&e.owner.isDead?e.onAllSubActionEnd():e.subAction.play()):e.onAllSubActionEnd()},t.prototype.onSpring=function(){this.nspy=Fixed.value(this.nspy).neg().mul(.6).value},t.prototype.onDestroy=function(){var t=this;t.px=0,t.py=0,t.ctime=0,t.isSpring=!1,t.spx=0,t.spy=0,t.nspy=0,t.adjust=0,e.prototype.onDestroy.call(this)},t}(HurtAction);__reflect(HitDownAction.prototype,"HitDownAction"),window.HitDownAction=HitDownAction;var RegisterClass=function(){function e(){}return e.registerClass=function(){var e=this;e.initialized||(e.initialized=!0,e.registerEntity(),e.registerState(),e.registerAI(),e.registerPlotStep(),e.registerUI(),e.initPHELink())},e.getCl=function(e){var t=this._clMap[e];return t},e.initPHELink=function(){var e=PHE.define.bind(PHE);e("joinTeam","{linkText:JOIN_TEAM_DUNGEON:%[$0%];%[$1%]}","{/linkText}",["","#ffcc00"])},e.registerEntity=function(){function e(e,t){ServiceMgr.registerEntityClass(e,t)}e("Agent",Agent),e("Avatar",Avatar),e("AvatarAdvRoom",AvatarAdvRoom),e("AncientRoom",AncientRoom),e("Boss",Boss),e("Bullet",Bullet),e("ChampionRoom",ChampionRoom),e("ChampionTwoRoom",ChampionTwoRoom),e("ChaosRoom",ChaosRoom),e("City",City),e("CityAgent",CityAgent),e("CityFruit",CityFruit),e("CityScene",CityScene),e("CrossAccount",CrossAccount),e("CrossPlayer",CrossPlayer),e("Elite",Elite),e("EntertainRoom",EntertainRoom),e("FairyLandRoom",FairyLandRoom),e("FairRoom",FairRoom),e("Fruit",Fruit),e("InfernalHellRoom",InfernalHellRoom),e("LaddersRoom",LaddersRoom),e("Machine",Machine),e("MainCity",MainCity),e("MainRoom",MainRoom),e("MainMultRoom",MainMultRoom),e("MainNoUseItemRoom",MainNoUseItemRoom),e("MainRandomBuffRoom",MainRandomBuffRoom),e("MainTimeLimitRoom",MainTimeLimitRoom),e("Monster",Monster),e("MetalPail",MetalPail),e("NorMonster",NorMonster),e("Npc",Npc),e("OfferRewardRoom",OfferRewardRoom),e("PartyAgent",PartyAgent),e("PartyBossRoom",PartyBossRoom),e("PartyCity",PartyCity),e("PartyWarBRoom",PartyWarBRoom),e("PartyWarGRoom",PartyWarGRoom),e("PartyWarRRoom",PartyWarRRoom),e("PartyWarPRoom",PartyWarPRoom),e("Pet",Pet),e("Player",Player),e("Portal",Portal),e("BattNpc",BattNpc),e("PvPRoom",PvPRoom),e("RCity",RCity),e("RCityAgent",RCityAgent),e("RelayAgent",RelayAgent),e("RelayRoom",RelayRoom),e("RobotAgent",RobotAgent),e("Scene",Scene),e("Sprite",Sprite),e("SumAvatar",SumAvatar),e("TowerRoom",TowerRoom),e("PetSallyRoom",PetSallyRoom),e("FairyLandTrialsRoom",FairyLandTrialsRoom),e("SpiritDreamLandRoom",SpiritDreamLandRoom),e("ItemDungeonRoom",ItemDungeonRoom),e("Trap",Trap),e("GhostKingRoom",GhostKingRoom),e("WorldGhostKingRoom",WorldGhostKingRoom),e("AncientBuildingRoom",AncientBuildingRoom),e("AncientBuildingBossRoom",AncientBuildingBossRoom),e("AncientBuildingWBossRoom",AncientBuildingWBossRoom)},e.registerPlotStep=function(){},e.registerUI=function(){function e(e,i,r){UI.registerUI(e,i,r),t[e]=i}var t=this._clMap={};e("SceneLoadUI",SceneLoadUI),e("CityUI",CityUI),e("NormalBattleUI",NormalBattleUI)},e.registerState=function(){function e(e,t){State.regHurtAction(e,t)}e(0,NormalHurtAction),e(1,AirAction),e(2,FlyAction),e(3,BeatBackAction),e(4,PullPointAction),e(5,HitDownAction),e(7,FollowBulletAction),e(8,BulletLineAction),e(9,PullRowAction),e(10,PullColAction),e(11,PullRotationAction)},e.registerAI=function(){function e(e,t){BaseAI.regAction(e,t)}function t(e,t){BaseAI.regTrig(e,t)}e(1,AIAction_IdleStand),e(2,AIAction_PatrolRange),e(3,AIAction_PatrolDir),e(4,AIAction_Special),e(5,AIAction_CloseTo),e(6,AIAction_FarAwayCircle),e(7,AIAction_BattleStand),e(99,AIAction_CloseToPortal),e(8,AIAction_CloseToY),e(9,AIAction_FarAwayRect),e(10,AIAction_FarAwayBorder),e(11,AIAction_FollowAvatar),e(12,AIAction_MoveToDest),t(1,AITrig_BloodPercent),t(2,AITrig_BloodReduce),t(3,AITrig_BeHurtCount),t(4,AITrig_Base),t(5,AITrig_IntervalTime),t(6,AITrig_AfterTargetDead),t(7,AITrig_Skill),t(8,AITrig_Skill),t(9,AITrig_Bullet),t(10,AITrig_Bullet),t(11,AITrig_Bullet),t(12,AITrig_AddBuff),t(13,AITrig_RemoveBuff),t(14,AITrig_CallPet),t(15,AITrig_PetHideFuse),t(16,AITrig_UnderLandCount),t(17,AITrig_BeingHurt),t(18,AITrig_AvatarBeHurt),t(19,AITrig_BloodReduceTimes),t(20,AITrig_DeadActiveMachine),t(21,AITrig_AfterMachineActive),t(22,AITrig_BuffCollide),t(23,AITrig_BeHurtEnd),t(24,AITrig_CallNextPet),t(25,AITrig_EnterScene),t(26,AITrig_EnteredScene),t(27,AITrig_Base),t(28,AITrig_TargetCollide),t(29,AITrig_TargetUndeadChange),t(30,AITrig_BuffElementLink),t(31,AITrig_ComboCount),t(32,AITrig_Base),t(33,AITrig_PetExeunt),t(34,AITrig_PetEnter),t(35,AITrig_PetFuse),t(36,AITrig_BulletElementLink),t(37,AITrig_PropChange),t(38,AITrig_PetHide),t(39,AITrig_OpenPetKill),t(40,AITrig_AutoUsePetKill)},e.initialized=!1,e}();__reflect(RegisterClass.prototype,"RegisterClass"),window.RegisterClass=RegisterClass;var BatiState=function(e){function t(){return e.call(this)||this}return __extends(t,e),t}(BaseState);__reflect(BatiState.prototype,"BatiState"),window.BatiState=BatiState;var BlindState=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.onAdd=function(){var e=this.owner;e.scene.master==e&&(e.scene.guise&&e.scene.guise.showBlindMask(e),this.showing=!0)},t.prototype.onRemove=function(){var e=this;e.showing&&(e.owner.scene.guise&&e.owner.scene.guise.hideBlindMask(e.owner),e.showing=!1)},t.prototype.onDestroy=function(){var t=this,i=t.owner;t.showing&&(i&&i.scene&&i.scene.guise&&i.scene.guise.hideBlindMask(i),t.showing=!1),e.prototype.onDestroy.call(this)},t}(BaseState);__reflect(BlindState.prototype,"BlindState"),window.BlindState=BlindState;var BloodState=function(e){function t(){return e.call(this)||this}return __extends(t,e),t}(BaseState);__reflect(BloodState.prototype,"BloodState"),window.BloodState=BloodState;var CityPoseState=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.initialize=function(e,t,i,r){void 0===r&&(r=null);var n=this;if(n.isvalid=!0,n.com=e,n.owner=e.owner,n.cfg=i,n.state=t,n.count=0,r){var a=n.action=ObjectPool.pop(AgentAction);a.initialize(n,r,1==i.play)}},t.prototype.onActionEnd=function(){this.owner.state.add(112)},t}(AgentState);__reflect(CityPoseState.prototype,"CityPoseState"),window.CityPoseState=CityPoseState;var CrazyState=function(e){function t(){return e.call(this)||this}return __extends(t,e),t}(BaseState);__reflect(CrazyState.prototype,"CrazyState"),window.CrazyState=CrazyState;var CurseState=function(e){function t(){return e.call(this)||this}return __extends(t,e),t}(BaseState);__reflect(CurseState.prototype,"CurseState"),window.CurseState=CurseState;var DeadState=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.createAction=function(e,t,i,r){void 0===e&&(e=!1),void 0===t&&(t=null),void 0===i&&(i=null),void 0===r&&(r=0/0);var n=this;n.clearAction(),n.action=ObjectPool.pop(DeadAction),n.action.initialize(n),n.action instanceof DeadAction&&n.action.setActionInfo(e,n.cfg.action)},t.prototype.onAdd=function(){this.owner.onDead()},t.prototype.onActionEnd=function(){this.owner.onEndDead()},t}(BaseState);__reflect(DeadState.prototype,"DeadState"),window.DeadState=DeadState;var DizzyState=function(e){function t(){return e.call(this)||this}return __extends(t,e),t}(BaseState);__reflect(DizzyState.prototype,"DizzyState"),window.DizzyState=DizzyState;var ExeuntState=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.createAction=function(e,t,i,r){void 0===e&&(e=!1),void 0===t&&(t=null),void 0===i&&(i=null),void 0===r&&(r=0/0);var n=this;n.clearAction(),n.action=ObjectPool.pop(ExeuntAction),n.action.initialize(n),n.action.setActionInfo(t)},t.prototype.onActionEnd=function(){this.owner.onExeuntEnd()},t}(BaseState);__reflect(ExeuntState.prototype,"ExeuntState"),window.ExeuntState=ExeuntState;var FireState=function(e){function t(){return e.call(this)||this}return __extends(t,e),t}(BaseState);__reflect(FireState.prototype,"FireState"),window.FireState=FireState;var FlyDownState=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.setActionInfo=function(e){this.lctime=e},t.prototype.createAction=function(e,t,i,r){void 0===e&&(e=!1),void 0===t&&(t=null),void 0===i&&(i=null),void 0===r&&(r=0/0);var n=this;n.clearAction(),n.action=ObjectPool.pop(FlyDownAction),n.action.initialize(n),n.action.setActionInfo(0)},t.prototype.onRemove=function(){this.com.remove(114,!1),this.com.remove(115,!1)},t}(BaseState);__reflect(FlyDownState.prototype,"FlyDownState"),window.FlyDownState=FlyDownState;var FronzenState=function(e){function t(){return e.call(this)||this}return __extends(t,e),t}(BaseState);__reflect(FronzenState.prototype,"FronzenState"),window.FronzenState=FronzenState;var FrostState=function(e){function t(){return e.call(this)||this}return __extends(t,e),t}(BaseState);__reflect(FrostState.prototype,"FrostState"),window.FrostState=FrostState;var HurtState=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.initialize=function(t,i,r){e.prototype.initialize.call(this,t,i,r);var n=this.owner;n&&n.ai&&n.ai.trig(17)},t.prototype.setActionInfo=function(e,t,i,r,n,a,o){var s=this;s.caster=e,s.bullet=t,s.type=r,s.attackValues=n,s.dir=a,s.still=o,s.lctime=Fixed.millisecond(i.lctime)},t.prototype.createAction=function(e,t,i,r){void 0===e&&(e=!1),void 0===t&&(t=null),void 0===i&&(i=null),void 0===r&&(r=0/0);var n=this;n.clearAction();var a=State.getHurtAction(n.type)||NormalHurtAction;if(!t&&i){var o=i.length;o&&(t=Fixed.randGet(i,n.owner.scene.seedr))}n.action=ObjectPool.pop(a),n.action.initialize(n),n.action.setActionInfo(n.caster,n.bullet,e,t,n.attackValues,n.dir,n.still)},t.prototype.onRemove=function(){this.com.remove(114,!1),this.com.remove(115,!1);var e=this.owner;e&&e.ai&&e.ai.resetTrig(17)},t.prototype.onDestroy=function(){var e=this;e.caster=null,e.bullet=null,e.type=0,e.attackValues=null,e.dir=0,e.still=null},t}(BaseState);__reflect(HurtState.prototype,"HurtState"),window.HurtState=HurtState;var IdleState=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.onAdd=function(){var e=this.owner,t=e.heroCfg.idleBuff;if(t){var i=e.buff.addBuff(e,0,0,t);i&&(this.buffIdx=i.idx)}},t.prototype.onRemove=function(){this.clearBuff()},t.prototype.clearBuff=function(){var e=this,t=e.owner;e.buffIdx&&(t&&t.buff&&t.buff.removeIdx(e.buffIdx,0,1),e.buffIdx=0)},t.prototype.onDestroy=function(){this.clearBuff()},t}(BaseState);__reflect(IdleState.prototype,"IdleState"),window.IdleState=IdleState;var IgnoreBatiState=function(e){function t(){return e.call(this)||this}return __extends(t,e),t}(BaseState);__reflect(IgnoreBatiState.prototype,"IgnoreBatiState"),window.IgnoreBatiState=IgnoreBatiState;var ImprisonState=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.onAdd=function(){this.owner.standLand()},t}(BaseState);__reflect(ImprisonState.prototype,"ImprisonState"),window.ImprisonState=ImprisonState;var MoState=function(e){function t(){return e.call(this)||this}return __extends(t,e),t}(BaseState);__reflect(MoState.prototype,"MoState"),window.MoState=MoState;var ParalysisState=function(e){function t(){return e.call(this)||this}return __extends(t,e),t}(BaseState);__reflect(ParalysisState.prototype,"ParalysisState"),window.ParalysisState=ParalysisState;var PoisoningState=function(e){function t(){return e.call(this)||this}return __extends(t,e),t}(BaseState);__reflect(PoisoningState.prototype,"PoisoningState"),window.PoisoningState=PoisoningState;var ProtectState=function(e){function t(){return e.call(this)||this}return __extends(t,e),t}(BaseState);__reflect(ProtectState.prototype,"ProtectState"),window.ProtectState=ProtectState;var ReliveState=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.createAction=function(e,t,i,r){void 0===e&&(e=!1),void 0===t&&(t=null),void 0===i&&(i=null),void 0===r&&(r=0/0);var n=this;n.clearAction(),n.action=ObjectPool.pop(ReliveAction),n.action.initialize(n)},t.prototype.onActionEnd=function(){this.owner.onReliveEnd(),e.prototype.onActionEnd.call(this)},t}(BaseState);__reflect(ReliveState.prototype,"ReliveState"),window.ReliveState=ReliveState;var RunState=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.createAction=function(e,t,i,r){void 0===e&&(e=!1),void 0===t&&(t=null),void 0===i&&(i=null),void 0===r&&(r=0/0);var n=this;n.clearAction(),n.cfg.action&&(n.action=ObjectPool.pop(RunAction),n.action.initialize(n),n.action.setActionInfo(t,r))},t.prototype.onAdd=function(){var e=this.owner,t=e.heroCfg.moveBuff;if(t){var i=e.buff.addBuff(e,0,0,t);i&&(this.buffIdx=i.idx)}},t.prototype.onRemove=function(){this.clearBuff()},t.prototype.setActionInfo=function(e,t,i,r,n,a,o){void 0===e&&(e=null),void 0===t&&(t=null),void 0===i&&(i=null),void 0===r&&(r=0),void 0===n&&(n=!0),void 0===a&&(a=0),void 0===o&&(o=0);var s=this;s.dest=e,s.callback=i,s.speedRate=r,s.adjust=n,s.endx=a,s.endy=o,s.target=t},t.prototype.clearBuff=function(){var e=this,t=e.owner;e.buffIdx&&(t&&t.buff&&t.buff.removeIdx(e.buffIdx,0,1),e.buffIdx=0)},t.prototype.onDestroy=function(){this.clearBuff(),ObjectUtils.clearKeys(this,["dest","adjust","endx","endy","speedRate","callback","target"])},t}(BaseState);__reflect(RunState.prototype,"RunState"),window.RunState=RunState;var SealState=function(e){function t(){return e.call(this)||this}return __extends(t,e),t}(BaseState);__reflect(SealState.prototype,"SealState"),window.SealState=SealState;var ShacklesState=function(e){function t(){return e.call(this)||this}return __extends(t,e),t}(BaseState);__reflect(ShacklesState.prototype,"ShacklesState"),window.ShacklesState=ShacklesState;var SilenceState=function(e){function t(){return e.call(this)||this}return __extends(t,e),t}(BaseState);__reflect(SilenceState.prototype,"SilenceState"),window.SilenceState=SilenceState;var SkillState=function(e){function t(){return e.call(this)||this}return __extends(t,e),Object.defineProperty(t.prototype,"move",{get:function(){return this.action.move},enumerable:!0,configurable:!0}),t.prototype.canUseOther=function(e){return this.action.canUseOther(e)},t.prototype.comboing=function(e){return this.action.comboing(e)},t.prototype.szing=function(){return this.action.szing()},t.prototype.setActionInfo=function(e,t,i){var r=this;r.skillInfo=e,r.skillId=t,r.skillCfg=Data.getItem("SkillData",t),r.vampireRate=i},t.prototype.createAction=function(e,t,i,r){void 0===e&&(e=!1),void 0===t&&(t=null),void 0===i&&(i=null),void 0===r&&(r=0/0);var n=this;n.clearAction(),n.action=ObjectPool.pop(SkillAction),n.action.initialize(n)},t.prototype.setStillInfo=function(e){this.action.setStillInfo(e)},t.prototype.stopXuli=function(e,t){this.skillId==e&&this.action.stopXuli(t)},t.prototype.interrupt=function(e){this.action.interrupt(e)},t.prototype.onActionEnd=function(){var e=this,t=e.action.interruptType;t&&2!=t&&1!=t||e.owner.standLand(),e.com.remove(e.state,!e.action.interruptType)},t.prototype.onRemove=function(){var e=this;e.action.removeBuffIdx(1),e.owner.skill.onEndSkill(e.skillInfo,e.skillId,e.skillCfg,e.action.interruptType,e.action.interruptSkip)},t.prototype.onDestroy=function(){var t=this;t.skillInfo=null,t.skillId=0,t.skillCfg=null,t.vampireRate=0,e.prototype.onDestroy.call(this)},t}(BaseState);__reflect(SkillState.prototype,"SkillState"),window.SkillState=SkillState;var SleepState=function(e){function t(){return e.call(this)||this}return __extends(t,e),t}(BaseState);__reflect(SleepState.prototype,"SleepState"),window.SleepState=SleepState;var StoneState=function(e){function t(){return e.call(this)||this}return __extends(t,e),t}(BaseState);__reflect(StoneState.prototype,"StoneState"),window.StoneState=StoneState;var SuperBatiState=function(e){function t(){return e.call(this)||this}return __extends(t,e),t}(BaseState);__reflect(SuperBatiState.prototype,"SuperBatiState"),window.SuperBatiState=SuperBatiState;var TearingState=function(e){function t(){return e.call(this)||this}return __extends(t,e),t}(BaseState);__reflect(TearingState.prototype,"TearingState"),window.TearingState=TearingState;var TemptState=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.createAction=function(e,t,i,r){void 0===e&&(e=!1),void 0===t&&(t=null),void 0===i&&(i=null),void 0===r&&(r=0/0);var n=this;n.clearAction(),n.action=ObjectPool.pop(TemptAction),n.action.initialize(n)},t.prototype.setActionInfo=function(e,t){this.action&&this.action.setActionInfo(e,t)},t.prototype.onAdd=function(){var e=this.owner;e.state.interrupt(4),e.stopMove(),e.ai.stop(),e.standLand()},t}(BaseState);__reflect(TemptState.prototype,"TemptState"),window.TemptState=TemptState;var TenacityState=function(e){function t(){return e.call(this)||this}return __extends(t,e),t}(BaseState);__reflect(TenacityState.prototype,"TenacityState"),window.TenacityState=TenacityState;var ThunderState=function(e){function t(){return e.call(this)||this}return __extends(t,e),t}(BaseState);__reflect(ThunderState.prototype,"ThunderState"),window.ThunderState=ThunderState;var UnAirState=function(e){function t(){return e.call(this)||this}return __extends(t,e),t}(BaseState);__reflect(UnAirState.prototype,"UnAirState"),window.UnAirState=UnAirState;var UnBackState=function(e){function t(){return e.call(this)||this}return __extends(t,e),t}(BaseState);__reflect(UnBackState.prototype,"UnBackState"),window.UnBackState=UnBackState;var UnCallPetState=function(e){function t(){return e.call(this)||this}return __extends(t,e),t}(BaseState);__reflect(UnCallPetState.prototype,"UnCallPetState"),window.UnCallPetState=UnCallPetState;var UndeadState=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.createAction=function(e,t,i,r){void 0===e&&(e=!1),void 0===t&&(t=null),void 0===i&&(i=null),void 0===r&&(r=0/0);var n=this;n.clearAction(),n.action=ObjectPool.pop(UndeadAction),n.action.initialize(n),n.action.setActionInfo(0)},t.prototype.onAdd=function(){var e=this.owner;e.scene.trigAI(20,e),e.scene.trigAI(29,e)},t.prototype.onRemove=function(){this.owner.scene.trigAI(29,this.owner)},t}(BaseState);__reflect(UndeadState.prototype,"UndeadState"),window.UndeadState=UndeadState;var UnDownState=function(e){function t(){return e.call(this)||this}return __extends(t,e),t}(BaseState);__reflect(UnDownState.prototype,"UnDownState"),window.UnDownState=UnDownState;var UnFlyState=function(e){function t(){return e.call(this)||this}return __extends(t,e),t}(BaseState);__reflect(UnFlyState.prototype,"UnFlyState"),window.UnFlyState=UnFlyState;var UnPullState=function(e){function t(){return e.call(this)||this}return __extends(t,e),t}(BaseState);__reflect(UnPullState.prototype,"UnPullState"),window.UnPullState=UnPullState;var WudiState=function(e){function t(){return e.call(this)||this}return __extends(t,e),t}(BaseState);__reflect(WudiState.prototype,"WudiState"),window.WudiState=WudiState;var XianState=function(e){function t(){return e.call(this)||this}return __extends(t,e),t}(BaseState);__reflect(XianState.prototype,"XianState"),window.XianState=XianState;var NativeCon=function(){function e(){this._taskId=0,this._listenerList=new Map,this._callList=new Map}return Object.defineProperty(e,"in",{get:function(){return e._in||(e._in=new e),e._in},enumerable:!0,configurable:!0}),e.prototype.initialize=function(){this.clearAll(),this.addListener("updateBehindDownloadInfo")},e.prototype.addListener=function(e,t,i){var r=this._listenerList.get(e);r||(r=[],egret.ExternalInterface.addCallback(e,this.dispatch.bind(this,e)),this._listenerList.set(e,r)),t&&r.push({handler:t,target:i})},e.prototype.removeListener=function(e,t,i){var r=this._listenerList.get(e);if(r)for(var n=0;n<r.length;n++){var a=this._listenerList[n];if(a==t&&a.target==i)return void r.splice(n,1)}},e.prototype.call=function(e,t){void 0===t&&(t=""),egret.ExternalInterface.call(e,t)},e.prototype.addTimerCall=function(e){var t=0;this._callList.has(e)&&(t=this._callList.get(e)),t++,this._callList.set(e,t),this._checkTimer()},e.prototype.removeTimerCall=function(e){if(this._callList.has(e)){var t=this._callList.get(e)-1;0>=t?this._callList["delete"](e):this._callList.set(e,t)}this._checkTimer()},e.prototype._timerCall=function(){var e=this;this._callList.forEach(function(t,i){e.call(i)})},e.prototype._checkTimer=function(){if(this._callList.size>0){if(this._taskId)return;this._taskId=Date.now(),TimerManager.addCycleTask(1e3,this._timerCall,this,this._taskId)}else this._clearTimer()},e.prototype._clearTimer=function(){this._taskId&&(TimerManager.removeTask(this._taskId),this._taskId=0,this._callList.clear())},e.prototype.dispatch=function(e,t){if(this._listenerList.has(e)){var i=this._listenerList.get(e);
i.forEach(function(e,i){e.target?e.handler.call(e.target,t):e.handler.call(t)})}},e.prototype.clearAll=function(){this._listenerList.forEach(function(e){e=[]}),this._clearTimer()},e}();__reflect(NativeCon.prototype,"NativeCon"),window.NativeCon=NativeCon;var PartyRoomPlayerInfo=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.updatePos=function(e,t,i){this.x=e,this.y=t,this.dir=i},t.prototype.onDispose=function(){ObjectUtils.clearKeys(this,["seeOther","invisibily","x","y","dir","fruitId","agent"]),e.prototype.onDispose.call(this)},t}(GuisePlayerInfo);__reflect(PartyRoomPlayerInfo.prototype,"PartyRoomPlayerInfo",["IPartyRoomPlayerInfo","IBasePlayerInfo"]),window.PartyRoomPlayerInfo=PartyRoomPlayerInfo;var CameraEffectAction=function(){function e(){}return e.prototype.initialize=function(e){var t=this;t.isvalid=!0,t.owner=e,t.os=1,ObjectUtils.clearKeysNum(t,["scaleId","scaleTotalFrame","scaleIndex","moveId","moveTotalFrame","moveIndex","ox","oy","x","y","splashId","splashTotalFrame","splashIndex"])},e.prototype.playAction=function(e,t,i){if(e){var r=Data.getItem("CameraEffectData",t);if(Functor.assert(!!r,"摄像机效果配置不存在："+t),r.scale||r.move||r.splashs&&r.splashs.length){var n=this,a=n.effectCfg;if(!(a&&(a.priority||0)>(r.priority||0))){var o=n.owner.camera;n.caster=e,n.effectCfg=r,n.skillId=i,n.multiply=e.multiply,n.totalFrame=r.total||0,n.cx=e.x,n.lx=o.x+Math.round(.4*o.width),n.rx=o.x+Math.round(.6*o.width),n.playScaleId(r.scale),n.playMoveId(r.move),n.playSplash()}}}},e.prototype.clearAction=function(){var e=this;e.effectCfg=null,e.totalFrame=0,e.scaleId&&e.resetScale(),e.moveId&&e.resetMove(),e.splashId&&e.stopSplash()},e.prototype.onSkillEnd=function(e,t){var i=this;i.caster==e&&i.skillId==t&&i.effectCfg&&i.effectCfg.dependSkill&&i.clearAction()},e.prototype.playScaleId=function(e){var t=this;if(!e)return void(t.scaleId&&t.resetScale());var i=Data.getItem("CameraScaleData",e);return i&&i.datas&&i.datas.length?(t.scaleId=e,t.scaleCfg=i,t.scaleTotalFrame=1,t.scaleIndex=0,void t.onTrigScale()):void(t.scaleId&&t.resetScale())},e.prototype.onTrigScale=function(){var e=this,t=e.scaleCfg.datas,i=e.scaleIndex,r=t[i];r&&r.frame==e.scaleTotalFrame&&(e.playScale(r),t[i+1]?e.scaleIndex=i+1:e.scaleTotalFrame=0)},e.prototype.playScale=function(e){var t=this;if(t.owner.guise){var i=t.owner.guise.scaleContent;e.total=e.total||1,t.isscaling=!0,t.scaleInfo=e,i.anchorOffsetX=i.x=t.caster.x-t.owner.camera.x,i.anchorOffsetY=i.y=t.caster.y-t.owner.camera.y,e.spd=(e.scale-i.scaleX)/e.total||0}},e.prototype.resetScale=function(){var e=this;10!=e.scaleId&&(e.isscaling=!1,e.scaleId=0,e.scaleCfg=null,e.scaleTotalFrame=0,e.scaleIndex=0,e.playScaleId(10))},e.prototype.playMoveId=function(e){var t=this;if(!e)return void(t.moveId&&t.resetMove());var i=Data.getItem("CameraMoveData",e);return i&&i.datas&&i.datas.length?(t.moveId=e,t.moveCfg=i,t.moveTotalFrame=1,t.moveIndex=0,void t.onTrigMove()):void(t.moveId&&t.resetMove())},e.prototype.onTrigMove=function(){var e=this,t=e.moveCfg.datas,i=e.moveIndex,r=t[i];r&&r.frame==e.moveTotalFrame&&(e.playMove(r),t[i+1]?e.moveIndex=i+1:e.moveTotalFrame=0)},e.prototype.playMove=function(e){var t=this;t.ismoving=!0,t.moveInfo=e,e.total=e.total||1;var i=e.x=e.x||0,r=e.y=e.y||0,n=t.multiply,a=t.cx,o=t.lx,s=t.rx;e.noDepend?e.rx=i*n:n>0&&i>0||0>n&&0>i?e.rx=Math.max(a+i*n-s,0):n>0&&0>i||0>n&&i>0?e.rx=Math.min(a+i*n-o,0):e.rx=0,e.ry=r,e.spdx=(e.rx-t.x)/e.total||0,e.spdy=(e.ry-t.y)/e.total||0},e.prototype.resetMove=function(){var e=this;10!=e.moveId&&(e.ismoving=!1,e.moveId=0,e.moveCfg=null,e.moveTotalFrame=0,e.moveIndex=0,e.playMoveId(10))},e.prototype.playSplash=function(){var e=this,t=e.effectCfg.splashs;return t&&t.length?(e.splashTotalFrame=1,e.splashIndex=0,void e.onTrigSplash()):void(e.splashId&&e.stopSplash())},e.prototype.onTrigSplash=function(){var e=this,t=e.effectCfg.splashs,i=e.splashIndex,r=t[i];r&&r.frame==e.splashTotalFrame&&(e.playSplashId(r.splash),t[i+1]?e.splashIndex=i+1:e.splashTotalFrame=0)},e.prototype.playSplashId=function(e){var t=this;t.splashId=e,t.owner.guise&&t.owner.guise.playSplashEffect(t.owner.$eid,e)},e.prototype.stopSplash=function(){var e=this,t=e.owner,i=e.splashId;i&&(t.guise&&t.guise.stopSplashEffect(t.$eid),e.splashId=0,e.splashTotalFrame=0,e.splashIndex=0)},e.prototype.onEnterFrame=function(){var e=this,t=!1;if(e.ismoving){var i=e.moveInfo;e.ox=i.spdx>0?Math.min(e.ox+i.spdx,i.rx):Math.max(e.ox+i.spdx,i.rx),e.oy=i.spdy>0?Math.min(e.oy+i.spdy,i.ry):Math.max(e.oy+i.spdy,i.ry),e.x=Math.round(e.ox),e.y=Math.round(e.oy),e.ox==i.rx&&e.oy==i.ry&&(e.ismoving=!1),t=!0}if(e.isscaling&&e.owner.guise){var r=e.scaleInfo,n=e.owner.guise.scaleContent;e.os=r.spd>0?Math.min(e.os+r.spd,r.scale):Math.max(e.os+r.spd,r.scale),n.scaleX=n.scaleY=NumberUtils.toFixed(e.os,4),e.os==r.scale&&(e.isscaling=!1,1==r.scale&&(n.anchorOffsetX=n.anchorOffsetY=n.x=n.y=0)),t=!0}return e.scaleTotalFrame>0&&(e.scaleTotalFrame++,e.onTrigScale()),e.moveTotalFrame>0&&(e.moveTotalFrame++,e.onTrigMove()),e.splashTotalFrame>0&&(e.splashTotalFrame++,e.onTrigSplash()),e.totalFrame>0&&(e.totalFrame--,0==e.totalFrame&&e.clearAction()),t},e.prototype.destroy=function(){var e=this;e.isvalid&&(ObjectUtils.clearKeys(e,["isvalid","owner","caster","effectCfg","totalFrame","isscaling","scaleCfg","scaleInfo","ismoving","moveCfg","moveInfo"]),ObjectUtils.clearKeysNum(e,["scaleId","scaleTotalFrame","scaleIndex","os","moveId","moveTotalFrame","moveIndex","multiply","cx","lx","rx","ox","oy","x","y","splashId","splashTotalFrame","splashIndex","skillId"]),ObjectPool.push(e))},e}();__reflect(CameraEffectAction.prototype,"CameraEffectAction"),window.CameraEffectAction=CameraEffectAction;var KeyBoard=keyboard.KeyBoard,AttData=Formula.AttData,FormulaData=Formula.FormulaData,Data=function(){function e(){}return e.init=function(){var e=this;e._datas=Config.datas,e._dataDict={},e._effectUid=0;var t=e._opps={};t.AttData={initialized:!1,func:e.genAttData},t.AttDouble={initialized:!1,func:e.genAttData},t.AttMaxValue={initialized:!1,func:e.genAttData},t.AttExprData={initialized:!1,func:e.genAttExpr},t.StateData={initialized:!1,func:e.genStateData},t.RoleAction={initialized:!1,func:e.genActionData},t.EffectAction={initialized:!1,func:e.genActionData},t.AIData={initialized:!1,func:e.genAIData},t.AIActionData={initialized:!1,func:e.genAIActionData},t.SubAIData={initialized:!1,func:e.genSubAIData},e.createOppKeyItem("RoomData","roomName"),e.createOppKeyItem("ComboData","lv"),e.createOppKeyItem("PetData","actItemId","PetActData"),t.FormulaData={initialized:!1,func:e.genFormulaData},t.ItemBySubType={initialized:!1,func:e.genItemData},t.ItemByColor={initialized:!1,func:e.genItemData},t.CompoundBySubType={initialized:!1,func:e.genCompoundData},t.CompoundByMoney={initialized:!1,func:e.genCompoundData},t.CompoundByColor={initialized:!1,func:e.genCompoundData},t.CompoundByItemId={initialized:!1,func:e.genCompoundData},t.CscLaddersData={initialized:!1,func:e.genCscLaddersData},t.PanelData={initialized:!1,func:e.genPanelData},e.createOppKeyItem("RankData","name"),e.createOppKeyItem("JobSkillData","skillId"),e.createOppKeyItem("HeadData","acId"),e.createOppKeyItem("SvrTargetRewardData","rankId"),e.createOppKeyItem("SelfTargetRewardData","rankId"),e.createOppKeyItem("TitleData","acItemId"),e.createOppKeyItem("PanelData","name","PanelData1"),e.createOppKeyItem("SoulCardData","aId");for(var i=this.getData("PanelData"),r={},n=0,a=i;n<a.length;n++){var o=a[n];o.forceHide&&(r[o.name]=!0)}UI.setData(r,Msg.msg(109)),e._cfgs={}},e.getData=function(e){return this._datas[e]||("SystemParams"==e?{}:[])},e.getDict=function(e){var t=this._dataDict;return t[e]||this.decodeData(e),t[e]},e.decodeData=function(e){var t=this.getData(e);if(!t)return void GameLog.error("模版表不存在：",e);if("SystemParams"==e)this._dataDict[e]=t;else{var i={};t.forEach(function(e){i[e.id]=e}),this._dataDict[e]=i}},e.getItem=function(e,t){var i=this.getDict(e);return i[t]},e.getItemAtt=function(e,t,i){var r=this.getItem(e,t);return r?r[i]:null},e.getSItem=function(e,t){var i,i=Config.special[e];return i?Config.getyihuo(i[t]):null},e.getSValue=function(e,t,i){var r,r=Config.special[e];return r&&r[t]?Config.getyihuo(r[t][i]):null},e.getOppData=function(e){var t=this._opps[e];return t&&!t.initialized&&t.func.apply(this),t?t.data:{}},e.getOppItem=function(e,t){var i=this.getOppData(e);return i&&i[t]?i[t]:"ItemBySubType"===e||"ItemByColor"===e?[]:{}},e.getOppSub=function(e,t,i){var r=this.getOppItem(e,t);return r?r[i]:null},e.genAttData=function(){var e=this._opps.AttData,t=this._opps.AttDouble,i=this._opps.AttMaxValue,r=e.data={},n=t.data={},a=i.data={};e.initialized=t.initialized=i.initialized=!0;var o=this.getData("AttData");o.forEach(function(e){n[e.id]=n[e.name]=r[e.name]=e});for(var s=0,l=o;s<l.length;s++){var u=l[s];if(u.maxKey){var c=n[u.maxKey];u.depend=u.depend||[],-1==u.depend.indexOf(c.name)&&u.depend.push(c.name)}if(u.propAdd){var p=n[u.propAdd];u.depend=u.depend||[],-1==u.depend.indexOf(p.name)&&u.depend.push(p.name)}if(u.depend)for(var d=0,f=u.depend;d<f.length;d++){var h=f[d],v=r[h];v&&(v.affects=v.affects||{},v.affects[u.name]=1)}if(u.maxKey){var c=n[u.maxKey],m=a[c.name]=a[c.name]||[];m.push(u.name)}}},e.genAttExpr=function(){var e=this._opps.AttExprData,t=e.data={};e.initialized=!0,AttData.forEach(function(e){t[e.id]=e})},e.expr=function(t,i){var r=e.getOppItem("AttExprData",t),n=r&&r.exprts;return n?n.apply(i,[i]):0},e.expr_d=function(t,i){var r=e.getOppItem("AttExprData",t),n=r&&r.exprd;return n?n.apply(i,[i]):0},e.genActionData=function(){var e=this._opps.RoleAction,t=this._opps.EffectAction,i=e.data={},r=t.data={};e.initialized=t.initialized=!0;for(var n=this.getData("ActionData"),a=function(e){e.dic||(e.dic={});var t=e.actions;t.forEach(function(t){e.dic[t.action]=t}),2==e.type?r[e.res]=e:i[e.res]=e},o=0,s=n;o<s.length;o++){var l=s[o];a(l)}},e.createOppItem=function(e,t,i){var r={initialized:!1,func:t},n=this;return n._opps[i||e]=r,r},e.createOppKeyItem=function(e,t,i){var r=this.createOppItem(e,Functor.functorLeft(this.createKeyMap,this,e,t,i),i);return r},e.genPanelData=function(){var t=this._opps.PanelData,i=t.data={};t.initialized=!0;var r=e.getData("PanelData");r.forEach(function(e){void 0!==e.index&&-1!=e.index?i[e.name+":"+e.index]=e:i[e.name]=e})},e.createKeyMap=function(e,t,i){var r=this,n=r._opps[i||e],a=n.data={};n.initialized=!0;var o=r.getData(e);o.forEach(function(e){a[e[t]]=e})},e.genStateData=function(){var e=this._opps.StateData,t=e.data={};e.initialized=!0;for(var i=this.getData("StateData"),r=0,n=i;r<n.length;r++){var a=n[r];if(a.unstate)for(var o=0,s=a.unstate;o<s.length;o++){var l=s[o],u=t[l]=t[l]||[];u.push(a.state)}}},e.genFormulaData=function(){var e=FormulaData,t={},i=this._opps.FormulaData;i.initialized=!0;for(var r in e)t[e[r].id]=e[r];i.data=t},e.genItemData=function(){},e.genCompoundData=function(){},e.genAIData=function(){var t=this._opps.AIData,i=t.data={};t.initialized=!0;var r=e.getData("AIData");r.forEach(function(e){i[e.id]=e,e.weight=0,e.subs&&e.subs.forEach(function(t){t.total=e.weight,e.weight+=t.weight||0})})},e.genAIActionData=function(){var t=this._opps.AIActionData,i=t.data={};t.initialized=!0;var r=e.getData("AIActionData");r.forEach(function(e){i[e.id]=e,e.weight=0,e.actions&&e.actions.forEach(function(t,i){t.total=e.weight,e.weight+=t.weight||0,(5==t.type||8==t.type)&&(e.closeToIndex=i,e.closeToItem=t)})})},e.genSubAIData=function(){var t=this._opps.SubAIData,i=t.data={};t.initialized=!0;var r=e.getData("SubAIData");r.forEach(function(e){i[e.id]=e,e.weight=0,0==(e.type||0)&&e.skillList&&e.skillList.forEach(function(t){t.total=e.weight,e.weight+=t.weight||0})})},e.genCscLaddersData=function(){var t=this._opps.CscLaddersData,i=t.data={};t.initialized=!0;var r,n=e.getData("CscLaddersData");n.forEach(function(e){r=i[e.id]={},e.datas&&e.datas.forEach(function(e){r[e.id]=e})})},e.getLvListValue=function(e,t,i){if(!e)return i;var r=e.length,n=t-1;return n>=0&&r>n?e[n]||i:e[r-1]||i},e.getLvIndexValue=function(e,t,i){if(!e)return i;var r=e.length;return t>=0&&r>t?e[t]||i:e[r-1]||i},e.getLvBaseValue=function(e,t,i,r){if(!e)return r;var n=e.length,a=Fixed.value(t).div(i||1).ceil().sub(1).value;return a>=0&&n>a?e[a]||r:e[n-1]||r},e.getSkillDesc=function(e,t,i,r,n,a){void 0===i&&(i=!0);var o=this.getItem("SkillData",e),s=this.getSkillDescInfo(e,t,{});if(i){if(a)for(var l in s)if(s[l]&&/^(a_)\S*(damage_added)$/.test(l)){var u=s[l];u=u.replace("（+","").replace("）",""),s[l]=PHE.format(a,[u])}}else for(var l in s)/^(a_)/.test(l)&&(s[l]="");if(n)for(var l in n)s[l]=n[l];var c=o.desc;return 1===r?c=c.replace(/34ff6d/g,"22A377"):"string"==typeof r&&(c=c.replace(/34ff6d/g,r)),PHE.format(c,s)},e.getSkillUpDesc=function(e,t){var i=this.getItem("SkillData",e),r=this.getSkillDescInfo(e,t,{});return PHE.format(i.upDesc,r)},e.getSkillWord=function(e){var t=this.getItem("SkillData",e);return t.word||""},e.getUseItemDesc=function(e){var t=this,i={},r=t.getItem("ItemData",e),n=r.desc||"";if(!r.bUseEff)return n;var a=t.getItem("RoomItemUseData",r.bUseEff),o=a.buff||[];return o.forEach(function(e){t.getBuffDescInfo(e.id,e.lv,i)}),PHE.format(n,i)},e.getUseItemProps=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var i=this,r={};return e.forEach(function(e){e instanceof Array?e.forEach(function(e){i.addUseItemProp(r,e)}):i.addUseItemProp(r,e)}),ObjectUtils.getValues(r)},e.addUseItemProp=function(e,t){var i=this,r=i.getItem("ItemData",t);if(r.bUseEff){var n=i.getItem("RoomItemUseData",r.bUseEff),a=n.buff||[];a.forEach(function(t){for(var r=i.getItem("BuffData",t.id),n=t.lv||1,a=r.added||[],o=0,s=a.length;s>o;o++){var l=a[o];if(l.attr){var u=e[l.attr];u||(u=e[l.attr]={name:l.attr,val:0}),u.val=Math.floor(1e3*(u.val+i.getLvBaseValue(l.value,n,l.base,0)))/1e3}}})}},e.getBuffDesc=function(e,t,i,r,n,a){if(void 0===t&&(t=1),void 0===i&&(i=!0),void 0===r&&(r=1),!e)return"";var o=this.getItem("BuffData",e),s=this.getBuffDescInfo(e,t,{},"",r);if(!i)for(var l in s)/^(a_)/.test(l)&&(s[l]="");if(a)for(var l in a)s[l]=a[l];var u=o.desc;return 1===n&&(u=u.replace(/34ff6d/g,"22A377")),PHE.format(u,s)},e.getSkillDescInfo=function(e,t,i){var r=this,n=r.getItem("SkillData",e),a=t+1;i=i||{},i.cd=r.getLvBaseValue(n.cd,t,n.cdb,0),i.n_cd=r.getLvBaseValue(n.cd,a,n.cdb,0),i.av_cd=Math.ceil(100*(i.n_cd-i.cd))/100,i.a_cd=i.av_cd?"（+"+i.av_cd+"）":"";var o=r.getOppItem("AttDouble",n.utype);if(i.utype=i.n_utype=i.a_utype=o.cname,i.mp=r.getLvBaseValue(n.mp,t,n.mpb,0),i.n_mp=r.getLvBaseValue(n.mp,a,n.mpb,0),i.av_mp=i.n_mp-i.mp,i.a_mp=i.av_mp?"（+"+i.av_mp+"）":"",n.ebuff&&n.ebuff.forEach(function(e,n){r.getBuffDescInfo(e,t,i,"ebuff_"+n+"_")}),n.at)for(var s=n.at,l=function(e){var n=e+1,a=s[e];a.buff&&a.buff.forEach(function(e){r.getBuffDescInfo(e,t,i,"at_"+n+"_buff_")}),a.tid&&r.getBulletDescInfo(a.tid,t,i,"at_"+n+"_bid_buffs_buff_"),a.tids&&a.tids.forEach(function(e){r.getBulletDescInfo(e,t,i,"at_"+n+"_bid_buffs_buff_")})},u=0;u<n.at.length;u++)l(u);return i},e.getBulletDescInfo=function(e,t,i,r){void 0===r&&(r="");for(var n=this,a=n.getItem("BulletTrigData",e),o=n.getItem("BulletData",a.bid),s=o.buffs||[],l=0,u=s;l<u.length;l++){var c=u[l];c.buff&&n.getBuffDescInfo(c.buff,t,i,r),c.sbuff&&n.getBuffDescInfo(c.sbuff,t,i,r),c.dbuff&&c.dbuff.forEach(function(e){n.getBuffDescInfo(e,t,i,r)})}o.etids&&o.etids.forEach(function(e){n.getBulletDescInfo(e,t,i,r)}),o.trigs&&o.trigs.forEach(function(e){e.ids&&e.ids.forEach(function(e){n.getBulletDescInfo(e,t,i,r)})})},e.getBuffDescInfo=function(e,t,i,r,n){function a(e,i,r,n,a,o){for(var s=1;A>=s;++s){var l=r(e,s,"v"+s+"_"+i);e["v"+s+"_"+i]=l;var u=o?l+"%":""+l;s===t?(e[i]=l,e[i+"_percent"]=u):s===_&&(e["n_"+i]=l,e["n_"+i+"_percent"]=u),s===w?e["vc"+s+"_"+i]=u:e["vc"+s+"_"+i]=HtmlUtils.color(5921370,u)}o&&(e["d_"+i]="%"),e["av_"+i]=n(e,"n_"+i,i),e["a_"+i]=a(e,"av_"+i),e["diff_"+i]=n(e,"v"+t+"_"+i,"v1_"+i),e["neg_d_"+i]=n(e,"v1_"+i,"v"+t+"_"+i)}function o(e,i,r){for(var n=1;A>=n;++n)e["vc"+n+"_"+i]=e["v"+n+"_"+i]=r,n===t?e[i]=r:n===_&&(e["n_"+i]=r);e["av_"+b]=e["a_"+b]=e["diff_"+b]=e["neg_d_"+b]=e["vc_"+b]=r}function s(e,t,i){return Math.floor(100*x.getLvBaseValue(I.derate,t,I.debase,0)*10)/10}function l(e,t,i){return Math.floor(100*(e[t]-e[i]))/100}function u(e,t){return e[t]?"（+"+e[t]+"%）":""}function c(e,t,i){return x.getLvBaseValue(I.duration,t,I.durbase,0)}function p(e,t,i){return Math.floor(100*(e[t]-e[i]))/100}function d(e,t){return e[t]?"（+"+e[t]+"）":""}function f(e,t,i){return Math.floor(10*((e[i]||0)+100*x.getLvBaseValue(S.drate,t,S.dbase,0)))/10}function h(e,t,i){return Math.floor(1e3*(e[t]-e[i]))/1e3}function v(e,t){return e[t]?"（+"+e[t]+"%）":""}function m(e,t,i){return Math.floor(10*((e[i]||0)+x.getLvBaseValue(S.added,t,S.addedb,0)))/10}function y(e,t,i){return Math.floor(10*(e[t]-e[i]))/10}function g(e,t){return e[t]?"（+"+e[t]+"）":""}void 0===r&&(r=""),void 0===n&&(n=1);var b,x=this,I=x.getItem("BuffData",e),_=t+1,S=I.damage||{},T=I.added||[],w=t;t=t||1,i=i||{},n=n||1;var A=Math.max(5,_);if(b=r+"damage_derate",a(i,b,s,l,u,!0),b=r+"damage_duration",a(i,b,c,p,d,!1),b=r+"damage_dattr",S.dattr&&!i[b]){var P=x.getOppItem("AttDouble",S.dattr);o(i,b,P.cname||"")}b=r+"damage_drate",a(i,b,f,h,v,!0),b=r+"damage_added",a(i,b,m,y,g,!1);for(var C=function(e,t){var s=e+1,l=T[e];if(b=r+"added_"+s+"_attr",l.attr){var u=x.getOppItem("AttDouble",l.attr);i[b]||o(i,b,u.cname||""),b=r+"added_"+s+"_value";var c=function(e,t,i){return Math.abs(Math.floor(100*((e[i]||0)+PropUtils.percent(x.getLvBaseValue(l.value,t,l.base,0)*n,l.attr)))/100)},p=function(e,t,r){return Math.floor(100*(i[t]-i[r]))/100},d=function(e,t){return e[t]?"（+"+i[t]+(u.feature?"%":"")+"）":""};a(i,b,c,p,d,!!u.feature)}if(b=r+"added_"+s+"_dattr",l.dattr){if(!i[b]){var f=x.getOppItem("AttDouble",l.dattr);o(i,b,f.cname||"")}b=r+"added_"+s+"_drate";var h=function(e,t,i){return(e[i]||0)+Math.floor(x.getLvBaseValue(l.drate,t,l.dbase,0)*n*1e3)/10},v=function(e,t,r){return Math.floor(100*(e[t]-i[r]))/100},m=function(e,t){return e[t]?"（+"+e[t]+"%）":""};a(i,b,h,v,m,!0)}},D=0,B=T.length;B>D;D++)C(D,B);var k=I.isTrig;if(k&&I.trig){var E=I.trig;b=r+"trig_rate";var R=function(e,t,i){return Math.floor(100*x.getLvListValue(E.rate,t,1)*10)/10},F=function(e,t,i){return Math.floor(100*(e[t]-e[i]))/100},M=function(e,t){return e[t]?"（+"+e[t]+"%）":""};a(i,b,R,F,M,!0),b=r+"trig_cd";var L=function(e,t,i){return x.getLvListValue(E.cd,t,0)},U=function(e,t,i){return Math.abs(Math.floor(100*(e[t]-e[i]))/100)},O=function(e,t){return e[t]?"（+"+e[t]+"）":""};a(i,b,L,U,O,!1),E.param&&(b=r+"trig_param_",E.param.forEach(function(e,t){i[b+(t+1)]=e?e+"":""}));var N=E.buff;N&&N.forEach(function(e,a){x.getBuffDescInfo(e,t,i,r+"trig_"+(a+1)+"_",n)}),E.btid&&x.getBulletDescInfo(E.btid,t,i,r+"trig_btid_")}return i},e.getEquipSkillDesc=function(e,t,i,r){void 0===i&&(i=!1);var n=this,a=n.getItem("SkillForceData",e),o=this.getEquipSkillDescInfo(e,t,{});if(i){if(r)for(var s in o)if(o[s]&&/^(n_)/.test(s)){var l=o[s].toString();l.indexOf("（")>=0&&(l=l.replace("（+","").replace("）","")),o[s]=PHE.format(r,[l])}}else for(var s in o)/^(n_)/.test(s)&&(o[s]="");var u=a.desc;return PHE.format(u,o)},e.getEquipSkillDescInfo=function(e,t,i,r){void 0===r&&(r="");var n=this,a=n.getItem("SkillForceData",e);t=t||0;var o=t+1,s=a.datas[t];i=i||{};for(var l=0,u=function(){var e=t+l,r=l?"n_":"";if(a.damage.forEach(function(t,n){var a=t.value&&t.value[e]?Math.floor(1e3*t.value[e])/10:0;i[r+"damage_"+(n+1)+"_value"]=a?a:"",i[r+"damage_"+(n+1)+"_value_percent"]=a?a+"%":"",t.state&&(i[r+"damage_"+(n+1)+"_state"]=t.state),t.grade&&(i[r+"damage_"+(n+1)+"_grade"]=t.grade)}),a.n){var n=Object.keys(a.n);n.forEach(function(t){var n=a.n[t][e]||0;n=Math.floor(1e3*n)/10,i[""+(r+t)]=n,i[r+t+"_percent"]=n+"%"})}l++};o-t>=l;)u();if(a.bfArr&&s){var c=s.bfLv;a.bfArr.forEach(function(e,t){n.getBuffDescInfo(e,c,i,r+"buff_"+(t+1)+"_")})}return i},e.getMonsterHpNum=function(e,t){if(100>e)return 1;var i=this.getSysValue("BOSS_HP_NUM");for(var r in i){var n=i[r];if(n.min<=t&&(n.max>t||0==n.max))return n.num}return 1},e.getEffectUid=function(){return this._effectUid+=1},e.getSysValue=function(t){return this.systemParam||(this.systemParam=e.getData("SystemParams")),this.systemParam[t]},e.getSysValueItem=function(e,t){var i=this.getSysValue(e);return i?i[t]:void 0},e.getEntranceIcon=function(e){return this.getSysValueItem("REWARD_ENTRANCE_BTN",e)},e.getUIConfig=function(t,i){if(void 0===i&&(i=!0),t){var r;r=t.vo&&t.vo.className?t.vo.className:t.className;var n;if(i&&"function"==typeof t.getTabIdx){var a=t.getTabIdx();n=-1!=a?r+":"+a:r+""}var o;return n&&(o=e.getOppItem("PanelData",n)),o&&0!=Object.keys(o).length||(o=e.getOppItem("PanelData",r)),o||""}},e.getAttCfg=function(e){return"number"==typeof e?this.getItem("AttData",e):this.getOppItem("AttData",e)},e.getAttrIdByName=function(t){var i=e.getOppItem("AttData",t);return i?i.id:0},e.getAttVo=function(e,t){var i={name:"",cname:"",des:"",val:t,id:0},r=this.getAttCfg(e);return r?(i.id=r.id,i.name=r.name,i.cname=r.cname,i.des=PropUtils.percentStr(i.val,i.name)):GameLog.error("Can not find attCfg of attr == "+e),i},e.parseDescAttrTypes=function(t){if(t){for(var i=[],r=[],n=void 0,a=void 0,o=0,s=t.length;s>o;o++)a=t[o],n=e.getAttVo(a.property,a.value),i[o]=n.cname,r[o]="+"+n.des;return[i,r]}},e.parseDescAttrTypesToIAttrVos=function(t){if(t){for(var i=[],r=void 0,n=void 0,a=0,o=t.length;o>a;a++)n=t[a],r=e.getAttVo(n.property,n.value),i[a]=r;return i}},e.multiAttrType=function(e,t,i){i||(i=[]);for(var r,n=0,a=e;n<a.length;n++){var o=a[n];r={};for(var s in o)r[s]=o[s];r.value*=t,i.push(r)}return i},e.compAttrs=function(e){var t=[];if(e&&e.length>0)if(1==e.length)t=e[0];else{var i,r=new HashMap;e.forEach(function(e){e.forEach(function(e){i=r.getValue(e.name),i?i.val+=e.val:(i={name:e.name,val:e.val},r.add(i.name,i))})}),r.valueSet.forEach(function(e,i){t[i]=e})}return t},e.getChangeAttrMap=function(e,t){var i,r,n=this,a=new HashMap,o=new HashMap,s=new HashMap,l=new HashMap;e.forEach(function(e){l.hasKey(e.name)||l.add(e.name,e.name),o.add(e.name,e)}),t.forEach(function(e){l.hasKey(e.name)||l.add(e.name,e.name),s.add(e.name,e)});var u;return l.valueSet.forEach(function(e){r=s.getValue(e),i=o.getValue(e),u=n.getAttVo(e,(r?r.val:0)-(i?i.val:0)),a.add(e,u)}),a},e.getZeroAttrs=function(e){var t=[];return e.forEach(function(e,i){t[i]={name:e.name,val:0}}),t},e.parseCfgProp=function(e,t){t?t.length=0:t=[];var i=this;return e.forEach(function(e){e&&e.name&&t.push(i.getAttVo(e.name,e.val))}),t},e.regName=function(e,t){this._names[e]=t},e.getStaticVo=function(e,t){var i=this._cfgs[e+"_"+t];if(!i){var r=this.getItem(e,t);if(r){var n=this._names[e];n&&(i=new n(r),this._cfgs[e+"_"+t]=i)}}return i},e.changeData=function(e,t,i){var r=this.getDict(e),n=this.getData(e);if(r&&n){var a=r[t];if(a&&n instanceof Array){var o=n.indexOf(a);o>=0&&n.splice(o,1)}r[t]=i,n instanceof Array&&n.push(i);var s=this._opps[e];s&&(s.initialized=!1),App.dispatch("c1",{tableName:e,key:t,value:i})}},e.exprts=function(e){for(var t=[],i=1;i<arguments.length;i++)t[i-1]=arguments[i];var r=this.getOppItem("FormulaData",e);return r&&"exprts"in r?r.exprts.apply(r,t):null},e.exprd=function(e){for(var t=[],i=1;i<arguments.length;i++)t[i-1]=arguments[i];var r=this.getOppItem("FormulaData",e);return r&&"exprd"in r?r.exprd.apply(r,t):null},e.getElementName=function(e){switch(e){case 5:return Msg.msg(556);case 4:return Msg.msg(555);case 1:return Msg.msg(552);case 3:return Msg.msg(554);case 2:return Msg.msg(553)}},e.isNormalSkill=function(t){var i=e.getItem("SkillData",t);return i&&0==(i.type||0)},e.isEnterSkill=function(t){var i=e.getItem("SkillData",t);return i&&5==(i.type||0)},e.getPartyWarGradeItem=function(e){for(var t=this._datas.PartyWarGradeData,i=0,r=t;i<r.length;i++){var n=r[i];if((!n.hScore||e>=n.hScore)&&(!n.lScore||e<=n.lScore))return n}return t[0]},e.getCityConvEmotion=function(){var t=e.getData("CityConvData"),i=[];return t instanceof Array&&t.forEach(function(e){1==e.type&&i.push(e)}),i},e.getCityConvAction=function(){var t=e.getData("CityConvData"),i=[];return t instanceof Array&&t.forEach(function(e){2==e.type&&i.push(e)}),i},e.getGhostKingLvStarData=function(t,i){for(var r=e.getData("GhostKingLvStarData"),n=r[0],a=n.datas[0],o=0,s=r;o<s.length;o++){var l=s[o];if(l.id>t)break;n=l}if(n){var u=n.datas,c=ArrayUtils.find(u,i,"star");a=u[c]}return a},e.getBossAbility1=function(t,i){var r=this.getGhostKingLvStarData(t,i);if(!r)return 0;var n=e.getItem("GhostKingTroubledData",1001);if(!n||!n.aFun)return 0;var a=e.exprd(n.aFun,r.ability,r.factor,t);return a},e._names={},e}();__reflect(Data.prototype,"Data"),window.Data=Data;var NormalHurtAction=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.setActionInfo=function(t,i,r,n,a,o,s){e.prototype.setActionInfo.call(this,t,i,r,n,a,o,s);var l=this,u=Fixed.millisecond(a[0]),c=ObjectPool.pop(SubAction);c.initialize(l,n||"behit_stand",u?r?90:2:0,u,l.owner.isAir?114:0),l.subActions.push(c)},t}(HurtAction);__reflect(NormalHurtAction.prototype,"NormalHurtAction"),window.NormalHurtAction=NormalHurtAction;var HashArray=function(){function e(){this._obj={},this._array=[],this._key=[]}return e.prototype.add=function(e,t){if(this.hasKey(e)){var i=this._key.indexOf(e);this._array[i]=t}else this._key[this._array.length]=e,this._array.push(t);this._obj[e]=t},e.prototype.hasKey=function(e){return e in this._obj},e.prototype.getValue=function(e){return this._obj[e]},e.prototype.removeKey=function(e){var t;if(this.hasKey(e)){t=this._obj[e],delete this._obj[e];var i=this._key.indexOf(e);i>-1&&(this._array.splice(i,1),this._key.splice(i,1))}return t},e.prototype.getMap=function(){return this._obj},Object.defineProperty(e.prototype,"valueSet",{get:function(){return this._array.concat()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"keySet",{get:function(){return this._key.concat()},enumerable:!0,configurable:!0}),e.prototype.clear=function(){this._obj={},this._array.length=0,this._key.length=0},Object.defineProperty(e.prototype,"length",{get:function(){return this._array.length},enumerable:!0,configurable:!0}),e.prototype.getIndex=function(e){return this._key.indexOf(e)},e.prototype.getLast=function(){return this._array[this._array.length-1]},e}();__reflect(HashArray.prototype,"HashArray"),window.HashArray=HashArray;var PullColAction=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.setActionInfo=function(t,i,r,n,a,o,s){e.prototype.setActionInfo.call(this,t,i,r,n,a,o,s);var l,u=this,c=u.owner,p=u.subActions,d=Fixed.millisecond(a[0]),f=!a[5],h=Fixed.value(a[7]||0).mul(i.multiply).add(i.x).value;u.time=u.cstime=u.disx=u.lastDisx=u.disz=u.lastDisz=0,u.ttime=d,u.ctime=Fixed.millisecond(a[1]),u.stime=Fixed.millisecond(a[8]),u.disx=Fixed.value(h).sub(c.x).abs().value,u.disz=a[6]?0:Fixed.value(c.z).neg().value,u.multiply=c.x>h?-1:1,u.stopDis=a[2]||0,u.useWeight=!a[4],d||(f=!0),u.depend=f,f&&i.addListener("onRemoved",u.onBulletRemoved,u),l=ObjectPool.pop(SubPullColAction),l.initialize(u,n||"behit_stand",r?90:2,d,u.owner.isAir?114:0),p.push(l)},t.prototype.onBulletRemoved=function(){this.onAllSubActionEnd()},t.prototype.onDestroy=function(){var t=this;t.depend&&t.bullet.removeListener("onRemoved",t.onBulletRemoved,t),t.ttime=0,t.ctime=0,t.time=0,t.stime=0,t.cstime=0,t.disx=0,t.disz=0,t.lastDisx=0,t.lastDisz=0,t.stopDis=0,t.useWeight=!1,t.depend=!1,e.prototype.onDestroy.call(this)},t}(HurtAction);__reflect(PullColAction.prototype,"PullColAction"),window.PullColAction=PullColAction;var ConstD=function(){function e(){}return e.getRoleNameLv=function(e){return e=e||{name:"",level:0},e.name+" Lv."+e.level},e.getRoleNameLv2=function(e,t){return e+" Lv."+t},e.parseActionData=function(e){e&&!e.initialized&&(e.pos=Functor.parse(e.pos)||{},e.aps=Functor.parse(e.aps)||{},e.events=Functor.parse(e.events)||{},MmeUtils.initActionData(e))},e.createDamageFont=function(e,t,i,r,n){var a=ObjectPool.pop(DamageBitmapLabel);return a.font="damage_fnt",a.letterSpacing=-3,a.touchEnabled=!1,a.x=e,a.y=t,a.factor=n,a.alpha=r,a.scaleX=a.scaleY=i,a.visible=!0,a},e.createDamageLabel=function(e,t,i,r,n,a,o,s,l){var u=ObjectPool.pop(DamageLabel);return u.textColor=o,u.size=a,u.stroke=s,u.strokeColor=l,u.touchEnabled=!1,u.x=e,u.y=t,u.factor=n,u.alpha=r,u.scaleX=u.scaleY=i,u.visible=!0,u},e.getRankFont1=function(e){return 1==e?"F":2==e?"S":3==e?"T":e+""},e.getRankFont2=function(e){return 1==e?"F":2==e?"S":3==e?"T":"第"+e+"名"},e.transRaceScore=function(e){var t=Data.getSysValue("PARTY_WAR_PLAY_RACE_DISTINCE")||1,i=Math.min(Math.ceil(e/10),t);return i>=t&&(i=1.2*i),i},e}();__reflect(ConstD.prototype,"ConstD"),window.ConstD=ConstD;var DebugStatic=function(){function e(){}return Object.defineProperty(e,"isRecordLockStep",{get:function(){return!0},enumerable:!0,configurable:!0}),e.dps=function(e,t,i){var r=this,n=!1,a=egret.getTimer();if(t){var o=Data.getItem("SkillData",t);n=0!=o.type}e instanceof Avatar?(r.totalDamage+=i,r.avatarDPS=Math.ceil(r.totalDamage/((a-r.startTime)/1e3)),n?r.skillDamage+=i:r.normalDamage+=i):e instanceof Pet&&(r.petTotalDamage+=i,r.petDPS=Math.ceil(r.petTotalDamage/((a-r.petStartTime)/1e3))),App.dispatch("c77")},e.resetPetDps=function(){this.petStartTime=egret.getTimer(),this.petDPS=0},e.resetDps=function(){var e=this;e.totalDamage=0,e.normalDamage=0,e.skillDamage=0,e.avatarDPS=0,e.petTotalDamage=0,e.petDPS=0,e.startTime=e.petStartTime=egret.getTimer()},e.drog=function(e){this._dis||App.stage.addEventListener(Evt.touchBegin,this.onDrogBegin,this),this._dis=e,e.touchEnabled=!0},e.onDrogBegin=function(e){App.stage.removeEventListener(Evt.touchMove,this.onDrogMove,this),App.stage.removeEventListener(Evt.touchEnd,this.onDrogEnd,this),this._x=e.stageX-this._dis.x,this._y=e.stageY-this._dis.y,App.stage.addEventListener(Evt.touchMove,this.onDrogMove,this),App.stage.addEventListener(Evt.touchEnd,this.onDrogEnd,this)},e.onDrogMove=function(e){var t=e.stageX-this._x,i=e.stageY-this._y;isNaN(this._dis.left)?this._dis.x=t:this._dis.left=t,isNaN(this._dis.top)?this._dis.y=i:this._dis.top=i},e.onDrogEnd=function(){App.stage.removeEventListener(Evt.touchMove,this.onDrogMove,this),App.stage.removeEventListener(Evt.touchEnd,this.onDrogEnd,this),console.log("drog",this._dis.x,this._dis.y)},e.startStatistics=function(e){if(void 0===e&&(e=1),!this.statisticsId){e=e||1;var t=egret.$hashCount;this.statisticsId=setInterval(function(){var e=egret.$hashCount;t=e},1e3*e)}},e.stopStatistics=function(){this.statisticsId&&(clearInterval(this.statisticsId),this.statisticsId=0)},e.debug=!1,e.damage={},e.isShowRect=!1,e.showTrapNum=0,e.isOpenFrameOper=!1,e.isVideo=!1,e.isOpenMonsterAI=!0,e.isOpenMonsterTrig=!0,e.isOpenPetAI=!0,e.isOpenPeTrig=!0,e.petTime=0,e.monsterIndex=0,e.battleEffectId=0,e.isOpenDPS=!1,e.totalDamage=0,e.normalDamage=0,e.skillDamage=0,e.startTime=0,e.avatarDPS=0,e.petStartTime=0,e.petTotalDamage=0,e.petDPS=0,e.soundPause=!0,e.lockStep=!1,e.skipVerify=!1,e}();__reflect(DebugStatic.prototype,"DebugStatic"),window.DebugStatic=DebugStatic;var PullPointAction=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.setActionInfo=function(t,i,r,n,a,o,s){e.prototype.setActionInfo.call(this,t,i,r,n,a,o,s);var l,u=this,c=u.owner,p=u.subActions,d=Fixed.millisecond(a[0]),f=!a[8];u.time=u.cstime=u.dis=u.lastDis=u.disz=u.lastDisz=0,u.ttime=d,u.ctime=Fixed.millisecond(a[1]),u.stime=Fixed.millisecond(a[10]),u.px=Fixed.value(a[2]||0).mul(i.multiply).add(i.x).value,u.py=Fixed.value(a[3]||0).add(i.y).value,u.radian=Fixed.atan2_pos(c.x,c.y,u.px,u.py),u.dis=Fixed.distance(u.px,u.py,c.x,c.y),u.disz=a[9]?0:Fixed.value(i.z).add(a[4]||0).max(0).sub(c.z).value,u.stopRadius=a[5]||0,u.useWeight=!a[7],d||(f=!0),u.depend=f,f&&i.addListener("onRemoved",u.onBulletRemoved,u),l=ObjectPool.pop(SubPullPointAction),l.initialize(u,n||"behit_stand",r?90:2,d,u.owner.isAir||u.disz>0?114:0),p.push(l)},t.prototype.onBulletRemoved=function(){this.onAllSubActionEnd()
},t.prototype.onDestroy=function(){var t=this;t.depend&&t.bullet.removeListener("onRemoved",t.onBulletRemoved,t),t.ttime=0,t.ctime=0,t.time=0,t.stime=0,t.cstime=0,t.radian=0,t.dis=0,t.disz=0,t.lastDis=0,t.lastDisz=0,t.stopRadius=0,t.useWeight=!1,t.depend=!1,e.prototype.onDestroy.call(this)},t}(HurtAction);__reflect(PullPointAction.prototype,"PullPointAction"),window.PullPointAction=PullPointAction;var AncientBuildingBossRoom=function(e){function t(t,i,r,n){return void 0===i&&(i=0),void 0===r&&(r=null),void 0===n&&(n=null),e.call(this,t,i,r,n)||this}return __extends(t,e),t.prototype.onCreate=function(){e.prototype.onCreate.call(this);var t=Data.getItem("AncientBuildingData",this.cfgId);t&&(this._propId=t.bProp)},t.prototype.createSpawnMonsterInfo=function(t,i,r){var n=Data.getItem("MonsterPropData",this._propId);if(n){var a,o,s=e.prototype.createSpawnMonsterInfo.call(this,t,i,r),l=[];return o=this.dunAbility||0,n.datas.forEach(function(e){e.name&&e.fun&&("level"==e.name?a=Data.exprd(e.fun,o,r.monsterType):l.push({name:e.name,val:Data.exprd(e.fun,o,r.monsterType)}))}),s.extraProps=l,s.level=a||1,s}return e.prototype.createSpawnMonsterInfo.call(this,t,i,r)},t.prototype.onLeaveMap=function(){e.prototype.onLeaveMap.call(this)},Object.defineProperty(t.prototype,"resultPanelId",{get:function(){return 141},enumerable:!0,configurable:!0}),t.prototype.isHideLv=function(e){return!0},t.prototype.onWin=function(t,i,r,n,a){for(var o=[],s=5;s<arguments.length;s++)o[s-5]=arguments[s];e.prototype.onWin.apply(this,[t,i,r,n].concat(o))},t}(RelayRoom);__reflect(AncientBuildingBossRoom.prototype,"AncientBuildingBossRoom"),window.AncientBuildingBossRoom=AncientBuildingBossRoom;var AncientBuildingRoom=function(e){function t(t,i,r,n){return void 0===i&&(i=0),void 0===r&&(r=null),void 0===n&&(n=null),e.call(this,t,i,r,n)||this}return __extends(t,e),t.prototype.onCreate=function(){e.prototype.onCreate.call(this);var t=Data.getItem("AncientBuildingData",this.cfgId);t&&(this._propId=t.mProp)},t.prototype.createSpawnMonsterInfo=function(t,i,r){var n=Data.getItem("MonsterPropData",this._propId);if(n){var a,o,s=e.prototype.createSpawnMonsterInfo.call(this,t,i,r),l=[];return o=this.dunAbility||0,n.datas.forEach(function(e){e.name&&e.fun&&("level"==e.name?a=Data.exprd(e.fun,o,r.monsterType):l.push({name:e.name,val:Data.exprd(e.fun,o,r.monsterType)}))}),s.extraProps=l,s.level=a||1,s}return e.prototype.createSpawnMonsterInfo.call(this,t,i,r)},Object.defineProperty(t.prototype,"resultPanelId",{get:function(){return 159},enumerable:!0,configurable:!0}),t}(RelayRoom);__reflect(AncientBuildingRoom.prototype,"AncientBuildingRoom"),window.AncientBuildingRoom=AncientBuildingRoom;var AncientBuildingWBossRoom=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.onCreate=function(){e.prototype.onCreate.call(this);var t=Data.getItem("AncientBuildingWBossData",this.cfgId);t&&(this._propId=t.bProp)},t.prototype.createSpawnMonsterInfo=function(t,i,r){var n=Data.getItem("MonsterPropData",this._propId);if(n){var a,o,s=e.prototype.createSpawnMonsterInfo.call(this,t,i,r),l=[];return o=this.dunAbility||0,n.datas.forEach(function(e){e.name&&e.fun&&("level"==e.name?a=Data.exprd(e.fun,o,r.monsterType):l.push({name:e.name,val:Data.exprd(e.fun,o,r.monsterType)}))}),s.extraProps=l,s.level=a||1,s}return e.prototype.createSpawnMonsterInfo.call(this,t,i,r)},t.prototype.battleOver=function(t,i){void 0===i&&(i=null),e.prototype.battleOver.call(this,t,i)},t.prototype.getPvEResultExtra=function(t,i){var r=e.prototype.getPvEResultExtra.call(this,t,i);return r||(r={}),r.damage=this.selfDamage,r},t.prototype.getBattleResultParams=function(t){var i=e.prototype.getBattleResultParams.call(this,t);return i.damage=this.selfDamage,i},t.prototype.isInfiniteHp=function(e){return e instanceof Boss?!0:!1},Object.defineProperty(t.prototype,"scenePanelId",{get:function(){return 604},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"resultPanelId",{get:function(){return 3101},enumerable:!0,configurable:!0}),t.prototype.getBestDamage=function(e){return e},t}(RelayRoom);__reflect(AncientBuildingWBossRoom.prototype,"AncientBuildingWBossRoom"),window.AncientBuildingWBossRoom=AncientBuildingWBossRoom;var AncientRoom=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.createSpawnMonsterInfo=function(t,i,r){var n=1,a=Data.getItem("AncientData",this.dunId);a&&a.hpParam&&(n=+a.hpParam[this.agentInfoList.length-1]);var o=e.prototype.createSpawnMonsterInfo.call(this,t,i,r);return o.maxHpRate=n,o},Object.defineProperty(t.prototype,"resultPanelId",{get:function(){return 141},enumerable:!0,configurable:!0}),t.prototype.onWin=function(t,i,r,n,a){for(var o=[],s=5;s<arguments.length;s++)o[s-5]=arguments[s];e.prototype.onWin.apply(this,[t,i,r,n].concat(o))},t}(RelayRoom);__reflect(AncientRoom.prototype,"AncientRoom"),window.AncientRoom=AncientRoom;var Avatar=function(e){function t(t,i,r,n){return void 0===i&&(i=0),void 0===r&&(r=null),void 0===n&&(n=null),e.call(this,t,i,r,n)||this}return __extends(t,e),Object.defineProperty(t.prototype,"aiClass",{get:function(){return AvatarAI},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"guiseClass",{get:function(){return GAvatar},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"skillClass",{get:function(){return AvatarSkill},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"curHeroCfg",{get:function(){return this.transHeroCfg||this.heroCfg},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"curHeroResCfg",{get:function(){return this.transHeroResCfg||this.heroResCfg},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"element",{get:function(){var e=this,t=e.agent,i=e.scene;if(!i||!t)return 0;var r=e.buff.element;if(r)return r;if(e.petId)return e.heroCfg.element;if(i.isAllPetUp)return t.getFirstPetElement();var n=t.pet;return n&&!n.isDead?n.element||0:0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"resId",{get:function(){var e=this;if(e.transHeroId)return e.transHeroResCfg.res;if(e.petId)return e.heroResCfg.res;var t=e.agent.fashionId;if(t){var i=Data.getItem("ClothData",t);return i.res}return e.heroResCfg.res},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"heroUrl",{get:function(){return this.transHeroId||this.petId?Urls.hero():this.agent.fashionId?Urls.fashion():Urls.hero()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"titleUrl",{get:function(){if(this.petId)return null;var e=this.agent.titleId;if(e){var t=Data.getItem("TitleData",e);return t.res}return null},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"weaponUrl",{get:function(){var e=this;if(e.transHeroId)return null;if(e.petId)return e.heroResCfg.weapon;var t=e.agent.weaFasId,i=e.agent.weaponId;if(t)return"";if(i){var r=Data.getItem("EquipApData",i);return r?r.res:e.heroResCfg.weapon}return e.heroResCfg.weapon},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"weaponEffectUrl",{get:function(){var e=this;if(e.transHeroId)return null;if(e.petId)return null;var t=e.agent.weaponId;if(!t)return null;var i=Data.getItem("EquipApData",t);return i?i.battleRes:null},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"wingUrl",{get:function(){if(this.petId)return null;var e=this.agent.wingFasId;if(e){var t=Data.getItem("WingSkinData",e);return t.exteriorRes+"_"+this.agent.job}return null},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"upperHaloAction",{get:function(){return this.side==this.scene.player.side&&this.hold?"1_upper":null},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"lowerHaloAction",{get:function(){return this.side==this.scene.player.side?this.hold?"1_lower":"3_lower":"4_lower"},enumerable:!0,configurable:!0}),t.prototype.setParams=function(e){e&&(this.isClient=!0,this.aiId=e.aiId||0,ObjectUtils.assignKeys(e,this,["roomsn","side","prid","heroId","petId"]))},t.prototype.onEnteredScene=function(){var t=this;t.agent.onAddAvatar(t),e.prototype.onEnteredScene.call(this),t.updateLevel(),App.dispatch("c61",{rid:t.prid,avatar:t})},t.prototype.onStopPvERound=function(){this.skill&&this.skill.clearPortalDelayBullet()},t.prototype.onLeftScene=function(){var t=this;t.agent.onRemoveAvatar(t),App.dispatch("c62",{rid:t.prid,avatar:t}),e.prototype.onLeftScene.call(this)},t.prototype.onNextRound=function(){var e=this,t=e.guise;e.visible_guise=!0,e.ai.onNextRound(),t&&(e.scene.addGuise(t),t.onNextRound()),e.state.hasState(110)&&e.state.interrupt(5),e.isTouch?e.startMove(1):e.state.normal(112,!0);var i=e.scene;if(!e.isDead&&i instanceof TowerRoom){var r=Data.getItem("TowerData",i.dunId);if(r&&r.rcv){var n=r.rcv[i.roundId-2]||0;if(n>0){var a=e.props,o=a.gv("hp"),s=a.gv("maxHp");a.setPropSlot("hp","BASE",Fixed.value(s).mul(n).div(100).add(o).value),e.guise&&e.guise.updateHp()}}}},t.prototype.touchMoveBegin=function(e){var t=this;t.scene.isLockStep&&(t.lastDir=e),t.agent.syncTouchBegin(e)},t.prototype.onTouchBegin=function(e){var t=this;t.isTouch=!0,t.touchDir=e,t.updateSpdByDir(e),t.scene.isControl&&1!=t.moveType&&(t.state.limit(101)?t.state.canSkillRun&&!t.beControl&&1==t.state.skillMoveType&&t.startMove(1):t.startMove(1))},t.prototype.touchMoveChange=function(e){var t=this;t.lastDir!=e&&(t.scene.isLockStep&&(t.lastDir=e),t.agent.syncTouchChange(e))},t.prototype.onTouchChange=function(e){this.touchDir=e,this.updateSpdByDir(e)},t.prototype.touchMoveEnd=function(){this.agent.syncTouchEnd()},t.prototype.onTouchEnd=function(){var e=this;e.clearTouch(),1==e.moveType&&(e.stopMove(),e.ai&&e.ai.stop(),e.ai.tickAI()),e.hold&&ActionMgr.checkNext()},t.prototype.clearTouch=function(){this.isTouch=!1,this.touchDir=0,this.lastDir=0},t.prototype.updatePos=function(t,i,r,n){var a=this;a.transHeroId&&a.transHeroCfg.unmovex&&(t=a.x),e.prototype.updatePos.call(this,t,i,r,n),a.hold&&a.scene instanceof PartyWarRRoom&&(a.scene.syncDataDirty=!0)},t.prototype.updateSpecialSpd=function(e){this.specialSpd=e,this.updateSpdByDir(this.touchDir)},t.prototype.onFree=function(e,t){var i=this;if(i.isAir)return void i.state.flyDown(t);if(i.isDead)return void i.dead(!1,!1,!0);i.hold&&(110!=e&&(103!=e&&113!=e&&1!=e&&2!=e&&4!=e&&5!=e&&6!=e&&17!=e&&33!=e&&38!=e||i.beControl)||App.dispatch("c72"));var r=ActionMgr.changeDirToX(i.touchDir);i.isTouch&&r&&i.changeDirection(r>0);var n=i.skill;return i.isPress&&!n.nextSkillId&&(n.nextSkillId=n.nskillId),n.nextSkillId&&n.playComboSkill()?void 0:i.isTouch&&!i.beControl?void i.onTouchBegin(i.touchDir):void(i.state.limit(112)||(i.state.normal(112,!1),i.ai.onStateFree(e)))},t.prototype.onAttPropChange=function(e){("hp"in e||"maxHp"in e||"mp"in e||"maxMp"in e)&&App.dispatch("c59",{rid:this.prid,target:this,changedKeys:e})},t.prototype.updateHeroInfo=function(t,i,r){e.prototype.updateHeroInfo.call(this,t,i,r);var n=this,a=n.agentInfo;a&&a.avatarData&&(a.avatarData.hp=n.props.gv("hp"))},t.prototype.updateEquipSkill=function(e){var t,i,r,n,a,o,s=this,l=s.svrActBullets,u=s.svrUnactBullets,c=s.svrActSkillBullets,p=s.svrUnactSkillBullets,d=s.svrActSkillActions,f=s.equipProps,h=s.changeSkillIds;for(var v in e)if(t=e[v],i=Data.getItem("SkillForceData",t.id),i.sId){if(i.nId&&(h||(h=s.changeSkillIds={}),h[i.sId]=i.nId),i.bullet&&i.bullet.forEach(function(e){o=e.skillId,e.atids&&e.atids.forEach(function(e){o?(c||(c=s.svrActSkillBullets={}),n=c[o],n||(n=c[o]={}),n[e]=!0):(l||(l=s.svrActBullets={}),l[e]=!0)}),e.dtids&&e.dtids.forEach(function(e){o?(p||(p=s.svrUnactSkillBullets={}),n=p[o],n||(n=p[o]={}),n[e]=!0):(u||(u=s.svrUnactBullets={}),u[e]=!0)})}),t.awaken&&i.a&&(f||(f=s.equipProps={}),r=f[i.sId],r||(r=f[i.sId]={damage:0,cd:0,bhr:0,teva:0,crva:0,crra:0}),r.damage=Fixed.value(r.damage).add(i.a.damage||0).value,r.cd=Fixed.value(r.cd).add(i.a.cd||0).value,i.nId&&(f[i.nId]=r)),i.n){f||(f=s.equipProps={}),r=f[i.sId],r||(r=f[i.sId]={damage:0,cd:0,bhr:0,teva:0,crva:0,crra:0});var m=Data.getLvListValue(i.n.bhr,t.lv,0),y=Data.getLvListValue(i.n.teva,t.lv,0),g=Data.getLvListValue(i.n.crva,t.lv,0),b=Data.getLvListValue(i.n.crra,t.lv,0);r.bhr=Fixed.value(r.bhr).add(m).value,r.teva=Fixed.value(r.teva).add(y).value,r.crva=Fixed.value(r.crva).add(g).value,r.crra=Fixed.value(r.crra).add(b).value,i.nId&&(f[i.nId]=r)}i.actionIds&&i.actionIds.forEach(function(e){d||(d=s.svrActSkillActions={}),a=d[o],a||(a=d[o]={}),a[e]=!0})}this.skill.initEquipSkills(e)},t.prototype.relive=function(){this.clearAll(),e.prototype.relive.call(this)},t.prototype.onReliveEnd=function(){e.prototype.onReliveEnd.call(this);var t=this.agentInfo&&this.agentInfo.avatarData;t&&(t.hp=this.props.gv("hp"))},t.prototype.onEndDead=function(){var e=this;e.clearAll(),App.dispatch("c66",{target:e}),e.dispatch("onDead",{target:e}),e.scene.isPetSally&&e.scene.addCallLater(e.receiveLeaveScene,e,1,!1,!1)},t.prototype.clearAll=function(){var t=this;t.clearTransTime(),t.transHeroId=0,t.transHeroCfg=null,t.transHeroResCfg=null,t.heroResCfg&&(t.actionCfg=Data.getOppItem("RoleAction",t.heroResCfg.res)),t.stopPetKill(),t.onResetBalance(!0),e.prototype.clearAll.call(this),t.skill&&t.skill.clearAll()},t.prototype.updateHalo=function(){this.guise&&this.guise.updateHalo()},t.prototype.updateFashion=function(){this.guise&&this.guise.updateFashion()},t.prototype.updateTitle=function(){this.guise&&this.guise.updateTitle()},t.prototype.updateWeapon=function(){this.guise&&this.guise.updateWeapon()},t.prototype.updateWeaponEffect=function(){this.guise&&this.guise.updateWeaponEffect()},t.prototype.updateWing=function(){this.guise&&this.guise.updateWing()},t.prototype.onStartPvPWait=function(){if(!this.isDead){e.prototype.onStartPvPWait.call(this);var t=Data.getSysValue("PVP_WHEEL_HP_BUFF");t&&this.buff.addBuff(this,0,1,t)}},t.prototype.onPvPStopRound=function(){this.buff.removeAll()},t.prototype.onEnterFrame=function(t){e.prototype.onEnterFrame.call(this,t);var i=this;i.transNpc&&i.transNpc.spskill_curCd&&i.guise&&i.guise.updateTransSkillCd(),i.transTotalTime>0&&i.transCurTime>0&&(i.transCurTime=Fixed.value(i.transCurTime).sub(t).value,i.transCurTime<=0&&(i.transNpc?i.agent&&i.agent.onNpcTransStop():i.onTransStop())),i.killPetId&&i.killTotalTime>0&&i.killCurTime>0&&(i.killCdTime>0&&(i.killCdTime=Fixed.value(i.killCdTime).sub(t).value,i.killCdTime<=0&&(i.killCdTime=0,i.agent.autoBattle&&i.ai.trig(40),App.dispatch("c119"))),i.killCurTime=Fixed.value(i.killCurTime).sub(t).value,i.killCurTime<=0&&i.stopPetKill())},t.prototype.onNpcTransBegin=function(e){var t=this,i=e.battNpcCfg.trans.heroId;if(t.transHeroId!=i){t.transNpc=e,t.transNpcCfg=e.battNpcCfg,e.addListener("onTransSkillChange",t.oTransSkillChange,t);var r=t.scene;t.updatePos(r.limitX(e.x),r.limitY(e.y),0,e.right),t.onTransBegin(i,0);var n=e.battNpcCfg.trans.buffId;n&&t.buff.addBuff(t,0,0,n),t.guise&&(e.spskill_id?t.guise.showTransSkill():t.guise.hideTransSkill())}},t.prototype.oTransSkillChange=function(){this.guise&&this.guise.showTransSkill()},t.prototype.onNpcTransStop=function(){var e=this,t=e.transNpc;t&&(t.spskill_id&&e.guise&&e.guise.hideTransSkill(),t.removeListener("onTransSkillChange",e.oTransSkillChange,e));var i=e.transNpcCfg.trans.buffId;i&&e.buff.removeId(i,1),e.transNpc=null,e.transNpcCfg=null,e.onTransStop()},t.prototype.onTransBegin=function(e,t){var i=this;if(!(i.transHeroId==e||0>t)){i.state.interrupt(8),i.ai.stop(),i.stopMove(),i.clearTransTime(),i.transTotalTime=i.transCurTime=Fixed.millisecond(t);var r=Data.getItem("HeroData",e);i.transHeroId=e,i.transHeroCfg=r,i.transHeroResCfg=Data.getItem("HeroResData",r.guise),i.actionCfg=Data.getOppItem("RoleAction",i.transHeroResCfg.res),i.visible_ui=!r.hideUI,i.visible_shadow=!r.hideShadow,i.visible_halo=!r.hideHalo,i.props.setPropSlot("hp","BASE",i.props.gv("maxHp")),i.guise&&i.guise.updateHp(),i.skill.onTransBegin(),r.ai&&i.ai.changeAI(r.ai,!1);var n="rc",a=i.actionCfg.dic[n];if(a){ConstD.parseActionData(a),i.state.normal(112,!1,n,!1,0);var o=i.scene;o.setControl(!1),i.transTimeId=o.addCallLater(i.onTransActionEnd,i,a.total,!1,!0)}else i.state.normal(112,!1,"idle",!1,1);i.guise&&i.guise.updateTrans(),r.enterSound&&SoundUtils.playSoundById(r.enterSound,i.hashCode),i.hold&&App.dispatch("c111")}},t.prototype.onTransActionEnd=function(){this.scene.setControl(!0)},t.prototype.clearTransTime=function(){var e=this.transTimeId;e&&(this.transTimeId=0,this.scene.removeCallLaterIdx(e))},t.prototype.onTransStop=function(){var e=this;if(e.transHeroId&&!e.isDead){e.state.interrupt(8),e.ai.stop(),e.stopMove();var t="rc",i=e.actionCfg.dic[t];i&&e.guise&&e.guise.addEffect(69084,0),e.transTotalTime=0,e.transCurTime=0,e.transHeroId=0,e.transHeroCfg=null,e.transHeroResCfg=null,e.actionCfg=Data.getOppItem("RoleAction",e.heroResCfg.res);var r=e.heroCfg;e.visible_ui=!r.hideUI,e.visible_shadow=!r.hideShadow,e.visible_halo=!r.hideHalo,e.skill.onTransStop();var n=e.aiId||r.ai;n&&e.ai.changeAI(n,!1),e.guise&&e.guise.updateTrans(),e.state.normal(112,!1),e.hold&&App.dispatch("c111")}},t.prototype.startPetKill=function(e,t){var i=this;if(!(!e||0>=t||i.killPetId)){var r=Data.getItem("PetKillData",e);r&&(i.killPetId=e,i.killTotalTime=t,i.killCurTime=t,i.killCdTime=0,i.agent.autoBattle&&i.ai.trig(40),App.dispatch("c120"))}},t.prototype.stopPetKill=function(){var e=this;e.killPetId&&(e.killPetId=0,e.killTotalTime=0,e.killCurTime=0,e.killCdTime=0,App.dispatch("c121"))},t.prototype.canUsePetKillSkill=function(e,t){var i=this;return i.killPetId&&i.killPetId==e?i.killCdTime>0?(t&&Prompt.battleMsgId(2247),!1):!0:(t&&Prompt.battleMsgId(2246),!1)},t.prototype.onUsePetKillSkill=function(e,t){void 0===t&&(t=!0);var i=this;if(i.canUsePetKillSkill(e,t)){var r=Data.getItem("PetKillData",e),n=i.scene.getNearestTarget(i,0,!1),a=BulletExtra.create(i,n||i,r.tid,0,0,1);a&&(a.cameraFollow=!0,i.skill.onTrigBullet(a)),i.killCdTime=Fixed.millisecond(r.cd),App.dispatch("c119")}},t.prototype.onDestroy=function(){e.prototype.onDestroy.call(this);var t=this,i=t.params;i&&i.dispose();var r=t.transNpc;r&&(t.transNpc=null,r.removeListener("onTransSkillChange",t.oTransSkillChange,t)),t.transNpcCfg=null,t.transHeroId=0,t.transHeroCfg=null,t.transHeroResCfg=null,t.killPetId=0,t.killTotalTime=0,t.killCurTime=0,t.killCdTime=0},t}(Role);__reflect(Avatar.prototype,"Avatar"),window.Avatar=Avatar;var AvatarAdvRoom=function(e){function t(t,i,r,n){return void 0===i&&(i=0),void 0===r&&(r=null),void 0===n&&(n=null),e.call(this,t,i,r,n)||this}return __extends(t,e),Object.defineProperty(t.prototype,"scenePanelId",{get:function(){return 202},enumerable:!0,configurable:!0}),t.prototype.getPvEResultExtra=function(t,i){var r=e.prototype.getPvEResultExtra.call(this,t,i);return r.roundId=this.roundId,r},t}(RelayRoom);__reflect(AvatarAdvRoom.prototype,"AvatarAdvRoom"),window.AvatarAdvRoom=AvatarAdvRoom;var BattNpc=function(e){function t(t,i,r,n){void 0===i&&(i=0),void 0===r&&(r=null),void 0===n&&(n=null);var a=e.call(this,t,i,r,n)||this;return a.useStatus=0,a.useTimes=0,a}return __extends(t,e),Object.defineProperty(t.prototype,"aiClass",{get:function(){return BattNpcAI},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"guiseClass",{get:function(){return GBattNpc},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isTransNpc",{get:function(){return 3==this.battNpcCfg.type},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isTrapNpc",{get:function(){return 5==this.battNpcCfg.type},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isBattNpc",{get:function(){return 4==this.battNpcCfg.type},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"element",{get:function(){var e=this.buff.element;return e?e:this.lvElement||this.heroCfg.element||0},enumerable:!0,configurable:!0}),t.prototype.setParams=function(e){if(e){var t=this,i=e;t.isClient=!0,t.battNpcId=i.battNpcId,t.roomsn=i.roomsn,t.side=i.side}},t.prototype.onCreate=function(){var t=this,i=t.battNpcCfg=Data.getItem("BattNpcData",this.battNpcId);Functor.assert(!!i,"BattNpc 战斗NPC配置不存在ID："+t.battNpcId),t.heroId=i.heroId,t.x=i.x,t.y=i.y,t.right=i.right,t.aiId=i.aiId||0,e.prototype.onCreate.call(this),t.name=i.name||t.heroCfg.name},t.prototype.onEnterScene=function(){var t=this;if(t.isTransNpc){var i=t.battNpcCfg.trans;i&&i.skillId&&(t.spskill_id=i.skillId,t.spskill_curTimes=i.initTimes||0,t.spskill_maxTimes=i.maxTimes||0,t.spskill_maxCd=Fixed.millisecond(i.timesCd))}var r=Data.getSValue("HeroData",t.heroId,"prop"),n=Data.getSValue("HeroData",t.heroId,"skill")||[],a=[],o=[],s={},l=[];if(r&&r.forEach(function(e){t.addPropItem(e,s,l,1,1)}),t.battNpcCfg.lvId){var u=Data.getItem("MonsterLevel",t.battNpcCfg.lvId),c=u.skillLv;if(u.prop&&u.prop.forEach(function(e){t.addPropItem(e,s,l,1,1)}),u.buff&&u.buff.forEach(function(e){e.name&&e.lv&&o.push({buffId:e.name,lv:e.lv})}),c)for(var p=0,d=n.length;d>p;p++)a.push({id:n[p],lv:u.skillLv[p]||1});t.level=u.lv||1,t.sbaval=u.baval||t.sbaval||0,t.sbatime=u.batime||t.sbatime||0,t.lvElement=u.element||0}t.updateHeroInfo(l,a,o),e.prototype.onEnterScene.call(this)},t.prototype.onEnteredScene=function(){e.prototype.onEnteredScene.call(this);var t=this;t.battNpcCfg.hide&&(t.visible_guise=!1),t.isTransNpc&&(t.visible_name=!1,t.spskill_id&&t.startRecoverTimes()),t.skill.startInitCd()},t.prototype.onLeaveScene=function(){this.scene.removeCallLater(this),e.prototype.onLeaveScene.call(this)},t.prototype.onBuffEffect=function(t,i,r,n,a,o){e.prototype.onBuffEffect.call(this,t,i,r,n,a,o);var s=this.scene;s instanceof RelayRoom&&s.battleCfg.pNpcId==this.battNpcId&&s.changeScoreVal(17,this.hpRateFloor,!0)},t.prototype.onEndDead=function(){e.prototype.onEndDead.call(this),this.scene.addCallLater(this.receiveLeaveScene,this,1,!1,!1)},t.prototype.onHalfSecond=function(t){e.prototype.onHalfSecond.call(this,t);var i=this,r=i.useStatus;if(i.isTransNpc&&2!=r&&i.scene.player){var n=i.scene.player.avatar;if(n){var a=i.guise,o=i.rect.intersects(n.rect);o&&0==r?(i.useStatus=1,a&&a.updateTransStatus()):o||1!=r||(i.useStatus=0,a&&a.updateTransStatus())}}},t.prototype.reqNpcTransBegin=function(){var e=this,t=e.battNpcCfg,i=t.trans;if(i){var r=i.heroId;if(!r)return!1;var n=i.useTimes;return n&&e.useTimes>=n?!1:void e.scene.player.reqNpcTransBegin(e)}},t.prototype.onNpcTransBegin=function(e){var t=this;if(t.isTransNpc)if(t.battNpcId==e)t.useTimes++,t.useStatus=2,t.visible_guise=!1;else{var i=t.battNpcCfg.trans.useTimes;(!i||t.useTimes<i)&&(t.visible_guise=!0,t.guise&&(t.guise.alpha=.5))}},t.prototype.onNpcTransStop=function(){var e=this;if(e.isTransNpc){var t=e.battNpcCfg.trans.useTimes;(!t||e.useTimes<t)&&(e.visible_guise=!0,e.guise&&(e.guise.alpha=1))}},t.prototype.startRecoverTimes=function(){var e=this;if(e.isTransNpc&&!e.spskill_curCd){var t=e.spskill_id,i=e.spskill_curTimes,r=e.spskill_maxTimes,n=e.spskill_maxCd;!t||!n||r&&i>=r||(e.spskill_curCd=n,e.guise&&e.guise.updateTransSkill())}},t.prototype.onEnterFrame=function(t){e.prototype.onEnterFrame.call(this,t);var i=this;i.spskill_curCd&&(i.spskill_curCd=Fixed.value(i.spskill_curCd).sub(t).value,i.guise&&i.guise.updateTransSkillCd(),i.spskill_curCd<=0&&i.onRecoverTimes())},t.prototype.onRecoverTimes=function(){var e=this,t=e.spskill_curTimes,i=e.spskill_maxTimes;e.spskill_curTimes=i?Math.min(t+1,i):t+1,e.spskill_curCd=0,e.guise&&e.guise.updateTransSkill(),(!i||i>t)&&e.startRecoverTimes(),e.dispatch("onTransSkillChange",{target:e})},t.prototype.checkSpecialSkill=function(e,t){var i=this;return i.spskill_id!=e?!0:i.spskill_curTimes<=0?(t&&Prompt.msgId(2238),!1):!0},t.prototype.onSpecialSkillBegin=function(e){var t=this;t.spskill_id==e&&(t.spskill_curTimes=Math.max(t.spskill_curTimes-1,0),t.startRecoverTimes(),t.dispatch("onTransSkillChange",{target:t}))},t.prototype.onDestroy=function(){e.prototype.onDestroy.call(this),ObjectUtils.clearKeys(this,["battNpcCfg"])},t}(Role);__reflect(BattNpc.prototype,"BattNpc"),window.BattNpc=BattNpc;var Boss=function(e){function t(t,i,r,n){return void 0===i&&(i=0),void 0===r&&(r=null),void 0===n&&(n=null),e.call(this,t,i,r,n)||this}return __extends(t,e),Object.defineProperty(t.prototype,"guiseClass",{get:function(){return GBoss},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"lowerHaloAction",{get:function(){return"4_lower"},enumerable:!0,configurable:!0}),t.prototype.playBossEnterEffect=function(){var e=this,t=e.scene;e.canbeHit=!1,t.master_monster=e,t.cdirty=!0,t.changePauseTime(!0),t.setControl(!1),t.addCallLater(e.onBossCameraEnd,e,25,!1,!0),t.addCallLater(e.onBossEnterEnd,e,170,!1,!0),PanelMgr.open(250,{boss:this})},t.prototype.onEnterScene=function(){e.prototype.onEnterScene.call(this),this.isInfiniteHp=this.scene.isInfiniteHp(this)},t.prototype.onEnteredScene=function(){e.prototype.onEnteredScene.call(this);var t=this;t.effect&&t.scene.pauseBossEffect&&t.playBossEnterEffect(),App.dispatch("c99",{monster:t})},t.prototype.onBossCameraEnd=function(){var e=this.heroCfg;e.enterHide&&(this.visible_guise=!0),e.sskill&&this.skill.onBeginSkill(e.sskill,!1,!1)},t.prototype.onBossEnterEnd=function(){var e=this,t=e.scene;t.master_monster=null,t.cdirty=!0,t.changePauseTime(!1),t.setControl(!0),PanelMgr.close(250),e.canbeHit=!0,!e.playEnterSkill()&&e.onEnterEffectEnd()},t.prototype.playEnterEffect=function(){return this.effect?!0:this.playEnterSkill()},t.prototype.onEnterEffectEnd=function(){e.prototype.onEnterEffectEnd.call(this),this.scene.onBossEnterScene()},t.prototype.onLeftScene=function(){App.dispatch("c100",{monster:this}),e.prototype.onLeftScene.call(this)},t.prototype.onBuffEffect=function(t,i,r,n,a,o){e.prototype.onBuffEffect.call(this,t,i,r,n,a,o),0>r&&this.isInfiniteHp&&t.caster.hold&&App.dispatch("c101",{teid:this.$eid})},t.prototype.onDestroy=function(){this.effect&&PanelMgr.close(250),e.prototype.onDestroy.call(this)},t}(Monster);__reflect(Boss.prototype,"Boss"),window.Boss=Boss;var Bullet=function(e){function t(t,i,r,n){return void 0===i&&(i=0),void 0===r&&(r=null),void 0===n&&(n=null),e.call(this,t,i,r,n)||this}return __extends(t,e),Object.defineProperty(t.prototype,"guiseClass",{get:function(){return GBullet},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"resId",{get:function(){return this.effectCfg.res},enumerable:!0,configurable:!0}),t.prototype.setParams=function(e){if(e){var t=this,i=e,r=i.caster;ObjectUtils.assignKeys(i,t,["caster","trigId","skillId","skillLv","mca","x","y","z"]),t.isClient=!0,t.roomsn=r.roomsn,t.prid=r.prid,t.castereid=r.$eid,t.side=r.side,t.right=i.right;var n=Data.getSValue("SkillData",i.skillId,"rrate"),a=Data.getSValue("SkillData",i.skillId,"rbase");t.rrate=Data.getLvBaseValue(n,i.skillLv,a,0)}},t.prototype.onCreate=function(){var t=this;t.showTimes={},t.hitTimes={},t.stillType=t.stillTrig=t.stillFrame=t.slowFrames=t.curSlowFrame=t.curSlowTimes=0,t.slowStatus=0,t.angle=t.fspeedx=t.fspeedy=t.fspeedz=0;var i=t.trigCfg=Data.getSItem("BulletTrigData",t.trigId);Functor.assert(!!i,"Bullet 子弹触发配置不存在ID："+t.trigId),t.bid=i.bid,t.clear=i.clear;var r=t.bulletCfg=Data.getItem("BulletData",t.bid),n=t.effectCfg=Data.getItem("EffectData",r.guise);t.actionCfg=Data.getOppItem("EffectAction",n.res),Functor.assert(!!t.actionCfg,"子弹特效配置ID："+n.id+" 子弹特效资源："+n.res+"动作配置数据不存在");var a=i.play||0;if(1==a||2==a){var o=Data.getLvBaseValue(i.ctime,t.skillLv,i.ctimeb,0);t.ctime=t.time=Fixed.millisecond(o)}else(3==a||4==a)&&(t.ctime=t.time=Data.getLvBaseValue(i.ctime,t.skillLv,i.ctimeb,0));if(1==i.move){var s=i.mv||[],l=t.angle=i.angle||0,u=s[0]||0,c=Fixed.value(l).div(180).mul(Fixed.PI).value,p=l>270||90>l?t.multiply:Fixed.value(t.multiply).neg().value;t.fspeedx=Fixed.value(c).cos().mul(u).abs().mul(p).value;var d=Fixed.value(c).sin().mul(u).abs().mul(l>180?1:-1).value;s[0]?(t.fspeedy=Fixed.value(d).neg().value,t.fspeedz=0):(t.fspeedy=0,t.fspeedz=d)}t.max=Data.getSValue("BulletData",t.bid,"max")||0,t.hitMax=Data.getSValue("BulletData",t.bid,"hit")||0,t.hitIndex=0,t.trigFrames={},t.trigIndex=t.bulletMaxTimes=t.bulletTimes=0,e.prototype.onCreate.call(this)},t.prototype.onEnterScene=function(){e.prototype.onEnterScene.call(this),this.updateVisible()},t.prototype.createGuise=function(){var e=this;if(e.destroyGuise(),e.resId&&e.visible_guise){var t=e.guise=ObjectPool.pop(e.guiseClass);t.initOwner(e),e.addGuiseL(),t.create()}e.guise&&e.scene.addGuise(e.guise)},t.prototype.onEnteredScene=function(){var e=this,t=e.caster,i=e.bulletCfg,r=e.effectCfg,n=r.upper,a=r.lower;if(e.updateVisible(),e.upperEnd=!n,e.lowerEnd=!a,n){var o=e.upperActionData=e.actionCfg.dic[n];if(Functor.assert(!!o,"子弹特效配置ID："+r.id+" 子弹特效资源："+r.res+" 缺少动作配置上层动作数据:"+n),!o)return;ConstD.parseActionData(o),e.curUpperName=n,e.upperTotalFrame=o.total,e.curUpperFrame=1,e.onFrameEvent(o,n,e.curUpperFrame)}if(a){var s=e.lowerActionData=e.actionCfg.dic[a];if(Functor.assert(!!s,"子弹特效配置ID："+r.id+"子弹特效资源："+r.res+" 缺少动作配置下层动作数据:"+a),!s)return;ConstD.parseActionData(s),e.curLowerName=a,e.lowerTotalFrame=s.total,e.curLowerFrame=1,e.onFrameEvent(s,a,e.curLowerFrame)}e.afterEnterFrame(),i.warnId&&t.warn.onTrigWarn(i.warnId,e.skillId,e.right,e.x,e.y);var l=e.trigCfg.move||0;if(0==l)e.onActionMove();else if(2==l)e.onFollowCaster();else if(3==l){if(t instanceof Avatar){var u=Data.getItem("SkillData",e.skillId);u&&u.spd&&t.updateSpecialSpd(u.spd);var c=e.scene;t==c.master&&e.trigCfg.mv&&e.trigCfg.mv[0]&&(c.master_bullet=e,c.cdirty=!0)}}else if(4==l)e.onFollowAttackPos();else if(8==l){var p=e.trigCfg.mv||[],d=p[0]||0,f=Fixed.value(p[1]||0).div(180).mul(Fixed.PI).value,h=0|p[2],v=this.multiply;v=1==h?v:2==h?Fixed.value(v).neg().value:1,e.fspeedx=Fixed.value(f).cos().mul(d).mul(v).value,e.fspeedy=Fixed.value(f).sin().mul(d).value,e.fspeedz=0}var m=e.ttype=i.ttype||0,y=i.tv||[];if(1==m)e.binterval=y[0]||1,e.tinterval=e.binterval,1==y[1]&&e.onTrigBullet(e.trigIndex);else if(2==m)e.onTrigBullet(e.trigIndex);else{e.bulletMaxTimes=y[1]||0;var g=e.trigFrames={};i.trigs&&i.trigs.forEach(function(e,t){g[e.frame]=t});var b=1;b in g&&e.onTrigBullet(g[b])}var x=i.atype||0,I=i.av;if(2==x)e.onHit(e.hitIndex,!0)&&I&&1==I[0]&&e.onBulletEnd(!1);else if(1==x)I=I||[],e.hinterval=Fixed.millisecond(I[0]),e.interval=e.hinterval,1==I[1]&&e.onHit(e.hitIndex,!0)&&I[2]&&e.onBulletEnd(!1);else{var _=e.hitFrames={};i.buffs&&i.buffs.forEach(function(e,t){_[e.frame]=t});var b=1;b in _&&e.onHit(_[b],!0)}i.cameraId&&e.scene.playCameraEffect(t,i.cameraId,e.skillId),e.params.cameraFollow&&(e.scene.master_kill=e)},t.prototype.onEnterFrame=function(t){e.prototype.onEnterFrame.call(this,t);var i=this;if(i.upperEnd&&i.lowerEnd)return void i.onBulletEnd(!1);if(i.caster&&i.caster.scene&&!i.caster.$isRemoved){var r,n=i.stillType,a=!1,o=!1,s=!1,l=1,u=i.trigCfg.play||0;if(i.slowStatus=0,4==n?(s=!0,l=i.slowTimes[i.curSlowFrame-1],i.curSlowTimes>=l?(a=!1,i.curSlowFrame++,i.curSlowTimes=0,i.slowStatus=3):(a=!0,i.curSlowTimes++,i.slowStatus=1==i.curSlowTimes?1:2),i.curSlowFrame>i.slowFrames&&(a=!1,s=!1,i.stillType=i.slowFrames=i.curSlowFrame=i.curSlowTimes=0,i.slowTimes=null,i.slowStatus=4)):n&&(i.stillTrig>0?i.stillTrig--:i.stillFrame>0?(1==n?o=!0:3==n?a=!0:2==n&&(a=!0,o=!0),i.stillFrame--):i.stillType=0),!a){var c=void 0,p=1==u||3==u;if(i.curUpperName){var d=i.curUpperFrame,f=d+1;c=!0,f>i.upperTotalFrame&&(f=p?1:i.upperTotalFrame,(2==u||4==u)&&(i.isUpperInStopLast||(i.isUpperInStopLast=!0),c=!1)),i.curUpperFrame=f,c&&i.onFrameEvent(i.upperActionData,i.curUpperName,f)}if(i.curLowerName){var h=i.curLowerFrame,v=h+1;c=!0,v>i.lowerTotalFrame&&(v=p?1:i.lowerTotalFrame,(2==u||4==u)&&(i.isLowerInStopLast||(i.isLowerInStopLast=!0),c=!1)),i.curLowerFrame=v,c&&i.onFrameEvent(i.lowerActionData,i.curLowerName,v)}}if(!o){var m=i.scene,y=i.trigCfg.move||0;if(1==y){var g=Fixed.value(i.fspeedx).div(l).add(i.ox).value,b=Fixed.value(i.fspeedy).div(l).add(i.oy).value,x=Fixed.value(i.fspeedz).div(l).add(i.oz).value;i.bulletCfg.adjust&&(g=m.limitX(g)),i.updatePos(g,b,x,i.right)}else if(2==y)i.onFollowCaster();else if(3==y){var I=i.caster;if(I instanceof Avatar&&I.isTouch){var _=I.speedx,S=I.speedy,g=i.ox,b=i.oy;
g=Fixed.value(_).div(l).add(g).value,b=Fixed.value(S).div(l).add(b).value,i.bulletCfg.adjust&&(g=m.limitX(g),b=m.limitY(b)),i.updatePos(g,b,i.oz,_>0)}}else if(4==y)i.onFollowAttackPos();else if(5==y)i.onBoomerangPos();else if(6==y)i.onMoveToTarget(i.caster);else if(7==y){var T=i.followTarget;(!T||!T.isCanBeHit||T.unselect||T.isDead||T.$isRemoved)&&(T=i.followTarget=i.scene.getRandomEnemyAvatar(i.side)),T&&i.onMoveToTarget(T)}else if(8==y)i.onAngleUnifrom(s,l);else if(9==y){var T=i.followTarget;(!T||!T.isCanBeHit||T.unselect||T.isDead||T.$isRemoved)&&(T=i.followTarget=i.scene.getNearestTarget(i.caster,0,!1)),T&&i.onMoveToTarget(T)}else i.onActionMove(s,l);i.aidest&&i.aispd&&i.onMoveToDest()}if(!a){var w=i.bulletCfg.atype||0,A=i.bulletCfg.av;if(2==w)r=i.onHit(i.hitIndex+1,!1)&&A&&1==A[0];else if(1==w)A=A||[],i.interval=Fixed.value(i.interval).sub(t).value,i.interval<=0&&(r=i.onHit(i.hitIndex+1,!1)&&!!A[2],i.interval=Fixed.value(i.interval).add(i.hinterval).value);else if(0==w){var P=Math.max(i.curUpperFrame||0,i.curLowerFrame||0);P&&P in i.hitFrames&&i.onHit(i.hitFrames[P],!1)}var C=i.ttype;if(0==C||3==C){var P=Math.max(i.curUpperFrame||0,i.curLowerFrame||0);P&&P in i.trigFrames&&(!i.bulletMaxTimes||i.bulletTimes<i.bulletMaxTimes)&&i.onTrigBullet(i.trigFrames[P])}else 1==C&&(i.tinterval--,i.tinterval<=0&&(i.tinterval=i.binterval,i.onTrigBullet(i.trigIndex+1)))}1==u||2==u?i.ctime&&(i.time=Fixed.value(i.time).sub(t).value,i.time<=0&&(i.upperEnd||(i.upperEnd=!0),i.lowerEnd||(i.lowerEnd=!0))):3==u||4==u?i.ctime&&(i.time-=1,i.time<=0&&(i.upperEnd||(i.upperEnd=!0),i.lowerEnd||(i.lowerEnd=!0))):(i.upperEnd||(i.upperEnd=i.curUpperFrame==i.upperTotalFrame),i.lowerEnd||(i.lowerEnd=i.curLowerFrame==i.lowerTotalFrame)),r&&(i.upperEnd=i.lowerEnd=!0)}},t.prototype.onActionMove=function(e,t){void 0===e&&(e=!1),void 0===t&&(t=1);var i,r=this,n=r.slowStatus,a=r.ox,o=r.oz;if(2==n||3==n||4==n){var s=void 0;if(r.curUpperName?(i=MmeUtils.getPosInfo(r.curUpperName,r.upperActionData,r.curUpperFrame),s=MmeUtils.getPosInfo(r.curUpperName,r.upperActionData,r.curUpperFrame+1)):r.curLowerName&&(i=MmeUtils.getPosInfo(r.curLowerName,r.lowerActionData,r.curLowerFrame),s=MmeUtils.getPosInfo(r.curLowerName,r.lowerActionData,r.curLowerFrame+1)),i){s=s||i,a=Fixed.value(s.dx).sub(i.dx).div(t).mul(r.multiply).add(a).value;var l=Fixed.value(s.dy).sub(i.dy).div(t).value;o=Fixed.value(o).sub(l).value}}else{var u=void 0;if(r.curUpperName?r.isUpperInStopLast||(i=MmeUtils.getPosInfo(r.curUpperName,r.upperActionData,r.curUpperFrame),u=MmeUtils.getPosInfo(r.curUpperName,r.upperActionData,r.curUpperFrame-1)):r.curLowerName&&(r.isLowerInStopLast||(i=MmeUtils.getPosInfo(r.curLowerName,r.lowerActionData,r.curLowerFrame),u=MmeUtils.getPosInfo(r.curLowerName,r.lowerActionData,r.curLowerFrame-1))),i){var c=0,p=0;u&&(c=u.dx,p=u.dy),a=Fixed.value(i.dx).sub(c).mul(r.multiply).add(a).value,o=Fixed.value(o).sub(i.dy).add(p).value}}r.bulletCfg.adjust&&(a=r.scene.limitX(a)),r.updatePos(a,r.y,o,r.right)},t.prototype.onFollowCaster=function(){var e=this,t=e.trigCfg.mv||[],i=e.caster;e.updatePos(i.x,i.y,t[0]?e.z:i.z,i.right)},t.prototype.onFollowAttackPos=function(){var e=this,t=e.caster;if(t instanceof Avatar&&t.state){var i=t.state.actionState;if(i&&i.action&&i.action.subAction){var r=i.action.subAction;if(r instanceof AttackAction){var n=r.origAction+"_"+ActionMgr.changeDirToX(t.touchDir)*t.multiply,a=t.getAttackPos(n,r.curFrame);if(a){var o=e.trigCfg.mv||[],s=Fixed.value(a.dx).mul(t.multiply).add(t.x).value,l=t.y,u=t.z;o[0]?u=Fixed.value(u).sub(a.dy).value:l=Fixed.value(l).add(a.dy).value,e.bulletCfg.adjust&&(s=e.scene.limitX(s),l=e.scene.limitY(l)),e.updatePos(s,l,u,t.right)}}}}},t.prototype.onBoomerangPos=function(){var e,t,i,r=this,n=r.scene,a=r.trigCfg,o=a.mv||[],s=o[0]||0,l=o[1]||0,u=o[2]||0;if(r.fspeedx||r.fspeedy||r.fspeedz){if(r.y<=Fixed.value(n.roadTop).add(o[3]||0).value){e=!0;var c=n.seedr.random;t=Fixed.value(180).sub(u).value,i=Fixed.value(t).mul(c).value,i=Fixed.value(t).div(2).add(i).value}else if(r.y>=Fixed.value(n.roadBottom).add(o[4]||0).value){e=!0;var c=n.seedr.random;t=Fixed.value(180).sub(u).value,i=Fixed.value(c).mul(t).value,i=Fixed.value(t).neg().div(2).sub(i).value}else if(!r.right&&r.x<=n.roadLeft+(o[5]||0)){e=!0;var c=n.seedr.random;t=Fixed.value(180).sub(l).value,i=Fixed.value(c).mul(t).value,i=Fixed.value(t).div(2).sub(90).add(i).value}else if(r.right&&r.x>=n.roadRight+(o[6]||0)){e=!0;var c=n.seedr.random;t=Fixed.value(180).sub(l).value,i=Fixed.value(c).mul(t).value,i=Fixed.value(t).div(2).add(90).add(i).sub(180).value,i=i>=0?Fixed.value(180).sub(i).value:Fixed.value(-180).sub(i).value}}else e=!0,i=r.params.angle||0;if(e){var p=Fixed.value(i).div(180).mul(Fixed.PI).value;r.fspeedx=Fixed.value(p).cos().mul(s).value,r.fspeedy=Fixed.value(p).sin().mul(s).value,r.fspeedz=0}var d=Fixed.value(r.ox).add(r.fspeedx).value,f=Fixed.value(r.oy).add(r.fspeedy).value,h=Fixed.value(r.oz).add(r.fspeedz).value;r.bulletCfg.adjust&&(d=n.limitX(d),f=n.limitY(f)),r.updatePos(d,f,h,r.right)},t.prototype.onAngleUnifrom=function(e,t){var i=this,r=i.scene,n=Fixed.value(i.fspeedx).div(t).add(i.ox).value,a=Fixed.value(i.fspeedy).div(t).add(i.oy).value,o=Fixed.value(i.fspeedz).div(t).add(i.oz).value;i.bulletCfg.adjust&&(n=r.limitX(n),a=r.limitY(a)),i.updatePos(n,a,o,i.right)},t.prototype.onMoveToTarget=function(e){var t=this;if(e.y-e.z!=t.y||e.x!=t.x){var i=t.trigCfg,r=i.mv||[],n=r[0]||0,a=Fixed.value(e.y).sub(r[2]?0:e.z).value,o=Fixed.atan2_pos(t.x,t.y,e.x,a),s=Fixed.value(o).cos().mul(n).value,l=Fixed.value(o).sin().mul(n).value,u=s?s>0:t.right,c=t.ox;s>0?c=Fixed.value(t.ox).add(s).min(e.x).value:0>s&&(c=Fixed.value(t.ox).add(s).max(e.x).value);var p=t.oy;l>0?p=Fixed.value(t.oy).add(l).min(a).value:0>l&&(p=Fixed.value(t.oy).add(l).max(a).value),t.updatePos(c,p,t.oz,u)}},t.prototype.moveToDest=function(e,t){this.aidest=e,this.aispd=t},t.prototype.onMoveToDest=function(){var e=this,t=e.aidest;if(t.y==e.y&&t.x==e.x)return e.aidest=null,void(e.aispd=0);var i=e.aispd,r=Fixed.atan2_pos(e.x,e.y,t.x,t.y),n=Fixed.value(r).cos().mul(i).value,a=Fixed.value(r).sin().mul(i).value,o=e.ox;n>0?o=Fixed.value(e.ox).add(n).min(t.x).value:0>n&&(o=Fixed.value(e.ox).add(n).max(t.x).value);var s=e.oy;a>0?s=Fixed.value(e.oy).add(a).min(t.y).value:0>a&&(s=Fixed.value(e.oy).add(a).max(t.y).value),e.updatePos(o,s,e.oz,e.right)},t.prototype.onHit=function(e,t){var i=this,r=i.caster,n=i.bulletCfg.buffs;if(!n||!r||!r.props||r.$isRemoved)return!1;e>=n.length&&(e=0),i.hitIndex=e,i.updateRect();var a=i.scene,o=a.master,s=Data.getLvIndexValue(i.bulletCfg.buffs,e,{}),l=s.shake,u=a.getBulletHits(i,s.excLand,i.hitRange,s.w,s.h,i.hitMax,i.hitTimes),c=u.length;if(c){s.max&&c>s.max&&(u.length=s.max);var p,d,f,h,v,m,y,g,b,x,I,_,S,T,w,A,P,C,D,B,k,E,R=i.skillId,F=i.skillLv,M=i.params.damageRate,L=i.params.vampireRate,U=0,O={},N=u.length,H=r instanceof Avatar,j=!1,V=s.type||0,G=s.av||[],z=s.dir||0,K=s.tstill,W=s.cstill,X=void 0,q=l&&l.ignore,$=W&&W["float"]&&4!=W.type,Y=0,Q=0;if(H){var J=r.props.gv("comboIncProb"),Z=r.props.gv("comboInc");Z>0&&J>0&&a.seedr.random<=J&&(Q=Z)}if(4==V?(m=G[2]||0,y=G[3]||0,g=G[6]||0):(9==V||10==V)&&(g=G[3]||0),u.forEach(function(e){if(O[e.$eid]=e.props.gv("hp"),$){var t=e.props.gv("weight");U=Fixed.value(U).add(t).value}H&&i.hold&&(e instanceof Boss||e instanceof Elite)&&(!f||f.type<e.type)&&(f=e),j||i.max&&!((i.showTimes[e.$eid]||0)<i.max)||(j=!0)}),j){if(W&&W.type){var et=W.frame||0;if(4!=W.type&&W["float"]){var tt=Fixed.value(5).log().value,it=Fixed.value(U).div(50).mul(.25).value;et=Fixed.value(N).mul(.75).add(it).max(1).log().div(tt).min(2.5).mul(W["float"]||0).floor().add(et).value}X={type:W.type,frame:et,trig:0,shake:!1,times:W.times,caster:W.caster}}if(K&&K.type){var et=K.frame||0;4!=K.type&&(et+=X?X.frame:0,t||(et+=1)),d={type:K.type,frame:et,trig:0,shake:K.shake,times:K.times}}if(s.sound){var rt=s.sound.length,nt=s.sound[Math.floor(Math.random()*rt)],at=nt.split(":");b=!0,i.soundId||(i.soundId=IDUtils.genID("battleSound")),SoundUtils.playBattleSound(4,r.$eid,this.scene.stepTotal,i.soundId,"",0,at[0],+at[1]||1,1,+at[3]||0)}}if(H&&i.hold&&App.dispatch("c58",{targets:u,boss:f,oldHps:O}),j=!1,u.forEach(function(e){if(h=6!=V,x=e.isDead,v=!0,Y=0,T=null,w=null,A=null,D=!1,P=!1,C=!1,B=!1,4==V){var t=Fixed.value(m).mul(i.multiply).add(i.x).value,n=Fixed.value(i.y).add(y).value;v=Fixed.distance(t,n,e.x,e.y)<=g}else 9==V?v=Fixed.value(i.y).sub(e.y).abs().value<=g:10==V&&(v=Fixed.value(i.x).sub(e.x).abs().value<=g);if(v){T=s.buff&&e.buff.addBuff(r,R,F,s.buff,M,0,0,!1,Q,L),s.hbuff&&s.hbuff.forEach(function(t){var i=r.buff.getBuffLv(t,0);i&&(w=s.hbuff&&e.buff.addBuff(r,R,i,t,M,0,0,!1,Q,L),w&&w.damage&&w.damage<Y&&(Y=w.damage),!_&&w&&w.buffCfg.state&&-1!=w.buffCfg.state.indexOf(17)&&(_=!0),p||(p=!0),C||(C=!0),w&&(D=!0))}),A=s.sbuff&&e.buff.addBuff(r,R,F,s.sbuff,M,0,0,!1,0,L),T&&T.damage&&T.damage<Y&&(Y=T.damage),A&&A.damage&&A.damage<Y&&(Y=A.damage);var o;s.dbuff&&s.dbuff.forEach(function(t){o=e.buff.addBuff(r,R,F,t,M,0,0,!1,0,L),o&&(!_&&o.buffCfg.state&&-1!=o.buffCfg.state.indexOf(17)&&(_=!0),o.damage&&o.damage<Y&&(Y=o.damage),p||(p=!0),C||(C=!0))});var l;s.lvbuff&&s.lvbuff.forEach(function(t){var i=r.buff.getBuffLv(t,0);i>0&&(l=e.buff.addBuff(r,R,i,t,M,0,0,!1,Q,L),l&&(!_&&l.buffCfg.state&&-1!=l.buffCfg.state.indexOf(17)&&(_=!0),l.damage&&l.damage<Y&&(Y=l.damage),C||(C=!0)))}),(T&&T.buffCfg.state&&-1!=T.buffCfg.state.indexOf(17)||A&&A.buffCfg.state&&-1!=A.buffCfg.state.indexOf(17)||_)&&e.state.setTemptInfo(r,i),!p&&(A||T||D)&&(p=!0),!C&&(A||T||D)&&(C=!0),(A||!T&&!D)&&(h=!1),!T&&!D||q||(q=!0),i.hitMax&&(i.hitTimes[e.$eid]=(i.hitTimes[e.$eid]||0)+1),(T||D||A||s.skip)&&!i.params.helpRid&&e.side!=i.side&&e instanceof Avatar&&(S=!0),(T||D||A)&&a.addCallLater(i.onDelayHitTargetAfter,i,1,!1,!1,0,e,r,!1,R),k=s.atid,C&&k&&r.isBulletActive(k)&&(E=BulletExtra.create(r,e,k,1,R,F),E&&(E.vampireRate=i.params.vampireRate,r.skill.onTrigBullet(E)))}if((s.skip||h)&&!(r instanceof NorMonster)){var u=i.showTimes[e.$eid]||0;if(!i.max||u<i.max){j=!0,i.showTimes[e.$eid]=u+1;var c=e.props.gv("maxHp");Y&&e.isDead&&!(e instanceof Boss)&&i.scene.seedr.random<=Fixed.value(Y).abs().mul(100).div(c).pow(1.15).div(200).value?(e.guise&&e.guise.addHitEffect(i.caster,60002,z,!1),P=!0,B=!0,e.dead(!1,!0,!0)):s.openAir&&(e.state.hasState(114)||e.state.hasState(115))?(I=s.atype||0,x||!e.isDead||e.state.hasState(114)||2==I||1==I||5==I?(P=e.state.hurt(r,i,s,I,e.state.hasState(103)&&e.isAir&&s.ahold,s.aaction,s.aav||[],z,d,s.isHold),B=!1):(P=e.state.hurt(r,i,s,2,!1,null,[200,350],z,d,!1),B=!1)):x||!e.isDead||e.state.hasState(114)||2==V||1==V||5==V?(P=e.state.hurt(r,i,s,V,!1,s.action,G,z,d,s.isHold),B=!1):(P=e.state.hurt(r,i,s,2,!1,null,[200,350],z,d,!1),B=!1),s.damage&&e.onHitBalance(s.damage)}}s.filter&&!B&&(T||D||P)&&e.guise&&e.guise.playSpecialFilter(s.filter),s.eff&&(A||T||D||P)&&e.guise&&e.guise.addHitEffect(r,s.eff,z,b),S&&a.trigAvatarBehurt(e,r)}),j&&X&&(1!=X.caster&&i.setStillInfo(X),2!=X.caster&&r.state.actionState instanceof SkillState&&r.state.actionState.skillId==i.skillId&&(!t&&X.trig++,r.state.actionState.setStillInfo(X))),H&&p&&r.agent&&r.agent.combo&&r.agent.combo.add(Fixed.value(Q).add(1).value),q&&l&&o){var ot=void 0,st=void 0;if(o==r||l.owner&&o.prid==i.prid?(ot=!0,st=!1):r instanceof Monster&&(ot=!0,st=!0),ot){var lt=DeviceUtils.isMobile?l.mobile||1.5:1;a.guise&&a.guise.content&&ShakeEffect.start(a.guise.content,(l.hor||0)*lt,(l.ver||0)*lt,1e3*(l.time||0),0,null,st)}}return p&&(a.trigAI(11,r,i.bid),r.ai.trig(39),r.buff.dealTrigBuff(23,0,null,r,!1,R),r.buff.dealTrigBuff(29,0,null,r,!1,R)),s.sign&&a.trigAI(36,r,i,i.bulletCfg.sign),!0}if(l&&l.ignore&&o){var ot=void 0,st=void 0;if(o==r||l.owner&&o.prid==i.prid?(ot=!0,st=!1):r instanceof Monster&&(ot=!0,st=!0),ot){var lt=DeviceUtils.isMobile?l.mobile||1.5:1;a.guise&&a.guise.content&&ShakeEffect.start(a.guise.content,(l.hor||0)*lt,(l.ver||0)*lt,1e3*(l.time||0),0,null,st)}}return s.sign&&a.trigAI(36,r,i,i.bulletCfg.sign),!1},t.prototype.onDelayHitTargetAfter=function(e,t,i,r,n){i.buff&&(i.buff.dealTrigBuff(26,e,t,i,r,n),i.buff.dealTrigBuff(30,e,t,i,r,n))},t.prototype.setStillInfo=function(e){var t=this;e&&(t.stillType=e.type,t.stillTrig=e.trig,t.stillFrame=e.frame,t.slowFrames=e.frame,t.slowTimes=e.times,t.curSlowFrame=1,t.curSlowTimes=0)},t.prototype.onTrigBullet=function(e){var t=this,i=t.bulletCfg.trigs;if(i){e>=i.length&&(e=0),t.trigIndex=e;var r=i[e];if(r){t.bulletTimes++;var n,a=t.caster;r.ids&&r.ids.forEach(function(e){a.isBulletUnactive(e)||(n=BulletExtra.create(a,t,e,0,t.skillId,t.skillLv),n&&(n.vampireRate=t.params.vampireRate,a.skill.onTrigBullet(n)))}),r.aids&&r.aids.forEach(function(e){a.isBulletActive(e)&&(n=BulletExtra.create(a,t,e,0,t.skillId,t.skillLv),n&&(n.vampireRate=t.params.vampireRate,a.skill.onTrigBullet(n)))})}}},t.prototype.updatePos=function(e,t,i,r){var n=this,a=n.scene;n.ox=e,n.oy=t,n.oz=i,e=Math.round(e),t=Math.round(t),i=Math.round(i),!a||a.master_bullet!=n||a.cdirty||n.x==e&&n.y==t||(n.scene.cdirty=!0),n.x=e,n.y=t,n.z=i,n.changeDirection(r)},t.prototype.onBulletEnd=function(e){var t=this,i=t.caster;if(!e&&i){var r=t.bulletCfg;if(r){var n;r.etids&&r.etids.forEach(function(e){i.isBulletUnactive(e)||(n=BulletExtra.create(i,t,e,0,t.skillId,t.skillLv),n&&(n.angle=t.params.angle,n.vampireRate=t.params.vampireRate,i.skill.onTrigBullet(n)))}),r.aetids&&r.aetids.forEach(function(e){i.isBulletActive(e)&&(n=BulletExtra.create(i,t,e,0,t.skillId,t.skillLv),n&&(n.angle=t.params.angle,n.vampireRate=t.params.vampireRate,i.skill.onTrigBullet(n)))})}}t.scene.addCallLater(t.receiveLeaveScene,t,1,!1,!1)},t.prototype.onLeaveScene=function(){var e=this,t=e.scene;if(e.params.cameraFollow&&(e.scene.master_kill=null),3==e.trigCfg.move){var i=e.caster;i instanceof Avatar&&i.updateSpecialSpd(0),e==t.master_bullet&&(t.master_bullet=null,t.cdirty=!0)}t.$isRemoved||(t.trigAI(10,e.caster,e.bid),t.removeCallLater(e)),SoundUtils.onBattleActionEnd(e.soundId),e.dispatch("onRemoved",{target:e})},t.prototype.onLeftScene=function(){},t.prototype.updateRect=function(){var e=this;e.rect||(e.rect=ObjectPool.pop(Rect,"IntersectRect"));var t=Data.getLvIndexValue(e.bulletCfg.buffs,e.hitIndex,{}),i=Fixed.value(1).add(e.rrate).value,r=Fixed.value(t.w||1).mul(i).ceil().value,n=Fixed.value(t.h||1).mul(i).ceil().value,a=e.multiply,o=Fixed.value(t.offx||0).mul(i).ceil().mul(a).value,s=Fixed.value(t.offy||0).mul(i).ceil().value,l=Fixed.value(r).mul(.5).floor().add(e.x).add(o).sub(1==a?0:r).value,u=Fixed.value(n).mul(.5).floor().add(e.y).sub(e.z).add(s).value;e.hitRange=t.z||0,e.rect.reset(l,u,r,n,e.trigCfg.rotate?t.angle||0:e.angle)},t.prototype.onFrameEvent=function(e,t,i){var r=this;if(Functor.assert(!!e,"子弹特效配置ID："+r.effectCfg.id+" 子弹特效资源："+r.effectCfg.res+" 缺少动作配置上层动作数据:"+t),e.events){var n=e.events[i];if(n&&n.length){var a=r.caster.$eid,o=r.caster.scene.stepTotal;n.forEach(function(e){switch(e[0]){case"playShake":SceneMgr.onFrameShake(r.scene,r,e[1]);break;case"sound":r.soundId||(r.soundId=IDUtils.genID("battleSound")),SceneMgr.onFrameSound(a,o,r.soundId,t,i,e[1])}})}}},t.prototype.onStopPvERound=function(){var e=this;e.isClient&&e.trigCfg&&!e.trigCfg.phold&&e.receiveLeaveScene()},t.prototype.onNextRound=function(){var e=this,t=e.guise;e.updateVisible(),t&&(e.scene.addGuise(t),t.onNextRound())},t.prototype.updateVisible=function(){var e=this,t=e.scene,i=e.caster;if(t&&i){var r,n=t.player;r=i instanceof Pet?e.hold?t.ownerPetEffect:n&&e.side==n.side?t.teamPetEffect:n&&e.side!=n.side?t.enemyPetEffect:!0:e.hold||n&&n.side!=e.side||!e.prid?!0:e.scene.battleEffect,e.visible_guise=r}},t.prototype.onDestroy=function(){var t=this;t.scene&&!t.scene.$isRemoved&&t.scene.removeCallLater(t),e.prototype.onDestroy.call(this);var i=this.params;i&&i.dispose(),ObjectUtils.clearKeys(t,["caster","trigCfg","bulletCfg","effectCfg","actionCfg","hitFrames","upperActionData","lowerActionData","showTimes","hitTimes","trigFrames","slowTimes","soundId","followTarget"])},t}(Sprite);__reflect(Bullet.prototype,"Bullet"),window.Bullet=Bullet;var ChampionRoom=function(e){function t(t,i,r,n){return void 0===i&&(i=0),void 0===r&&(r=null),void 0===n&&(n=null),e.call(this,t,i,r,n)||this}return __extends(t,e),t}(PvPRoom);__reflect(ChampionRoom.prototype,"ChampionRoom"),window.ChampionRoom=ChampionRoom;var ChampionTwoRoom=function(e){function t(t,i,r,n){void 0===i&&(i=0),void 0===r&&(r=null),void 0===n&&(n=null);var a=e.call(this,t,i,r,n)||this;return a.points={},a.lastKillerTimes={},a}return __extends(t,e),t.prototype.onAvatarDeadAfter=function(t,i,r){var n=this,a=n.points,o=a[i.side];o||(o=a[i.side]={}),o[i.prid]=(o[i.prid]||0)+1,n.lastKillerTimes[i.side]=n.stepTotal,t.agent.clearReliveTime();var s=n.addCallLater(n.onDelayAgentRelive,n,Data.getSysValue("CHAMPION_RELIVE_TIME"),!0,!1,t.agent);t.agent.waitReliveTimeId=s,e.prototype.onAvatarDeadAfter.call(this,t,i,r)},t.prototype.onDelayAgentRelive=function(e){e&&e.onRelive(0)},t.prototype.checkAllPlayerDead=function(){var t=this;if(t.timeout>0&&t.startSeconds>=t.timeout){var i=t.battleSideList,r=t.lastKillerTimes,n=[],a=0,o=void 0;for(var s in i)o=t.getSideTotalPoint(+s),a+=o,n.push({side:+s,point:o,time:r[s]||0});if(0!=a){ArrayUtils.sortOn(n,["point","time","side"],[18,16,16]);var l=n[0];t.passRound(l?l.side:0)}}else 0==t.timeout&&e.prototype.checkAllPlayerDead.call(this)},t.prototype.onStopRound=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];this.clearReliveTime(),e.prototype.onStopRound.apply(this,t)},t.prototype.onBattleTimeOut=function(){this.checkAllPlayerDead(),App.dispatch("c102")},t.prototype.clearReliveTime=function(){this.agentList&&this.agentList.forEach(function(e){e.clearReliveTime()})},t.prototype.passRound=function(e){void 0===e&&(e=0),this.isPlaying&&this.syncPvPResult(e)},t.prototype.getSideTotalPoint=function(e){var t=this.points[e],i=0;for(var r in t)i+=t[r]||0;return i},t.prototype.getPvPResultExtra=function(t,i){var r=e.prototype.getPvPResultExtra.call(this,t,i);return r.points=this.points,r},t.prototype.onDestroy=function(){e.prototype.onDestroy.call(this),ObjectUtils.clearKeys(this,["points","lastKillerTimes"])},t}(PvPRoom);__reflect(ChampionTwoRoom.prototype,"ChampionTwoRoom"),window.ChampionTwoRoom=ChampionTwoRoom;var ChaosRoom=function(e){function t(t,i,r,n){return void 0===i&&(i=0),void 0===r&&(r=null),void 0===n&&(n=null),e.call(this,t,i,r,n)||this}return __extends(t,e),Object.defineProperty(t.prototype,"resultPanelId",{get:function(){return 141},enumerable:!0,configurable:!0}),t}(RelayRoom);__reflect(ChaosRoom.prototype,"ChaosRoom"),window.ChaosRoom=ChaosRoom;var PullRotationAction=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.setActionInfo=function(t,i,r,n,a,o,s){e.prototype.setActionInfo.call(this,t,i,r,n,a,o,s);var l,u=this,c=u.owner,p=u.subActions,d=Fixed.millisecond(a[0]),f=!a[6];u.frame=0,u.ttime=d,u.circle=a[1]||0,u.overRatio=a[2]||0,u.useWeight=!a[3],u.direction=a[4]?-1:1,a[5]&&(u.direction=Fixed.value(u.direction).mul(t.multiply).value);var h=u.useWeight?c.props.gv("weight"):50,v=Fixed.value(50).div(h).value;u.coorx=Fixed.value(c.x).sub(i.x).value,u.coory=Fixed.value(c.y).sub(i.y).value;var m=Fixed.value(u.coory).div(u.overRatio).div(u.coorx).value||0;u.radian=Fixed.value(m).atan().neg().add(u.coorx>0?0:Fixed.PI).value;var y=Fixed.value(u.coory).div(u.overRatio).pow(2).value;u.radius=Fixed.value(u.coorx).pow(2).add(y).pow(.5).value,u.radianSpd=Fixed.value(v).mul(2).mul(Fixed.PI).div(u.circle).div(60).mul(u.direction).value,u.radiusSpd=Fixed.value(v).mul(u.radius).mul(.0175).value,d||(f=!0),u.depend=f,f&&i.addListener("onRemoved",u.onBulletRemoved,u),l=ObjectPool.pop(SubPullRotationAction),l.initialize(u,n||"behit_stand",r?90:2,d,u.owner.isAir?114:0),p.push(l)},t.prototype.onBulletRemoved=function(){this.onAllSubActionEnd()},t.prototype.onDestroy=function(){var t=this;t.depend&&t.bullet.removeListener("onRemoved",t.onBulletRemoved,t),t.ttime=0,t.coorx=0,t.coory=0,t.circle=0,t.overRatio=0,t.frame=0,t.radian=0,t.radianSpd=0,t.radius=0,t.radiusSpd=0,t.useWeight=!1,t.depend=!1,e.prototype.onDestroy.call(this)},t}(HurtAction);__reflect(PullRotationAction.prototype,"PullRotationAction"),window.PullRotationAction=PullRotationAction;var PullRowAction=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.setActionInfo=function(t,i,r,n,a,o,s){e.prototype.setActionInfo.call(this,t,i,r,n,a,o,s);var l,u=this,c=u.owner,p=u.subActions,d=Fixed.millisecond(a[0]),f=!a[2],h=Fixed.value(a[7]||0).add(i.y).value;u.time=u.cstime=u.disy=u.lastDisy=u.disz=u.lastDisz=0,u.ttime=d,u.ctime=Fixed.millisecond(a[1]),u.stime=Fixed.millisecond(a[8]),u.disy=Fixed.value(h).sub(c.y).abs().value,u.disz=a[6]?0:Fixed.value(c.z).neg().value,u.multiply=c.y>h?-1:1,u.stopDis=a[2]||0,u.useWeight=!a[4],d||(f=!0),u.depend=f,f&&i.addListener("onRemoved",u.onBulletRemoved,u),l=ObjectPool.pop(SubPullRowAction),l.initialize(u,n||"behit_stand",r?90:2,d,u.owner.isAir?114:0),p.push(l)},t.prototype.onBulletRemoved=function(){this.onAllSubActionEnd()},t.prototype.onDestroy=function(){var t=this;t.depend&&t.bullet.removeListener("onRemoved",t.onBulletRemoved,t),t.ttime=0,t.ctime=0,t.time=0,t.stime=0,t.cstime=0,t.disy=0,t.disz=0,t.lastDisy=0,t.lastDisz=0,t.stopDis=0,t.useWeight=!1,t.depend=!1,e.prototype.onDestroy.call(this)},t}(HurtAction);__reflect(PullRowAction.prototype,"PullRowAction"),window.PullRowAction=PullRowAction;var CityFruit=function(e){function t(t,i,r,n){return void 0===i&&(i=0),void 0===r&&(r=null),void 0===n&&(n=null),e.call(this,t,i,r,n)||this}return __extends(t,e),Object.defineProperty(t.prototype,"guiseClass",{get:function(){return GCityFruit},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"resId",{get:function(){return this.heroResCfg.res},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"heroUrl",{get:function(){return Urls.hero()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"spd",{get:function(){if(this.specialSpd)return this.specialSpd;var e=Data.getOppItem("AttData","spd");return Data.expr(e.id,this)},enumerable:!0,configurable:!0}),t.prototype.gv=function(e){var t=Data.getOppItem("AttDouble",e);return this[t.name]||0},t.prototype.setParams=function(e){e&&(this.isClient=!0,ObjectUtils.assignKeys(e,this,["roomsn","prid","fruitId"]))},t.prototype.onCreate=function(){e.prototype.onCreate.call(this);var t=this;t.fruitCfg=Data.getItem("FruitMonsterData",t.fruitId),t.heroId=t.fruitCfg.heroId,t.heroCfg=Data.getItem("HeroData",t.heroId),t.heroResCfg=Data.getItem("HeroResData",t.heroCfg.guise),t.spdInc=0,t.endx=50,t.endy=100,t.followTick=300,t.curTick=t.followTick;var i=t.heroCfg.prop;if(i){var r="spdBase",n=Data.getOppItem("AttDouble",r);i.forEach(function(e){(e.name==n.name||+e.name==n.id)&&(t.spdBase=e.val||0)})}else t.spdBase=0},t.prototype.onEnteredScene=function(){e.prototype.onEnteredScene.call(this);var t=this;t.canbeHit=!1,t.agent.onAddFruit(t),t.idle()},t.prototype.onLeftScene=function(){this.agent.onRemoveFruit(this),e.prototype.onLeftScene.call(this)},t.prototype.onEnterFrame=function(t){e.prototype.onEnterFrame.call(this,t);var i=this;if(i.updateGuiseVisible(),i.curTick){if(i.curTick-=t,i.curTick<=0){var r=i.getFollowAgent();r?i.onStartFollow(r):i.curTick=i.followTick}}else i.moving&&i.onMoveToPos()},t.prototype.changeDirection=function(e){var t=this;t.right!=e&&(t.right=e,t.guise&&t.guise.updateDirection(t.direction))},t.prototype.idle=function(){this.playAction("idle",this.direction)},t.prototype.playAction=function(e,t){this.guise&&this.guise.playAction(e,t)},t.prototype.updateGuiseVisible=function(){this.guise&&this.guise.updateGuiseVisible()},t.prototype.onStartFollow=function(e){var t=this;t.curTick=0,t.moving||(t.playAction("run",this.direction),t.moving=!0),t.target=e},t.prototype.onMoveToPos=function(){var e=this,t=e.target;if(t){e.updateSpdByPos(e.x,e.y,t.x,t.y);var i=1,r=e.ox,n=e.speedx*i;n>0?r=Math.min(e.ox+n,t.x):0>n&&(r=Math.max(e.ox+n,t.x));var a=e.oy,o=e.speedy*i;o>0?a=Math.min(e.oy+o,t.y):0>o&&(a=Math.max(e.oy+o,t.y)),r=e.scene.limitX(r),a=e.scene.limitY(a);var s=void 0,l=e.target;s=l?l.x==e.x?!l.right:l.x>e.x:n?n>0:l.right,e.updatePos(r,a,e.z,s),Math.abs(t.x-e.x)<=e.endx&&Math.abs(t.y-e.y)<=e.endy&&e.onStopFollow()}},t.prototype.onStopFollow=function(){var e=this;e.moving&&(e.moving=!1,e.target=null,e.curTick=this.followTick,e.idle())},t.prototype.moveToDestEnd=function(){this.onStopFollow()},t.prototype.onStopPvERound=function(){this.isClient&&this.receiveLeaveScene()},t.prototype.getFollowAgent=function(){var e=this,t=e.agent;return t&&(Math.abs(e.x-t.x)>e.endx||Math.abs(e.y-t.y)>e.endy)?t:null},t.prototype.onDestroy=function(){var t=this;e.prototype.onDestroy.call(this),t.fruitCfg=null,t.heroCfg=null,t.heroResCfg=null},t}(Sprite);__reflect(CityFruit.prototype,"CityFruit"),window.CityFruit=CityFruit;var CityScene=function(e){function t(t,i,r,n){return void 0===i&&(i=0),void 0===r&&(r=null),void 0===n&&(n=null),e.call(this,t,i,r,n)||this}return __extends(t,e),t.prototype.onCreate=function(){},t}(Scene);__reflect(CityScene.prototype,"CityScene"),window.CityScene=CityScene;var CrossAccount=function(e){function t(i,r,n,a){void 0===r&&(r=0),void 0===n&&(n=null),void 0===a&&(a=null);var o=e.call(this,i,r,n,a)||this;return t["in"]=o,o}return __extends(t,e),t.prototype.onCreate=function(){this.checkToken()},t.prototype.checkToken=function(){this.active&&this.gateway.checkToken(ServiceMgr.getToken(this.$channel))},t.prototype.onCheckToken=function(e){e&&Prompt.msgId(e)},t}(GameEntity);__reflect(CrossAccount.prototype,"CrossAccount"),window.CrossAccount=CrossAccount;var CrossPlayer=function(e){function t(i,r,n,a){void 0===r&&(r=0),void 0===n&&(n=null),void 0===a&&(a=null);var o=e.call(this,i,r,n,a)||this;return t["in"]=o,o}return __extends(t,e),t.prototype.createCom=function(){var e=this;ServiceMgr.createGameCom;e.addResMgr()},t.prototype.addResMgr=function(){},t.prototype.onCreate=function(){e.prototype.onCreate.call(this)},t.prototype.enterSceneOK=function(e){},t.prototype.enterScene=function(e,t,i,r){},t.prototype.onDestroy=function(){t["in"]=null},t}(Agent);__reflect(CrossPlayer.prototype,"CrossPlayer"),window.CrossPlayer=CrossPlayer,window.CrossPlayerReg=CrossPlayerReg;var Elite=function(e){function t(t,i,r,n){return void 0===i&&(i=0),void 0===r&&(r=null),void 0===n&&(n=null),e.call(this,t,i,r,n)||this}return __extends(t,e),Object.defineProperty(t.prototype,"guiseClass",{get:function(){return GElite},enumerable:!0,configurable:!0}),t.prototype.onEnteredScene=function(){e.prototype.onEnteredScene.call(this),this.canBeKill=!0},t}(Monster);__reflect(Elite.prototype,"Elite"),window.Elite=Elite;var EntertainRoom=function(e){function t(t,i,r,n){return void 0===i&&(i=0),void 0===r&&(r=null),void 0===n&&(n=null),e.call(this,t,i,r,n)||this}return __extends(t,e),Object.defineProperty(t.prototype,"hasMvp",{get:function(){return this.isSingleFight?!1:this.roomCfg.mvp},enumerable:!0,configurable:!0}),t.prototype.buildPlayData=function(){this.playCfg=Data.getItem("EntertainData",this.entertainId)},t}(PvPRoom);__reflect(EntertainRoom.prototype,"EntertainRoom"),window.EntertainRoom=EntertainRoom;var FairRoom=function(e){function t(t,i,r,n){return void 0===i&&(i=0),void 0===r&&(r=null),void 0===n&&(n=null),e.call(this,t,i,r,n)||this}return __extends(t,e),t.prototype.getPvPResultExtra=function(t,i){var r=e.prototype.getPvPResultExtra.call(this,t,i);return r.mvps=this.getBattleMvps(),r.ranks=this.getBattleScoreRanks(t),r},t}(PvPRoom);__reflect(FairRoom.prototype,"FairRoom"),window.FairRoom=FairRoom;var FairyLandRoom=function(e){function t(t,i,r,n){return void 0===i&&(i=0),void 0===r&&(r=null),void 0===n&&(n=null),e.call(this,t,i,r,n)||this}return __extends(t,e),Object.defineProperty(t.prototype,"resultPanelId",{get:function(){return 141},enumerable:!0,configurable:!0}),t}(RelayRoom);__reflect(FairyLandRoom.prototype,"FairyLandRoom"),window.FairyLandRoom=FairyLandRoom;var FairyLandTrialsRoom=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.onCreate=function(){e.prototype.onCreate.call(this);var t=this,i=Data.getItem("FairyLandTrialsData",t.configId),r=t.layer,n=t.trialsProps={};t.startLayer=r-1,t.trialsCfg=i,t.isPetSally=2==i.t;var a=i.prop;if(i.lvFun&&(t.monsterLevel=Data.exprts(i.lvFun,r)),i.aFun&&(t.equipScore=Data.exprts(i.aFun,r)),i.verifyPower&&(t.verifyPower=Data.exprts(i.verifyPower,r)),a){var o=n[0]=[],s=n[100]=[],l=n[200]=[];a.forEach(function(e){e.name&&e.fun&&(o.push({name:e.name,val:Data.exprd(e.fun,r,0)}),s.push({name:e.name,val:Data.exprd(e.fun,r,100)}),l.push({name:e.name,val:Data.exprd(e.fun,r,200)}))})}t.openUI=1911},Object.defineProperty(t.prototype,"scenePanelId",{get:function(){return this.isPetSally?201:120},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"resultPanelId",{get:function(){return 154},enumerable:!0,configurable:!0}),t.prototype.getEquipScore=function(){return this.equipScore||0},t.prototype.getVerifyPower=function(){return this.verifyPower||0},t.prototype.onWin=function(t,i,r,n,a){for(var o=[],s=5;s<arguments.length;s++)o[s-5]=arguments[s];this.layer=a,e.prototype.onWin.apply(this,[t,i,r,n,a].concat(o))},t.prototype.createSpawnMonsterInfo=function(t,i,r){var n=e.prototype.createSpawnMonsterInfo.call(this,t,i,r);return n.extraProps=this.trialsProps[n.type],n.level=this.monsterLevel,n},t.prototype.onAvatarDeadBefor=function(e,t,i){var r=e.agent;e.petId&&r.checkHasNextAvatar(e.petId)?r.createAvatar():r.onAvatarDead(t,i)},t.prototype.onDestroy=function(){e.prototype.onDestroy.call(this),this.trialsProps=null},t}(RelayRoom);__reflect(FairyLandTrialsRoom.prototype,"FairyLandTrialsRoom"),window.FairyLandTrialsRoom=FairyLandTrialsRoom;var Fruit=function(e){function t(t,i,r,n){return void 0===i&&(i=0),void 0===r&&(r=null),void 0===n&&(n=null),e.call(this,t,i,r,n)||this}return __extends(t,e),Object.defineProperty(t.prototype,"aiClass",{get:function(){return FruitAI},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"skillClass",{get:function(){return FruitSkill},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"guiseClass",{get:function(){return GFruit},enumerable:!0,configurable:!0}),t.prototype.setParams=function(e){e&&(this.isClient=!0,ObjectUtils.assignKeys(e,this,["roomsn","side","prid","fruitId","heroId"]))},t.prototype.onCreate=function(){e.prototype.onCreate.call(this),this.fruitCfg=Data.getItem("FruitMonsterData",this.fruitId)},t.prototype.onEnterScene=function(){e.prototype.onEnterScene.call(this);var t=this,i=t.scene.getAgent(t.prid),r=i.avatar;r?t.updatePos(r.x,r.y,0,r.right):t.updatePos(0,0,0,!0)},t.prototype.onEnteredScene=function(){var t=this;t.canbeHit=!1,t.agent.onAddFruit(t),e.prototype.onEnteredScene.call(this);var i=t.agent.avatar;if(i){var r=i.buff.xianMoXBuff;r&&r.caster&&!r.caster.isDead&&t.buff.addBuff(r.caster,r.skillId,r.skillLv,r.buffId)}t.skill.startInitCd()},t.prototype.onStopPvERound=function(){this.skill&&this.skill.clearPortalDelayBullet()},t.prototype.onStopPvPRound=function(t){e.prototype.onStopPvPRound.call(this,t),this.side!=t&&this.receiveLeaveScene()},t.prototype.onLeftScene=function(){this.agent.onRemoveFruit(this),e.prototype.onLeftScene.call(this)},t.prototype.onDestroy=function(){var t=this;e.prototype.onDestroy.call(this);var i=this.params;i&&i.dispose(),ObjectUtils.clearKeys(t,["fruitCfg"])},t}(Role);__reflect(Fruit.prototype,"Fruit"),window.Fruit=Fruit;var GhostKingRoom=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.level=1,t}return __extends(t,e),t.prototype.onCreate=function(){e.prototype.onCreate.call(this);var t=Data.getItem("GhostKingTroubledData",1001);if(t){var i=t.prop,r=this.props=[];if(i){var n=Data.getBossAbility1(this.lv,this.star);this.level=Data.exprd(t.lvFun,n)||1,i.forEach(function(e){e.name&&e.fun&&r.push({name:e.name,val:Data.exprd(e.fun,n)})})}}},t.prototype.createSpawnMonsterInfo=function(t,i,r){var n=e.prototype.createSpawnMonsterInfo.call(this,t,i,r);
return n.extraProps=this.props,n.level=this.level,n},t.prototype.onLeaveMap=function(){e.prototype.onLeaveMap.call(this)},Object.defineProperty(t.prototype,"resultPanelId",{get:function(){return 141},enumerable:!0,configurable:!0}),t.prototype.isHideLv=function(e){return!0},t.prototype.onWin=function(t,i,r,n,a){for(var o=[],s=5;s<arguments.length;s++)o[s-5]=arguments[s];e.prototype.onWin.apply(this,[t,i,r,n].concat(o))},t}(RelayRoom);__reflect(GhostKingRoom.prototype,"GhostKingRoom"),window.GhostKingRoom=GhostKingRoom;var InfernalHellRoom=function(e){function t(t,i,r,n){void 0===i&&(i=0),void 0===r&&(r=null),void 0===n&&(n=null);var a=e.call(this,t,i,r,n)||this,o=a;return o.agentSelectedBuff={},o.isSelectedMap={},o.randomTimesMap={},o.agentRandomBuff={},a}return __extends(t,e),Object.defineProperty(t.prototype,"resultPanelId",{get:function(){return 142},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scenePanelId",{get:function(){var e=this.dtype;return 1===e?125:2===e?126:3===e?127:4==e?260:void 0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isTimeLimit",{get:function(){return 1===this.dtype},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isRandomBuff",{get:function(){return 2===this.dtype},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isNoUseItem",{get:function(){return 3===this.dtype},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isProtNpc",{get:function(){return 4===this.dtype},enumerable:!0,configurable:!0}),t.prototype.startScene=function(t,i,r,n){for(var a=[],o=4;o<arguments.length;o++)a[o-4]=arguments[o];this.bossBuffs=n,e.prototype.startScene.apply(this,[t,i,r,n].concat(a))},t.prototype.createSpawnMonsterInfo=function(t,i,r){var n=e.prototype.createSpawnMonsterInfo.call(this,t,i,r);return n.type>=200&&(n.extraBuffs=this.bossBuffs),n},t.prototype.onMonsterDeadBegin=function(t,i,r){if(e.prototype.onMonsterDeadBegin.call(this,t,i,r),this.isTimeLimit&&r){var n=this.agentInfos[i.prid];n&&(n.killNum+=1,n.hold&&App.dispatch("c93",{killer:i,target:t.$eid}))}},t.prototype.cmd_selectRandomBuff=function(e,t){var i=this;if(i.needVerify&&RecordMgr.record(31,i.roomsn,i.$eid,e,t),i.isRandomBuff){var r=i.agentSits[e];r&&i.onAgentSelectBuff(r.rid,t)}},t.prototype.cmd_randomBuffAgain=function(e){var t=this;if(t.needVerify&&RecordMgr.record(32,t.roomsn,t.$eid,e),t.isRandomBuff){var i=t.agentSits[e];i&&t.onAgentRandomBuffAgain(i.rid)}},t.prototype.onPassRound=function(t){e.prototype.onPassRound.call(this,t);var i=this;if(i.isRandomBuff){var r=i.agentRandomBuff={};i.isSelectedMap={};var n;i.agentList.forEach(function(e){n=i.getRandomBuffList(e.rid),r[e.rid]=n,e.onRandomBuffList(n)}),i.clearSelectBuffTime(),i.selectBuffTimeId=i.addCallLater(i.onSelectBuffTimeout,i,Data.getSysValue("MAIN_RANDOM_BUFF_TIME_LIMIT"),!0,!1)}},t.prototype.onAgentSelectBuff=function(e,t){var i=this;if(i.isRandomBuff){var r=i.agentRids[e],n=i.agentRandomBuff;if(!r)return void delete n[e];var a=n[e];if(!a)return void(r.hold&&Prompt.msgId(6017));var o=a[t-1];if(!o)return void(r.hold&&Prompt.msgId(6017));var s=i.agentSelectedBuff[e];s||(s=i.agentSelectedBuff[e]={}),s[o.idx]=!0,delete n[e],i.isSelectedMap[e]=!0,r.onSelectRandomBuff(0,o.slotId,o.buffId,o.buffLv)}},t.prototype.onAgentRandomBuffAgain=function(e){var t=this;if(t.isRandomBuff){var i=t.agentRids[e];if(i){var r=t.randomTimesMap,n=r[e]||0,a=t.dungeonCfg.maxRandTimes||0;if(n>=a)return void(i.hold&&Prompt.msgId(2076));var o=t.getRandomBuffList(e);t.agentRandomBuff[i.rid]=o,r[e]=n+1,i.onRandomBuffAgain(0,o)}}},t.prototype.getRandomBuffList=function(e){var t=this;if(t.isRandomBuff){var i=[],r=Data.getSysValue("MAIN_RANDOM_BUFF_POOL");if(!r)return i;if(t.isSelectedMap[e])return i;var n,a=t.agentSelectedBuff[e]||{},o=DropUtils.getRandomWeight(r,3,t.seedr,a);return o.forEach(function(e,t){n=r[e],i.push({idx:e,slotId:t+1,buffId:n.buffId,buffLv:n.buffLv||1})}),i}},t.prototype.onSelectBuffTimeout=function(){this.clearSelectBuffTime();var e,t=this,i=t.agentRandomBuff;for(var r in i){e=i[r];var n=t.seedr.random;t.onAgentSelectBuff(+r,Fixed.value(n).mul(e.length).ceil().value)}},t.prototype.onBattleTimeOut=function(){this.isRandomBuff&&this.clearSelectBuffTime(),e.prototype.onBattleTimeOut.call(this)},t.prototype.onStopRound=function(){this.isRandomBuff&&this.clearSelectBuffTime(),e.prototype.onStopRound.call(this)},t.prototype.clearSelectBuffTime=function(){var e=this.selectBuffTimeId;e&&(this.removeCallLaterIdx(e),this.selectBuffTimeId=0)},t.prototype.onWin=function(t,i,r,n,a){for(var o=[],s=5;s<arguments.length;s++)o[s-5]=arguments[s];e.prototype.onWin.apply(this,[t,i,r,n,a].concat(o))},t.prototype.checkAllowRelive=function(){if(this.isNoUseItem)return!1;var e=this.roomCfg;return e&&e.relive},t.prototype.canShowPortal=function(){if(!this.isPass)return!1;if(this.isRandomBuff){for(var e=!1,t=0,i=this.agentList;t<i.length;t++){var r=i[t];r.curRandomBuffs&&(e=!0)}return!e}return!0},Object.defineProperty(t.prototype,"canUseItem",{get:function(){return 3!=this.dtype},enumerable:!0,configurable:!0}),t.prototype.onDestroy=function(){e.prototype.onDestroy.call(this),ObjectUtils.clearKeys(this,["agentSelectedBuff","isSelectedMap","randomTimesMap","agentRandomBuff","bossBuffs"])},t}(RelayRoom);__reflect(InfernalHellRoom.prototype,"InfernalHellRoom"),window.InfernalHellRoom=InfernalHellRoom;var ItemDungeonRoom=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),Object.defineProperty(t.prototype,"resultPanelId",{get:function(){return 155},enumerable:!0,configurable:!0}),t.prototype.createSpawnMonsterInfo=function(t,i,r){this.props||this.buildProps();var n=e.prototype.createSpawnMonsterInfo.call(this,t,i,r);return this.props&&(n.extraProps=this.props),n.level=this.monsterLevel,n},t.prototype.buildProps=function(){var e=Data.getItem("DunAttrData",1e3);if(e){var t=this.player;if(t){var i=e.items,r=Fixed.value(t.ability).mul(Data.getSysValue("DUN_BATTLE_KEY")||.7).value;if(e.monster&&e.monster.lv&&(this.monsterLevel=Data.exprd(e.monster.lv,r)),i){var n=this.props=[];i.forEach(function(e){e.name&&e.fun&&n.push({name:e.name,val:Data.exprd(e.fun,r)})})}}}},t}(RelayRoom);__reflect(ItemDungeonRoom.prototype,"ItemDungeonRoom"),window.ItemDungeonRoom=ItemDungeonRoom;var LaddersRoom=function(e){function t(t,i,r,n){return void 0===i&&(i=0),void 0===r&&(r=null),void 0===n&&(n=null),e.call(this,t,i,r,n)||this}return __extends(t,e),t.prototype.getPvPResultExtra=function(t,i){var r=e.prototype.getPvPResultExtra.call(this,t,i);return r.mvps=this.getBattleMvps(),r.ranks=this.getBattleScoreRanks(t),r},t}(PvPRoom);__reflect(LaddersRoom.prototype,"LaddersRoom"),window.LaddersRoom=LaddersRoom;var Machine=function(e){function t(t,i,r,n){void 0===i&&(i=0),void 0===r&&(r=null),void 0===n&&(n=null);var a=e.call(this,t,i,r,n)||this;return a.isActivated=!1,a}return __extends(t,e),Object.defineProperty(t.prototype,"guiseClass",{get:function(){return GMachine},enumerable:!0,configurable:!0}),t.prototype.onEnteredScene=function(){e.prototype.onEnteredScene.call(this),this.canbeHit=!1},t.prototype.changeActivated=function(e){var t=this;t.isActivated!=e&&(t.isActivated=e,t.state.normal(112,!1,e?"idle_activated":null,!1,e?2:1),t.scene.trigAI(21,t))},t}(Monster);__reflect(Machine.prototype,"Machine"),window.Machine=Machine;var MainCity=function(e){function t(t,i,r,n){return void 0===i&&(i=0),void 0===r&&(r=null),void 0===n&&(n=null),e.call(this,t,i,r,n)||this}return __extends(t,e),Object.defineProperty(t.prototype,"scenePanelId",{get:function(){return 130},enumerable:!0,configurable:!0}),t.prototype.setParams=function(e){e&&(this.seed=e.seed,this.cityId=e.cityId,this.roomId=e.roomId,this.mapId=e.mapId)},t}(RCity);__reflect(MainCity.prototype,"MainCity"),window.MainCity=MainCity;var MainMultRoom=function(e){function t(t,i,r,n){return void 0===i&&(i=0),void 0===r&&(r=null),void 0===n&&(n=null),e.call(this,t,i,r,n)||this}return __extends(t,e),Object.defineProperty(t.prototype,"resultPanelId",{get:function(){return 141},enumerable:!0,configurable:!0}),t.prototype.onDestroy=function(){e.prototype.onDestroy.call(this)},t}(RelayRoom);__reflect(MainMultRoom.prototype,"MainMultRoom"),window.MainMultRoom=MainMultRoom;var MainNoUseItemRoom=function(e){function t(t,i,r,n){void 0===i&&(i=0),void 0===r&&(r=null),void 0===n&&(n=null);var a=e.call(this,t,i,r,n)||this;return a.isAllPetUp=!0,a}return __extends(t,e),Object.defineProperty(t.prototype,"scenePanelId",{get:function(){return 261},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"resultPanelId",{get:function(){return 148},enumerable:!0,configurable:!0}),t}(RelayRoom);__reflect(MainNoUseItemRoom.prototype,"MainNoUseItemRoom"),window.MainNoUseItemRoom=MainNoUseItemRoom;var MainRandomBuffRoom=function(e){function t(t,i,r,n){void 0===i&&(i=0),void 0===r&&(r=null),void 0===n&&(n=null);var a=e.call(this,t,i,r,n)||this,o=a;return o.agentSelectedBuff={},o.isSelectedMap={},o.randomTimesMap={},o.agentRandomBuff={},a}return __extends(t,e),Object.defineProperty(t.prototype,"scenePanelId",{get:function(){return 126},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"resultPanelId",{get:function(){return 148},enumerable:!0,configurable:!0}),t.prototype.cmd_selectRandomBuff=function(e,t){var i=this;i.needVerify&&RecordMgr.record(31,i.roomsn,i.$eid,e,t);var r=i.agentSits[e];r&&i.onAgentSelectBuff(r.rid,t)},t.prototype.cmd_randomBuffAgain=function(e){var t=this;t.needVerify&&RecordMgr.record(32,t.roomsn,t.$eid,e);var i=t.agentSits[e];i&&t.onAgentRandomBuffAgain(i.rid)},t.prototype.onPassRound=function(t){e.prototype.onPassRound.call(this,t);var i=this,r=i.agentRandomBuff={};i.isSelectedMap={};var n;i.agentList.forEach(function(e){n=i.getRandomBuffList(e.rid),r[e.rid]=n,e.onRandomBuffList(n)}),i.clearSelectBuffTime(),i.selectBuffTimeId=i.addCallLater(i.onSelectBuffTimeout,i,Data.getSysValue("MAIN_RANDOM_BUFF_TIME_LIMIT"),!0,!1)},t.prototype.onAgentSelectBuff=function(e,t){var i=this,r=i.agentRids[e],n=i.agentRandomBuff;if(!r)return void delete n[e];var a=n[e];if(!a)return void(r.hold&&Prompt.msgId(6017));var o=a[t-1];if(!o)return void(r.hold&&Prompt.msgId(6017));var s=i.agentSelectedBuff[e];s||(s=i.agentSelectedBuff[e]={}),s[o.idx]=!0,delete n[e],i.isSelectedMap[e]=!0,r.onSelectRandomBuff(0,o.slotId,o.buffId,o.buffLv)},t.prototype.onAgentRandomBuffAgain=function(e){var t=this,i=t.agentRids[e];if(i){var r=t.randomTimesMap,n=r[e]||0,a=t.dungeonCfg.maxRandTimes||0;if(n>=a)return void(i.hold&&Prompt.msgId(2076));var o=t.getRandomBuffList(e);t.agentRandomBuff[i.rid]=o,r[e]=n+1,i.onRandomBuffAgain(0,o)}},t.prototype.getRandomBuffList=function(e){var t=this,i=[],r=Data.getSysValue("MAIN_RANDOM_BUFF_POOL");if(!r)return i;if(t.isSelectedMap[e])return i;var n,a=t.agentSelectedBuff[e]||{},o=DropUtils.getRandomWeight(r,3,t.seedr,a);return o.forEach(function(e,t){n=r[e],i.push({idx:e,slotId:t+1,buffId:n.buffId,buffLv:n.buffLv||1})}),i},t.prototype.onSelectBuffTimeout=function(){this.clearSelectBuffTime();var e,t=this,i=t.agentRandomBuff;for(var r in i){e=i[r];var n=t.seedr.random;t.onAgentSelectBuff(+r,Fixed.value(n).mul(e.length).ceil().value)}},t.prototype.onBattleTimeOut=function(){this.clearSelectBuffTime(),e.prototype.onBattleTimeOut.call(this)},t.prototype.onStopRound=function(){this.clearSelectBuffTime(),e.prototype.onStopRound.call(this)},t.prototype.clearSelectBuffTime=function(){var e=this.selectBuffTimeId;e&&(this.removeCallLaterIdx(e),this.selectBuffTimeId=0)},t.prototype.canShowPortal=function(){if(!this.isPass)return!1;for(var e=!1,t=0,i=this.agentList;t<i.length;t++){var r=i[t];r.curRandomBuffs&&(e=!0)}return!e},t.prototype.onDestroy=function(){e.prototype.onDestroy.call(this),ObjectUtils.clearKeys(this,["agentSelectedBuff","isSelectedMap","randomTimesMap","agentRandomBuff"])},t}(RelayRoom);__reflect(MainRandomBuffRoom.prototype,"MainRandomBuffRoom"),window.MainRandomBuffRoom=MainRandomBuffRoom;var MainRoom=function(e){function t(t,i,r,n){return void 0===i&&(i=0),void 0===r&&(r=null),void 0===n&&(n=null),e.call(this,t,i,r,n)||this}return __extends(t,e),t.prototype.setParams=function(e){e&&(this.roomsn=e.roomsn,this.roomId=e.roomId,this.mapId=e.mapId,this.mainId=e.mainId,this.dunId=e.dunId,this.diffId=e.diffId,this.dungeonId=e.dungeonId,this.seed=e.seed,this.timeout=e.timeout,this.playId=e.playId,this.battleId=e.battleId,this.needVerify=!1,this.isNoPower=!1)},t.prototype.noOtherBtn=function(){return!1},t.prototype.showDrawCard=function(){for(var t=this,i=Data.getSysValue("NO_DRAW_CARD_DUNGEON"),r=!0,n=0,a=i;n<a.length;n++){var o=a[n];if(o.dunId===t.dunId&&o.diffId===t.diffId&&t.player.firstFlag){r=!1;break}}r&&e.prototype.showDrawCard.call(this)},t}(RelayRoom);__reflect(MainRoom.prototype,"MainRoom"),window.MainRoom=MainRoom;var MainTimeLimitRoom=function(e){function t(t,i,r,n){return void 0===i&&(i=0),void 0===r&&(r=null),void 0===n&&(n=null),e.call(this,t,i,r,n)||this}return __extends(t,e),Object.defineProperty(t.prototype,"scenePanelId",{get:function(){return 125},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"resultPanelId",{get:function(){return 148},enumerable:!0,configurable:!0}),t.prototype.onMonsterDeadBegin=function(t,i,r){if(e.prototype.onMonsterDeadBegin.call(this,t,i,r),r){var n=this.agentInfos[i.prid];n&&(n.killNum+=1,n.hold&&App.dispatch("c93",{killer:i,target:t.$eid}))}},t}(RelayRoom);__reflect(MainTimeLimitRoom.prototype,"MainTimeLimitRoom"),window.MainTimeLimitRoom=MainTimeLimitRoom;var MetalPail=function(e){function t(t,i,r,n){return void 0===i&&(i=0),void 0===r&&(r=null),void 0===n&&(n=null),e.call(this,t,i,r,n)||this}return __extends(t,e),Object.defineProperty(t.prototype,"guiseClass",{get:function(){return GMetalPail},enumerable:!0,configurable:!0}),t.prototype.onVariantData=function(){var e,t=this,i=t.variants,r=i?i.length>0:!1,n=r||t.type>=100||3==t.type?t.name||t.heroCfg.name||"":"";r&&i.forEach(function(i){e=Data.getItem("VariantData",i),e.name&&(n=Msg.phe(2236,e.color,e.name,n)),e.ai&&(t.aiId=e.ai)}),t.isVariant=r,t.name=n},t.prototype.onEnteredScene=function(){e.prototype.onEnteredScene.call(this),this.canBeKill=!0,this.isVariant||(this.visible_top=!1)},t}(Monster);__reflect(MetalPail.prototype,"MetalPail"),window.MetalPail=MetalPail;var ReliveAction=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.play=function(){this.onAllSubActionEnd()},t}(BaseAction);__reflect(ReliveAction.prototype,"ReliveAction"),window.ReliveAction=ReliveAction;var NorMonster=function(e){function t(t,i,r,n){return void 0===i&&(i=0),void 0===r&&(r=null),void 0===n&&(n=null),e.call(this,t,i,r,n)||this}return __extends(t,e),Object.defineProperty(t.prototype,"guiseClass",{get:function(){return GNorMonster},enumerable:!0,configurable:!0}),t.prototype.onEnteredScene=function(){e.prototype.onEnteredScene.call(this),this.canBeKill=!0,this.isVariant||(this.visible_top=!1)},t}(Monster);__reflect(NorMonster.prototype,"NorMonster"),window.NorMonster=NorMonster;var Npc=function(e){function t(t,i,r,n){return void 0===i&&(i=0),void 0===r&&(r=null),void 0===n&&(n=null),e.call(this,t,i,r,n)||this}return __extends(t,e),Object.defineProperty(t.prototype,"guiseClass",{get:function(){return GNpc},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"resId",{get:function(){return this.npcCfg.guise},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"spd",{get:function(){return this.specialSpd||this.npcCfg.spd||0},enumerable:!0,configurable:!0}),t.prototype.setParams=function(e){if(e){var t=this,i=e;t.isClient=!0,t.roomsn=i.roomsn,t.npcId=i.npcId,t.x=i.x,t.y=i.y,t.right=!i.dir,t.key=i.key}},t.prototype.onCreate=function(){e.prototype.onCreate.call(this);var t=this;t.npcCfg=Data.getItem("NpcData",t.npcId),Functor.assert(!!t.npcCfg,"NPC模版数据不存在 npcId："+t.npcId)},t.prototype.changeDirection=function(e){var t=this;t.right!=e&&(t.right=e,t.guise&&t.guise.updateDirection(t.direction))},t.prototype.onEnteredScene=function(){var e=this;e.canbeHit=!1,e.idle(),e.startRandomAction(),App.dispatch("c135",{npc:e})},t.prototype.idle=function(){this.playAction("idle",this.direction,1,!0)},t.prototype.startRandomAction=function(){var e=this;if(!e.randomId){var t=e.npcCfg,i=t.actions;if(i&&i.length){var r=t.mint||0,n=t.maxt||0;e.randomId=e.addOnceTimer(Math.random()*(n-r)+r,e.playRandomAction)}}},t.prototype.playRandomAction=function(){var e=this,t=e.npcCfg;e.playAction(t.actions[Math.floor(Math.random()*t.actions.length)],e.direction,1,!1,!1,e.onRandomActionEnd,e)},t.prototype.onRandomActionEnd=function(){var e=this;e.idle(),e.startRandomAction()},t.prototype.stopRandomAction=function(){var e=this;e.randomId&&(e.delTimer(e.randomId),e.randomId=0)},t.prototype.playAction=function(e,t,i,r,n,a,o,s){void 0===n&&(n=!1);var l=this,u=l.guise;l.stopRandomAction(),n&&l.onActionEnd(),l.action_callback=a,l.action_thisObj=o,l.action_param=s,u&&(!r&&EventCenter.addEvent(u,"actionPlayEnd",l.onPlayEnd,l),u.playAction(e,t,i,r))},t.prototype.onPlayEnd=function(){var e=this;EventCenter.removeEvent(e.guise,"actionPlayEnd",e.onPlayEnd,e),e.onActionEnd()},t.prototype.onActionEnd=function(){var e=this,t=e.action_callback,i=e.action_thisObj,r=e.action_param;e.action_callback=void 0,e.action_thisObj=void 0,e.action_param=void 0,t&&t.apply(i,r)},t.prototype.onEnterFrame=function(t){e.prototype.onEnterFrame.call(this,t),this.moving&&this.onMoveToPos()},t.prototype.moveToPos=function(e,t){var i=this;i.moving||(i.playAction("run",this.direction,1,!0),i.moving=!0),i.dx=i.scene.limitX(e),i.dy=i.scene.limitY(t)},t.prototype.onMoveEnd=function(){var e=this;e.moving&&(e.moving=!1,e.dx=0,e.dy=0,e.idle(),e.startRandomAction())},t.prototype.onMoveToPos=function(){var e=this;if(e.scene.mdirty=!0,e.x==e.dx&&e.y==e.dy)e.onMoveEnd();else{e.updateSpdByPos(e.x,e.y,e.dx,e.dy);var t=e.ox,i=e.speedx;i>0?t=Math.min(e.ox+i,e.dx):0>i&&(t=Math.max(e.ox+i,e.dx));var r=e.oy,n=e.speedy;n>0?r=Math.min(e.oy+n,e.dy):0>n&&(r=Math.max(e.oy+n,e.dy)),e.updatePos(e.scene.limitX(t),e.scene.limitY(r),e.z,i?i>0:e.right)}},t.prototype.onTrigNpc=function(){},t.prototype.onStopPvERound=function(){this.isClient&&this.receiveLeaveScene()},t.prototype.removeGuiseL=function(){EventCenter.removeEvent(this.guise,"actionPlayEnd",this.onPlayEnd,this)},t.prototype.onDestroy=function(){e.prototype.onDestroy.call(this);var t=this;t.npcCfg=null,t.action_callback=void 0,t.action_thisObj=void 0,t.action_param=void 0},t}(Sprite);__reflect(Npc.prototype,"Npc"),window.Npc=Npc;var OfferRewardRoom=function(e){function t(t,i,r,n){return void 0===i&&(i=0),void 0===r&&(r=null),void 0===n&&(n=null),e.call(this,t,i,r,n)||this}return __extends(t,e),Object.defineProperty(t.prototype,"resultPanelId",{get:function(){return 142},enumerable:!0,configurable:!0}),t.prototype.startScene=function(t,i,r,n){for(var a=[],o=4;o<arguments.length;o++)a[o-4]=arguments[o];this.bossBuffs=n,e.prototype.startScene.apply(this,[t,i,r,n].concat(a))},t.prototype.createSpawnMonsterInfo=function(t,i,r){var n=e.prototype.createSpawnMonsterInfo.call(this,t,i,r);return 200==n.type&&(n.extraBuffs=this.bossBuffs),n},t.prototype.onWin=function(t,i,r,n,a){for(var o=[],s=5;s<arguments.length;s++)o[s-5]=arguments[s];e.prototype.onWin.apply(this,[t,i,r,n,a].concat(o))},t.prototype.onDestroy=function(){e.prototype.onDestroy.call(this),this.bossBuffs=null},t}(RelayRoom);__reflect(OfferRewardRoom.prototype,"OfferRewardRoom"),window.OfferRewardRoom=OfferRewardRoom;var PartyAgent=function(e){function t(t,i,r,n){return void 0===i&&(i=0),void 0===r&&(r=null),void 0===n&&(n=null),e.call(this,t,i,r,n)||this}return __extends(t,e),t.prototype.setParams=function(e){e&&ObjectUtils.assignKeys(e,this,["rid","job","head","level","name","svrId","ability","seeOther","invisibily","x","y","right","titleId","fashionId","weaponId","weaFasId","wingFasId","haloId","fruitId"])},t.prototype.onCreate=function(){e.prototype.onCreate.call(this);var t=this;t.heroId=t.jobCfg.heroId,t.heroCfg=Data.getItem("HeroData",t.heroId),t.heroResCfg=Data.getItem("HeroResData",t.heroCfg.guise),t.synPosTime=1e3},t.prototype.onVerifyGuise=function(){var e=this;!e.hold},t.prototype.onEnterFrame=function(t){e.prototype.onEnterFrame.call(this,t);var i=this;if(i.hold){var r=i.synPosTime,n=i.lastSynPos;if(r-=t,0>=r){r=1e3;var a=i.x,o=i.y,s=i.z,l=i.right;n&&n.x==a&&n.y==o&&n.z==s&&n.right==l||(n=i.lastSynPos=i.lastSynPos||{},n.x=a,n.y=o,n.z=s,n.right=l,i.synPos(a,o,s,l))}i.synPosTime=r}},t.prototype.onStopMove=function(){},t.prototype.syncTouchBegin=function(e){},t.prototype.syncTouchEnd=function(){},t.prototype.syncTouchChange=function(e){},t.prototype.syncMoveToPos=function(e,t,i,r){},t.prototype.onMoveToPos=function(e,t,i,r){!this.hold&&this.ai.moveToPos(e,t)},t.prototype.synPos=function(e,t,i,r){},t.prototype.syncInvisibily=function(e){},t.prototype.onInvisibily=function(e){},t.prototype.onTapAgent=function(e){},t.prototype.onDestroy=function(){this.params&&this.params.dispose(),e.prototype.onDestroy.call(this)},t}(CityAgent);__reflect(PartyAgent.prototype,"PartyAgent"),window.PartyAgent=PartyAgent;var PartyBossRoom=function(e){function t(t,i,r,n){return void 0===i&&(i=0),void 0===r&&(r=null),void 0===n&&(n=null),e.call(this,t,i,r,n)||this}return __extends(t,e),Object.defineProperty(t.prototype,"scenePanelId",{get:function(){return 128},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"resultPanelId",{get:function(){return 149},enumerable:!0,configurable:!0}),t.prototype.battleOver=function(t,i){e.prototype.battleOver.call(this,t,i)},t.prototype.isInfiniteHp=function(e){return e instanceof Boss?!0:!1},t.prototype.getBattleResultParams=function(t){var i=e.prototype.getBattleResultParams.call(this,t),r=this.player;return i.damage=r&&r.agentInfo?r.agentInfo.getTotal("damage"):0,i},t}(RelayRoom);__reflect(PartyBossRoom.prototype,"PartyBossRoom"),window.PartyBossRoom=PartyBossRoom;var PartyCity=function(e){function t(t,i,r,n){return void 0===i&&(i=0),void 0===r&&(r=null),void 0===n&&(n=null),e.call(this,t,i,r,n)||this}return __extends(t,e),t.prototype.setParams=function(e){e&&ObjectUtils.assignKeys(e,this,["svrType","sn","cityId","roomsn","tag","roomId","mapId","seed","isLockStep"])},Object.defineProperty(t.prototype,"scenePanelId",{get:function(){return 131},enumerable:!0,configurable:!0}),t.prototype.onDestroy=function(){this.params&&this.params.dispose(),e.prototype.onDestroy.call(this)},t}(City);__reflect(PartyCity.prototype,"PartyCity"),window.PartyCity=PartyCity;var PartyWarBRoom=function(e){function t(t,i,r,n){void 0===i&&(i=0),void 0===r&&(r=null),void 0===n&&(n=null);var a=e.call(this,t,i,r,n)||this;return a.curKilledBossNum=0,a}return __extends(t,e),Object.defineProperty(t.prototype,"scenePanelId",{get:function(){return 335},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"resultPanelId",{get:function(){return 153},enumerable:!0,configurable:!0}),t.prototype.onMonsterDeadBegin=function(t,i,r){e.prototype.onMonsterDeadBegin.call(this,t,i,r),t.isBoss&&App.dispatch("c93",{killer:i,target:t.$eid})},t.prototype.syncRoomData=function(){this.curKilledBossNum=this.killedBossNum,e.prototype.syncRoomData.call(this)},t.prototype.getBattleResultParams=function(t){var i=e.prototype.getBattleResultParams.call(this,t);return i.twType=2,i.curNum=this.curKilledBossNum,i.bestNum=this.curKilledBossNum,i},t}(RelayRoom);__reflect(PartyWarBRoom.prototype,"PartyWarBRoom"),window.PartyWarBRoom=PartyWarBRoom;var PartyWarGRoom=function(e){function t(t,i,r,n){void 0===i&&(i=0),void 0===r&&(r=null),void 0===n&&(n=null);var a=e.call(this,t,i,r,n)||this;return a.curGoldNum=0,a}return __extends(t,e),Object.defineProperty(t.prototype,"scenePanelId",{get:function(){return 336},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"resultPanelId",{get:function(){return 153},enumerable:!0,configurable:!0}),t.prototype.syncRoomData=function(){this.syncDataDirty&&(this.curGoldNum=this.getMonsterDropNum(1)),e.prototype.syncRoomData.call(this)},t.prototype.getBattleResultParams=function(t){var i=e.prototype.getBattleResultParams.call(this,t);return i.twType=1,i.curNum=this.curGoldNum,i.bestNum=this.curGoldNum,i},t}(RelayRoom);__reflect(PartyWarGRoom.prototype,"PartyWarGRoom"),window.PartyWarGRoom=PartyWarGRoom;var PartyWarPRoom=function(e){function t(t,i,r,n){return void 0===i&&(i=0),void 0===r&&(r=null),void 0===n&&(n=null),e.call(this,t,i,r,n)||this}return __extends(t,e),Object.defineProperty(t.prototype,"scenePanelId",{get:function(){return 338},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"playType",{get:function(){return 1},enumerable:!0,configurable:!0}),t.prototype.buildPlayData=function(){this.playCfg={}},t.prototype.getCameraFollow=function(){var e=this,t=e.player,i=e.master;if(!t)return i;if(i&&i.hold&&!i.isDead)return i;for(var r=0,n=e.avatarList;r<n.length;r++){var a=n[r];if(!a.isDead&&a.side==t.side)return a}return i},t}(PvPRoom);__reflect(PartyWarPRoom.prototype,"PartyWarPRoom"),window.PartyWarPRoom=PartyWarPRoom;var PartyWarRRoom=function(e){function t(t,i,r,n){void 0===i&&(i=0),void 0===r&&(r=null),void 0===n&&(n=null);var a=e.call(this,t,i,r,n)||this;return a.curRaceDistance=0,a}return __extends(t,e),Object.defineProperty(t.prototype,"scenePanelId",{get:function(){return 337},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"resultPanelId",{get:function(){return 153},enumerable:!0,configurable:!0}),t.prototype.syncRoomData=function(){var t=this;t.syncDataDirty&&(t.curRaceDistance=t.getRaceDistance(),t.player.syncRaceDistance(t.curRaceDistance)),e.prototype.syncRoomData.call(this)},t.prototype.getBattleResultParams=function(t){var i=e.prototype.getBattleResultParams.call(this,t);i.twType=4;var r=ConstD.transRaceScore(this.curRaceDistance);return i.curNum=r,i.bestNum=r,i},t}(RelayRoom);__reflect(PartyWarRRoom.prototype,"PartyWarRRoom"),window.PartyWarRRoom=PartyWarRRoom;var Pet=function(e){function t(t,i,r,n){void 0===i&&(i=0),void 0===r&&(r=null),void 0===n&&(n=null);var a=e.call(this,t,i,r,n)||this;return a.isTemp=!1,a}return __extends(t,e),Object.defineProperty(t.prototype,"aiClass",{get:function(){return PetAI},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"skillClass",{get:function(){return PetSkill},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"guiseClass",{get:function(){return GPet},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"lowerHaloAction",{get:function(){return null},enumerable:!0,configurable:!0}),t.prototype.setParams=function(e){e&&(this.isClient=!0,ObjectUtils.assignKeys(e,this,["roomsn","side","prid","petId","heroId","name"]))},t.prototype.onCreate=function(){e.prototype.onCreate.call(this),this.petCfg=Data.getItem("PetData",this.petId),this.battleType=1},t.prototype.onEnterScene=function(){e.prototype.onEnterScene.call(this);var t=this,i=t.heroCfg.pos;if(i){var r,n,a,o,s=t.scene.getAgent(t.prid),l=s.avatar,u=i.type,c=i.val||[];if(1==u){var p=c[0]||0,d=!!c[1];r=Fixed.value(c[2]||0).mul(d?1:l.multiply).add(l.x).value,n=Fixed.value(l.y).add(c[3]||0).value,a=0,o=1==p?!0:2==p?!1:4==p?!l.right:l.right}else if(2==u){var f=t.scene.getCallPetTarget(l);f?(r=Fixed.value(c[0]||0).mul(l.multiply).add(f.x).value,n=Fixed.value(f.y).add(c[1]||0).value,a=0,o=f.x==r?!f.right:f.x>r):(r=l.x,n=l.y,a=0,o=l.right)}else if(3==u){var h=t.scene,f=h.getCallPetTarget(l);f?(r=Fixed.value(c[0]||0).mul(l.multiply).add(f.x).value,o=f.x==r?!f.right:f.x>r):(r=l.x,o=l.right),n=Fixed.value(h.roadBottom).sub(h.roadTop).mul(.5).add(h.roadTop).add(c[1]||0).round().value,a=0}else r=l.x,n=l.y,a=0,o=l.right;t.updatePos(r,n,a,o)}},t.prototype.onEnteredScene=function(){var t=this;t.agent.onAddPet(t);var i=t.agent.avatar;if(t.scene.isAllPetUp)t.ctime=0;else{var r=i&&i.props?i.props.gv("petTime"):0,n=t.props.gv("petTime");t.ctime=DebugStatic.petTime?DebugStatic.petTime:Fixed.value(n).add(r).mul(1e3).value}e.prototype.onEnteredScene.call(this);var a=t.heroCfg;if(i){i.guise&&i.guise.updateElementImg(),t.buff.dealTrigBuff(14,0,i,t);var o=i.buff.xianMoXBuff;o&&o.caster&&!o.caster.isDead&&t.buff.addBuff(o.caster,o.skillId,o.skillLv,o.buffId)}if(t.skill.startInitCd(),t.scene.trigAI(34,t),t.hold){if(a.callEff){var s="idle_"+a.id;t.callEff0=RenderUtils.playSceneEffect("77_1",Urls.uieff(),"idle",0,"LT",400,400),t.callEff=RenderUtils.playSceneEffect("77_"+a.id,Urls.uieff(),s,0,"LT",400,400),121==t.heroId&&SoundUtils.playBattleSound(4,t.$eid,t.scene.stepTotal,IDUtils.genID("battleSound"),s,1,"shl_jingju",1,1)}App.dispatch("c73",{pet:t})}t.hold&&DebugStatic.isOpenDPS&&DebugStatic.resetPetDps()},t.prototype.onEnterEffectEnd=function(){e.prototype.onEnterEffectEnd.call(this),this.scene.isAllPetUp&&this.agent.autoCallNextPet()},t.prototype.onStopPvERound=function(){this.skill&&this.skill.clearPortalDelayBullet()},t.prototype.onLeftScene=function(){var t=this,i=t.agent;i.onRemovePet(t),i&&i.avatar&&i.avatar.guise&&i.avatar.guise.updateElementImg(),e.prototype.onLeftScene.call(this)},t.prototype.onEnterFrame=function(t){e.prototype.onEnterFrame.call(this,t);var i=this;3==i.battleType&&i.canFollow&&i.onFollowMaster(),!i.scene.pauseTime&&i.ctime&&(i.ctime=Fixed.value(i.ctime).sub(t).value,i.ctime<=0&&i.exeuntScene(!0))},t.prototype.onAttPropChange=function(e){this.hold&&("hp"in e||"maxHp"in e||"mp"in e||"maxMp"in e)&&App.dispatch("c59",{rid:this.prid,target:this,changedKeys:e})},t.prototype.onFree=function(e,t){var i=this;if(i.isAir)return void i.state.flyDown(t);if(i.isDead)return void i.dead(!1,!1,!0);var r=i.skill;if(i.isPress&&!r.nextSkillId&&(r.nextSkillId=r.nskillId),r.nextSkillId){if(r.playComboSkill())return}else 2==i.battleType?(i.hideIdx&&(i.scene.removeCallLaterIdx(i.hideIdx),i.hideIdx=0),i.hideIdx=i.scene.addCallLater(i.onHideEffectEnd,i,50,!1,!1),i.guise&&i.guise.playDisappearShader()):3==i.battleType&&(i.visible_guise=!1);i.state.limit(112)||(i.state.normal(112,!1),i.ai.onStateFree(e))},t.prototype.onPetHide=function(){var e=this;e.battleType=2,e.canbeHit=!1,e.ai.stop(),e.state.interrupt(6),e.state.normal(112,!1),e.standLand();var t=e.heroCfg.hide;e.buff.trigPassiveBuff(3);var i=e.agent?e.agent.avatar:null;i&&i.buff.trigPassiveBuff(6),e.hideIdx&&(e.scene.removeCallLaterIdx(e.hideIdx),e.hideIdx=0),e.hideIdx=e.scene.addCallLater(e.onHideEffectEnd,e,50,!1,!1),t.ai&&e.scene.addCallLater(e.onDelayChangeAI,e,50,!1,!1,t.ai,!0),e.guise&&e.guise.playDisappearShader(),e.scene.trigAI(38,e),e.dispatch("onPetHide",{target:e})},t.prototype.onDelayChangeAI=function(e,t){this.ai&&this.ai.changeAI(e,t)},t.prototype.onHideEffectEnd=function(){this.visible_guise=!1},t.prototype.onPetFuse=function(){var e=this;e.battleType=3,e.canbeHit=!1,e.ai.stop(),e.state.interrupt(6),e.state.normal(112,!1),e.standLand();var t=e.heroCfg.fuse;e.buff.trigPassiveBuff(2);var i=e.agent?e.agent.avatar:null;if(i&&i.buff.trigPassiveBuff(5),e.fuseIdx&&(e.scene.removeCallLaterIdx(e.fuseIdx),e.fuseIdx=0),e.fuseIdx=e.scene.addCallLater(e.onFuseEffectEnd,e,50,!1,!1),t&&t.eff&&RenderUtils.playSceneEffect(t.eff,Urls.effect(),"idle",0,"MT",0,200),e.guise&&e.guise.playDisappearShader(),t&&t.hide&&e.guise){var r=e.guise.addEffect(t.hide,0);r&&(e.fuseHideEffectUid=r.uid)}e.dispatch("onPetFuse",{target:e})},t.prototype.onFuseEffectEnd=function(){var e=this;if(!e.canFollow){e.fuseIdx&&(e.scene.removeCallLaterIdx(e.fuseIdx),e.fuseIdx=0),e.canFollow=!0,e.visible_ui=!1,e.onFollowMaster(),e.scene.trigAI(35,e);var t=e.guise;if(t&&(e.agent.avatar.guise&&(t.depth=e.agent.avatar.guise.depth-1),t.onFuseHideUI()),e.stopFuseEffect(),e.heroCfg.fuse){var i=t.addEffect(e.heroCfg.fuse.show,0);i&&(e.fuseShowEffectUid=i.uid)}}},t.prototype.stopFuseEffect=function(){var e=this;e.guise&&(e.fuseHideEffectUid&&e.guise.removeEffect(e.fuseShowEffectUid),e.fuseShowEffectUid&&e.guise.removeEffect(e.fuseShowEffectUid),e.guise.stopShader()),e.fuseShowEffectUid=0,e.fuseHideEffectUid=0},t.prototype.onFollowMaster=function(){var e=this;
if(e.agent){var t=e.agent.avatar;t&&e.updatePos(t.x,t.y,e.z,t.right)}},t.prototype.onMasterBeginSkill=function(e){var t=this;if(!t.isDead&&3==t.battleType){t.stopFuseEffect(),t.fuseIdx&&(t.scene.removeCallLaterIdx(t.fuseIdx),t.fuseIdx=0),!t.canFollow&&t.onFuseEffectEnd(),t.state.interrupt(7);var i=t.heroCfg.fuse.normal[e];t.skill.canUse(i)&&t.skill.onBeginSkill(i,!1,!1)}},t.prototype.onMasterInterruptSkill=function(){var e=this;e.isDead||3!=e.battleType||(e.state.interrupt(7),e.state.normal(112,!1))},t.prototype.onNextRound=function(){var t=this;t.isDead||(e.prototype.onNextRound.call(this),2==t.battleType?t.visible_guise=!1:3==t.battleType&&(t.visible_ui=!1,t.guise&&t.guise.onFuseHideUI()))},t.prototype.onDead=function(){var t=this;t.stopFuseEffect(),t.guise&&t.guise.stopShader(),t.scene.onPetExeunt(t),t.scene.trigAI(33,t),t.scene.removeCallLater(t),e.prototype.onDead.call(this)},t.prototype.onEndDead=function(){var e=this;e.clearAll(),e.scene.addCallLater(e.receiveLeaveScene,e,1,!1,!1),e.hold&&App.dispatch("c66",{target:e}),e.dispatch("onDead",{target:e})},t.prototype.exeuntScene=function(e){var t=this;if(!t.isDead){t.ctime=0,t.canbeHit=!1,t.stopFuseEffect(),t.guise&&t.guise.stopShader(),t.scene.onPetExeunt(t),t.scene.trigAI(33,t),t.scene.removeCallLater(t),t.isDead=!0,t.scene.onRoleDead(t,null,e,!0);var i=t.state.actionState;t.state.normal(116,!0,i&&i.action&&i.action.subAction?i.action.subAction.actionName:null)}},t.prototype.onExeuntEnd=function(){var e=this;e.canbeHit=!1,e.scene.addCallLater(e.receiveLeaveScene,e,1,!1,!1)},t.prototype.onStopEnd=function(){var e=this;e.guise&&e.guise.stopBlackEffect(),e.isDead||1!=e.battleType||(e.visible_ui=!0)},t.prototype.onHideSkillBegin=function(){var e=this;e.guise&&e.guise.stopShader(),e.hideIdx&&(e.scene.removeCallLaterIdx(e.hideIdx),e.hideIdx=0)},t.prototype.onPlayExeunt=function(){var e=this;e.guise&&e.guise.stopShader(),e.hideIdx&&(e.scene.removeCallLaterIdx(e.hideIdx),e.hideIdx=0),e.fuseIdx&&(e.scene.removeCallLaterIdx(e.fuseIdx),e.fuseIdx=0)},t.prototype.destroyGuise=function(t){void 0===t&&(t=!1);var i=this;i.stopFuseEffect(),e.prototype.destroyGuise.call(this,t)},t.prototype.onDestroy=function(){var t=this,i=t.callEff;i&&(t.callEff=null,i.parent&&i.parent.removeChild(i));var r=t.callEff0;r&&(t.callEff0=null,r.parent&&r.parent.removeChild(r)),e.prototype.onDestroy.call(this);var n=this.params;n&&n.dispose(),ObjectUtils.clearKeys(t,["petCfg","battleType","fuseHideEffectUid","fuseShowEffectUid","callEff0","callEff"])},t}(Role);__reflect(Pet.prototype,"Pet"),window.Pet=Pet;var PetSallyRoom=function(e){function t(t,i,r,n){void 0===i&&(i=0),void 0===r&&(r=null),void 0===n&&(n=null);var a=e.call(this,t,i,r,n)||this;return a.isPetSally=!0,a}return __extends(t,e),Object.defineProperty(t.prototype,"scenePanelId",{get:function(){return 201},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"resultPanelId",{get:function(){return 150},enumerable:!0,configurable:!0}),t.prototype.onAvatarDeadBefor=function(e,t,i){var r=e.agent;r.checkHasNextAvatar(e.petId)?r.createAvatar():r.onAvatarDead(t,i)},t.prototype.onWin=function(t,i,r,n,a){for(var o=[],s=5;s<arguments.length;s++)o[s-5]=arguments[s];e.prototype.onWin.apply(this,[t,i,r,n,a].concat(o)),App.dispatch("c559",this.dunId)},t}(RelayRoom);__reflect(PetSallyRoom.prototype,"PetSallyRoom"),window.PetSallyRoom=PetSallyRoom;var Player=function(e){function t(i,r,n,a){void 0===r&&(r=0),void 0===n&&(n=null),void 0===a&&(a=null);var o=e.call(this,i,r,n,a)||this;return o.svrId=0,o.roomSn=0,o.speed=0,o.openServerTime=0,o.combineServerTime=0,t.destroy(),t["in"]=o,o}return __extends(t,e),t.prototype.setParams=function(e){e&&(this.svrId=e.svrId,this.roomSn=e.roomSn,this.rid=e.rid,this.job=e.job,this.level=e.level,this.speed=e.speed)},t.prototype.onCreate=function(){e.prototype.onCreate.call(this),Login.closeLastUI(),Login.closeMainLoading=!0,UI.close("MainLoadUI"),DeviceUtils.isMobile||KeyBoardMgr.initialize()},t.prototype.enterScene=function(e,t,i,r){},t.prototype.enterSceneOK=function(){this.enterCity()},t.prototype.enterCity=function(){this.destroyRoom(),this.addOnceTimer(0,this.createCity)},t.prototype.enterRoom=function(e,t){this.destroyCity(),this.addOnceTimer(0,this.createRoom,e,t)},t.prototype.restartEnterRoom=function(e,t){this.destroyRoom(),this.addOnceTimer(.1,this.createRoom,e,t)},t.prototype.createCity=function(){if(!this.city){var e=1,t=Data.getItem("CityData",e),i={};i.roomsn=this.roomSn,i.cityId=e,i.roomId=301,i.mapId=t.roundMap,i.seed=Math.round((new Date).getTime()/1e3);var r={};r.roomsn=this.roomSn,r.rid=this.rid,r.job=this.job,r.level=this.level,this.city=ServiceMgr.createEntity(0,"MainCity",!0,0,null,i),this.cityAgent=ServiceMgr.createEntity(0,"RCityAgent",!0,0,null,r),this.cityAgent.enterScene(this.city.$eid,t.born.x,t.born.y,!0),this.city.startScene()}},t.prototype.destroyCity=function(){var e=this.city,t=this.cityAgent;t&&(t.leaveScene(),ServiceMgr.removeEntity(0,t.$eid)),e&&ServiceMgr.removeEntity(0,e.$eid),this.city=null,this.cityAgent=null},t.prototype.createRoom=function(e,t){if(!this.room){var i={};i.roomsn=this.roomSn,i.roomId=1,i.mapId=2,i.mainId=1,i.dunId=1,i.diffId=1,i.dungeonId=1,i.timeout=86400,i.playId=1,i.battleId=1,i.seed=Math.round((new Date).getTime()/1e3);var r={};r.roomsn=this.roomSn,r.rid=this.rid,r.sit=1,r.order=1,r.svrId=this.svrId,r.ability=99999999,r.job=e,r.level=this.level;var n=[],a=Data.getItem("HeroData",t);a.prop.forEach(function(e){var t=Data.getItem("AttData",e.name);n.push({name:t.name,val:e.val})});var o=[],s={1:[2,3]};s[e][0]&&o.push({id:s[e][0],lv:1}),s[e][1]&&o.push({id:s[e][1],lv:1});var l=[];l.push({buffId:22,lv:1});var u={};u.heroId=t,u.props=ObjectUtils.clone(n,!0),u.skills=ObjectUtils.clone(o,!0),u.buffs=ObjectUtils.clone(l,!0),u.petId=0;var c=[];s[e][0]&&c.push({slotId:1,skillId:s[e][0]}),s[e][1]&&c.push({slotId:2,skillId:s[e][1]});var p={};p.fruitId=0,p.heroId=0,p.props=[],p.skills=[],p.buffs=[];var d={};d.rid=this.rid,d.svrId=this.svrId,d.job=e,d.name="",d.head=0,d.headFrame=0,d.level=this.level,d.vip=0,d.ability=99999999,d.partyName="",d.partyId=0,d.laddersLv=0,d.fairLv=0,d.order=1,d.side=1,d.fashionId=0,d.weaponId=0,d.weaponRTimes=0,d.weaFasId=0,d.wingFasId=0,d.titleId=0,d.petAbility=0,d.hellLvId=0,d.aiid=0,d.avatars=[ObjectUtils.clone(u,!0)],d.pets=[],d.fruit=ObjectUtils.clone(p,!0),d.useItems=[],d.helpSkills=[],d.equipSkillList=[],d.useSkills=ObjectUtils.clone(c,!0),this.room=ServiceMgr.createEntity(0,"MainRoom",!0,0,null,i),this.roomAgent=ServiceMgr.createEntity(0,"RelayAgent",!0,0,null,r),this.roomAgent.enterScene(this.room.$eid,700,830,!0),this.room.startScene(0,1,[d]),this.roomAgent.onAgentStartGame(!1,!1,!1,0,[u],[],[],c,[],p,[]),egret.callLater(this.room.onSceneStarted,this.room)}},t.prototype.destroyRoom=function(){var e=this.room,t=this.roomAgent;t&&(t.leaveScene(),ServiceMgr.removeEntity(0,t.$eid)),e&&ServiceMgr.removeEntity(0,e.$eid),this.room=null,this.roomAgent=null},t.prototype.onComCreated=function(){e.prototype.onComCreated.call(this),this.props.initProps([{name:"spdBase",val:7.36}])},t.prototype.createCom=function(){this.props=ServiceMgr.createGameCom(Props,this)},t.prototype.onDestroy=function(){},t.destroy=function(){var e=this["in"];e&&e.onDestroy1(),this["in"]=void 0},t.prototype.onDestroy1=function(){e.prototype.onDestroy.call(this),t["in"]=null},t}(Agent);__reflect(Player.prototype,"Player"),window.Player=Player;var Portal=function(e){function t(t,i,r,n){return void 0===i&&(i=0),void 0===r&&(r=null),void 0===n&&(n=null),e.call(this,t,i,r,n)||this}return __extends(t,e),t.prototype.setParams=function(e){if(e){var t=this,i=e;t.isClient=!0,t.portalId=i.portalId,t.x=i.x,t.y=i.y}},Object.defineProperty(t.prototype,"resId",{get:function(){return this.portalCfg.guise},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"guiseClass",{get:function(){return GPortal},enumerable:!0,configurable:!0}),t.prototype.onCreate=function(){e.prototype.onCreate.call(this),this.portalCfg=Data.getItem("PortalData",this.portalId)},t.prototype.onEnteredScene=function(){this.canbeHit=!1},t.prototype.updateRect=function(){var e=this;e.rect||(e.rect=ObjectPool.pop(Rect,"IntersectRect"));var t=e.portalCfg.w||1,i=e.portalCfg.h||1,r=e.x,n=Fixed.value(i).mul(.5).ceil().value;n=Fixed.value(e.y).sub(e.z).sub(n).value,e.rect.reset(r,n,t,i,0)},t.prototype.showPortal=function(){this.guise&&this.guise.showPortal()},t.prototype.hidePortal=function(){this.guise&&this.guise.hidePortal()},t.prototype.onStopPvPRound=function(e){this.receiveLeaveScene()},t.prototype.onStopPvERound=function(){this.isClient&&this.receiveLeaveScene()},t.prototype.onDestroy=function(){e.prototype.onDestroy.call(this),this.portalCfg=null},t}(Sprite);__reflect(Portal.prototype,"Portal"),window.Portal=Portal;var RunAction=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.doFrame=function(e,t,i,r,n){if(!i){var a=this,o=a.owner;if(1==o.moveType){if(o.scene.isControl){var s=o.speedx,l=o.skill.curSkillId||0==s?o.right:s>0,u=o.scene.limitX(Fixed.value(o.ox).add(s).value),c=o.scene.limitY(Fixed.value(o.oy).add(o.speedy).value);o.updatePos(u,c,o.z,l)}}else{var p=a.state,d=p.dest;if(d){o.updateSpdByPos(o.x,o.y,d.x,d.y);var f=Fixed.value(p.speedRate).add(1).value,u=o.ox,h=Fixed.value(o.speedx).mul(f).value;h>0?u=Fixed.value(o.ox).add(h).min(d.x).value:0>h&&(u=Fixed.value(o.ox).add(h).max(d.x).value);var c=o.oy,v=Fixed.value(o.speedy).mul(f).value;v>0?c=Fixed.value(o.oy).add(v).min(d.y).value:0>v&&(c=Fixed.value(o.oy).add(v).max(d.y).value),p.adjust&&(u=o.scene.limitX(u),c=o.scene.limitY(c));var l=void 0,m=p.target;if(l=m?m.x==o.x?!m.right:m.x>o.x:h?h>0:o.right,o.updatePos(u,c,o.z,l),p.callback){var y=Fixed.value(d.x).sub(o.x).abs().value,g=Fixed.value(d.y).sub(o.y).abs().value;y<=p.endx&&g<=p.endy&&(o.scene.addCallLater(a.onMoveToDest,a,1,!1,!0,p.callback),p.callback=null)}}}}},t.prototype.onMoveToDest=function(e){e&&e.apply(null)},t.prototype.onDestroy=function(){var t=this.owner;t&&t.scene&&t.scene.removeCallLater(this),e.prototype.onDestroy.call(this)},t}(NormalAction);__reflect(RunAction.prototype,"RunAction"),window.RunAction=RunAction;var SkillAction=function(e){function t(){return e.call(this)||this}return __extends(t,e),Object.defineProperty(t.prototype,"move",{get:function(){return this.subAction?this.subAction.atInfo.move||0:0},enumerable:!0,configurable:!0}),t.prototype.canUseOther=function(e){var t=this,i=t.subAction;if(!i)return!0;var r=i.atInfo;return r.mustId&&r.mustId!=e?!1:r.us&&r.ue&&(i.curFrame<r.us||i.curFrame>r.ue)?!1:t.owner.skill.isNormal(e)?r.normal:t.owner.skill.isDodge(e)?r.dodge||r.skill:r.skill},t.prototype.comboing=function(e){return this.subAction?this.subAction.isCombo(e):!1},t.prototype.szing=function(){return this.subAction?this.subAction.isSz():!1},t.prototype.initialize=function(t){e.prototype.initialize.call(this,t);var i=this,r=t.skillId,n=t.skillCfg,a=i.owner,o=i.subActions,s=n.at||[],l=n.atkSpd;i.skillInfo=t.skillInfo,i.skillId=r,i.skillCfg=n,i.curXuliTime=-1,i.nextActionId=0,i.interruptSkip=!1,i.hasSZ=!1,a.standLand();var u=0;if(l){var c=a.props.gv("atkSpd");u=.01>c?1:c>=.01&&.1>c?2:c>=.1&&.25>c?3:c>=.25&&.45>c?4:5,i.nextActionId=u}s.forEach(function(e,t){if((!l||!e.id||u==e.id)&&(!e.aid||a.isSkillActionActive(r,e.aid))){3!=e.type||i.hasSZ||(i.hasSZ=!0);var n=void 0;n=4==e.type?ChargeAction:11==e.type?ChargeSpdAction:AttackAction;var s=ObjectPool.pop(n);s.initialize(i,e.name,e.play,0,0),s.setActionInfo(e),o.push(s)}})},t.prototype.setStillInfo=function(e){var t=this;e?(t.stillType=e.type,t.stillTrig=e.trig,t.stillFrame=e.frame,t.stillShake=e.shake,t.slowFrames=e.frame,t.slowTimes=e.times,t.curSlowFrame=1,t.curSlowTimes=0):t.stillType=0},t.prototype.play=function(){var t=this;if(3==t.skillCfg.cast){var i=t.owner,r=i.scene,n=t.skillCfg.cv,a=n?n[1]||0:0,o=void 0,s=void 0;if(1==a){var l=Fixed.value(r.roadRight).sub(r.roadLeft).mul(.5).add(r.roadLeft).value;i.x<=l?(o=r.roadLeft,s=!0):(o=r.roadRight,s=!1)}else o=i.right?r.roadLeft:r.roadRight,s=i.right;t.dx=i.x,i.updatePos(o,i.oy,i.oz,s)}e.prototype.play.call(this)},t.prototype.stopXuli=function(e){var t=this,i=t.subAction;t.curXuliTime=e,1==i.type?t.nextActionId=i.atInfo.av?i.atInfo.av[0]:0:5==i.type&&(t.nextActionId=i.atInfo.av?i.atInfo.av[0]:0,t.subAction.actionEnd(!0))},t.prototype.interrupt=function(e){var t=this;t.interruptType=e,t.interruptSkip=t.owner instanceof Avatar&&t.szing()&&(2==e||1==e),t.onAllSubActionEnd()},t.prototype.doFrame=function(e,t,i,r,n){var a=this,o=a.owner,s=a.skillCfg;if(o instanceof Avatar&&o.touchDir&&s&&s.xdir&&(a.touchDir=o.touchDir),!i&&3==s.cast){var l=a.skillCfg.cv,u=o.spd,c=Fixed.value(l?l[0]||0:0).add(1).mul(u).mul(o.multiply).div(n).value,p=a.dx,d=void 0;c>0?d=Fixed.value(o.ox).add(c).min(p).value:0>c&&(d=Fixed.value(o.ox).add(c).max(p).value),o.updatePos(d,o.oy,o.oz,o.right),Fixed.value(o.x).sub(p).abs().value<=0&&a.onAllSubActionEnd()}},t.prototype.onAllSubActionEnd=function(){var t=this;if(!t.hasSZ&&!t.interruptType){var i=t.skillInfo;i.hasSub&&(i.isNormal&&i.isLast&&i.clearSub(),t.owner.skill.startNextSubSkill(i,t.skillId))}e.prototype.onAllSubActionEnd.call(this)},t.prototype.addBuffIdx=function(e,t){var i=this.buffIdxs;i||(i=this.buffIdxs={});var r=i[e];r||(r=i[e]=[]),r.push(t)},t.prototype.removeBuffIdx=function(e){var t=this;if(t.owner&&!t.owner.$isRemoved){var i=t.buffIdxs;if(i){var r=i[e];r&&(r.forEach(function(e){e&&t.owner.buff.removeIdx(e,0,1)}),delete i[e])}}},t.prototype.onDestroy=function(){var e=this,t=e.buffIdxs;if(t)for(var i in t)e.removeBuffIdx(+i);e.skillInfo=null,e.skillId=0,e.skillCfg=null,e.buffIdxs=null,e.curXuliTime=-1,e.nextActionId=0,e.interruptType=0,e.interruptSkip=!1,e.touchDir=0,e.dx=0,e.hasSZ=!1},t}(BaseAction);__reflect(SkillAction.prototype,"SkillAction"),window.SkillAction=SkillAction;var RCityAgent=function(e){function t(t,i,r,n){return void 0===i&&(i=0),void 0===r&&(r=null),void 0===n&&(n=null),e.call(this,t,i,r,n)||this}return __extends(t,e),t.prototype.setParams=function(e){e&&(this.roomsn=e.roomsn,this.rid=e.rid,this.job=e.job,this.level=e.level,this.invisibily=!1)},t.prototype.onCreate=function(){e.prototype.onCreate.call(this),this.synPosTime=500},t.prototype.onEnteredScene=function(){e.prototype.onEnteredScene.call(this)},t.prototype.onEnterFrame=function(t){e.prototype.onEnterFrame.call(this,t);var i=this;if(i.hold){var r=i.synPosTime,n=i.lastSynPos;if(r-=t,0>=r){r=500;var a=i.x,o=i.y,s=i.z,l=i.right;n&&n.x==a&&n.y==o&&n.z==s&&n.right==l||(n=i.lastSynPos=i.lastSynPos||{},n.x=a,n.y=o,n.z=s,n.right=l,i.synPos(a,o,s,l))}i.synPosTime=r}},t.prototype.synPos=function(e,t,i,r){this.hold&&this.hall.synPos(e,t,i,r)},t.prototype.syncTouchBegin=function(e){var t=this;t.hold&&!t.viewer&&t.hall.syncTouchBegin(t.x,t.y,t.z,t.right,e)},t.prototype.syncTouchEnd=function(){var e=this;e.hold&&!e.viewer&&e.hall.syncTouchEnd(e.x,e.y,e.z,e.right)},t.prototype.syncTouchChange=function(e){var t=this;t.hold&&!t.viewer&&1==t.moveType&&t.hall.syncTouchChange(e)},t.prototype.syncMoveToPos=function(e,t,i,r){this.hold&&this.hall.syncMoveToPos(e,t,i,r)},t.prototype.onDestroy=function(){e.prototype.onDestroy.call(this),this.lastSynPos=null},t}(CityAgent);__reflect(RCityAgent.prototype,"RCityAgent"),window.RCityAgent=RCityAgent;var RelayAgent=function(e){function t(t,i,r,n){void 0===i&&(i=0),void 0===r&&(r=null),void 0===n&&(n=null);var a=e.call(this,t,i,r,n)||this;return Player["in"]&&Player["in"].roomSn&&(a.roomsn=Player["in"].roomSn),a}return __extends(t,e),t.prototype.setParams=function(e){e&&(this.roomsn=e.roomSn,this.rid=e.rid,this.sit=e.sit,this.order=e.order,this.svrId=e.svrId,this.ability=e.ability,this.job=e.job,this.level=e.level)},t.prototype.onAddRecord=function(){Player["in"]&&Player["in"].roomSn&&(this.roomsn=Player["in"].roomSn),e.prototype.onAddRecord.call(this)},t.prototype.onCreate=function(){e.prototype.onCreate.call(this);var t=this;Functor.assert(!!t.roomsn,"战斗服务器房间号不存在"),t.active&&t.gateway.checkToken(ServiceMgr.getToken(t.$channel))},t.prototype.onCheckToken=function(e){var t=this;e?(Prompt.msgId(e),t.onEnterBattleRoomFail(e)):t.roomsn&&(t.active&&t.gateway.reqEnterRoom(t.roomsn,"",""),Player["in"].roomSn=0)},t.prototype.onReqEnterRoom=function(e,t){var i=this;return e?(Prompt.msgId(e),void i.onEnterBattleRoomFail(e)):void 0},t.prototype.onEnterBattleRoomFail=function(e){SceneMgr.unlock(),PanelMgr.hasUI(160)&&PanelMgr.close(160),PanelMgr.hasUI(84)&&PanelMgr.close(84),PanelMgr.hasUI(161)&&PanelMgr.close(161),ServiceMgr.disconnect(2,e)},t.prototype.onBattleOver=function(e){},t.prototype.reqSendGift=function(e,t,i){},t.prototype.syncGiveGift=function(e,t,i){var r=this.scene.getAgent(i);r&&this.gateway.syncGiveGift(t,i)},t.prototype.onGiveGift=function(e,t){var i=this,r=i.scene.getAgentInfo(t);if(r){var n=ObjectPool.pop(GiftInfo);n.parse(e,i.rid,i.name,i.agentInfo.head,i.agentInfo.headFrame,t,r.name),App.dispatch("c620",n)}},t.prototype.syncBarrage=function(e){return!0},t.prototype.onBarrage=function(e,t,i,r){},t.prototype.syncNextRoundStarted=function(e){this.active&&!this.viewer&&this.gateway.syncNextRoundStarted(e)},t.prototype.syncHaloId=function(e){var t=this;t.active&&!t.viewer&&t.haloId!=e&&t.gateway.syncHaloId(e)},t.prototype.onHaloId=function(e){this.avatar&&this.avatar.updateHalo()},t.prototype.syncFashionId=function(e){var t=this;t.active&&!t.viewer&&t.fashionId!=e&&t.gateway.syncFashionId(e)},t.prototype.onFashionId=function(e){this.avatar&&this.avatar.updateFashion()},t.prototype.syncTitleId=function(e){var t=this;t.active&&!t.viewer&&t.titleId!=e&&t.gateway.syncTitleId(e)},t.prototype.onTitleId=function(e){this.avatar&&this.avatar.updateTitle()},t.prototype.syncWeaponId=function(e){var t=this;t.active&&!t.viewer&&t.weaponId!=e&&t.gateway.syncWeaponId(e)},t.prototype.onWeaponId=function(e){this.avatar&&this.avatar.updateWeapon()},t.prototype.syncWeaponRTimes=function(e){var t=this;t.active&&!t.viewer&&t.weaponRTimes!=e&&t.gateway.syncWeaponRTimes(e)},t.prototype.onWeaponRTimes=function(e){this.avatar&&this.avatar.updateWeaponEffect()},t.prototype.syncWeaFasId=function(e){var t=this;t.active&&!t.viewer&&t.weaFasId!=e&&t.gateway.syncWeaFasId(e)},t.prototype.onWeaFasId=function(e){this.avatar&&this.avatar.updateWeapon()},t.prototype.syncWingFasId=function(e){var t=this;t.active&&!t.viewer&&t.wingFasId!=e&&t.gateway.syncWingFasId(e)},t.prototype.onWingFasId=function(e){this.avatar&&this.avatar.updateWing()},t.prototype.syncChangeScore=function(e,t){this.active&&!this.viewer&&this.gateway.syncChangeScore(e,t)},t.prototype.syncMonsterSpecialDrop=function(e,t){this.active&&!this.viewer&&this.gateway.syncMonsterSpecialDrop(e,t)},t.prototype.syncRaceDistance=function(e){this.active&&!this.viewer&&this.gateway.syncRaceDistance(e)},t}(RoomAgent);__reflect(RelayAgent.prototype,"RelayAgent"),window.RelayAgent=RelayAgent;var TemptAction=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.initialize=function(t){e.prototype.initialize.call(this,t);var i=ObjectPool.pop(SubTemptAction);i.initialize(this,"run",1,0,0),this.subActions.push(i)},t.prototype.setActionInfo=function(e,t){this.caster=e,this.bullet=t},t.prototype.onDestroy=function(){this.caster=null,this.bullet=null,e.prototype.onDestroy.call(this)},t}(BaseAction);__reflect(TemptAction.prototype,"TemptAction"),window.TemptAction=TemptAction;var RobotAgent=function(e){function t(t,i,r,n){void 0===i&&(i=0),void 0===r&&(r=null),void 0===n&&(n=null);var a=e.call(this,t,i,r,n)||this;return a.autoHelpTime=0,a}return __extends(t,e),Object.defineProperty(t.prototype,"autoBattle",{get:function(){return!0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"autoSpeSkill",{get:function(){return!0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"autoCallPet",{get:function(){return!0},enumerable:!0,configurable:!0}),t.prototype.onCreate=function(){this.isRobot=!0,e.prototype.onCreate.call(this)},t.prototype.onStartPvPRound=function(){this.onRandomHelpTime()},t.prototype.onEnterFrame=function(t){e.prototype.onEnterFrame.call(this,t);var i=this;i.autoHelpTime>0&&(i.autoHelpTime=Fixed.value(i.autoHelpTime).sub(t).value,i.autoHelpTime<=0&&i.onAutoUseHelp())},t.prototype.onRandomHelpTime=function(){var e=this,t=e.scene;if(t instanceof PvPRoom&&!t.isAgentFight(e)&&!e.viewer){var i=Data.getSysValue("BATTLE_ROBOT_HELL_SKILL_MIN")||0,r=Data.getSysValue("BATTLE_ROBOT_HELL_SKILL_MAX")||1,n=Fixed.randInt(i,r,e.scene.seedr);e.autoHelpTime=Fixed.millisecond(n)}else e.autoHelpTime=0},t.prototype.onAutoUseHelp=function(){var e=this.getAutoHelpSkill();e&&this.onUseHelpSkill(e),this.onRandomHelpTime()},t.prototype.getAutoHelpSkill=function(){var e=this,t=this.helpSkillList;if(!t.length)return 0;var i=t.filter(function(t){return e.checkUseHelpSkill(t.skillId,!1)}),r=i.length;if(!r)return 0;var n;return n=1==r?i[0]:Fixed.randGet(i,this.scene.seedr),n.skillId},t}(RoomAgent);__reflect(RobotAgent.prototype,"RobotAgent"),window.RobotAgent=RobotAgent;var UndeadAction=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.setActionInfo=function(e){var t,i=this,r=i.owner,n=i.state.cfg.play||1,a=i.subActions;if(r.isAir){var o=r.props.gv("weight")||1;i.py=e,i.nspy=i.spy=Fixed.value(i.py).div(o).mul(130).value,t=ObjectPool.pop(DownAction),t.initialize(i,"undead",n,0,0),a.push(t)}t=ObjectPool.pop(SubAction),t.initialize(i,"undead",n,0,0),i.subActions.push(t)},t.prototype.onDestroy=function(){var e=this;e.py=0,e.spy=0,e.nspy=0},t}(BaseAction);__reflect(UndeadAction.prototype,"UndeadAction"),window.UndeadAction=UndeadAction;var AgentAction=function(){function e(){}return e.prototype.initialize=function(e,t,i){var r=this;r.isvalid=!0,r.owner=e.owner,r.state=e,r.actionName=t,r.isLoop=i},e.prototype.play=function(){var e=this.owner;EventCenter.addEvent(e.guise.body,"actionPlayEnd",this.onAllSubActionEnd,this),e.guise.playAction(this.actionName,e.direction,1,this.isLoop)},e.prototype.doFrame=function(e){},e.prototype.destroy=function(){var e=this;e.isvalid&&(e.isvalid=!1,e.onDestroy(),e.owner=null,e.state=null,e.actionName=null,e.isLoop=!1,ObjectPool.push(e))},e.prototype.onAllSubActionEnd=function(){this.state.onActionEnd()},e.prototype.onDestroy=function(){},e}();__reflect(AgentAction.prototype,"AgentAction"),window.AgentAction=AgentAction;var BackAction=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.checkEnd=function(t,i,r,n,a){if(!r){var o=this,s=o.action,l=s.ctime;if(s.time<l){var u=o.owner,c=s.time=Fixed.value(t).div(a).add(s.time).value,p=Fixed.value(l).sub(c).value,d=Fixed.value(l).pow(3).value,f=s.useWeight?u.props.gv("weight"):50,h=Fixed.value(p).pow(2).mul(3).mul(1).mul(c).value;h=Fixed.value(c).pow(2).mul(3).mul(1).mul(p).add(h).value,h=Fixed.value(c).pow(3).mul(1).add(h).value,h=Fixed.value(s.dis).mul(h).div(d).value,h=Fixed.value(50).div(f).pow(1.25).mul(h).value;var v=Fixed.value(h).sub(s.lastDis).add(u.ox).value;s.lastDis=h,u.updatePos(u.scene.limitX(v),u.y,u.z,u.right)}else o.stilling||(o.stilling=!0,o.shakeIndex++,o.owner.guise.onStillShake(o.shakeIndex))}e.prototype.checkEnd.call(this,t,i,r,n,a)},t}(SubAction);__reflect(BackAction.prototype,"BackAction"),window.BackAction=BackAction;var ChargeAction=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.setActionInfo=function(t){e.prototype.setActionInfo.call(this,t);var i=this.skillCfg.cv;this.chargeSpeed=i?i[0]||0:0},t.prototype.doFrameMove=function(){var e=this.owner,t=Fixed.value(this.chargeSpeed).mul(e.multiply).add(e.ox).value;e.updatePos(e.scene.limitX(t),e.y,e.z,e.right)},t}(AttackAction);__reflect(ChargeAction.prototype,"ChargeAction"),window.ChargeAction=ChargeAction;var SpiritDreamLandRoom=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.onCreate=function(){e.prototype.onCreate.call(this);var t=this,i=Data.getItem("SpiritDreamLandData",1);if(i){var r=i.prop,n=t.dreamProps=[],a=t.spiritAbility;i.verifyPower&&(t.verifyPower=Data.exprd(i.verifyPower,a)),i.lvFun&&(t.monsterLevel=Data.exprd(i.lvFun,a)),r&&r.forEach(function(e){e.name&&e.fun&&n.push({name:e.name,val:Data.exprd(e.fun,a)})})}},t.prototype.createSpawnMonsterInfo=function(t,i,r){var n=e.prototype.createSpawnMonsterInfo.call(this,t,i,r);return n.extraProps=this.dreamProps,n.level=this.monsterLevel,n},Object.defineProperty(t.prototype,"resultPanelId",{get:function(){return 155},enumerable:!0,configurable:!0}),t.prototype.getVerifyPower=function(){return this.verifyPower||0},t}(RelayRoom);__reflect(SpiritDreamLandRoom.prototype,"SpiritDreamLandRoom"),window.SpiritDreamLandRoom=SpiritDreamLandRoom;var ChargeSpdAction=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.setActionInfo=function(t){e.prototype.setActionInfo.call(this,t);var i=this,r=i.skillCfg.cv||[];i.chargeSpeed=r[0]||0,i.maxSpeed=r[1]||0,i.spd=Fixed.value(i.maxSpeed).sub(i.chargeSpeed).div(r[2]||1).value,i.canOps=!!r[3]},t.prototype.doFrameMove=function(){var e=this,t=e.owner,i=e.spd,r=e.chargeSpeed,n=t.oy;if(i){var a=e.maxSpeed;i>0&&a>r?r=Fixed.value(r).add(i).min(a).value:0>i&&r>a&&(r=Fixed.value(r).add(i).max(a).value),e.chargeSpeed=r}if(t instanceof Avatar&&e.canOps&&t.isTouch){var o=ActionMgr.changeDirToX(t.touchDir);n=t.scene.limitY(Fixed.value(n).add(t.speedy).value),o&&t.changeDirection(o>0)}var s=t.scene.limitX(Fixed.value(r).mul(t.multiply).add(t.ox).value);t.updatePos(s,n,t.z,t.right)},t}(AttackAction);__reflect(ChargeSpdAction.prototype,"ChargeSpdAction"),window.ChargeSpdAction=ChargeSpdAction;var SumAvatar=function(e){function t(t,i,r,n){return void 0===i&&(i=0),void 0===r&&(r=null),void 0===n&&(n=null),e.call(this,t,i,r,n)||this}return __extends(t,e),Object.defineProperty(t.prototype,"guiseClass",{get:function(){return GSumAvatar},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"resId",{get:function(){var e=this.fashionId;if(e){var t=Data.getItem("ClothData",e);return t.res}return this.heroResCfg.res},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"heroUrl",{get:function(){return this.fashionId?Urls.fashion():Urls.hero()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"titleUrl",{get:function(){var e=this.titleId;if(e){var t=Data.getItem("TitleData",e);return t.res}return null},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"weaponUrl",{get:function(){var e=this,t=e.weaFasId,i=e.weaponId;if(t)return"";if(i){var r=Data.getItem("EquipApData",i);return r?r.res:this.heroResCfg.weapon}return this.heroResCfg.weapon},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"weaponEffectUrl",{get:function(){var e=this,t=e.weaponId;if(!t)return null;var i=Data.getItem("EquipApData",t);return i?i.battleRes:null},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"wingUrl",{get:function(){var e=this.wingFasId;if(e){var t=Data.getItem("WingSkinData",e);return t.exteriorRes+"_"+this.job}return""},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"lowerHaloAction",{get:function(){return this.side==this.scene.player.side?"3_lower":"4_lower"},enumerable:!0,configurable:!0}),t.prototype.setParams=function(t){if(e.prototype.setParams.call(this,t),t){var i=t;ObjectUtils.assignKeys(i,this,["job","haloId","fashionId","titleId","weaponId","weaponRTimes","weaFasId","wingFasId"])}},t}(Monster);__reflect(SumAvatar.prototype,"SumAvatar"),window.SumAvatar=SumAvatar;var TowerRoom=function(e){function t(t,i,r,n){void 0===i&&(i=0),void 0===r&&(r=null),void 0===n&&(n=null);var a=e.call(this,t,i,r,n)||this;return a.isAllPetUp=!0,a}return __extends(t,e),Object.defineProperty(t.prototype,"scenePanelId",{get:function(){return 129},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"resultPanelId",{get:function(){return 145},enumerable:!0,configurable:!0}),t.prototype.onCreate=function(){e.prototype.onCreate.call(this)},t.prototype.getPvEResultExtra=function(t,i){var r=e.prototype.getPvEResultExtra.call(this,t,i);return r.roundId=this.roundId,r},t}(RelayRoom);__reflect(TowerRoom.prototype,"TowerRoom"),window.TowerRoom=TowerRoom;var Trap=function(e){function t(t,i,r,n){return void 0===i&&(i=0),void 0===r&&(r=null),void 0===n&&(n=null),e.call(this,t,i,r,n)||this}return __extends(t,e),Object.defineProperty(t.prototype,"guiseClass",{get:function(){return GTrap},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"resId",{get:function(){return this.effectCfg.res},enumerable:!0,configurable:!0}),t.prototype.setParams=function(e){if(e){var t=this,i=e,r=i.caster;t.isClient=!0,t.caster=!r||r.isDead||r.$isRemoved?null:r,ObjectUtils.assignKeys(i,t,["trapId","x","y","prid","roomsn","side"])}},t.prototype.onCreate=function(){var t=this,i=t.trapCfg=Data.getItem("TrapData",t.trapId);t.effectCfg=Data.getItem("EffectData",i.guise),t.actionCfg=Data.getOppItem("EffectAction",t.effectCfg.res),Functor.assert(!!t.actionCfg,"陷阱特效配置ID："+t.effectCfg.id+" 陷阱特效资源："+t.effectCfg.res+"动作配置数据不存在"),t.ctime=t.time=i.time||0,t.interval=i.interval||0,t.rinterval=i.iinterval||0,t.right=!i.left,e.prototype.onCreate.call(this)},t.prototype.onEnteredScene=function(){var e=this.effectCfg;this.playAction(e.upper,e.lower,1,0)},t.prototype.playAction=function(e,t,i,r){var n=this,a=n.effectCfg;if(n.upperEnd=!e,n.lowerEnd=!t,n.playType=i,n.actionTotalTime=n.actionCurTime=r,n.isActionEnd=!1,e){var o=n.upperActionData=n.actionCfg.dic[e];Functor.assert(!!o,"陷阱特效配置ID："+a.id+" 陷阱特效资源："+a.res+" 缺少动作配置上层动作数据:"+e),ConstD.parseActionData(o),n.curUpperName=e,n.upperTotalFrame=o.total,n.curUpperFrame=1,n.onFrameEvent(o,e,n.curUpperFrame)}if(t){var s=n.lowerActionData=n.actionCfg.dic[t];Functor.assert(!!s,"陷阱特效配置ID："+a.id+"陷阱特效资源："+a.res+" 缺少动作配置下层动作数据:"+t),ConstD.parseActionData(s),n.curLowerName=t,n.lowerTotalFrame=s.total,n.curLowerFrame=1,n.onFrameEvent(s,t,n.curLowerFrame)}n.afterEnterFrame()},t.prototype.onEnterFrame=function(t){e.prototype.onEnterFrame.call(this,t);var i=this;if(i.isTrigEnd)return void i.onTrapEnd();if(i.isActionEnd){var r=i.effectCfg;i.playAction(r.upper,r.lower,1,0)}else{var n=void 0,a=i.playType,o=1==a||3==a;if(i.curUpperName){var s=i.curUpperFrame,l=s+1;n=!0,l>i.upperTotalFrame&&(l=o?1:i.upperTotalFrame,(2==a||4==a)&&(n=!1)),i.curUpperFrame=l,n&&i.onFrameEvent(i.upperActionData,i.curUpperName,l)}if(i.curLowerName){var u=i.curLowerFrame,c=u+1;n=!0,c>i.lowerTotalFrame&&(c=o?1:i.lowerTotalFrame,(2==a||4==a)&&(n=!1)),i.curLowerFrame=c,n&&i.onFrameEvent(i.lowerActionData,i.curLowerName,c)}1==a||2==a||90==a?i.actionTotalTime&&(i.actionCurTime=Fixed.value(i.actionCurTime).sub(t).value,i.actionCurTime<=0&&(i.isActionEnd=!0)):3==a||4==a||91==a?i.actionTotalTime&&(i.actionCurTime=Fixed.value(i.actionCurTime).sub(1).value,i.actionCurTime<=0&&(i.isActionEnd=!0)):(i.upperEnd||(i.upperEnd=i.curUpperFrame==i.upperTotalFrame),i.lowerEnd||(i.lowerEnd=i.curLowerFrame==i.lowerTotalFrame),i.upperEnd&&i.lowerEnd&&(i.isActionEnd=!0))}var p=i.tintervals;if(p){var d=void 0;for(var f in p)d=(p[f]||0)-1,p[f]=d,0>=d&&delete p[f]}var h;i.interval?(i.rinterval-=1,i.rinterval<=0&&(i.rinterval=i.interval,h=i.onHit())):h=i.onHit(),i.ctime&&(i.time-=1,i.time<=0&&(!h&&i.trapCfg.isEndTrig&&i.scene.onTrigTrap(i.caster,i.trapCfg,i,null),i.isTrigEnd=!0)),h&&i.trapCfg.isTrigRem&&(i.isTrigEnd=!0)},t.prototype.onHit=function(){var e=this,t=e.trapCfg;if(t.datas&&t.datas.length){var i,r=e.scene,n=e.tintervals;if(1==t.condition&&(i=r.getTrapHits(e,t.target,t.range,t.max,n)),!i||!i.length)return!1;var a=t.tinterval||0,o=(r instanceof AvatarAdvRoom||r instanceof PartyWarRRoom)&&t.pickup;return a&&!n&&(n=e.tintervals={}),i.forEach(function(i){a&&(n[i.$eid]=a),o?i.agent.onPickupTrap(t,e.caster):r.onTrigTrap(e.caster,t,e,i)}),!0}},t.prototype.updatePos=function(e,t,i,r){var n=this;n.ox=e,n.oy=t,n.oz=i,e=Math.round(e),t=Math.round(t),i=Math.round(i),n.x=e,n.y=t,n.z=i,n.changeDirection(r)
},t.prototype.onTrapEnd=function(){this.scene.addCallLater(this.receiveLeaveScene,this,1,!1,!1)},t.prototype.onLeaveScene=function(){this.scene.removeCallLater(this),SoundUtils.onBattleActionEnd(this.soundId)},t.prototype.updateRect=function(){var e=this;e.rect||(e.rect=ObjectPool.pop(Rect,"IntersectRect"));var t=e.trapCfg,i=t.w||1,r=t.h||1,n=e.x,a=Fixed.value(r).mul(.5).floor().value;a=Fixed.value(e.y).sub(e.z).sub(a).value,e.rect.reset(n,a,i,r,0)},t.prototype.onFrameEvent=function(e,t,i){var r=this;if(Functor.assert(!!e,"陷阱特效配置ID："+r.effectCfg.id+" 陷阱特效资源："+r.effectCfg.res+" 缺少动作配置上层动作数据:"+t),e.events){var n=e.events[i];n&&n.length&&n.forEach(function(e){switch(e[0]){case"playShake":SceneMgr.onFrameShake(r.scene,r,e[1]);break;case"sound":r.soundId||(r.soundId=IDUtils.genID("battleSound")),SceneMgr.onFrameSound(r.$eid,r.scene.stepTotal,r.soundId,t,i,e[1])}})}},t.prototype.onStopPvPRound=function(e){this.receiveLeaveScene()},t.prototype.onStopPvERound=function(){this.isClient&&this.receiveLeaveScene()},t.prototype.onDestroy=function(){e.prototype.onDestroy.call(this);var t=this;t.params&&t.params.dispose(),ObjectUtils.clearKeys(t,["caster","trapCfg","effectCfg","actionCfg","upperActionData","lowerActionData","soundId","tintervals"])},t}(Sprite);__reflect(Trap.prototype,"Trap"),window.Trap=Trap;var WorldGhostKingRoom=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.level=1,t}return __extends(t,e),t.prototype.onCreate=function(){e.prototype.onCreate.call(this);var t=Data.getItem("GhostKingTroubledData",1001);if(t){var i=t.wProp,r=this.props=[];if(i){var n=this.bossAbility;this.level=Data.exprd(t.wLvFun,n)||1,i.forEach(function(e){e.name&&e.fun&&r.push({name:e.name,val:Data.exprd(e.fun,n)})})}}},t.prototype.battleOver=function(t,i){void 0===i&&(i=null),e.prototype.battleOver.call(this,t,i)},t.prototype.createSpawnMonsterInfo=function(t,i,r){var n=e.prototype.createSpawnMonsterInfo.call(this,t,i,r);return n.extraProps=this.props,n.level=this.level,n},t.prototype.getPvEResultExtra=function(t,i){var r=e.prototype.getPvEResultExtra.call(this,t,i);return r||(r={}),r.damage=this.selfDamage,r},t.prototype.getBattleResultParams=function(t){var i=e.prototype.getBattleResultParams.call(this,t);return i.damage=this.selfDamage,i},t.prototype.isInfiniteHp=function(e){return e instanceof Boss?!0:!1},Object.defineProperty(t.prototype,"scenePanelId",{get:function(){return 604},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"resultPanelId",{get:function(){return 156},enumerable:!0,configurable:!0}),t}(RelayRoom);__reflect(WorldGhostKingRoom.prototype,"WorldGhostKingRoom"),window.WorldGhostKingRoom=WorldGhostKingRoom;var GameStatic=function(){function e(){this._currentChatType=0}return Object.defineProperty(e,"currentChatType",{get:function(){return this._activityId},set:function(e){this._activityId=e,App.dispatch("c153")},enumerable:!0,configurable:!0}),Object.defineProperty(e,"activityId",{get:function(){return this._activityId},set:function(e){this._activityId=e},enumerable:!0,configurable:!0}),e.firstEnterGame=function(){},Object.defineProperty(e,"battleWait",{get:function(){return CallQueue.get("BATTLE_WAIT")},enumerable:!0,configurable:!0}),Object.defineProperty(e,"cityIconWait",{get:function(){return CallQueue.get("CITY_ICON_WAIT")},enumerable:!0,configurable:!0}),Object.defineProperty(e,"funcOpenWait",{get:function(){return CallQueue.get("FUNC_OPEN_WAIT")},enumerable:!0,configurable:!0}),Object.defineProperty(e,"partyWarWait",{get:function(){return CallQueue.get("PARTY_WAR_WAIT")},enumerable:!0,configurable:!0}),e.isFirstScene=!1,e._activityId=0,e}();__reflect(GameStatic.prototype,"GameStatic"),window.GameStatic=GameStatic;var BalanceBar=function(e){function t(){var t=e.call(this)||this,i=t;return i.skinName="BattleBalanceBarSkin",i.width=121,i.height=8,i.anchorOffsetX=60,t}return __extends(t,e),t}(MaskBar);__reflect(BalanceBar.prototype,"BalanceBar"),window.BalanceBar=BalanceBar;var DownAction=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.checkEnd=function(t,i,r,n,a){e.prototype.checkEnd.call(this,t,i,r,n,a);var o=this;if(!r&&2!=o.status){var s=o.owner,l=o.action;if(!s.isAir)return void(o.status=2);var u=l.nspy,c=Fixed.value(40).div(a).value;l.nspy=Fixed.value(u).sub(c).value;var p=Fixed.value(2).mul(60).mul(a).value;p=Fixed.value(u).mul(2).sub(c).div(p).add(s.oz).max(0).value,s.updatePos(s.ox,s.oy,p,s.right),s.isAir||(o.status=2)}},t}(SubAction);__reflect(DownAction.prototype,"DownAction"),window.DownAction=DownAction;var CastBar=function(e){function t(){var t=e.call(this)||this,i=t;return i.skinName="BattleCastBarSkin",i.width=122,i.height=9,i.anchorOffsetX=61,t}return __extends(t,e),t}(MaskBar);__reflect(CastBar.prototype,"CastBar"),window.CastBar=CastBar;var FuseSkillBar=function(e){function t(){var t=e.call(this)||this,i=t;return i.skinName="BattleFuseBarSkin",i.width=122,i.height=9,i.anchorOffsetX=61,t}return __extends(t,e),t}(MaskBar);__reflect(FuseSkillBar.prototype,"FuseSkillBar"),window.FuseSkillBar=FuseSkillBar;var GAgent=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.preInitialize=function(){var e=this;e.touchEnabled=!1,e.touchChildren=!0,e.content=new egret.DisplayObjectContainer;var t=e.shadow=new UIImage;t.width=121,t.height=80,t.anchorOffsetX=.5*t.width,t.anchorOffsetY=.5*t.height;var i=e.nameTxt=new eui.Label;i.size=20,i.textAlign="center",i.verticalAlign="middle"},t.prototype.initialize=function(){var e=this;e.upperHalo=ObjectPool.pop(MmeRender),e.lowerHalo=ObjectPool.pop(MmeRender),e.title=ObjectPool.pop(MmeRender),e.title.touchChildren=e.title.touchEnabled=!1,e.upperHalo.depth=e.depth,e.updateNameStyle()},t.prototype.childrenCreated=function(){var e=this,t=e.content;t.addChild(e.nameTxt),t.addChild(e.title),e.addChild(e.lowerHalo),e.addChild(t)},t.prototype.create=function(){var e=this;e.destroyBody(),e.createBody();var t=e.owner;e.updatePos(t.x,t.y,t.z),e.updateIcon(),e.updateHalo(),e.updateTitle(),e.updateName()},t.prototype.createBody=function(){var e=this,t=e.owner,i=t.heroCfg,r=i.flag,n=i.color,a=e.body=ObjectPool.pop(UnitPlayer);a.touchEnabled=!0,a.touchChildren=!1;var o={};o[1]={part:1,url:t.heroUrl,id:t.resId,flag:r,color:n};var s=t.weaponUrl;s&&(o[2]={part:2,url:Urls.weapon_c(),id:s,flag:r,color:n});var l=t.wingUrl;l&&(o[3]={part:3,url:Urls.wing_c(),id:l,flag:r,color:n});var u=t.weaponEffectUrl;u&&(o[4]={part:4,url:Urls.weaponEffect(),id:u,flag:r,color:n}),EventCenter.addEvent(a,"ready",e.onGuiseReady,e),a.initialize(o,3),e.content.addChildAt(a,0),e.body.addEventListener(Evt.touchTap,e.onTap,e)},t.prototype.updateIcon=function(){this.shadow.source="hero_shadow"},t.prototype.updateHalo=function(){var e=this,t=e.owner.lowerHaloAction,i=e.owner.upperHaloAction,r=e.lowerHalo,n=e.upperHalo;t?(r=e.lowerHalo=e.lowerHalo||ObjectPool.pop(MmeRender),r.load("1",Urls.halo(),null,null,3),r.playAction(t,3,1,!0)):r&&r.unload(),i?(n=e.upperHalo=e.upperHalo||ObjectPool.pop(MmeRender),n.load("1",Urls.halo(),null,null,3),n.playAction(i,3,1,!0)):n&&n.unload(),e.updateHaloVisible()},t.prototype.updateFashion=function(){var e=this;if(e.body){var t=e.owner,i=t.heroCfg;e.body.changePart(1,t.heroUrl,t.resId,i.flag,i.color)}},t.prototype.updateTitle=function(){var e=this,t=e.title,i=e.owner.titleUrl;i?(t||(t=e.title=ObjectPool.pop(MmeRender)),t.addEventListener("loaded",e.updateUIPos,e),t.load(i,Urls.title(),null,null,3),t.playAction("idle-2",3,1,!0)):t&&(t.addEventListener("loaded",e.updateUIPos,e),t.unload(),e.updateUIPos())},t.prototype.updateWeapon=function(){var e=this.owner;this.body.changePart(2,Urls.weapon_c(),e.weaponUrl,e.heroCfg.flag,e.heroCfg.color),this.body.changePart(4,Urls.weaponEffect(),e.weaponEffectUrl,e.heroCfg.flag,e.heroCfg.color)},t.prototype.updateWeaponEffect=function(){var e=this.owner;this.body.changePart(4,Urls.weaponEffect(),e.weaponEffectUrl,e.heroCfg.flag,e.heroCfg.color)},t.prototype.updateWing=function(){var e=this.owner;this.body.changePart(3,Urls.wing_c(),e.wingUrl,e.heroCfg.flag,e.heroCfg.color)},t.prototype.updatePos=function(e,t,i){var r=this;e!=r.$x&&(r.x=r.upperHalo.x=r.shadow.x=e),t!=r.$y&&(r.y=r.layouty=r.upperHalo.y=r.shadow.y=t),i!=r.content.y&&(r.content.y=-i)},t.prototype.updateUIPos=function(){var e=this,t=e.getRefPoint("p_hp"),i=t.y,r=e.nameTxt;r.x=t.x-.5*r.width,r.y=i-=22;var n=e.title;return n&&n.isLoaded&&(n.x=t.x,n.y=i-=15),t},t.prototype.updateName=function(){this.nameTxt.text=this.owner.name,this.updateUIPos()},t.prototype.updateNameStyle=function(){this.nameTxt.textColor=this.owner.hold?16767533:16777215},t.prototype.updateDirection=function(e){this.body.updateDirection(e)},t.prototype.playAction=function(e,t,i,r){this.body&&this.body.playAction(e,t,i,r)},t.prototype.afterEnterFrame=function(){e.prototype.afterEnterFrame.call(this);var t=this;t.body&&t.body.manualEnterFrame(),t.title&&t.title.manualEnterFrame(),t.upperHalo&&t.upperHalo.manualEnterFrame(),t.lowerHalo&&t.lowerHalo.manualEnterFrame()},t.prototype.updateGuiseVisible=function(){var e=this,t=e.owner,i=t.visible_guise&&t.visible_view,r=t.visible_ui;e.visible=i,e.upperHalo&&(e.upperHalo.visible=i&&r&&t.visible_halo),e.shadow&&(e.shadow.visible=i&&r&&t.visible_shadow)},t.prototype.updateUIVisible=function(){var e=this,t=e.owner,i=t.visible_guise&&t.visible_view,r=t.visible_ui,n=t.visible_halo;e.upperHalo&&(e.upperHalo.visible=i&&r&&n),e.lowerHalo&&(e.lowerHalo.visible=r&&n),e.shadow&&(e.shadow.visible=i&&r&&t.visible_shadow),e.updateTopVisible()},t.prototype.updateTopVisible=function(){var e=this;e.nameTxt.visible=e.title.visible=e.owner.visible_top&&e.owner.visible_ui},t.prototype.updateShadowVisible=function(){var e=this,t=e.owner;e.shadow&&(e.shadow.visible=t.visible_guise&&t.visible_view&&t.visible_ui&&t.visible_shadow)},t.prototype.updateHaloVisible=function(){var e=this,t=e.owner,i=t.visible_guise&&t.visible_view,r=t.visible_ui,n=t.visible_halo;e.upperHalo&&(e.upperHalo.visible=i&&r&&n),e.lowerHalo&&(e.lowerHalo.visible=r&&n)},t.prototype.getRefPoint=function(e){return this.body?this.body.getRefPoint(e):egret.Point.create(0,0)},t.prototype.onTap=function(e){this.owner.onTapAgent(e)},t.prototype.showCityConvTalk=function(e,t){var i=this.bubbleText||ObjectPool.pop(CityConvTalk,"CityConvTalk");this.bubbleText=i;var r=this.getRefPoint("p_hp");i.x=r.x,i.y=r.y,!i.parent&&this.content.addChild(i),i.updateText(e,t)},t.prototype.getGuiseRect=function(){return this.body?this.body.getBounds():this.getBounds()},t.prototype.destroyBody=function(){var e=this,t=e.body;t&&(EventCenter.removeEvent(t,"ready",e.onGuiseReady,e),EventCenter.clearTarget(t),e.body=null,t.destroy())},t.prototype.onDestroy=function(){var e=this;e.body&&e.body.removeEventListener(Evt.touchTap,e.onTap,e),e.destroyBody(),e.upperHalo&&(e.upperHalo.dispose(),e.upperHalo=null),e.lowerHalo&&(e.lowerHalo.dispose(),e.lowerHalo=null);var t=e.title;t&&(t.removeEventListener("loaded",e.updateUIPos,e),t.dispose(),t=null);var i=e.shadow;i.parent&&i.parent.removeChild(i),e.nameTxt.text="",e.removeChildren(),e.content.removeChildren()},t}(BaseGuise);__reflect(GAgent.prototype,"GAgent"),window.GAgent=GAgent;var GAvatar=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.playBodyAction=function(){var e=this,t=e.owner,i=t.state.actionState;if(i&&i.action&&i.action.subAction){var r=i.action.subAction,n=void 0;n=r instanceof AttackAction&&r.atInfo.mca?r.origAction+"_"+ActionMgr.changeDirToX(t.touchDir)*t.multiply:r.actionName,e.body.gotoAction(n,t.direction,r.totalFrame,r.curFrame)}e.body.afterEnterFrame()},t.prototype.updateFashion=function(){var e=this;if(e.body){var t=e.owner,i=t.curHeroCfg;e.body.changePart(1,t.heroUrl,t.resId,i.flag,i.color)}},t.prototype.updateWeapon=function(){var e=this.owner,t=e.curHeroCfg;this.body.changePart(2,Urls.weapon(),e.weaponUrl,t.flag,t.color)},t.prototype.updateWeaponEffect=function(){var e=this.owner,t=e.curHeroCfg;this.body.changePart(4,Urls.weapon(),e.weaponEffectUrl,t.flag,t.color)},t.prototype.updateWing=function(){var e=this.owner,t=e.curHeroCfg;this.body.changePart(3,Urls.wing(),e.wingUrl,t.flag,t.color)},t.prototype.updateTrans=function(){this.destroyBody(),this.createBody()},t.prototype.updateName=function(){var e,t=this,i=t.owner;if(i.petId){var r=Data.getItem("PetData",i.petId);r.isMain&&(e=i.agent.mainPetName),e||(e=i.heroCfg.name||"")}else e=i.agent.name;t.nameTxt.text="",t.nameTxt.visible=i.visible_name,t.updateUIPos()},t.prototype.createHpItem=function(){var e=this,t=e.hpItem;t||(t=e.hpItem=ObjectPool.pop(PlayerHpItem),e.topGrp.addChild(t),e.updateUIPos())},t.prototype.updateHp=function(){var e=this;e.createHpItem(),e.hpItem.updateHp(e.owner)},t.prototype.updateBuff=function(){var e=this;e.createHpItem(),e.hpItem.updateBuff(e.owner)},t.prototype.updateShieldBar=function(){e.prototype.updateShieldBar.call(this);var t=this,i=t.hpItem;i||(i=ObjectPool.pop(PlayerHpItem)),i.updateHp(t.owner)},t.prototype.updateUIPos=function(){var e=this,t=this.getRefPoint("p_hp"),i=t.y,r=e.timeBar;r&&r.visible&&(r.x=t.x,r.y=i-=10);var n=e.castBar;n&&n.visible&&(n.x=t.x,n.y=i-=10);var a=e.xuliBar;a&&a.visible&&(a.x=t.x,a.y=i-19);var o=e.protectBar;o&&o.visible&&(o.x=t.x,o.y=i-=10);var s=e.balanceBar;s&&s.visible&&(s.x=t.x,s.y=i-=10),i-=10;var l=e.hpItem;l&&(l.x=t.x,l.y=i-=11);var u=this.nameTxt;u.visible&&(u.x=t.x-.5*u.width,u.y=i-=24);var c=e.elementImg;c&&c.visible&&u.visible&&(c.x=u.x-c.width-5,c.y=u.y+.5*u.height-.5*c.height);var p=e.title;p&&p.isLoaded&&(p.x=t.x,p.y=i-=15);var d=e.shieldBar;d&&d.visible&&(d.x=t.x,d.y=i-=80);var f=e.timeTxt;if(f&&f.visible){var h=this.getRefPoint("p_defence");f.x=.5*-f.width,f.y=h.y-.5*f.height}return t},t.prototype.updateNameStyle=function(){var e=this.owner;this.nameTxt.textColor=e.hold?65535:e.side==e.scene.player.side?16765492:16736050},t.prototype.showXuliBar=function(e){var t=this,i=t.owner.skill.getXuliTime(e);if(i){var r=t.xuliBar;r||(r=t.xuliBar=ObjectPool.pop(XuliBar),t.topGrp.addChild(r)),r.visible=!0,r.minimum=0,r.maximum=i.maxTime,r.signBg.x=r.sign.x=Math.round(r.width*i.xuliTime/i.maxTime),RenderUtils.playUIEffect(r.barEff,"505",Urls.uieff(),"idle",0,!0),t.updateXuliBar(i,!1),t.updateUIPos()}},t.prototype.updateXuliBar=function(e,t){var i=this.xuliBar;i&&(i.value=e.time,t&&RenderUtils.playUIEffect(i.barEff,"506",Urls.uieff(),"idle",0,!0))},t.prototype.hideXuliBar=function(){var e=this.xuliBar;e&&(e.barEff.stop(),e.visible=!1,this.updateUIPos())},t.prototype.showPortalTime=function(){var e=this,t=e.owner,i=e.timeTxt;i||(i=e.timeTxt=ObjectPool.pop(UIBitmapLabel),i.width=150,i.height=59,i.textAlign=egret.HorizontalAlign.CENTER,i.font="battle1_json",i.prefix="battle_f_time6_",e.topGrp.addChild(i));var r=Math.ceil((t.scene.portalOverTime-DateUtils.serverNow)/1e3);r>0&&TimerManager.addCycleTask(500,e.onPortalTimeTick,e),i.visible=!0,e.updatePortalTime(r),e.updateUIPos()},t.prototype.onPortalTimeTick=function(){var e=this.owner.scene,t=Math.ceil((e.portalOverTime-DateUtils.serverNow)/1e3);0>=t&&TimerManager.removeTask(this.hashCode),this.updatePortalTime(t)},t.prototype.updatePortalTime=function(e){this.timeTxt.text=e+""},t.prototype.hidePortalTime=function(){var e=this.timeTxt;e&&(e.text="",e.visible=!1),TimerManager.removeTask(this.hashCode)},t.prototype.onFrameEffect=function(e){if(e){var t=e.split(":");this.addRunEffect(+t[0],+t[1],+t[2])}},t.prototype.showTransSkill=function(){var e=this,t=e.owner.transNpc;if((!t||t.isTransNpc)&&t.spskill_id){var i=e.transSkillItem;i||(i=e.transSkillItem=ObjectPool.pop(TransSkillItem),e.topGrp.addChild(i),i.x=-150,i.y=-60),i.visible=!0,i.updateNum(t)}},t.prototype.hideTransSkill=function(){this.transSkillItem&&(this.transSkillItem.visible=!1)},t.prototype.updateTransSkillCd=function(){var e=this.transSkillItem;e&&e.visible&&e.updateTime()},t.prototype.updateElementImg=function(){var e=this,t=e.owner,i=t.element,r=e.elementImg;i?(r||(r=e.elementImg=ObjectPool.pop(UIImage,"elementImg"),r.width=29,r.height=25,e.topGrp.addChild(r)),r.source="battle_ele_"+i,r.visible=!0,e.updateUIPos()):r&&(r.source=null,r.visible=!1)},t.prototype.onDestroy=function(){var t=this;TimerManager.removeTask(t.hashCode);var i=t.xuliBar;i&&(i.barEff.unload(),t.xuliBar=null,ObjectPool.push(i));var r=t.timeTxt;r&&(t.timeTxt=null,ObjectPool.push(r));var n=t.hpItem;n&&(t.hpItem=null,ObjectPool.push(n)),e.prototype.onDestroy.call(this)},t}(GRole);__reflect(GAvatar.prototype,"GAvatar"),window.GAvatar=GAvatar;var GBattNpc=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.initialize=function(){e.prototype.initialize.call(this),this.enabled=!0},t.prototype.create=function(){e.prototype.create.call(this),this.updateTransStatus(),this.updateTransSkill()},t.prototype.updateNameStyle=function(){var e=this.owner;this.nameTxt.textColor=e.side==e.scene.player.side?65535:16736050},t.prototype.updateHp=function(){},t.prototype.showBalanceBar=function(){},t.prototype.hideBalanceBar=function(){},t.prototype.showProtectBar=function(){},t.prototype.hideProtectBar=function(){},t.prototype.updateTransStatus=function(){var e=this,t=e.owner;if(t.isTransNpc){var i=e.transTopItem;i||(i=e.transTopItem=ObjectPool.pop(TransTopItem),e.topGrp.addChild(i),e.updateUIPos()),i.updateStatus(t)}},t.prototype.updateUIPos=function(){var t=e.prototype.updateUIPos.call(this),i=this.transTopItem;return i&&(i.x=t.x,i.y=t.y),t},t.prototype.updateTransSkill=function(){var e=this,t=e.owner;if(t.isTransNpc&&t.spskill_id){var i=e.transSkillItem;i||(i=e.transSkillItem=ObjectPool.pop(TransSkillItem),e.topGrp.addChild(i),i.x=-150,i.y=-60),i.visible=!0,i.updateNum(t)}},t.prototype.updateTransSkillCd=function(){this.transSkillItem&&this.transSkillItem.updateTime()},t.prototype.onDestroy=function(){var t=this.transTopItem;t&&(this.transTopItem=null,ObjectPool.push(t)),e.prototype.onDestroy.call(this)},t}(GRole);__reflect(GBattNpc.prototype,"GBattNpc"),window.GBattNpc=GBattNpc;var GBoss=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.updateNameStyle=function(){this.nameTxt.textColor=16736050},t}(GMonster);__reflect(GBoss.prototype,"GBoss"),window.GBoss=GBoss;var GBullet=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.create=function(){var e=this,t=e.owner,i=t.caster,r=t.effectCfg,n=i.guise?i.guise.getNewDepth():0,a=Urls.effect();if(r.upper){var o=e.upperMme=e.upperMme||ObjectPool.pop(MmeRender,"BattleMmeRender");o.load(r.res,a,null,null,3),o.depth=n,o.owner=t,o.visible=t.visible_guise}if(r.lower){var s=e.lowerMme=e.lowerMme||ObjectPool.pop(MmeRender,"BattleMmeRender");s.load(r.res,a,null,null,3),s.depth=-n,s.owner=t,s.visible=t.visible_guise}e.addBulletGuise(),e.updatePos(t.x,t.y,t.z);var l=0,u=t.trigCfg.angle;u&&(l=t.right?u:360-u),e.updateRotation(l)},t.prototype.setParent=function(e,t){this.upper=e,this.lower=t,this.addBulletGuise()},t.prototype.addBulletGuise=function(){var e=this,t=e.upper,i=e.lower,r=-1;if(t&&i){var n=e.upperMme,a=e.lowerMme;0!=(e.owner.effectCfg.utype||0)?n&&n.parent!=t&&t.addChild(n):(r=e.owner.guise?t.getChildIndex(e.owner.guise):0,n&&n.parent!=t&&t.addChildAt(n,r)),0!=(e.owner.effectCfg.ltype||0)?a&&a.parent!=i&&i.addChild(a):(-1==r&&(r=e.owner.guise?t.getChildIndex(e.owner.guise):0),a&&a.parent!=i&&i.addChildAt(a,r+2))}},t.prototype.afterEnterFrame=function(){var t=this,i=t.owner;i.visible_guise&&(e.prototype.afterEnterFrame.call(this),t.upperMme&&t.upperMme.gotoAction(i.curUpperName,i.direction,i.upperTotalFrame,i.curUpperFrame),t.lowerMme&&t.lowerMme.gotoAction(i.curLowerName,i.direction,i.lowerTotalFrame,i.curLowerFrame))},t.prototype.updatePos=function(e,t,i){var r=this,n=r.upperMme,a=r.lowerMme,o=r.owner,s=o.effectCfg;if(s){if(n){if(2!=s.utype)n.x=e,n.y=t-i;else if(o.scene){var l=o.scene.camera;l&&(n.x=.5*l.width,n.y=.5*l.height)}n.layouty=t}if(a){if(2!=s.ltype)a.x=e,a.y=t-i;else{var l=o.scene.camera;l&&(a.x=.5*l.width,a.y=.5*l.height)}a.layouty=t}}},t.prototype.updateRotation=function(e){var t=this;t.upperMme&&(t.upperMme.rotation=e),t.lowerMme&&(t.lowerMme.rotation=e)},t.prototype.playBlackEffect=function(){var e=this;e.upperMme&&(e.upperMme.filters=FiltersUtils.BLACK_FILTERS),e.lowerMme&&(e.lowerMme.filters=FiltersUtils.BLACK_FILTERS)},t.prototype.stopBlackEffect=function(){var e=this;e.upperMme&&(e.upperMme.filters=null),e.lowerMme&&(e.lowerMme.filters=null)},t.prototype.updateGuiseVisible=function(){var e=this,t=e.owner,i=t.visible_guise;e.upperMme&&(e.upperMme.visible=i),e.lowerMme&&(e.lowerMme.visible=i),i&&(t.curUpperName||t.curLowerName)&&e.afterEnterFrame()},t.prototype.clear=function(){e.prototype.clear.call(this);var t=this;t.upper=null,t.lower=null},t.prototype.onDestroy=function(){var e=this,t=e.upperMme;t&&(t.dispose(),e.upperMme=null);var i=e.lowerMme;i&&(i.dispose(),e.lowerMme=null)},t}(BaseGuise);__reflect(GBullet.prototype,"GBullet"),window.GBullet=GBullet;var GCityFruit=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.preInitialize=function(){var e=this;e.touchEnabled=!0,e.touchChildren=!1,e.content=new egret.DisplayObjectContainer},t.prototype.childrenCreated=function(){this.addChild(this.content)},t.prototype.create=function(){var e=this;e.destroyBody(),e.createBody();var t=e.owner;e.updatePos(t.x,t.y,t.z)},t.prototype.createBody=function(){var e=this,t=e.owner,i=t.heroCfg,r=i.flag,n=i.color,a=e.body=ObjectPool.pop(UnitPlayer),o={};o[1]={part:1,url:t.heroUrl,id:t.resId,flag:r,color:n},EventCenter.addEvent(a,"ready",e.onGuiseReady,e),a.initialize(o,3),e.content.addChildAt(a,0)},t.prototype.updateDirection=function(e){this.body.updateDirection(e)},t.prototype.playAction=function(e,t){this.body&&this.body.playAction(e,t,0,!0)},t.prototype.afterEnterFrame=function(){e.prototype.afterEnterFrame.call(this),this.body&&this.body.manualEnterFrame()},t.prototype.updateGuiseVisible=function(){var e=this.owner,t=e.agent,i=t?t.visible_guise&&t.visible_view:!1;this.visible=e.visible_guise&&e.visible_view&&i},t.prototype.getRefPoint=function(e){return this.body?this.body.getRefPoint(e):egret.Point.create(0,0)},t.prototype.getGuiseRect=function(){return this.body?this.body.getBounds():this.getBounds()},t.prototype.destroyBody=function(){var e=this,t=e.body;t&&(EventCenter.removeEvent(t,"ready",e.onGuiseReady,e),EventCenter.clearTarget(t),e.body=null,t.destroy())},t.prototype.onDestroy=function(){var e=this;e.destroyBody(),e.removeChildren(),e.content.removeChildren()},t}(BaseGuise);__reflect(GCityFruit.prototype,"GCityFruit"),window.GCityFruit=GCityFruit;var GEffect=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.initialize=function(e,t,i){var r=this;r.clear(),r.isvalid=!0,r.owner=e,r.upper=t,r.lower=i,r.effects={},r.effectList=[],r.uppers=[],r.lowers=[];var n=e.scene.guise;n&&(r.sceneUpper=n.getLayer(8),r.sceneLower=n.getLayer(5),r.fullUpper=n.getLayer(10),r.fullLower=n.getLayer(4))},t.prototype.playEffect=function(e,t,i,r,n,a,o,s,l){void 0===o&&(o=!1),void 0===s&&(s=!1),void 0===l&&(l=!1);var u,c=this,p=c.effectList;if(l)for(var d=0,f=p.length;f>d;d++)if(u=p[d],u&&u.cfg==e){if(0==u.playType)break;return null}var h,v,m,y,g=c.owner,b=g.visible_effect,x=g.invisible,I=Urls.effect(),_=Data.getEffectUid(),S=Data.getOppItem("EffectAction",e.res);u={uid:_,cfg:e,playType:a,direction:i,offx:r,offy:n,upper:e.upper,upperEnd:!e.upper,lower:e.lower,lowerEnd:!e.lower,skipSound:o},p.push(u),c.effects[_]=u;var T=e.solo?c.checlSoloVisible(e):!0;u.visible_solo=T;var w=r,A=n,P=r,C=n;if(1==e.utype)w+=g.x,A+=g.y-g.z,h=c.sceneUpper;else if(2==e.utype){var D=g.scene.camera;w+=.5*D.width,A+=.5*D.height,h=c.fullUpper}else 3==e.utype?(w+=g.x,A+=g.y-g.z,h=c.sceneUpper):h=c.upper;if(1==e.ltype)P+=g.x,C+=g.y-g.z,v=c.sceneLower;else if(2==e.ltype){var D=g.scene.camera;P+=.5*D.width,C+=.5*D.height,v=c.fullLower}else 3==e.ltype?(P+=g.x,C+=g.y-g.z,v=c.sceneLower):v=c.lower;if(u.upper){m=ObjectPool.pop(MmeRender,"BattleMmeRender"),m.load(e.res,I,null,null,3,o),m.owner=g,e.suf&&(u.upper=u.upper+"_"+t);var B=S.dic[u.upper];Functor.assert(B,"特效动作数据不存在，特效id："+u.cfg.id+" 动作名称："+u.upper),ConstD.parseActionData(B),u.upperActionData=B,u.upperTotalFrame=B.total||1,u.upperCurFrame=1,g.hold?(m.alpha=x&&b?.5:1,m.visible=!x&&b&&T):(m.alpha=1,m.visible=0==e.utype||1==e.utype?!x&&b&&T:b&&T),m.x=w,m.y=m.layouty=A,h.addChild(m),c.onFrameEvent(u,B,u.upper,u.upperCurFrame,u.skipSound)}if(u.lower){y=ObjectPool.pop(MmeRender,"BattleMmeRender"),y.load(e.res,I,null,null,3,o),y.owner=g,e.suf&&(u.lower=u.lower+"_"+t);var B=S.dic[u.lower];Functor.assert(B,"特效动作数据不存在，特效id："+u.cfg.id+" 动作名称："+u.lower),ConstD.parseActionData(B),u.lowerActionData=B,u.lowerTotalFrame=B.total||1,u.lowerCurFrame=1,g.hold?(y.alpha=x&&b?.5:1,y.visible=!x&&b&&T):(y.alpha=1,y.visible=0==e.ltype||1==e.ltype?!x&&b&&T:b&&T),y.x=P,y.y=y.layouty=C,v.addChild(y),c.onFrameEvent(u,B,u.lower,u.lowerCurFrame,u.skipSound)}return c.uppers.push(m),c.lowers.push(y),c.afterEnterFrame(),u},t.prototype.removeEffect=function(e){var t=this,i=t.effects[e];if(i){delete t.effects[e];var r=t.effectList,n=r.indexOf(i);if(n>=0){r.splice(n,1);var a=t.uppers[n],o=t.lowers[n];t.uppers.splice(n,1),t.lowers.splice(n,1),a&&a.dispose(),o&&o.dispose(),SoundUtils.onBattleActionEnd(i.soundId)}if(i.cfg.solo&&i.visible_solo)for(var s=void 0,l=0,u=r.length;u>l;l++)if(s=r[l],s.cfg==i.cfg){s.visible_solo=!0,t.updateEffectVisible(s,l);break}return i}return null},t.prototype.updateEffectsVisible=function(){var e=this,t=e.owner;e.effectList.forEach(function(t,i){e.updateEffectVisible(t,i)}),t.visible_effect&&(t.hold||!t.invisible)&&e.afterEnterFrame()},t.prototype.checlSoloVisible=function(e){for(var t,i=this.effectList,r=0,n=i.length;n>r;r++)if(t=i[r],t.cfg==e&&t.visible_solo)return!1;return!0},t.prototype.updateEffectVisible=function(e,t){var i=this,r=i.owner,n=r.visible_effect,a=r.invisible,o=i.uppers[t],s=i.lowers[t],l=e.cfg,u=e.visible_solo;o&&(r.isPlayerSide?(o.alpha=a&&n?.5:1,o.visible=!a&&n&&u):(o.alpha=1,o.visible=0==l.utype||1==l.utype?!a&&n&&u:n&&u)),s&&(r.isPlayerSide?(s.alpha=a&&n?.5:1,s.visible=!a&&n&&e.visible_solo):(s.alpha=1,s.visible=0==l.ltype||1==l.ltype?!a&&n&&u:n&&u))},t.prototype.onEnterFrame=function(e){var t,i,r,n=this;n.effectList.forEach(function(e){if(t=e.playType,0==t&&e.upperEnd&&e.lowerEnd)return void EventCenter.execute(n,"actionPlayEnd",e);if(i=e.stillType,r=!1,4==i?(e.curSlowTimes>=e.slowTimes[e.curSlowFrame-1]?(r=!1,e.curSlowFrame++,e.curSlowTimes=0):(r=!0,e.curSlowTimes++),e.curSlowFrame>e.slowFrames&&(r=!1,e.stillType=e.slowFrames=e.curSlowFrame=e.curSlowTimes=0,e.slowTimes=null)):i&&(e.stillTrig>0?e.stillTrig--:e.stillFrame>0?(1==i||(3==i?r=!0:2==i&&(r=!0)),e.stillFrame--):e.stillType=0),!r){var a=void 0;if(!e.upperEnd){var o=e.upperCurFrame+1;a=!0,o>e.upperTotalFrame&&(o=1==t||3==t?1:e.upperTotalFrame,(2==t||4==t)&&(a=!1)),e.upperCurFrame=o,a&&n.onFrameEvent(e,e.upperActionData,e.upper,o,e.skipSound),0==t&&(e.upperEnd=o==e.upperTotalFrame)}if(!e.lowerEnd){var o=e.lowerCurFrame+1;a=!0,o>e.lowerTotalFrame&&(o=1==t||3==t?1:e.lowerTotalFrame,(2==t||4==t)&&(a=!1)),e.lowerCurFrame=o,a&&n.onFrameEvent(e,e.lowerActionData,e.lower,o,e.skipSound),0==t&&(e.lowerEnd=o==e.lowerTotalFrame)}}})},t.prototype.afterEnterFrame=function(){var e=this,t=e.owner;if(t.visible_effect&&(t.isPlayerSide||!t.invisible))for(var i,r,n,a,o=t.direction,s=e.uppers,l=e.lowers,u=0,c=s.length;c>u;u++)i=e.effectList[u],r=i.direction?i.direction:o,n=s[u],a=l[u],n&&(1==i.cfg.utype&&(n.x=i.offx+t.x,n.y=n.layouty=i.offy+t.y-t.z),n.gotoAction(i.upper,r,i.upperTotalFrame,i.upperCurFrame)),a&&(1==i.cfg.ltype&&(a.x=i.offx+t.x,a.y=a.layouty=i.offy+t.y-t.z),a.gotoAction(i.lower,r,i.lowerTotalFrame,i.lowerCurFrame))},t.prototype.onFrameEvent=function(e,t,i,r,n){var a=this,o=a.owner;if(Functor.assert(t,"特效动作数据不存在，特效id："+e.cfg.id+" 动作名称："+e.upper),t.events){var s=t.events[r];if(s&&s.length){var l=o.$eid,u=o.scene.stepTotal;s.forEach(function(t){switch(t[0]){case"playShake":SceneMgr.onFrameShake(o.scene,o,t[1]);break;case"sound":n||(e.soundId||(e.soundId=IDUtils.genID("battleSound")),SceneMgr.onFrameSound(l,u,e.soundId,i,r,t[1]))}})}}},t.prototype.onNextRound=function(){var e,t,i,r,n,a=this,o=a.uppers,s=a.lowers,l=this.owner.scene.guise;if(l){var u=a.sceneUpper=l.getLayer(8),c=a.sceneLower=l.getLayer(5),p=a.fullUpper=l.getLayer(10),d=a.fullLower=l.getLayer(4);a.effectList.forEach(function(a,l){t=o[l],i=s[l],e=a.cfg,a.upper&&t&&(r=1==e.utype?u:2==e.utype?p:3==e.utype?u:null,r&&r.addChild(t)),a.lower&&i&&(n=1==e.ltype?c:2==e.ltype?d:3==e.ltype?c:null,n&&n.addChild(i))})}},t.prototype.getEffectsById=function(e){return this.effectList?this.effectList.filter(function(t){return t.cfg.id==e}):null},t.prototype.clear=function(){ObjectUtils.clearKeys(this,["owner","upper","lower","sceneUpper","sceneLower","fullUpper","fullLower","effectList","effects","uppers","lowers"])},t.prototype.destroy=function(){var e=this;if(e.isvalid){e.isvalid=!0;for(var t=0,i=e.uppers.length;i>t;t++){var r=e.uppers[t];r&&r.dispose();var n=e.lowers[t];n&&n.dispose()}e.onDestroy(),e.clear()}},t.prototype.onDestroy=function(){},t}(egret.HashObject);__reflect(GEffect.prototype,"GEffect"),window.GEffect=GEffect;var GElite=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.updateNameStyle=function(){this.nameTxt.textColor=16736050},t.prototype.showBalanceBar=function(){},t.prototype.hideBalanceBar=function(){},t.prototype.showProtectBar=function(){},t.prototype.hideProtectBar=function(){},t}(GMonster);__reflect(GElite.prototype,"GElite"),window.GElite=GElite;var GFruit=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.updateNameStyle=function(){var e=this.owner;this.nameTxt.textColor=e.hold?16765492:e.side==e.scene.player.side?16765492:16736050},t.prototype.updateName=function(){var e=this;e.nameTxt.text=e.owner.name,e.nameTxt.visible=e.owner.visible_name,e.updateUIPos()},t.prototype.showBalanceBar=function(){},t.prototype.hideBalanceBar=function(){},t.prototype.showProtectBar=function(){},t.prototype.hideProtectBar=function(){},t}(GRole);__reflect(GFruit.prototype,"GFruit"),window.GFruit=GFruit;var GMachine=function(e){function t(){return e.call(this)||this}return __extends(t,e),t}(GMonster);__reflect(GMachine.prototype,"GMachine"),window.GMachine=GMachine;var GMetalPail=function(e){function t(){return e.call(this)||this}return __extends(t,e),t}(GMonster);__reflect(GMetalPail.prototype,"GMetalPail"),window.GMetalPail=GMetalPail;var NormalDeadAction=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.play=function(){e.prototype.play.call(this);var t=this;t.totalFrame>this.ctime&&(t.ctime=t.time=t.totalFrame)},t.prototype.doAction=function(e,t,i,r,n){11==this.curFrame},t}(SubAction);__reflect(NormalDeadAction.prototype,"NormalDeadAction"),window.NormalDeadAction=NormalDeadAction;var GNorMonster=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.updateNameStyle=function(){this.nameTxt.textColor=16777215},t.prototype.updateName=function(){var e=this;e.nameTxt.text="",e.nameTxt.visible=!1,e.updateUIPos()},t.prototype.updateHp=function(){e.prototype.updateHp.call(this);var t=this,i=t.topGrp;t.owner.visible_top||(t.owner.visible_top=!0,i.alpha=0,egret.Tween.get(i).to({alpha:1},300).wait(4e3).to({alpha:0},300).call(t.hideTop,t))},t.prototype.hideTop=function(){this.owner.visible_top=!1},t.prototype.showBalanceBar=function(){},t.prototype.hideBalanceBar=function(){},t.prototype.showProtectBar=function(){},t.prototype.hideProtectBar=function(){},t.prototype.onDestroy=function(){this.topGrp.alpha=1,egret.Tween.removeTweens(this.topGrp),e.prototype.onDestroy.call(this)},t}(GMonster);__reflect(GNorMonster.prototype,"GNorMonster"),window.GNorMonster=GNorMonster;var GNpc=function(e){function t(){var t=e.call(this)||this;return t.touchId=-1,t}return __extends(t,e),t.prototype.preInitialize=function(){var e=this;
e.touchEnabled=!0,e.content=new egret.DisplayObjectContainer;var t=e.shadow=new UIImage;t.width=121,t.height=80,t.anchorOffsetX=.5*t.width,t.anchorOffsetY=.5*t.height},t.prototype.childrenCreated=function(){var e=this;e.addChild(e.content),e.owner.npcCfg.tapAction&&(e.addEventListener(Evt.touchBegin,e.onTapBegin,e),App.stage.addEventListener(Evt.touchEnd,e.onTapEnd,e)),e.addEventListener(Evt.touchTap,e.onTap,e)},t.prototype.create=function(){var e=this;e.destroyBody(),e.createBody();var t=e.owner;e.updatePos(t.x,t.y,t.z),e.updateIcon(),e.updateFunc()},t.prototype.createBody=function(){var e=this,t=e.owner,i=e.body=ObjectPool.pop(UnitPlayer);EventCenter.addProxy(i,e);var r={};r[1]={part:1,url:Urls.npc(),id:t.resId,flag:null,color:null},EventCenter.addEvent(i,"ready",e.onGuiseReady,e),i.initialize(r,3),e.content.addChildAt(i,1)},t.prototype.updateIcon=function(){this.shadow.source="hero_shadow"},t.prototype.updateFunc=function(){var e=this.owner.npcCfg;e.funcId?NameMgr.reg(this,"GNpc.funcBtn:"+e.funcId):NameMgr.reg(this,"GNpc.funcBtn:"+e.id)},t.prototype.updateText=function(e,t,i,r,n,a,o,s,l){},t.prototype.updateDirection=function(e){this.body.updateDirection(e)},t.prototype.playAction=function(e,t,i,r){var n=this,a=n.owner.npcCfg;-1!=n.touchId&&"idle"==e&&a.tapAction&&(e=a.tapAction),n.body&&n.body.playAction(e,t,i,r)},t.prototype.afterEnterFrame=function(){var e=this,t=e.owner;if(e.body){var i=e.body.actionName,r=t.npcCfg.tapAction;!r||"idle"!=i&&i!=r?e.body.manualEnterFrame():e.body.manualEnterFrame(-1!=e.touchId?r:"idle")}e.updatePos(t.x,t.y,t.z)},t.prototype.getRefPoint=function(e){return this.body?this.body.getRefPoint(e):egret.Point.create(0,0)},t.prototype.onTapBegin=function(e){this.touchId=e.touchPointID},t.prototype.onTapEnd=function(e){-1!=this.touchId&&this.touchId==e.touchPointID&&(this.touchId=-1)},t.prototype.onTap=function(){this.owner.onTrigNpc()},t.prototype.destroyBody=function(){var e=this,t=e.body;t&&(EventCenter.removeProxy(t),EventCenter.clearTarget(t),t.destroy(),e.body=null)},t.prototype.onDestroy=function(){var e=this;e.touchId=-1,e.removeEventListener(Evt.touchBegin,e.onTapBegin,e),App.stage.removeEventListener(Evt.touchEnd,e.onTapEnd,e),e.removeEventListener(Evt.touchTap,e.onTap,e),e.destroyBody();var t=e.shadow;t.parent&&t.parent.removeChild(t),e.removeChildren(),e.content.removeChildren()},t.NUM=0,t}(BaseGuise);__reflect(GNpc.prototype,"GNpc"),window.GNpc=GNpc;var GPet=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.updateNameStyle=function(){var e=this.owner;this.nameTxt.textColor=e.hold?16765492:e.side==e.scene.player.side?16765492:16736050},t.prototype.updateName=function(){var e=this;e.nameTxt.text=e.owner.name,e.nameTxt.visible=e.owner.visible_name,e.updateUIPos()},t.prototype.onFuseHideUI=function(){this.body.visible=!1},t.prototype.showBalanceBar=function(){},t.prototype.hideBalanceBar=function(){},t.prototype.showProtectBar=function(){},t.prototype.hideProtectBar=function(){},t}(GRole);__reflect(GPet.prototype,"GPet"),window.GPet=GPet;var GPortal=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.initialize=function(){this.touchEnabled=!0,this.touchChildren=!1,this.effect=ObjectPool.pop(MmeRender,"BattleMmeRender")},t.prototype.childrenCreated=function(){this.addChild(this.effect)},t.prototype.create=function(){var e=this,t=e.owner;e.effect.load(t.resId,Urls.effect(),null,null,3),e.updatePos(t.x,t.y,t.z)},t.prototype.afterEnterFrame=function(){this.effect&&this.effect.manualEnterFrame()},t.prototype.showPortal=function(){var e=this;e.effect.addEventListener("action_play_end",e.onShowEnd,e),e.effect.playAction(e.owner.portalCfg.appear,3,1,!1)},t.prototype.onShowEnd=function(){var e=this;e.effect.removeEventListener("action_play_end",e.onShowEnd,e),e.effect.playAction(e.owner.portalCfg.loop,3,1,!0)},t.prototype.hidePortal=function(){var e=this;e.effect.removeEventListener("action_play_end",e.onShowEnd,e),e.effect.playAction(e.owner.portalCfg.disappear,3,1,!1)},t.prototype.onDestroy=function(){var e=this,t=e.effect;t&&(t.removeEventListener("action_play_end",e.onShowEnd,e),t.dispose(),e.effect=null),e.filters=null},t}(BaseGuise);__reflect(GPortal.prototype,"GPortal"),window.GPortal=GPortal;var SpecialDeadAction=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.play=function(){e.prototype.play.call(this)},t.prototype.doAction=function(e,t,i,r,n){},t.prototype.onShaderEnd=function(){},t}(SubAction);__reflect(SpecialDeadAction.prototype,"SpecialDeadAction"),window.SpecialDeadAction=SpecialDeadAction;var GSumAvatar=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.updateNameStyle=function(){var e=this.owner;this.nameTxt.textColor=e.hold?65535:e.side==e.scene.player.side?16765492:16736050},t}(GMonster);__reflect(GSumAvatar.prototype,"GSumAvatar"),window.GSumAvatar=GSumAvatar;var GTrap=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.preInitialize=function(){this.topGrp=new egret.DisplayObjectContainer},t.prototype.childrenCreated=function(){this.addChild(this.topGrp)},t.prototype.create=function(){var e=this,t=e.owner,i=t.effectCfg,r=Urls.effect();if(i.upper){var n=e.upperMme=e.upperMme||ObjectPool.pop(MmeRender,"BattleMmeRender");n.load(i.res,r,null,null,3),n.owner=t,n.visible=t.visible_guise&&t.visible_view}if(i.lower){var a=e.lowerMme=e.lowerMme||ObjectPool.pop(MmeRender,"BattleMmeRender");a.load(i.res,r,null,null,3),a.owner=t,a.visible=t.visible_guise&&t.visible_view}e.addTrapGuise(),e.showRemainTime(),e.updatePos(t.x,t.y,t.z)},t.prototype.setParent=function(e,t,i){var r=this;e.addChild(r),r.upper=t,r.lower=i,r.addTrapGuise()},t.prototype.addTrapGuise=function(){var e=this,t=e.upper,i=e.lower,r=-1;if(t&&i){var n=e.upperMme,a=e.lowerMme;0!=(e.owner.effectCfg.utype||0)?n&&n.parent!=t&&t.addChild(n):(r=e.owner.guise?t.getChildIndex(e.owner.guise):0,n&&n.parent!=t&&t.addChildAt(n,r)),0!=(e.owner.effectCfg.ltype||0)?a&&a.parent!=i&&i.addChild(a):(-1==r&&(r=e.owner.guise?t.getChildIndex(e.owner.guise):0),a&&a.parent!=i&&i.addChildAt(a,r+2))}},t.prototype.afterEnterFrame=function(){var t=this,i=t.owner;if(i.visible_guise&&i.visible_view){e.prototype.afterEnterFrame.call(this);var r=i.effectCfg.mirror?3:i.direction;t.upperMme&&t.upperMme.gotoAction(i.curUpperName,r,i.upperTotalFrame,i.curUpperFrame),t.lowerMme&&t.lowerMme.gotoAction(i.curLowerName,r,i.lowerTotalFrame,i.curLowerFrame),i.trapCfg.isShowTime&&i.ctime&&t.updateRemainTime()}},t.prototype.updatePos=function(t,i,r){var n=this.upperMme,a=this.lowerMme;n&&(n.x=t,n.y=i-r,n.layouty=i),a&&(a.x=t,a.y=i-r,a.layouty=i),e.prototype.updatePos.call(this,t,i,r)},t.prototype.playBlackEffect=function(){var e=this;e.upperMme&&(e.upperMme.filters=FiltersUtils.BLACK_FILTERS),e.lowerMme&&(e.lowerMme.filters=FiltersUtils.BLACK_FILTERS)},t.prototype.stopBlackEffect=function(){var e=this;e.upperMme&&(e.upperMme.filters=null),e.lowerMme&&(e.lowerMme.filters=null)},t.prototype.updateGuiseVisible=function(){var e=this,t=e.owner,i=t.visible_guise;e.upperMme&&(e.upperMme.visible=i),e.lowerMme&&(e.lowerMme.visible=i),i&&(t.curUpperName||t.curLowerName)&&e.afterEnterFrame()},t.prototype.updateUIVisible=function(){this.updateTopVisible()},t.prototype.updateTopVisible=function(){var e=this,t=e.owner;e.topGrp.visible=t.visible_top&&t.visible_ui&&!DebugStatic.isVideo},t.prototype.showRemainTime=function(){var e=this,t=e.owner;if(t.trapCfg.isShowTime&&t.ctime){var i=e.timeTxt;i||(i=e.timeTxt=ObjectPool.pop(UIBitmapLabel),i.width=150,i.height=59,i.textAlign=egret.HorizontalAlign.CENTER,i.font="battle1_json",i.prefix="battle_f_time6_",e.topGrp.addChild(i)),e.updateRemainTime(),e.updateUIPos()}},t.prototype.updateRemainTime=function(){var e=this.owner;e.trapCfg.isShowTime&&e.ctime&&(this.timeTxt.text=Math.ceil(e.time/60)+"")},t.prototype.updateUIPos=function(){var e=this,t=this.getRefPoint("p_hp"),i=e.timeTxt;return i&&(i.x=.5*-i.width,i.y=t.y-i.height-70),t},t.prototype.getRefPoint=function(e){var t=this.upperMme||this.lowerMme;return t?t.getRefPoint(e)||egret.Point.create(0,0):egret.Point.create(0,0)},t.prototype.clear=function(){e.prototype.clear.call(this);var t=this;t.upper=null,t.lower=null},t.prototype.onDestroy=function(){var e=this,t=e.upperMme;t&&(t.dispose(),e.upperMme=null);var i=e.lowerMme;i&&(i.dispose(),e.lowerMme=null);var r=e.timeTxt;r&&(e.timeTxt=null,ObjectPool.push(r)),e.removeChildren(),e.topGrp.removeChildren()},t}(BaseGuise);__reflect(GTrap.prototype,"GTrap"),window.GTrap=GTrap;var MonsterHpBar=function(e){function t(){var t=e.call(this)||this,i=t;return i.skinName="BattleMonsterHpBarSkin2",i.width=125,i.height=11,i.anchorOffsetX=62,t}return __extends(t,e),t}(MaskBar);__reflect(MonsterHpBar.prototype,"MonsterHpBar"),window.MonsterHpBar=MonsterHpBar;var PlayerHpBar=function(e){function t(){var t=e.call(this)||this,i=t;return i.skinName="BattlePlayerHpBarSkin",i.width=125,i.height=11,i.anchorOffsetX=62,t}return __extends(t,e),t}(MaskBar);__reflect(PlayerHpBar.prototype,"PlayerHpBar"),window.PlayerHpBar=PlayerHpBar;var PlayerHpItem=function(e){function t(){var t=e.call(this)||this;return t.skinName="PlayerHpItemSkin",t.anchorOffsetX=42,t.anchorOffsetY=14,t}return __extends(t,e),t.prototype.initUI=function(){this.buffColl=new eui.ArrayCollection,this.buffList.dataProvider=this.buffColl,this.buffList.itemRenderer=BattlePlayerBuffItem},t.prototype.updateHp=function(e){if(e){var t=e.props;if(t){var i=this.hpBar,r=this.shieldIcon,n=t.gv("maxHp"),a=t.gv("hp"),o=t.gv("shield"),s=82,l=2,u=(n-a)/n*s,c=Math.min(s,Math.floor(o/n*s));i.maximum=n,i.minimum=0,i.value=a,r.width=c,c>u?r.x=l+s-c:r.x=l+s-u}}},t.prototype.updateBuff=function(e){var t=e.buff.getShowBuffs();t=t.reverse(),this.replace(this.buffColl,t)},t}(BaseView);__reflect(PlayerHpItem.prototype,"PlayerHpItem"),window.PlayerHpItem=PlayerHpItem;var ProtectBar=function(e){function t(){var t=e.call(this)||this,i=t;return i.skinName="BattleProtectBarSkin",i.width=121,i.height=8,i.anchorOffsetX=60,t}return __extends(t,e),t}(MaskBar);__reflect(ProtectBar.prototype,"ProtectBar"),window.ProtectBar=ProtectBar;var ShieldBar=function(e){function t(){var t=e.call(this)||this,i=t;return i.skinName="BattleShieldBarSkin",i.width=171,i.height=19,i.anchorOffsetX=85,t}return __extends(t,e),t.prototype.updateTime=function(e,t){this.timeTxt.text=e>0?Math.ceil(t/1e3)+"":""},t}(MaskBar);__reflect(ShieldBar.prototype,"ShieldBar"),window.ShieldBar=ShieldBar;var TeamHpBar=function(e){function t(){var t=e.call(this)||this,i=t;return i.skinName="BattlePlayerHpBarSkin5",i.width=125,i.height=11,i.anchorOffsetX=62,t}return __extends(t,e),t}(MaskBar);__reflect(TeamHpBar.prototype,"TeamHpBar"),window.TeamHpBar=TeamHpBar;var SpinUpAction1=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.checkEnd=function(e,t,i,r,n){var a=this;if(!i){var o=a.owner,s=a.action,l=s.nspy,u=void 0;if(l>0){var c=Fixed.value(2).mul(60).mul(n).value;if(u=Fixed.value(160).mul(n).value,u=Fixed.value(l).mul(2).sub(u).div(c).add(o.oz).max(0).value,c=Fixed.value(160).div(n).value,s.nspy=Fixed.value(l).sub(c).value,o.updatePos(o.ox,o.oy,u,o.right),s.canSpin){var p=a.rotation;p=s.px?Fixed.value(s.px).div(l).mul(.6).atan().div(Fixed.PI).mul(180).value:p?Fixed.value(p).add(2).value:40,p=Fixed.value(40).max(p).value,p=Fixed.value(60).min(p).value,a.rotation=p=Fixed.value(o.multiply).neg().mul(p).value,o.updateRotation(p)}}else{if(!o.isAir)return void(a.status=2);var c=Fixed.value(2).mul(60).mul(n).value;u=Fixed.value(40).div(n).value,u=Fixed.value(l).mul(2).sub(u).div(c).add(o.oz).max(0).value,c=Fixed.value(40).div(n).value,s.nspy=Fixed.value(l).sub(c).value,o.updatePos(o.ox,o.oy,u,o.right),o.isAir||(a.status=2)}}},t}(SubAction);__reflect(SpinUpAction1.prototype,"SpinUpAction1"),window.SpinUpAction1=SpinUpAction1;var TimeBar1=function(e){function t(){var t=e.call(this)||this;return t.skinName="BattleTimeBarSkin1",t}return __extends(t,e),t}(TimeBar);__reflect(TimeBar1.prototype,"TimeBar1"),window.TimeBar1=TimeBar1;var TimeBar2=function(e){function t(){var t=e.call(this)||this;return t.skinName="BattleTimeBarSkin2",t}return __extends(t,e),t}(TimeBar);__reflect(TimeBar2.prototype,"TimeBar2"),window.TimeBar2=TimeBar2;var TransSkillItem=function(e){function t(){var t=e.call(this)||this;return t.skinName="TransSkillItemSkin",t}return __extends(t,e),t.prototype.update=function(){this.owner&&this.updateNum(this.owner)},t.prototype.updateNum=function(e){var t=this;if(t.owner=e,t.isReady&&e.spskill_id){for(var i,r=e.spskill_curTimes,n=1;3>=n;n++)i=t["numImg"+n],i&&(i.visible=r>=n);t.updateTime()}},t.prototype.updateTime=function(){var e=this,t=e.owner;if(e.isReady&&t&&t.spskill_id){var i=e.timeBar;i.maximum=t.spskill_maxCd||1,i.minimum=0,i.value=t.spskill_curTimes==t.spskill_maxTimes?i.maximum:t.spskill_maxCd-t.spskill_curCd}},t.prototype.removeUI=function(){this.owner=null},t}(BaseView);__reflect(TransSkillItem.prototype,"TransSkillItem"),window.TransSkillItem=TransSkillItem;var TransTopItem=function(e){function t(){var t=e.call(this)||this;return t.skinName="TransTopItemSkin",t.anchorOffsetX=55,t.anchorOffsetY=112,t}return __extends(t,e),t.prototype.addUI=function(){this.addTap(this.useBtn,this.onUseTap)},t.prototype.update=function(){this.owner&&this.updateStatus(this.owner)},t.prototype.updateStatus=function(e){var t=this;if(t.owner=e,t.isReady){var i=e.useStatus,r=t.arrowImg,n=t.useBtn;r.visible=0==i,n.visible=1==i,n.enabled=!0,0==i?(r.y=15,t.gt(r,{loop:!0}).to({y:-30},500).to({y:15},500)):egret.Tween.removeTweens(r)}},t.prototype.onUseTap=function(){var e=this.owner.reqNpcTransBegin();e&&(this.useBtn.enabled=!1)},t.prototype.removeUI=function(){this.owner=null},t}(BaseView);__reflect(TransTopItem.prototype,"TransTopItem"),window.TransTopItem=TransTopItem;var XuliBar=function(e){function t(){var t=e.call(this)||this,i=t;return i.skinName="BattleXuliBarSkin",i.width=122,i.height=17,i.anchorOffsetX=61,t}return __extends(t,e),t}(MaskBar);__reflect(XuliBar.prototype,"XuliBar"),window.XuliBar=XuliBar;var BarrageInfo=function(){function e(){}return e.prototype.parse=function(e,t,i,r){var n=this;n.isvalid=!0,n.canNext=!1,n.name=e,n.head=t,n.headFrame=i,n.msg=r},e.prototype.dispose=function(){var e=this;e.isvalid&&(e.isvalid=!1,ObjectUtils.clearKeys(e,["name","head","headFrame","msg","canNext"]),ObjectPool.push(e))},e}();__reflect(BarrageInfo.prototype,"BarrageInfo"),window.BarrageInfo=BarrageInfo;var GiftInfo=function(){function e(){}return e.prototype.parse=function(e,t,i,r,n,a,o){var s=this;s.isvalid=!0,s.canNext=!1,s.giftId=e,s.rid=t,s.name=i,s.head=r,s.headFrame=n,s.trid=a,s.tname=o,s.num=1},e.prototype.addNum=function(){this.num++},e.prototype.dispose=function(){var e=this;e.isvalid&&(e.isvalid=!1,ObjectUtils.clearKeys(e,["giftId","rid","name","head","headFrame","trid","tname","canNext","num"]),ObjectPool.push(e))},e}();__reflect(GiftInfo.prototype,"GiftInfo"),window.GiftInfo=GiftInfo;var ActionMgr=function(){function e(){}return Object.defineProperty(e,"master",{get:function(){var e=this.scene;return e instanceof Room?e.player?e.player.avatar:null:e instanceof City?e.player:null},enumerable:!0,configurable:!0}),e.startBattle=function(e,t,i,r,n,a){var o=this;if(o.isOpen&&o.exit(o.scene),e){o.isOpen=!0,o.operType=0,o.diskItem=t,o.diskRect=i,o.diskGroup=r,o.diskBg=n,o.disk=a,o.scene=e,o.tempPoint=o.tempPoint||egret.Point.create(0,0);var s=o.master;s&&s.clearTouch(),r.x=360,r.y=205,o.touchId=-1,i.addEventListener(Evt.touchBegin,o.onTouchBegin,o),DeviceUtils.isMobile||(KeyBoard.down(o.onkeydown,o),KeyBoard.up(o.onkeyup,o))}},e.startCity=function(e,t,i,r,n,a){var o=this;if(o.isOpen&&o.exit(o.scene),e){o.isOpen=!0,o.operType=0,o.diskItem=t,o.diskRect=i,o.diskGroup=r,o.diskBg=n,o.disk=a,o.scene=e,o.tempPoint=o.tempPoint||egret.Point.create(0,0);var s=o.master;s&&s.clearTouch(),r.x=360,r.y=205,o.touchId=-1,i.addEventListener(Evt.touchBegin,o.onTouchBegin,o),DeviceUtils.isMobile||(KeyBoard.down(o.onkeydown,o),KeyBoard.up(o.onkeyup,o))}},e.exit=function(e){var t=this;if(t.isOpen&&e==t.scene){t.isOpen=!1,t.diskRect.removeEventListener(Evt.touchBegin,t.onTouchBegin,t),App.stage.removeEventListener(Evt.touchMove,t.onTouchMove,t),App.stage.removeEventListener(Evt.touchEnd,t.onTouchEnd,t),DeviceUtils.isMobile||(KeyBoard.undown(t.onkeydown,t),KeyBoard.unup(t.onkeyup,t));var i=t.master;i&&i.clearTouch(),t.touchId=-1,t.touchx=0,t.touchy=0,t.diskItem=null,t.diskRect=null,t.diskGroup=null,t.disk=null,t.scene=null,t.keyBoard_X=0,t.keyBoard_Y=0}},e.checkNext=function(){var e=this;if(e.keyBoard_X||e.keyBoard_Y?e.onKeyMove():-1!=e.touchId&&e.onDiskMove(e.touchx,e.touchy),!DeviceUtils.isMobile&&KeyBoard.isContain(KeyBoard.J)&&e.scene instanceof Room&&e.scene.isControl){e.onTouchSkill(0,!0);var t=e.scene.player;t&&t.avatar&&t.avatar.changePress(!0)}},e.onkeydown=function(e){var t=this;if(t.playerOp&&!t.disableKey[e]){var i=t.scene;if(i instanceof Room&&i.isControl){var r=-1,n=i.player;e==KeyBoard.J&&(r=0),e==KeyBoard.K&&(r=1),e==KeyBoard.L&&(r=2),e==KeyBoard.Y&&(r=3),e==KeyBoard.U&&(r=4),e==KeyBoard.I&&(r=5),e==KeyBoard.O&&(r=6),e==KeyBoard.P&&(r=7),e==KeyBoard.T&&(r=8),e==KeyBoard.B&&(r=9),e==KeyBoard.N&&(r=10),e==KeyBoard.M&&(r=11),e==KeyBoard.H&&(r=99),e==KeyBoard.Z&&(r=100),e==KeyBoard.X&&(r=101),e==KeyBoard.C&&(r=102),r>=0?t.onTouchSkill(r,!0):e==KeyBoard.Q?!i.isAllPetUp&&n.reqCallPet(1):e==KeyBoard.T?!i.isAllPetUp&&n.reqCallPet(2):e==KeyBoard.E?n.reqPetFuse():e==KeyBoard.R?n.reqPetHide():e==KeyBoard.P&&n.reqUsePetKillSkill(n.avatar.killPetId),e==KeyBoard.J&&n.avatar.changePress(!0)}if(1!=t.operType){var a=!1;e==KeyBoard.W?(t.keyBoard_Y=-1,a=!0):e==KeyBoard.S?(t.keyBoard_Y=1,a=!0):e==KeyBoard.A?(t.keyBoard_X=-1,a=!0):e==KeyBoard.D&&(t.keyBoard_X=1,a=!0),a&&t.onKeyMove()}}},e.onkeyup=function(e){var t=this;if(t.scene instanceof Room&&t.scene.isControl){var i=-1;e==KeyBoard.J&&(i=0),e==KeyBoard.K&&(i=1),e==KeyBoard.L&&(i=2),e==KeyBoard.Y&&(i=3),e==KeyBoard.U&&(i=4),e==KeyBoard.I&&(i=5),e==KeyBoard.O&&(i=6),e==KeyBoard.P&&(i=7),e==KeyBoard.T&&(i=8),e==KeyBoard.B&&(i=9),e==KeyBoard.N&&(i=10),e==KeyBoard.M&&(i=11),e==KeyBoard.H&&(i=99),e==KeyBoard.Z&&(i=100),e==KeyBoard.X&&(i=101),e==KeyBoard.C&&(i=102),i>=0&&t.onTouchSkill(i,!1),e==KeyBoard.J&&t.scene.player.avatar.changePress(!1)}var r=!1;1==t.operType||t.disableKey[e]||(e==KeyBoard.W?(t.keyBoard_Y=KeyBoard.isContain(KeyBoard.S)?1:0,r=!0):e==KeyBoard.S?(t.keyBoard_Y=KeyBoard.isContain(KeyBoard.W)?-1:0,r=!0):e==KeyBoard.A?(t.keyBoard_X=KeyBoard.isContain(KeyBoard.D)?1:0,r=!0):e==KeyBoard.D&&(t.keyBoard_X=KeyBoard.isContain(KeyBoard.A)?-1:0,r=!0),r&&t.onKeyMove())},e.onKeyMove=function(){var e=this,t=e.master;if(t){if(!e.keyBoard_X&&!e.keyBoard_Y)return t.touchMoveEnd(),e.operType=0,void(e.disk.x=e.disk.y=0);if(!(!e.playerOp||t instanceof Avatar&&!t.scene.isControl)){var i=Math.atan2(e.keyBoard_Y,e.keyBoard_X),r=e.radius,n=Math.floor(Math.cos(i)*r),a=Math.floor(Math.sin(i)*r);e.operType=2,e.disk.x=n,e.disk.y=a;var o=e.getTouchDir(i);t.isTouch?t.touchMoveChange(o):t.touchMoveBegin(o)}}},e.onDiskMove=function(e,t){var i=this,r=i.master;if(i.playerOp&&r&&(!(r instanceof Avatar)||r.scene.isControl)){var n=i.calAngle(i.diskGroup,e,t);i.disk.x=n.ex,i.disk.y=n.ey,r.touchMoveBegin(i.getTouchDir(n.radian))}},e.startTouchDisk=function(e,t){var i=this,r=i.master;if(i.playerOp&&r&&(!(r instanceof Avatar)||r.scene.isControl)){var n=i.diskItem.globalToLocal(e,t,i.tempPoint);i.operType=1,i.touchx=e,i.touchy=t,i.diskGroup.x=n.x,i.diskGroup.y=n.y}},e.onTouchBegin=function(e){var t=this;if(-1==t.touchId){if(!t.isOpen||!t.playerOp)return void GameLog.log("ActionMgr.onTouchBegin: return aa");var i=t.master;if(i instanceof Avatar&&!i.scene.isControl)return void GameLog.log("ActionMgr.onTouchBegin: return bb");if(t.touchId=e.touchPointID,App.stage.addEventListener(Evt.touchMove,t.onTouchMove,t),App.stage.addEventListener(Evt.touchEnd,t.onTouchEnd,t),2==t.operType)return;t.startTouchDisk(e.stageX,e.stageY)}},e.onTouchMove=function(e){var t=this;if(-1!=t.touchId&&e.touchPointID==t.touchId){var i=t.master;i.isTouch||t.onDiskMove(e.stageX,e.stageY);var r=e.stageX,n=e.stageY,a=t.calAngle(t.diskGroup,r,n);t.touchx=r,t.touchy=n,t.disk.x=a.ex,t.disk.y=a.ey,i&&i.touchMoveChange(t.getTouchDir(a.radian))}},e.onTouchEnd=function(e){var t=this;if(-1!=t.touchId&&t.touchId==e.touchPointID){if(t.touchId=-1,App.stage.removeEventListener(Evt.touchMove,t.onTouchMove,t),App.stage.removeEventListener(Evt.touchEnd,t.onTouchEnd,t),2==t.operType)return;var i=t.master;i&&i.touchMoveEnd(),t.operType=0,t.disk.x=t.disk.y=0,t.diskGroup.x=360,t.diskGroup.y=205}},e.calAngle=function(e,t,i){var r=this,n=e.globalToLocal(t,i,r.tempPoint),a=Math.atan2(n.y,n.x),o=Math.sqrt(Math.pow(n.x,2)+Math.pow(n.y,2)),s=Math.min(r.radius,o)/o,l=Math.floor(s*n.x),u=Math.floor(s*n.y);return{radian:a,ex:l,ey:u}},e.getTouchDir=function(e){var t=e/Math.PI*180;0>t&&(t=360+t);var i;return i=(Math.round(t/22.5)+1)%16,i||16},e.changeDirToX=function(e){return 1==e||2==e||3==e||4==e||14==e||15==e||16==e?1:6==e||7==e||8==e||9==e||10==e||11==e||12==e?-1:0},e.changeTouchDir=function(e){return e?5:13},e.onTouchSkill=function(e,t){var i=this,r=i.master;if(r instanceof Avatar&&i.scene instanceof Room&&(!t||i.playerOp&&i.scene.isControl)){var n,a;if(100>e)if(n=r,0==e)a=n.skill.nskillId;else if(99==e)a=n.beControl?n.skill.escapeSkillId:n.skill.dodgeSkillId;else if(i.scene.isPetSally)a=n.heroCfg.skill?n.heroCfg.skill[e-1]:0;else if(n instanceof Avatar&&n.transHeroId&&n.transHeroCfg)a=n.transHeroCfg.skill?n.transHeroCfg.skill[e-1]:0;else{var o=r.agent.getSkillSlotId(e);o&&(a=o.skillId)}else if(n=r.agent.pet,n&&n.heroCfg.skill){var s=n.skill.getSkillInfo(n.heroCfg.skill[e%100]);s&&(a=s.skillId)}a&&(t?n.skill.onTouchSkillBegin(a,!0):n.skill.onTouchSkillEnd(a,!0))}},e.onItemSlotTap=function(e){var t=this,i=t.master;if(t.isOpen&&i instanceof Avatar&&i.agent&&t.scene instanceof Room&&t.playerOp&&t.scene.isControl){var r=i.agent.getItemSlotId(e);r&&i.agent.reqUseItem(r.itemId)}},e.radius=50,e.touchId=-1,e.keyBoard_X=0,e.keyBoard_Y=0,e.playerOp=!0,e.disableKey={},e}();__reflect(ActionMgr.prototype,"ActionMgr"),window.ActionMgr=ActionMgr;var CommonBtnEffMgr=function(){function e(){}return e.init=function(){if(!this.initialized){this.initialized=!0,this.items=[];var e=this.layer=LayerManager.addLayer(14,new eui.Group);e.touchEnabled=e.touchChildren=!1,App.stage.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTap,this,!0)}},e.onTap=function(e){var t=ObjectPool.pop(core.MmeEffect);t.x=e.stageX,t.y=e.stageY,this.items.push(t),this.layer.addChild(t),t.once("action_play_end",this.onEnd,this),RenderUtils.addUIEffect(this.layer.hashCode,t,"560",Urls.uieff(),"idle")},e.onEnd=function(e){var t=e.currentTarget;CommonUtils.arrayRemove(this.items,t),this.layer.removeChild(t),ObjectPool.push(t)},e.initialized=!1,e}();__reflect(CommonBtnEffMgr.prototype,"CommonBtnEffMgr"),window.CommonBtnEffMgr=CommonBtnEffMgr;var FuncMgr=function(){function e(){}return e.reg=function(e,t){},e.un=function(e){},e}();window.FuncMgr=FuncMgr;var GuideMgr=function(){function e(){}return e.reg=function(e,t,i,r,n){},e.un=function(e){},e}();window.GuideMgr=GuideMgr;var NameMgr=function(){function e(){}return e.reg=function(e,t){if(e){var i=this.itemMap[e.hashCode];if(i){var r=this.uiMap[i];if(r&&r.length){var n=r.indexOf(e);n>=0&&r.splice(n,1)}}this.itemMap[e.hashCode]=t;var a=this.uiMap;a[t]=a[t]||[],a[t].push(e)}},e.un=function(e,t){if(e){this.itemMap[e.hashCode]=void 0;var i=this.uiMap,r=i[t];if(r){var n=r.indexOf(e);n>=0&&r.splice(n,1)}}},e.getUI=function(e){var t=this.uiMap[e];if(t)for(var i=0,r=t;i<r.length;i++){var n=r[i];if(Utils.isVisible(n))return n}return t?t[0]:void 0},e.uiMap={},e.itemMap={},e}();__reflect(NameMgr.prototype,"NameMgr"),window.NameMgr=NameMgr;var PanelMgr=function(){function e(){}return e.initialize=function(){function e(e,t){return e.index-t.index}if(!this.initialized){this.initialized=!0,this._lineMap=new HashMap,this._line=this.getPanelLine(0),this._tabViewMap=new HashMap,this._mainUIMap=new HashMap;var t,i=Data.getData("PanelData"),r=this._uiMap=new HashMap;i.forEach(function(e){void 0===e.index&&(e.index=-1),e.name&&(t=r.getValue(e.name),t||(t=[],r.add(e.name,t)),t.push(e))});for(var n=r.valueSet,a=0,o=n;a<o.length;a++){var s=o[a];s.sort(e)}for(var l=new HashMap,u=0,c=n;u<c.length;u++){var s=c[u];l.clear();for(var p=0,d=s;p<d.length;p++){var f=d[p];-1===f.index&&l.add(f.id,f.id)}l.length>1&&GameLog.warning("Can not use same name with ids === "+l.valueSet.toString())}for(var h=0,v=n;h<v.length;h++){var s=v[h];this._mainUIMap.add(s[0].name,s[0])}App.addL("app_ui_hide",this.onHideUI,this),App.addL("app_ui_show",this.onShowUI,this),App.addL("c7",this.onSceneChange,this)}},e.getMainUICfg=function(e){var t=this._mainUIMap.getValue(e);return t},e.getMainUICfgByPid=function(t){var i=e.getUIKey(t),r=this.getMainUICfg(i);return r},e.getPanelLine=function(e){var t=this._lineMap.getValue(e);return t||(t=ObjectPool.pop(PanelLine),t.id=e,t.onCreate(),this._lineMap.add(e,t)),t},e.getPanelLineByPid=function(e,t){if(t)return t;var i=Data.getItem("PanelData",e);return i?i.line||1:void 0},e.onSceneChange=function(e){SceneMgr.scene.isCity||this.removePanelLines()},e.addParams=function(e,t,i){this._paramsMap.add(e,{pid:e,params:t,view:i})},e.getParams=function(e){return this._paramsMap.getValue(e)},e.removeParams=function(e){this._paramsMap.removeKey(e)},e.open=function(t,i,r,n,a){var o=e.openCheck(t,i,r,n,a);if(!o)return null;var s=Data.getItem("PanelData",t);if(s&&s.parent&&!this.open(s.parent,{showTip:i&&i.showTip||!0},r,n,a))return null;var l=e.getMainUICfgByPid(t);if(!a&&l&&l.level>9){var u=0,c=this.getPanelLine(0).lineItem;return c&&10!=c.cfg.line&&10===l.line&&(u=1),this.getPanelLine(u).open(t,o.params,r),this.onOpenPanelLine(t),null}var p=UI.open(o.uiType,o.params,r);return p},e.autoOpen=function(e,t,i,r){this.open(e,t,i,r,!0)},e.onOpenPanelLine=function(e){if(242===e)for(var t=this.getTargetLineUIs(e);t.length>2;)this.getPanelLine(t[0].oid).removeLineUIData(t[0]),t.shift()},e.openUI=function(e,t,i,r,n){var a=Data.getOppItem("PanelData",e);a&&this.open(a.id,t,i,r,n)},e.linkOpen=function(e,t,i,r,n){UI.closeUIType(2),t||(t={}),t.isCloseUpper=!0,"number"==typeof e?this.open(e,t,i,r,n):this.openUI(e,t,i,r,n)},e.removeLineUI=function(e){for(var t=this._lineMap.valueSet,i=t.length;i--;)t[i].removeLineUI(e)},e.openUICheck=function(e){var t=Data.getOppItem("PanelData1",e);return t&&t.id?!!this.openCheck(t.id):!0},e.openCheck=function(t,i,r,n,a){var o=Data.getItem("PanelData",t);if(!o)return null;var s=e.getMainUICfgByPid(t);if(!a&&s&&s.level>9&&!this.getPanelLine(0).checkAdd(t,i,r,n))return null;var l=this.getUIKey(t);return{uiType:l,params:this.createParams(t,i)}},e.forceOpen=function(e,t,i){var r=this.getUIKey(e),n=this.createParams(e,t);UI.open(r,n,i)},e.createParams=function(e,t){var i=Data.getItem("PanelData",e);if(!i)return null;var r=i.index>-1?i.index:-1;t=t||{},void 0!==t.index&&t.index!=r&&GameLog.warning("Error params index of pid = "+e),t.index=r,void 0!==t.pid&&t.pid!=e&&GameLog.warning("Error params pid of pid = "+e),t.pid||(t.pid=e);var n=this._paramsMap.getValue(e);if(n){var a=n.params;if(a){void 0==t&&(t={});for(var o in a)void 0!==t[o]&&t[o]!=a[o]&&GameLog.warning("Error params "+o+" of pid = "+e),t[o]=a[o]}}return t},e.getUIKey=function(e){var t,i=Data.getItem("PanelData",e);i&&(t=i.name);var r=this._paramsMap.getValue(e);return r&&r.view&&(t=r.view),t},e.openPupup=function(){this._lineMap.valueSet.forEach(function(e){e.openPupup()})},e.uiLock=function(){this._lineMap.valueSet.forEach(function(e){e.uiLock()})},e.unUiLock=function(){this._lineMap.valueSet.forEach(function(e){e.unUiLock()})},e.clearPanelLines=function(){var e=this._lineMap.valueSet;e.forEach(function(e){e.clear()})},e.removePanelLines=function(){var e=this._lineMap.valueSet;e.forEach(function(e){e.clearLineUIs()})},e.getLineUIs=function(){var e=[],t=this._lineMap.valueSet;return t.forEach(function(t){e.push.apply(e,t.getLineUIs())}),e},e.getTargetLineUIs=function(e){for(var t,i=[],r=this._lineMap.valueSet,n=0,a=r;n<a.length;n++){var o=a[n];t=o.getLineUIs();for(var s=0,l=t;s<l.length;s++){var u=l[s];u.id===e&&i.push(u)}}return i},e.getLockItem=function(){for(var e=this._lineMap.valueSet,t=0,i=e;t<i.length;t++){var r=i[t];if(r.lineItem)return r.lineItem}},e.onShowUI=function(e){var t=e.data.vo;if(t){var i=Data.getOppItem("PanelData",t.className);i&&App.dispatch("c18",i.id)}},e.onHideUI=function(t){var i=t.data.vo;if(i){var r=i.params;r&&r.back&&e.open(r.back.id,r.back.params)}},e.close=function(e){var t=Data.getItem("PanelData",e);t&&t.name&&UI.close(t.name)},e.closes=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var i=this;e.forEach(function(e){i.close(e)})},e.onRelogin=function(){if(this._lineMap){var e=this._lineMap.valueSet;e.forEach(function(e){e.clear()}),this._lineMap.clear()}},e.getUI=function(e){var t=Data.getItem("PanelData",e);return t&&t.name?UI.getUI(t.name):null},e.hasUI=function(e){return!!this.getUI(e)},e.getClassName=function(e){var t=Data.getItem("PanelData",e);return t?t.name:""},e.addTabPanel=function(e,t){this._tabMap.add(e,t)},e.addTabView=function(e,t){this._tabViewMap.add(e,t)},e.getTabView=function(e){return this._tabViewMap.getValue(e)},e.getTabPanel=function(e){var t=this._tabMap.getValue(e);return t||GameLog.warning("Please add cl of pid === "+e),t},e.getRedId=function(e){var t=Data.getItem("PanelData",e);if(t){var i=Data.getItem("OpenFuncData",t.funcId);if(i)return i.redId}},e.getFuncId=function(e){var t=Data.getItem("PanelData",e);if(t){var i=Data.getItem("OpenFuncData",t.funcId);return i?i.id:void 0}},e.getPidByFuncId=function(e){var t=Data.getItem("OpenFuncData",e);return t?t.ui:void 0},e.isOpen=function(e){var t=Data.getItem("PanelData",e);return t&&t.name&&UI.isOpen(t.name)?!0:!1},e._tabMap=new HashMap,e._tabViewMap=new HashMap,e._paramsMap=new HashMap,e.initialized=!1,e}();__reflect(PanelMgr.prototype,"PanelMgr"),window.PanelMgr=PanelMgr;var RecordMgr=function(){function e(){}return e.initialize=function(){if(!this.initialized){this.initialized=!0,this.records={};var e=this.recordClss={};e[1]=RecordCreateEntityData,e[2]=RecordDestroyEntityData,e[3]=RecordOpenSceneData,e[4]=RecordCloseSceneData,e[5]=RecordEnterSceneData,e[6]=RecordLeaveSceneData,e[7]=RecordEnterMapData,e[8]=RecordSceneStartData,e[9]=RecordNextRoundReadyData,e[10]=RecordNextRoundLoadedData,e[11]=RecordAgentStartGameData,e[12]=RecordPropChangeData,e[13]=RecordFrameData,e[14]=RecordTouchMoveBeginData,e[15]=RecordTouchMoveEndData,e[16]=RecordTouchMoveChangeData,e[17]=RecordUseAvatarSkillData,e[18]=RecordComboAvatarSkillData,e[19]=RecordBreakAvatarXuliData,e[20]=RecordCallPetData,e[21]=RecordPetHideData,e[22]=RecordPetFuseData,e[23]=RecordUseItemData,e[24]=RecordUseHelpSkillData,e[25]=RecordChangeHelpSkillData,e[26]=RecordReliveData,e[27]=RecordChangePressData,e[28]=RecordAutoBattleData,e[29]=RecordSynPosData,e[30]=RecordSyncChangeOrderData,e[31]=RecordSelectRandomBuffData,e[32]=RecordRandomBuffAgainData,e[33]=RecordBattleOverData,e[34]=RecordUsePetSkillData,e[35]=RecordComboPetSkillData,e[36]=RecordBreakPetXuliData,e[37]=RecordAutoSpeSkillData,e[38]=RecordAutoCallPetData,e[39]=RecordNpcTransBeginData,e[40]=RecordNpcTransStopData,e[41]=RecordUsePickupTrapData,e[42]=RecordSyncRoundLoadedData,e[43]=RecordPassRoundData,e[44]=RecordAvatarDeadData,e[45]=RecordPetDeadData,e[46]=RecordMaxData}},e.upload=function(e,t,i,r,n){for(var a=[],o=5;o<arguments.length;o++)a[o-5]=arguments[o]},e.record=function(e,t){for(var i=[],r=2;r<arguments.length;r++)i[r-2]=arguments[r]},e.recordRoomInfo=function(e){},e.verifyBattleOver=function(e,t,i,r){},e.verifyRecordMax=function(e,t,i){},e.dipose=function(e){},e.verify=function(e){return null},e.set_eid=function(e,t,i){void 0===i&&(i=null),i||(i=this.records[e]);var r=i.eids;return t in r||(r[t]=i.eidid+=1),r[t]
},e.get_eid=function(e,t,i){return void 0===i&&(i=null),i||(i=this.records[e]),i.oppeids[t]||0},e.set_sit=function(e,t,i){void 0===i&&(i=null),i||(i=this.records[e]);var r=i.sits;return t in r||(r[t]=i.sitid+=1),r[t]},e.get_sit=function(e,t,i){return void 0===i&&(i=null),i||(i=this.records[e]),i.oppsits[t]},e.isHold=function(e,t){var i=this.records[e];return i&&i.rid==t},e.getEntity=function(e,t){var i=this.records[e];return i&&i.entityMgr?i.entityMgr.getEntity(t):null},e.getScene=function(e,t){return this.getEntity(e,t)},e.createEntity=function(e,t,i,r,n,a){void 0===r&&(r=0),void 0===n&&(n=null),void 0===a&&(a=null);var o,s=this.records[e];return s&&s.entityMgr&&(s.reidid+=1,o=s.entityMgr.createEntity(t,i,r?r:this.get_eid(e,s.reidid,s),n,a)),o},e.removeEntity=function(e,t){var i=this.records[e];return i&&i.entityMgr?i.entityMgr.removeEntity(t):null},e.createGameEntity=function(e,t,i,r,n,a,o){void 0===n&&(n=0),void 0===a&&(a=null),void 0===o&&(o=null);var s=ServiceMgr.createEntity(t,i,r,n,a,o);return s},e.initialized=!1,e}();__reflect(RecordMgr.prototype,"RecordMgr"),window.RecordMgr=RecordMgr;var SceneMgr=function(){function e(){}return Object.defineProperty(e,"scene",{get:function(){return this._scene},set:function(e){var t=this._scene;this._scene=e,App.dispatch("c7",t)},enumerable:!0,configurable:!0}),e.getScene=function(e){return this.scenes[e]},e.addScene=function(e){var t=this;e.$eid in t.scenes||(t.scenes[e.$eid]=e,t.sceneList.push(e),t.scene=e)},e.removeScene=function(e){var t=this;delete t.scenes[e.$eid];var i=t.sceneList,r=i.indexOf(e);r>=0&&i.splice(r,1)},e.clearScene=function(){var e=this;e._scene=null,e.scenes={},e.sceneList.length=0,GameStatic.battleWait.clear(!0),e.unlock()},e.onEnterScene=function(){},e.onLeavScene=function(e){},e.goHome=function(){var e=this.scene;UI.close("AcGainBattleView"),e instanceof MainCity&&e.player&&e.player.syncInvisibily(!0)},e.goStreet=function(){var e=this.scene;e instanceof MainCity&&e.player&&e.player.syncInvisibily(!1)},e.playBGM=function(){this.scene&&this.scene.playBGM()},e.stopBGM=function(){this.scene&&this.scene.stopBGM()},e.updateName=function(e){var t=this.scene;t instanceof City&&t.player&&t.player.syncName(e)},e.updateFashion=function(e){var t=this.scene;t instanceof Room?t.player instanceof RelayAgent&&t.player.syncFashionId(e):t instanceof City&&t.player&&t.player.syncFashionId(e)},e.updateTitle=function(e){var t=this.scene;t instanceof Room?t.player instanceof RelayAgent&&t.player.syncTitleId(e):t instanceof City&&t.player&&t.player.syncTitleId(e)},e.updateHalo=function(e){var t=this.scene;t instanceof Room?t.player instanceof RelayAgent&&t.player.syncHaloId(e):t instanceof City&&t.player&&t.player.syncHaloId(e)},e.updateWeapon=function(e){var t=this.scene;t instanceof Room?t.player instanceof RelayAgent&&t.player.syncWeaponId(e):t instanceof City&&t.player&&t.player.syncWeaponId(e)},e.updateWeaponRTimes=function(e){var t=this.scene;t instanceof Room?t.player instanceof RelayAgent&&t.player.syncWeaponRTimes(e):t instanceof City&&t.player&&t.player.syncWeaponRTimes(e)},e.updateWeaFas=function(e){var t=this.scene;t instanceof Room?t.player instanceof RelayAgent&&t.player.syncWeaFasId(e):t instanceof City&&t.player&&t.player.syncWeaFasId(e)},e.updateWing=function(e){var t=this.scene;t instanceof Room?t.player instanceof RelayAgent&&t.player.syncWingFasId(e):t instanceof City&&t.player&&t.player.syncWingFasId(e)},e.updateFruit=function(e){var t=this.scene;t instanceof City&&t.player&&t.player.syncFruitId(e)},e.updateHelpSkill=function(e){var t=this.scene;t instanceof PvPRoom&&t.player&&t.playId==e&&t.player.reqChangeHelpSkill()},e.updateBattleFloat=function(e){this.battleFloat!=e&&(this.battleFloat=e)},e.updateBattleEffect=function(e){var t=this;if(t.battleEffect!=e){t.battleEffect=e;var i=t.scene;!e&&i instanceof RelayRoom&&(i.battleEffect=e,i.updateBattleEffect())}},e.updateBattleName=function(e){var t=this;t.battleName!=e&&(t.battleName=e,t.scene instanceof Room&&t.scene.updateBattleName(e))},e.updateBattleTitle=function(e){var t=this;this.battleTitle!=e&&(this.battleTitle=e,t.scene instanceof Room&&t.scene.updateBattleTitle(e))},e.updateOwnerPetEffect=function(e){var t=this;if(t.ownerPetEffect!=e){t.ownerPetEffect=e;var i=t.scene;!e&&i instanceof Room&&(i.ownerPetEffect=e,i.updateOwnerPetEffect(e))}},e.updateTeamPetEffect=function(e){var t=this;if(t.teamPetEffect!=e){t.teamPetEffect=e;var i=t.scene;!e&&i instanceof Room&&(i.teamPetEffect=e,i.updateTeamPetEffect(e))}},e.updateEnemyPetEffect=function(e){var t=this;if(t.enemyPetEffect!=e){t.enemyPetEffect=e;var i=t.scene;!e&&i instanceof Room&&(i.enemyPetEffect=e,i.updateEnemyPetEffect(e))}},e.updateAutoSpeSkill=function(e){var t=this.scene;t instanceof Room&&t.player&&t.player.reqChangeAutoSpeSkill(e)},e.updateAutoCallPet=function(e){var t=this.scene;t instanceof Room&&t.player&&t.player.reqChangeAutoCallPet(e)},e.getPlayerAvatar=function(){var e=this.scene.player;return e instanceof RelayAgent?e.avatar:null},e.onFrameShake=function(e,t,i){if(!DeviceUtils.isWxGame){e.master&&e.master.prid==t.prid||(i=i||"");var r=i.split(":"),n=Number(r[0])||1,a=Number(r[3])||100,o=0,s=0;(1==n||3==n)&&(o=Number(r[1])||10),(2==n||3==n)&&(s=Number(r[2])||10),e.guise&&e.guise.content&&ShakeEffect.start(e.guise.content,o,s,a,0)}},e.onFrameSound=function(e,t,i,r,n,a){a=a||"";var o=a.split(":"),s=o[0];if(s){var l=s.split("&");s=l.length>1?l[Math.floor(Math.random()*l.length)]:l[0],SoundUtils.playBattleSound(+o[4]||4,e,t,i,r,n,s,+o[1]||1,+o[2]||0,+o[3]||0)}},e.checkEnter=function(e,t){void 0===t&&(t=!0);var i=this.scene;if(i instanceof CityScene)return!0;var r=Data.getItem("GamePlayData",e);if(!r)return!1;var n=i?i.roomCfg:void 0;if(!n)return!1;var a=n.enter||[];return a.indexOf(r.roomType)<0?(t&&Prompt.msgId(2029),!1):!0},e.isInBattle=function(){return this.scene instanceof Room},e.isInCity=function(){return e.scene instanceof MainCity},Object.defineProperty(e,"isLock",{get:function(){return this._battleLock?this._battleLock.isLock:!1},enumerable:!0,configurable:!0}),e.lock=function(){var e=this._battleLock;e||(e=this._battleLock=new TimeoutLock(0)),e.lock()},e.unlock=function(){var e=this._battleLock;e&&e.unlock()},e.onBuyAndGiveGift=function(e,t,i){var r=this.scene;r instanceof PvPRoom&&r.playId==e&&r.player instanceof RelayAgent&&r.player.syncGiveGift(e,t,i)},e.getMonsterEntityType=function(e){switch(e){case 100:return"Elite";case 200:return"Boss";case 1:return"Machine";case 2:return"MetalPail";case 3:return"SumAvatar";default:return"NorMonster"}},e.resetPlayerProps=function(t,i,r,n,a,o){var s=e.scene;if(s){var l=s.player;if(l){var u=l.avatar;if(u){var c=u.props;c&&(c.setPropSlot("atkBase","BASE",t),c.setPropSlot("defBase","BASE",i),c.setPropSlot("maxHpBase","BASE",r),c.setPropSlot("crit","BASE",n),c.setPropSlot("critRate","BASE",a),c.setPropSlot("spdBase","BASE",o),c.setPropSlot("hp","BASE",c.gv("maxHp")),u.guise&&u.guise.updateHp())}}}},e.resetBossProps=function(t,i,r,n,a,o){var s=e.scene;if(s){var l=s.monsterList[0];if(l){var u=l.props;if(u){u.setPropSlot("atkBase","BASE",t),u.setPropSlot("defBase","BASE",i),u.setPropSlot("maxHpBase","BASE",r),u.setPropSlot("crit","BASE",n),u.setPropSlot("critRate","BASE",a),u.setPropSlot("spdBase","BASE",o),u.setPropSlot("hp","BASE",u.gv("maxHp"));var c=PanelMgr.getUI(120);c&&c.updateBoss()}}}},e.scenes={},e.sceneList=[],e.battleFloat=!0,e.battleEffect=!0,e.battleName=!0,e.battleTitle=!0,e.ownerPetEffect=!0,e.teamPetEffect=!0,e.enemyPetEffect=!0,e}();__reflect(SceneMgr.prototype,"SceneMgr"),window.SceneMgr=SceneMgr;var TipMgr=function(){function e(){}return e.reg=function(e,t,i,r){},e.update=function(e,t,i,r){},e.un=function(e){},e}();__reflect(TipMgr.prototype,"TipMgr"),window.TipMgr=TipMgr;var LineUIData=function(){function e(){}return e.prototype.clear=function(){this.id=this.params=this.cfg=this.lineParam=this.closeUI=this.oid=this.st=void 0},e.create=function(){var t=ObjectPool.pop(e);return t.isUse=!0,t},e.recover=function(e){e.isUse&&(e.isUse=!1,e.clear(),ObjectPool.push(e))},e}();__reflect(LineUIData.prototype,"LineUIData",["ILineUIData"]),window.LineUIData=LineUIData;var SpinUpAction2=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.checkEnd=function(e,t,i,r,n){var a=this;if(!i){var o=a.owner,s=a.action,l=s.nspy,u=void 0;if(l>0){var c=Fixed.value(2).mul(60).mul(n).value;u=Fixed.value(160).mul(n).value,u=Fixed.value(l).mul(2).sub(u).div(c).add(o.oz).max(0).value,c=Fixed.value(160).div(n).value,s.nspy=Fixed.value(l).sub(c).value,o.updatePos(o.ox,o.oy,u,o.right)}else{if(!o.isAir)return void(a.status=2);var c=Fixed.value(2).mul(60).mul(n).value;u=Fixed.value(40).div(n).value,u=Fixed.value(l).mul(2).sub(u).div(c).add(o.oz).max(0).value,c=Fixed.value(40).div(n).value,s.nspy=Fixed.value(l).sub(c).value,o.updatePos(o.ox,o.oy,u,o.right),o.isAir||(a.status=2)}}},t.prototype.doActionEnd=function(){var t=this.owner,i=this.action;i&&i.canSpin&&t&&t.updateRotation(0),e.prototype.doActionEnd.call(this)},t.prototype.onDestroy=function(){var t=this.owner,i=this.action;i&&i.canSpin&&t&&t.updateRotation(0),e.prototype.onDestroy.call(this)},t}(SubAction);__reflect(SpinUpAction2.prototype,"SpinUpAction2"),window.SpinUpAction2=SpinUpAction2;var PanelLine=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.onCreate=function(){e.prototype.onCreate.call(this)},t.prototype.openPupup=function(){this.lineLock||e.prototype.openPupup.call(this)},t.prototype.uiLock=function(){this._uiLock=!0},t.prototype.unUiLock=function(){return this._uiLock=!1,this.openPupup(),this._lineUIs.length>0},Object.defineProperty(t.prototype,"lineItem",{get:function(){return this._lineItem},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"lineLock",{get:function(){return this._lineLock||this._uiLock},enumerable:!0,configurable:!0}),t.prototype.addEvents=function(){e.prototype.addEvents.call(this),App.addL("app_ui_show",this.onShowUI,this),App.addL("c7",this.onSceneChange,this)},t.prototype.onShowUI=function(e){var t=e.data.vo;t&&"SummonEffView"==t.className||this.unUiLock()},t.prototype.onSceneChange=function(e){SceneMgr.scene instanceof City&&this.openPupup()},t.prototype.onHideUI=function(t){UI.checkLastOne("CityUI")&&(this._uiLock=!1),e.prototype.onHideUI.call(this,t)},t.prototype.checkPopupType=function(e){var t=PanelMgr.getMainUICfgByPid(e);if(!t)return!1;if(!(t.level>9))return!0;var i=t.type;if(3===i){var r=SceneMgr.scene;return UI.checkLastOne("CityUI")&&r instanceof MainCity&&r.player&&r.player.invisibily}return 2===i?UI.checkLastOne("CityUI"):1===i?SceneMgr.scene instanceof MainCity:!0},t.prototype.checkAdd=function(e,t,i,r){var n=PanelMgr.getMainUICfgByPid(e);if(!(n.level>9))return!0;var a=!0,o=!0;return r&&void 0!==r.diff&&(o=r.diff),o&&(this._lineItem&&this._lineItem.id==e&&ObjectUtils.checkSimpleSame(this._lineItem.params,t)?a=!1:this.getLineUI(e,t)&&(a=!1)),a},t.prototype.clear=function(){e.prototype.clear.call(this),App.removeL("app_ui_show",this.onShowUI,this),App.removeL("c7",this.onSceneChange,this)},t}(PanelBaseLine);__reflect(PanelLine.prototype,"PanelLine"),window.PanelLine=PanelLine;var RecordAgentStartGameData=function(e){function t(){return e.call(this,11)||this}return __extends(t,e),t.prototype.record=function(e,t,i,r,n,a,o,s,l,u,c,p){var d,f,h,v=[];a.forEach(function(e,t){d=[],f=[],h=[],e.props.forEach(function(e,t){d[t]=[e.name,e.val]}),e.skills.forEach(function(e,t){f[t]=[e.id,e.lv]}),e.buffs.forEach(function(e,t){h[t]=[e.buffId,e.lv]}),v[t]=[e.heroId,d,f,h,e.petId]});var m,y,g,b=[];o.forEach(function(e,t){m=[],y=[],g=[],e.props.forEach(function(e,t){m[t]=[e.name,e.val]}),e.skills.forEach(function(e,t){y[t]=[e.id,e.lv]}),e.buffs.forEach(function(e,t){g[t]=[e.buffId,e.lv]}),b[t]=[e.slotId,e.petId,e.star,e.heroId,m,y,g]});var x=[];s.forEach(function(e,t){x[t]=[e.slotId,e.itemId,e.extra]});var I=[];l.forEach(function(e,t){I[t]=[e.slotId,e.skillId]});var _=[],S=[],T=[],w=[];c.props.forEach(function(e,t){S[t]=[e.name,e.val]}),c.skills.forEach(function(e,t){T[t]=[e.id,e.lv]}),c.buffs.forEach(function(e,t){w[t]=[e.buffId,e.lv]}),_.push(c.fruitId,c.heroId,S,T,w);var A=[];p&&p.forEach(function(e,t){A[t]=[e.id,e.awaken,e.lv]}),this.data=[this.set_eid(e),t,i,r,n,v,b,x,I,u,_,A,this.type]},t.prototype.recover=function(e,t,i,r,n,a,o,s,l,u,c,p){var d,f,h,v,m,y,g=[];a.forEach(function(e,t){v=e[1],m=e[2],y=e[3],d=[],f=[],h=[],v.forEach(function(e,t){d[t]={name:e[0],val:e[1]}}),m.forEach(function(e,t){f[t]={id:e[0],lv:e[1]}}),y.forEach(function(e,t){h[t]={buffId:e[0],lv:e[1]}}),g[t]={heroId:e[0],props:d,skills:f,buffs:h,petId:e[4]}});var b,x,I,_,S,T,w=[];o.forEach(function(e,t){_=e[4],S=e[5],T=e[6],b=[],x=[],I=[],_.forEach(function(e,t){b[t]={name:e[0],val:e[1]}}),S.forEach(function(e,t){x[t]={id:e[0],lv:e[1]}}),T.forEach(function(e,t){I[t]={buffId:e[0],lv:e[1]}}),w[t]={slotId:e[0],petId:e[1],star:e[2],heroId:e[3],props:b,skills:x,buffs:I}});var A=[];s.forEach(function(e,t){A[t]={slotId:e[0],itemId:e[1],extra:e[2]}});var P=[];l.forEach(function(e,t){P[t]={slotId:e[0],skillId:e[1]}});var C=c[2],D=c[3],B=c[4],k=[],E=[],R=[];C.forEach(function(e,t){k[t]={name:e[0],val:e[1]}}),D.forEach(function(e,t){E[t]={id:e[0],lv:e[1]}}),B.forEach(function(e,t){R[t]={buffId:e[0],lv:e[1]}});var F={fruitId:c[0],heroId:c[1],props:k,skills:E,buffs:R},M=[];p&&p.forEach(function(e,t){M[t]={id:e[0],awaken:e[1],lv:e[2]}});var L=this.entityMgr.getEntity(this.get_eid(e));L instanceof RoomAgent&&L.onAgentStartGame(t,i,r,n,g,w,A,P,u,F,M)},t}(RecordBaseData);__reflect(RecordAgentStartGameData.prototype,"RecordAgentStartGameData"),window.RecordAgentStartGameData=RecordAgentStartGameData;var RecordAutoBattleData=function(e){function t(){return e.call(this,28)||this}return __extends(t,e),t.prototype.record=function(e,t,i){var r=this;r.data=[r.set_eid(e),r.set_sit(t),i,r.type]},t.prototype.recover=function(e,t,i){var r=this.entityMgr.getEntity(this.get_eid(e));r instanceof Room&&r.cmd_autoBattle(this.get_sit(t),i)},t}(RecordBaseData);__reflect(RecordAutoBattleData.prototype,"RecordAutoBattleData"),window.RecordAutoBattleData=RecordAutoBattleData;var RecordAutoCallPetData=function(e){function t(){return e.call(this,38)||this}return __extends(t,e),t.prototype.record=function(e,t,i){var r=this;r.data=[r.set_eid(e),r.set_sit(t),i,r.type]},t.prototype.recover=function(e,t,i){var r=this.entityMgr.getEntity(this.get_eid(e));r instanceof Room&&r.cmd_autoCallPet(this.get_sit(t),i)},t}(RecordBaseData);__reflect(RecordAutoCallPetData.prototype,"RecordAutoCallPetData"),window.RecordAutoCallPetData=RecordAutoCallPetData;var RecordAutoSpeSkillData=function(e){function t(){return e.call(this,37)||this}return __extends(t,e),t.prototype.record=function(e,t,i){var r=this;r.data=[r.set_eid(e),r.set_sit(t),i,r.type]},t.prototype.recover=function(e,t,i){var r=this.entityMgr.getEntity(this.get_eid(e));r instanceof Room&&r.cmd_autoSpeSkill(this.get_sit(t),i)},t}(RecordBaseData);__reflect(RecordAutoSpeSkillData.prototype,"RecordAutoSpeSkillData"),window.RecordAutoSpeSkillData=RecordAutoSpeSkillData;var RecordAvatarDeadData=function(e){function t(){return e.call(this,44)||this}return __extends(t,e),t.prototype.record=function(e,t,i){var r=this;r.data=[r.set_eid(e),r.set_sit(t),r.set_sit(i),r.type]},t.prototype.recover=function(e,t,i){var r=this,n=r.entityMgr.getEntity(r.get_eid(e));n instanceof Room&&n.cmd_avatarDead(r.get_sit(t),r.get_sit(i))},t}(RecordBaseData);__reflect(RecordAvatarDeadData.prototype,"RecordAvatarDeadData"),window.RecordAvatarDeadData=RecordAvatarDeadData;var AirAction=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.setActionInfo=function(t,i,r,n,a,o,s){e.prototype.setActionInfo.call(this,t,i,r,n,a,o,s);var l,u=this,c=u.owner,p=c.props.gv("weight")||1,d=u.subActions,f=c.isAir,h=a[1]||0,v=c.heroCfg.isNewAir;u.py=a[0]||0,u.nspy=u.spy=Fixed.value(u.py).div(p).mul(130).value,u.canSpin=!v||0>=h?!1:h>=1?!0:c.scene.seedr.random<=h,u.spyRate=1,v?u.canSpin?(l=ObjectPool.pop(TransUpAction),l.initialize(u,n||(f?"land_air_1":"land_air"),3,1,114),d.push(l),l=ObjectPool.pop(SpinUpAction1),l.initialize(u,"air_spin",r?90:1,0,114,u.onSpring),d.push(l),l=ObjectPool.pop(SpinUpAction2),l.initialize(u,"air_spin",r?90:1,0,114),d.push(l)):(l=ObjectPool.pop(TransUpAction),l.initialize(u,n||(f?"land_air_1":"land_air"),0,0,114),d.push(l),l=ObjectPool.pop(UpAction),l.initialize(u,f?"land_air_1":"behit_air",r?90:2,0,114),d.push(l),l=ObjectPool.pop(DownAction),l.initialize(u,"air_down",0,0,114),d.push(l),l=ObjectPool.pop(DownAction),l.initialize(u,"behit_down",2,0,114,u.onSpring),d.push(l),l=ObjectPool.pop(UpAction),l.initialize(u,"behit_air",2,0,114),d.push(l),l=ObjectPool.pop(DownAction),l.initialize(u,"behit_down",2,0,114),d.push(l)):((n||!f)&&(l=ObjectPool.pop(TransUpAction),l.initialize(u,n||"land_air",0,0,114),d.push(l)),l=ObjectPool.pop(UpAction),l.initialize(u,"behit_air",r?90:2,0,114),d.push(l),l=ObjectPool.pop(DownAction),l.initialize(u,"behit_down",2,0,114,u.onSpring),d.push(l),l=ObjectPool.pop(UpAction),l.initialize(u,"behit_air",2,0,114),d.push(l),l=ObjectPool.pop(DownAction),l.initialize(u,"behit_down",2,0,114),d.push(l));var m=u.state.lctime||Fixed.millisecond(Data.getSValue("HeroData",c.heroId,"lct"));l=ObjectPool.pop(UnderLandAction),l.initialize(u,"behit_land",m?2:0,m,115),d.push(l),l=ObjectPool.pop(UpLandAction),l.initialize(u,"behit_up",0,0,115),d.push(l)},t.prototype.play=function(){e.prototype.play.call(this),this.owner.buff.dealTrigBuff(25,0,this.owner,this.caster)},t.prototype.next=function(){var e=this;e.subActions.length>0?(e.subAction=e.subActions.shift(),0==e.subActions.length&&e.owner.isDead?e.onAllSubActionEnd():e.subAction.play()):e.onAllSubActionEnd()},t.prototype.onSpring=function(){var e=this;e.nspy=Fixed.value(e.nspy).neg().mul(.6).value,e.spyRate=0},t.prototype.doSubFrame=function(e,t,i,r,n){var a=this,o=a.spyRate&&a.nspy>=0&&a.nspy<=Fixed.value(a.spy).mul(.1).value?6:1;o=Fixed.value(o).mul(n).value,a.subAction&&a.subAction.onEnterFrame(e,t,i,r,o)},t.prototype.onDestroy=function(){var t=this,i=t.owner;t.canSpin&&i&&i.updateRotation(0),t.canSpin=!1,ObjectUtils.clearKeysNum(this,["py","spy","nspy","spyRate"]),e.prototype.onDestroy.call(this)},t}(HurtAction);__reflect(AirAction.prototype,"AirAction"),window.AirAction=AirAction;var RecordBattleOverData=function(e){function t(){return e.call(this,33)||this}return __extends(t,e),t.prototype.record=function(e,t,i,r){var n=this,a=[];i.forEach(function(e,t){a[t]=[n.set_eid(e.eid),e.x,e.y,e.z,e.isDead,e.hp,e.maxHp]}),n.parent.isOver=!0,n.data=[n.set_eid(e),t,a,r,n.type]},t.prototype.recover=function(e,t,i,r){var n=this,a=n.parent,o=a.entityMgr.getEntity(e);if(o instanceof Room&&a.result!=t)return void(n.parent.verify=0);if(o instanceof RelayRoom&&(13==o.playId||24==o.playId)&&r!=(a.damage||0))return void(n.parent.verify=0);var s=[];i.forEach(function(e,t){s[t]={eid:n.get_eid(e[0]),x:e[1],y:e[2],z:e[3],isDead:e[4],hp:e[5],maxHp:e[6]}});for(var l,u,c=!0,p=0,d=s.length;d>p;p++){if(l=s[p],u=n.getRoleInfo(l.eid),!u){c=!1;break}for(var f in u)if(u[f]!=l[f]){c=!1;break}if(!c)break}n.parent.verify=c?1:0},t.prototype.getRoleInfo=function(e){var t=this.parent.roles;if(!t)return null;for(var i=0,r=t;i<r.length;i++){var n=r[i];if(n.eid==e)return n}return null},t}(RecordBaseData);__reflect(RecordBattleOverData.prototype,"RecordBattleOverData"),window.RecordBattleOverData=RecordBattleOverData;var RecordBreakAvatarXuliData=function(e){function t(){return e.call(this,19)||this}return __extends(t,e),t.prototype.record=function(e,t,i){var r=this;r.data=[r.set_eid(e),r.set_sit(t),i,r.type]},t.prototype.recover=function(e,t,i){var r=this.entityMgr.getEntity(this.get_eid(e));r instanceof Room&&r.cmd_breakAvatarXuli(this.get_sit(t),i)},t}(RecordBaseData);__reflect(RecordBreakAvatarXuliData.prototype,"RecordBreakAvatarXuliData"),window.RecordBreakAvatarXuliData=RecordBreakAvatarXuliData;var RecordBreakPetXuliData=function(e){function t(){return e.call(this,36)||this}return __extends(t,e),t.prototype.record=function(e,t,i,r){var n=this;n.data=[n.set_eid(e),n.set_sit(t),i,r,n.type]},t.prototype.recover=function(e,t,i,r){var n=this.entityMgr.getEntity(this.get_eid(e));n instanceof Room&&n.cmd_breakPetXuli(this.get_sit(t),i,r)},t}(RecordBaseData);__reflect(RecordBreakPetXuliData.prototype,"RecordBreakPetXuliData"),window.RecordBreakPetXuliData=RecordBreakPetXuliData;var RecordCallPetData=function(e){function t(){return e.call(this,20)||this}return __extends(t,e),t.prototype.record=function(e,t,i){this.data=[this.set_eid(e),t,i,this.type]},t.prototype.recover=function(e,t,i){var r=this.entityMgr.getEntity(this.get_eid(e));r instanceof Room&&r.cmd_callPet(t,i)},t}(RecordBaseData);__reflect(RecordCallPetData.prototype,"RecordCallPetData"),window.RecordCallPetData=RecordCallPetData;var RecordChangeHelpSkillData=function(e){function t(){return e.call(this,25)||this}return __extends(t,e),t.prototype.record=function(e,t){this.data=[this.set_eid(e),t,this.type]},t.prototype.recover=function(e,t){var i=this.entityMgr.getEntity(this.get_eid(e));i instanceof RoomAgent&&i.onChangeHelpSkill(t)},t}(RecordBaseData);__reflect(RecordChangeHelpSkillData.prototype,"RecordChangeHelpSkillData"),window.RecordChangeHelpSkillData=RecordChangeHelpSkillData;var RecordChangePressData=function(e){function t(){return e.call(this,27)||this}return __extends(t,e),t.prototype.record=function(e,t,i){var r=this;r.data=[r.set_eid(e),r.set_sit(t),i,r.type]},t.prototype.recover=function(e,t,i){var r=this.entityMgr.getEntity(this.get_eid(e));r instanceof Room&&r.cmd_changePress(this.get_sit(t),i)},t}(RecordBaseData);__reflect(RecordChangePressData.prototype,"RecordChangePressData"),window.RecordChangePressData=RecordChangePressData;var RecordCloseSceneData=function(e){function t(){return e.call(this,4)||this}return __extends(t,e),t.prototype.record=function(e,t){var i=this;i.data=[i.set_eid(e),i.set_eid(t),i.type]},t.prototype.recover=function(e,t){var i=this.entityMgr.getEntity(this.get_eid(e));i instanceof Agent&&i.closeScene(this.get_eid(t))},t}(RecordBaseData);__reflect(RecordCloseSceneData.prototype,"RecordCloseSceneData"),window.RecordCloseSceneData=RecordCloseSceneData;var RecordComboAvatarSkillData=function(e){function t(){return e.call(this,18)||this}return __extends(t,e),t.prototype.record=function(e,t,i){var r=this;r.data=[r.set_eid(e),r.set_sit(t),i,r.type]},t.prototype.recover=function(e,t,i){var r=this.entityMgr.getEntity(this.get_eid(e));r instanceof Room&&r.cmd_comboAvatarSkill(this.get_sit(t),i)},t}(RecordBaseData);__reflect(RecordComboAvatarSkillData.prototype,"RecordComboAvatarSkillData"),window.RecordComboAvatarSkillData=RecordComboAvatarSkillData;var RecordComboPetSkillData=function(e){function t(){return e.call(this,35)||this}return __extends(t,e),t.prototype.record=function(e,t,i,r){var n=this;n.data=[n.set_eid(e),n.set_sit(t),i,r,n.type]},t.prototype.recover=function(e,t,i,r){var n=this.entityMgr.getEntity(this.get_eid(e));n instanceof Room&&n.cmd_comboPetSkill(this.get_sit(t),i,r)},t}(RecordBaseData);__reflect(RecordComboPetSkillData.prototype,"RecordComboPetSkillData"),window.RecordComboPetSkillData=RecordComboPetSkillData;var RecordCreateEntityData=function(e){function t(){return e.call(this,1)||this}return __extends(t,e),t.prototype.record=function(e,t,i,r,n){var a=[];for(var o in r)a.push([o,r[o]]);this.data=[e,t,this.set_eid(i),a,n,this.type]},t.prototype.recover=function(e,t,i,r,n){var a={};r.forEach(function(e){a[e[0]]=e[1]}),RecordMgr.createEntity(this.entityMgr.channel,e,t,this.get_eid(i),a,n)},t}(RecordBaseData);__reflect(RecordCreateEntityData.prototype,"RecordCreateEntityData"),window.RecordCreateEntityData=RecordCreateEntityData;var RecordDestroyEntityData=function(e){function t(){return e.call(this,2)||this}return __extends(t,e),t.prototype.record=function(e){this.data=[this.set_eid(e),this.type]},t.prototype.recover=function(e){this.entityMgr.removeEntity(this.get_eid(e))},t}(RecordBaseData);__reflect(RecordDestroyEntityData.prototype,"RecordDestroyEntityData"),window.RecordDestroyEntityData=RecordDestroyEntityData;var RecordEnterMapData=function(e){function t(){return e.call(this,7)||this}return __extends(t,e),t.prototype.record=function(e,t,i,r,n){var a,o,s,l=[];r.forEach(function(e,t){var i=[];e.avatars.forEach(function(e,t){a=[],o=[],s=[],e.props.forEach(function(e,t){a[t]=[e.name,e.val]}),e.skills.forEach(function(e,t){o[t]=[e.id,e.lv]}),e.buffs.forEach(function(e,t){s[t]=[e.buffId,e.lv]}),i[t]=[e.heroId,e.petId,a,o,s]});var r=[];e.pets.forEach(function(e,t){a=[],o=[],s=[],e.props.forEach(function(e,t){a[t]=[e.name,e.val]}),e.skills.forEach(function(e,t){o[t]=[e.id,e.lv]}),e.buffs.forEach(function(e,t){s[t]=[e.buffId,e.lv]}),r[t]=[e.slotId,e.petId,e.star,e.heroId,a,o,s]});var n=[];a=[],o=[],s=[],e.fruit.props.forEach(function(e,t){a[t]=[e.name,e.val]}),e.fruit.skills.forEach(function(e,t){o[t]=[e.id,e.lv]}),e.fruit.buffs.forEach(function(e,t){s[t]=[e.buffId,e.lv]}),n=[e.fruit.fruitId,e.fruit.heroId,a,o,s];var u=[];e.useItems.forEach(function(e,t){u[t]=[e.slotId,e.itemId,e.extra]});var c=e.helpSkills.concat(),p=[];e.equipSkillList.forEach(function(e,t){p[t]=[e.id,e.lv,e.awaken]});var d=[];e.useSkills.forEach(function(e,t){d[t]=[e.slotId,e.skillId]}),l[t]=[e.rid,e.svrId,e.job,e.name,e.head,e.headFrame,e.level,e.vip,e.ability,e.partyName,e.partyId,e.laddersLv,e.fairLv,e.order,e.side,e.fashionId,e.weaponId,e.weaponRTimes,e.weaFasId,e.wingFasId,e.titleId,e.petAbility,e.hellLvId,e.aiid,i,r,n,u,c,p,d]});var u;n&&(u=[],n.forEach(function(e,t){u[t]=[e.buffId,e.lv]})),this.data=[this.set_eid(e),t,i,l,u,this.type]},t.prototype.recover=function(e,t,i,r,n){var a,o,s,l=[];r.forEach(function(e,t){var i=[];e[24].forEach(function(e,t){a=[],o=[],s=[],e[2].forEach(function(e,t){a[t]={name:e[0],val:e[1]}}),e[3].forEach(function(e,t){o[t]={id:e[0],lv:e[1]}}),e[4].forEach(function(e,t){s[t]={buffId:e[0],lv:e[1]}}),i[t]={heroId:e[0],petId:e[1],props:a,skills:o,buffs:s}});var r=[];e[25].forEach(function(e,t){a=[],o=[],s=[],e[4].forEach(function(e,t){a[t]={name:e[0],val:e[1]}}),e[5].forEach(function(e,t){o[t]={id:e[0],lv:e[1]}}),e[6].forEach(function(e,t){s[t]={buffId:e[0],lv:e[1]}}),r[t]={slotId:e[0],petId:e[1],star:e[2],heroId:e[3],props:a,skills:o,buffs:s}});var n,u=e[26];a=[],o=[],s=[],u[2].forEach(function(e,t){a[t]={name:e[0],val:e[1]}}),u[3].forEach(function(e,t){o[t]={id:e[0],lv:e[1]}}),u[4].forEach(function(e,t){s[t]={buffId:e[0],lv:e[1]}}),n={fruitId:u[0],heroId:u[1],props:a,skills:o,buffs:s};var c=[];e[27].forEach(function(e,t){c[t]={slotId:e[0],itemId:e[1],extra:e[2]}});var p=e[28].concat(),d=[];e[29].forEach(function(e,t){d[t]={id:e[0],lv:e[1],awaken:e[2]}});var f=[];e[30].forEach(function(e,t){f[t]={slotId:e[0],skillId:e[1]}}),l[t]={rid:e[0],svrId:e[1],job:e[2],name:e[3],head:e[4],headFrame:e[5],level:e[6],vip:e[7],ability:e[8],partyName:e[9],partyId:e[10],laddersLv:e[11],fairLv:e[12],order:e[13],side:e[14],fashionId:e[15],weaponId:e[16],weaponRTimes:e[17],weaFasId:e[18],wingFasId:e[19],titleId:e[20],petAbility:e[21],hellLvId:e[22],aiid:e[23],avatars:i,pets:r,fruit:n,useItems:c,helpSkills:p,equipSkillList:d,useSkills:f}});var u;n&&(u=[],n.forEach(function(e,t){u[t]={buffId:e[0],lv:e[1]}}));var c=this.entityMgr.getEntity(this.get_eid(e));c instanceof Room&&c.startScene(t,i,l,u)},t}(RecordBaseData);__reflect(RecordEnterMapData.prototype,"RecordEnterMapData"),window.RecordEnterMapData=RecordEnterMapData;var RecordEnterSceneData=function(e){function t(){return e.call(this,5)||this}return __extends(t,e),t.prototype.record=function(e,t,i,r,n){var a=this;a.data=[a.set_eid(e),a.set_eid(t),i,r,n,a.type]},t.prototype.recover=function(e,t,i,r,n){var a=this.entityMgr.getEntity(this.get_eid(e));a instanceof Sprite&&a.enterScene(this.get_eid(t),i,r,n)},t}(RecordBaseData);__reflect(RecordEnterSceneData.prototype,"RecordEnterSceneData"),window.RecordEnterSceneData=RecordEnterSceneData;var RecordFrameData=function(e){function t(){return e.call(this,13)||this}return __extends(t,e),t.prototype.record=function(e,t){this.data=[this.set_eid(e),1,this.type]},t.prototype.add=function(e,t){var i=this.data,r=this.set_eid(e);if(!i||i[0]!=r)return!1;var n=i[1]||1;return i[1]=n+1,!0},t.prototype.recover=function(e,t){var i=this.entityMgr.getEntity(this.get_eid(e));if(i instanceof Room){if(t=t||1,1==t)return void i.onEnterFrame(!1,17);for(var r=0;t>r;r++)i.onEnterFrame(!1,17)}},t}(RecordBaseData);__reflect(RecordFrameData.prototype,"RecordFrameData"),window.RecordFrameData=RecordFrameData;var RecordLeaveSceneData=function(e){function t(){return e.call(this,6)||this}return __extends(t,e),t.prototype.record=function(e){var t=this;t.data=[t.set_eid(e),t.type]},t.prototype.recover=function(e){var t=this.entityMgr.getEntity(this.get_eid(e));t instanceof Sprite&&t.leaveScene()},t}(RecordBaseData);__reflect(RecordLeaveSceneData.prototype,"RecordLeaveSceneData"),window.RecordLeaveSceneData=RecordLeaveSceneData;var RecordMaxData=function(e){function t(){return e.call(this,46)||this}return __extends(t,e),t.prototype.record=function(e,t,i){var r=this,n=[];t.forEach(function(e,t){n[t]=[r.set_eid(e.eid),e.x,e.y,e.z,e.isDead,e.hp,e.maxHp]}),r.parent.isMax=!0,r.data=[r.set_eid(e),n,i,r.type]},t.prototype.recover=function(e,t,i){var r=this,n=r.parent,a=n.entityMgr.getEntity(e);if(a instanceof RelayRoom&&(13==a.playId||24==a.playId)&&i!=(n.damage||0))return void(r.parent.verify=0);var o=[];t.forEach(function(e,t){o[t]={eid:r.get_eid(e[0]),x:e[1],y:e[2],z:e[3],isDead:e[4],hp:e[5],maxHp:e[6]}});for(var s,l,u=!0,c=0,p=o.length;p>c;c++){if(s=o[c],l=r.getRoleInfo(s.eid),!l){u=!1;break}for(var d in l)if(l[d]!=s[d]){u=!1;break}if(!u)break}r.parent.verify=u?1:0},t.prototype.getRoleInfo=function(e){var t=this.parent.roles;if(!t)return null;for(var i=0,r=t;i<r.length;i++){var n=r[i];if(n.eid==e)return n}return null},t}(RecordBaseData);__reflect(RecordMaxData.prototype,"RecordMaxData"),window.RecordMaxData=RecordMaxData;var RecordNextRoundLoadedData=function(e){function t(){return e.call(this,10)||this}return __extends(t,e),t.prototype.record=function(e,t){this.data=[this.set_eid(e),t,this.type]},t.prototype.recover=function(e,t){var i=this.entityMgr.getEntity(this.get_eid(e));i instanceof Room&&i.cmd_nextRoundLoaded(t)},t}(RecordBaseData);__reflect(RecordNextRoundLoadedData.prototype,"RecordNextRoundLoadedData"),window.RecordNextRoundLoadedData=RecordNextRoundLoadedData;var RecordNextRoundReadyData=function(e){function t(){return e.call(this,9)||this}return __extends(t,e),t.prototype.record=function(e,t,i,r){this.data=[this.set_eid(e),t,i,r,this.type]},t.prototype.recover=function(e,t,i,r){var n=this.entityMgr.getEntity(this.get_eid(e));n instanceof Room&&n.cmd_nextRoundReady(t,i,r)},t}(RecordBaseData);__reflect(RecordNextRoundReadyData.prototype,"RecordNextRoundReadyData"),window.RecordNextRoundReadyData=RecordNextRoundReadyData;var RecordNpcTransBeginData=function(e){function t(){return e.call(this,39)||this}return __extends(t,e),t.prototype.record=function(e,t,i){var r=this;r.data=[r.set_eid(e),r.set_sit(t),i,r.type]},t.prototype.recover=function(e,t,i){var r=this.entityMgr.getEntity(this.get_eid(e));r instanceof Room&&r.cmd_npcTransBegin(this.get_sit(t),i)},t}(RecordBaseData);__reflect(RecordNpcTransBeginData.prototype,"RecordNpcTransBeginData"),window.RecordNpcTransBeginData=RecordNpcTransBeginData;var RecordNpcTransStopData=function(e){function t(){return e.call(this,40)||this}return __extends(t,e),t.prototype.record=function(e,t){var i=this;i.data=[i.set_eid(e),i.set_sit(t),i.type]},t.prototype.recover=function(e,t){var i=this.entityMgr.getEntity(this.get_eid(e));i instanceof Room&&i.cmd_npcTransStop(this.get_sit(t))},t}(RecordBaseData);__reflect(RecordNpcTransStopData.prototype,"RecordNpcTransStopData"),window.RecordNpcTransStopData=RecordNpcTransStopData;var RecordOpenSceneData=function(e){function t(){return e.call(this,3)||this
}return __extends(t,e),t.prototype.record=function(e,t){var i=this;i.data=[i.set_eid(e),i.set_eid(t),i.type]},t.prototype.recover=function(e,t){var i=this.entityMgr.getEntity(this.get_eid(e));i instanceof Agent&&i.openScene(this.get_eid(t))},t}(RecordBaseData);__reflect(RecordOpenSceneData.prototype,"RecordOpenSceneData"),window.RecordOpenSceneData=RecordOpenSceneData;var RecordPassRoundData=function(e){function t(){return e.call(this,43)||this}return __extends(t,e),t.prototype.record=function(e,t,i){var r=this;r.data=[r.set_eid(e),t,i,r.type]},t.prototype.recover=function(e,t,i){var r=this.entityMgr.getEntity(this.get_eid(e));r instanceof Room&&r.cmd_passRound(t,i)},t}(RecordBaseData);__reflect(RecordPassRoundData.prototype,"RecordPassRoundData"),window.RecordPassRoundData=RecordPassRoundData;var RecordPetDeadData=function(e){function t(){return e.call(this,45)||this}return __extends(t,e),t.prototype.record=function(e,t,i){var r=this;r.data=[r.set_eid(e),r.set_sit(t),i,r.type]},t.prototype.recover=function(e,t,i){var r=this.entityMgr.getEntity(this.get_eid(e));r instanceof Room&&r.cmd_petDead(this.get_sit(t),i)},t}(RecordBaseData);__reflect(RecordPetDeadData.prototype,"RecordPetDeadData"),window.RecordPetDeadData=RecordPetDeadData;var RecordPetFuseData=function(e){function t(){return e.call(this,22)||this}return __extends(t,e),t.prototype.record=function(e,t,i){var r=this;r.data=[r.set_eid(e),r.set_sit(t),i,r.type]},t.prototype.recover=function(e,t,i){var r=this.entityMgr.getEntity(this.get_eid(e));r instanceof Room&&r.cmd_petFuse(this.get_sit(t),i)},t}(RecordBaseData);__reflect(RecordPetFuseData.prototype,"RecordPetFuseData"),window.RecordPetFuseData=RecordPetFuseData;var RecordPetHideData=function(e){function t(){return e.call(this,21)||this}return __extends(t,e),t.prototype.record=function(e,t,i){var r=this;r.data=[r.set_eid(e),r.set_sit(t),i,r.type]},t.prototype.recover=function(e,t,i){var r=this.entityMgr.getEntity(this.get_eid(e));r instanceof Room&&r.cmd_petHide(this.get_sit(t),i)},t}(RecordBaseData);__reflect(RecordPetHideData.prototype,"RecordPetHideData"),window.RecordPetHideData=RecordPetHideData;var RecordPropChangeData=function(e){function t(){return e.call(this,12)||this}return __extends(t,e),t.prototype.record=function(e,t,i){this.data=[this.set_eid(e),t,i,this.type]},t.prototype.recover=function(e,t,i){var r=this.entityMgr.getEntity(this.get_eid(e));r&&r.setProp(t,i)},t}(RecordBaseData);__reflect(RecordPropChangeData.prototype,"RecordPropChangeData"),window.RecordPropChangeData=RecordPropChangeData;var RecordRandomBuffAgainData=function(e){function t(){return e.call(this,32)||this}return __extends(t,e),t.prototype.record=function(e,t){this.data=[this.set_eid(e),t,this.type]},t.prototype.recover=function(e,t){var i=this.entityMgr.getEntity(this.get_eid(e));i instanceof Room&&i.cmd_randomBuffAgain(t)},t}(RecordBaseData);__reflect(RecordRandomBuffAgainData.prototype,"RecordRandomBuffAgainData"),window.RecordRandomBuffAgainData=RecordRandomBuffAgainData;var RecordReliveData=function(e){function t(){return e.call(this,26)||this}return __extends(t,e),t.prototype.record=function(e,t){var i=this;i.data=[i.set_eid(e),i.set_sit(t),i.type]},t.prototype.recover=function(e,t){var i=this.entityMgr.getEntity(this.get_eid(e));i instanceof Room&&i.cmd_relive(this.get_sit(t))},t}(RecordBaseData);__reflect(RecordReliveData.prototype,"RecordReliveData"),window.RecordReliveData=RecordReliveData;var RecordSceneStartData=function(e){function t(){return e.call(this,8)||this}return __extends(t,e),t.prototype.record=function(e){this.data=[this.set_eid(e),this.type]},t.prototype.recover=function(e){var t=this.entityMgr.getEntity(this.get_eid(e));t instanceof Room&&t.onSceneStarted()},t}(RecordBaseData);__reflect(RecordSceneStartData.prototype,"RecordSceneStartData"),window.RecordSceneStartData=RecordSceneStartData;var RecordSelectRandomBuffData=function(e){function t(){return e.call(this,31)||this}return __extends(t,e),t.prototype.record=function(e,t,i){this.data=[this.set_eid(e),t,i,this.type]},t.prototype.recover=function(e,t,i){var r=this.entityMgr.getEntity(this.get_eid(e));r instanceof Room&&r.cmd_selectRandomBuff(t,i)},t}(RecordBaseData);__reflect(RecordSelectRandomBuffData.prototype,"RecordSelectRandomBuffData"),window.RecordSelectRandomBuffData=RecordSelectRandomBuffData;var RecordSyncChangeOrderData=function(e){function t(){return e.call(this,30)||this}return __extends(t,e),t.prototype.record=function(e,t,i,r,n){this.data=[this.set_eid(e),t,i,r,n,this.type]},t.prototype.recover=function(e,t,i,r,n){var a=this.entityMgr.getEntity(this.get_eid(e));a instanceof PvPRoom&&a.onSyncChangeOrder(t,i,r,n)},t}(RecordBaseData);__reflect(RecordSyncChangeOrderData.prototype,"RecordSyncChangeOrderData"),window.RecordSyncChangeOrderData=RecordSyncChangeOrderData;var RecordSyncRoundLoadedData=function(e){function t(){return e.call(this,42)||this}return __extends(t,e),t.prototype.record=function(e){this.data=[this.set_eid(e),this.type]},t.prototype.recover=function(e){var t=this.entityMgr.getEntity(this.get_eid(e));t instanceof RelayRoom&&t.syncNextRoundLoaded()},t}(RecordBaseData);__reflect(RecordSyncRoundLoadedData.prototype,"RecordSyncRoundLoadedData"),window.RecordSyncRoundLoadedData=RecordSyncRoundLoadedData;var RecordSynPosData=function(e){function t(){return e.call(this,29)||this}return __extends(t,e),t.prototype.record=function(e,t,i,r,n){this.data=[this.set_eid(e),t,i,r,n,this.type]},t.prototype.recover=function(e,t,i,r,n){var a=this.entityMgr.getEntity(this.get_eid(e));a instanceof Sprite&&a.onSynPos(t,i,r,n)},t}(RecordBaseData);__reflect(RecordSynPosData.prototype,"RecordSynPosData"),window.RecordSynPosData=RecordSynPosData;var RecordTouchMoveBeginData=function(e){function t(){return e.call(this,14)||this}return __extends(t,e),t.prototype.record=function(e,t,i){var r=this;r.data=[r.set_eid(e),r.set_sit(t),i,r.type]},t.prototype.recover=function(e,t,i){var r=this.entityMgr.getEntity(this.get_eid(e));r instanceof Room&&r.cmd_touchMoveBegin(this.get_sit(t),i)},t}(RecordBaseData);__reflect(RecordTouchMoveBeginData.prototype,"RecordTouchMoveBeginData"),window.RecordTouchMoveBeginData=RecordTouchMoveBeginData;var RecordTouchMoveChangeData=function(e){function t(){return e.call(this,16)||this}return __extends(t,e),t.prototype.record=function(e,t,i){var r=this;r.data=[r.set_eid(e),r.set_sit(t),i,r.type]},t.prototype.recover=function(e,t,i){var r=this.entityMgr.getEntity(this.get_eid(e));r instanceof Room&&r.cmd_touchMoveChange(this.get_sit(t),i)},t}(RecordBaseData);__reflect(RecordTouchMoveChangeData.prototype,"RecordTouchMoveChangeData"),window.RecordTouchMoveChangeData=RecordTouchMoveChangeData;var RecordTouchMoveEndData=function(e){function t(){return e.call(this,15)||this}return __extends(t,e),t.prototype.record=function(e,t){var i=this;i.data=[i.set_eid(e),i.set_sit(t),i.type]},t.prototype.recover=function(e,t){var i=this.entityMgr.getEntity(this.get_eid(e));i instanceof Room&&i.cmd_touchMoveEnd(this.get_sit(t))},t}(RecordBaseData);__reflect(RecordTouchMoveEndData.prototype,"RecordTouchMoveEndData"),window.RecordTouchMoveEndData=RecordTouchMoveEndData;var RecordUseAvatarSkillData=function(e){function t(){return e.call(this,17)||this}return __extends(t,e),t.prototype.record=function(e,t,i){var r=this;r.data=[r.set_eid(e),r.set_sit(t),i,r.type]},t.prototype.recover=function(e,t,i){var r=this.entityMgr.getEntity(this.get_eid(e));r instanceof Room&&r.cmd_useAvatarSkill(this.get_sit(t),i)},t}(RecordBaseData);__reflect(RecordUseAvatarSkillData.prototype,"RecordUseAvatarSkillData"),window.RecordUseAvatarSkillData=RecordUseAvatarSkillData;var RecordUseHelpSkillData=function(e){function t(){return e.call(this,24)||this}return __extends(t,e),t.prototype.record=function(e,t,i){var r=this;r.data=[r.set_eid(e),r.set_sit(t),i,r.type]},t.prototype.recover=function(e,t,i){var r=this.entityMgr.getEntity(this.get_eid(e));r instanceof Room&&r.cmd_useHelpSkill(this.get_sit(t),i)},t}(RecordBaseData);__reflect(RecordUseHelpSkillData.prototype,"RecordUseHelpSkillData"),window.RecordUseHelpSkillData=RecordUseHelpSkillData;var RecordUseItemData=function(e){function t(){return e.call(this,23)||this}return __extends(t,e),t.prototype.record=function(e,t,i){var r=this;r.data=[r.set_eid(e),r.set_sit(t),i,this.type]},t.prototype.recover=function(e,t,i){var r=this.entityMgr.getEntity(this.get_eid(e));r instanceof Room&&r.cmd_useItem(this.get_sit(t),i)},t}(RecordBaseData);__reflect(RecordUseItemData.prototype,"RecordUseItemData"),window.RecordUseItemData=RecordUseItemData;var RecordUsePetSkillData=function(e){function t(){return e.call(this,34)||this}return __extends(t,e),t.prototype.record=function(e,t,i,r){var n=this;n.data=[n.set_eid(e),n.set_sit(t),i,r,n.type]},t.prototype.recover=function(e,t,i,r){var n=this.entityMgr.getEntity(this.get_eid(e));n instanceof Room&&n.cmd_usePetSkill(this.get_sit(t),i,r)},t}(RecordBaseData);__reflect(RecordUsePetSkillData.prototype,"RecordUsePetSkillData"),window.RecordUsePetSkillData=RecordUsePetSkillData;var RecordUsePickupTrapData=function(e){function t(){return e.call(this,41)||this}return __extends(t,e),t.prototype.record=function(e,t,i){var r=this;r.data=[r.set_eid(e),r.set_sit(t),i,r.type]},t.prototype.recover=function(e,t,i){var r=this.entityMgr.getEntity(this.get_eid(e));r instanceof Room&&r.cmd_usePickupTrap(this.get_sit(t),i)},t}(RecordBaseData);__reflect(RecordUsePickupTrapData.prototype,"RecordUsePickupTrapData"),window.RecordUsePickupTrapData=RecordUsePickupTrapData;var RedMgr=function(){function e(){}return e.initialize=function(){},e.reg=function(e,t,i){},e.un=function(e,t){},e}();__reflect(RedMgr.prototype,"RedMgr"),window.RedMgr=RedMgr;var SubExeuntAction=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.play=function(){e.prototype.play.call(this);var t=this,i=t.owner.guise;t.curFrame=i.body.curFrame,i.playDisappearShader(t.hideGuise,t)},t.prototype.hideGuise=function(){this.owner&&(this.owner.visible_guise=!1)},t.prototype.gotoFrame=function(e,t,i,r,n){},t.prototype.doAction=function(e,t,i,r,n){},t.prototype.doActionEnd=function(){this.owner instanceof Pet&&this.owner.onPlayExeunt(),e.prototype.doActionEnd.call(this)},t}(SubAction);__reflect(SubExeuntAction.prototype,"SubExeuntAction"),window.SubExeuntAction=SubExeuntAction;var CityMap=function(e){function t(){var t=e.call(this)||this;return t.commands=["c126"],t}return __extends(t,e),t.prototype.initialize=function(t){e.prototype.initialize.call(this,t);var i=this;t instanceof PartyCity&&i.layers[2].addEventListener(Evt.touchTap,i.onTouchTap,i)},t.prototype.onTouchTap=function(e){var t=this.owner;if(t){var i=t.player;if(i)if(e.target instanceof BaseGuise){if(!e.target.owner.hold){var r=e.target.getBounds(),n=e.target.getGuiseRect();n.y=r.y+(r.height-n.height);var a=n.containsPoint(new egret.Point(e.localX,e.localY));a&&i.moveToPos(e.target.owner.x,e.target.owner.y)}}else i.moveToPos(Math.round(e.localX),Math.round(e.localY))}},t.prototype.addGuise=function(e){var t=this.layers;return e instanceof GAgent?(t[7].addChild(e),t[11].addChild(e.upperHalo),t[6].addChild(e.shadow)):e instanceof GPortal?t[5].addChild(e):t[7].addChild(e),!0},t.prototype.layerTouchEnabled=function(e){return 2==e||7==e},t.prototype.layerTouchChildren=function(e){return 7==e},t.prototype.onDestroy=function(){var t=this;t.owner instanceof PartyCity&&t.layers[2].removeEventListener(Evt.touchTap,t.onTouchTap,t),e.prototype.onDestroy.call(this)},t}(BaseMap);__reflect(CityMap.prototype,"CityMap"),window.CityMap=CityMap;var DamageBitmapLabel=function(e){function t(){var t=e.call(this)||this;return t._factor=0,t.disy=0,t.multiply=0,t.verticalAlign="middle",t}return __extends(t,e),Object.defineProperty(t.prototype,"factor",{get:function(){return this._factor},set:function(e){var t=this;t.y+=(e-t._factor)*t.disy,t._factor=e},enumerable:!0,configurable:!0}),t}(UIBitmapLabel);__reflect(DamageBitmapLabel.prototype,"DamageBitmapLabel"),window.DamageBitmapLabel=DamageBitmapLabel;var DamageLabel=function(e){function t(){var t=e.call(this)||this;return t._factor=0,t.disy=0,t.multiply=0,t.verticalAlign="middle",t}return __extends(t,e),Object.defineProperty(t.prototype,"factor",{get:function(){return this._factor},set:function(e){var t=this;t.y+=(e-t._factor)*t.disy,t._factor=e},enumerable:!0,configurable:!0}),t}(eui.Label);__reflect(DamageLabel.prototype,"DamageLabel"),window.DamageLabel=DamageLabel;var MapItem=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.initialize=function(e,t,i,r,n){var a=this,o=Data.getItem("MapItemData",t);a.isvalid=!0,a.isReady=!1,a.owner=e,a.itemId=t,a.ratio=n,a.touchEnabled=!1,a.touchChildren=!1,a.x=i,a.y=r+o.y||0,a.tiles={},a.itemCfg=o,a.width=o.w||1,a.height=o.h||1,a.thumbUrl=Urls.mapRes(o.guise+"_min"),a.dataUrl=Urls.mapJson(o.guise),a.loader=ObjectPool.pop(LoadMgr),a.loader.init(),a.loader.loadResByUrls([a.thumbUrl,a.dataUrl],5,a.onLoadComplete,a,!1)},t.prototype.onLoadComplete=function(e,t){var i=this,r=e[i.thumbUrl];i.isReady=!0,i.thumb=r?r.$bitmapData:new egret.BitmapData(null),i.data=e[i.dataUrl],i.update()},t.prototype.update=function(){var e=this;if(e.isReady)for(var t,i,r,n=e.owner,a=e.data,o=e.tiles,s=n.camera,l=n.mapCfg,u=s.x*e.ratio-e.x,c=s.y-e.y,p=51.2,d=51.2,f=512,h=512,v=1,m=a.row,y=Math.max(0,(c/h>>0)-v),g=Math.min(m,((c+s.height)/h>>0)+v),b=a.column,x=Math.max(0,(u/f>>0)-v),I=Math.min(b,((u+s.width)/f>>0)+v),_=0;m>_;_++)for(var S=0;b>S;S++)if(t=e.makeKey(_,S,b),i=o[t],_>=y&&g>=_&&S>=x&&I>=S){if(!i){var T=(S+1)*p>l.w?l.mapWide-S*p:p,w=(_+1)*d>l.h?l.mapHeight-_*d:d;r=ObjectPool.pop(egret.Bitmap,"thumbBitmap"),r.texture=Utils.createTexture(e.thumb,S*p,_*d,T,w),r.smoothing=!0,r.width=10*T,r.height=10*w,i=ObjectPool.pop(MapTile),i.initialize(e.owner,e,r,l.guise+"/"+a.mapId+"/"+t,_,S,f,h),o[t]=i}!i.isShow&&i.inViewpoint()}else i&&i.isShow&&i.outViewpoint()},t.prototype.makeKey=function(e,t,i){return i*e+t+""},t.prototype.destroy=function(){var e=this;if(e.isvalid){e.isvalid=!1,e.isReady=!1,e.onDestroy(),e.owner=null,e.itemCfg=null,e.ratio=0,e.loader.destroy(),e.loader=null,e.thumb=null,e.data=null;for(var t in e.tiles)e.tiles[t].destroy();e.tiles=null,e.removeChildren(),ObjectPool.push(e)}},t.prototype.onDestroy=function(){},t}(egret.DisplayObjectContainer);__reflect(MapItem.prototype,"MapItem"),window.MapItem=MapItem;var MapLayer=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.initialize=function(e,t){var i=this;i.isvalid=!0,i.owner=e,i.layerIndex=t,i.ratiox=e.getLayerSpeedx(i.layerIndex),i.ratioy=e.getLayerSpeedy(i.layerIndex),i.items=[];for(var r=0,n=i.owner.getLayerItems(i.layerIndex),a=0,o=n.length;o>a;a++){var s=ObjectPool.pop(MapItem);s.initialize(e,n[a],r,0,i.ratiox),i.items.push(s),i.addChild(s),r+=s.width}(2==t||1==t||0==t)&&(i.scaleX=i.scaleY=i.owner.scale),i.update()},t.prototype.update=function(){var e=this,t=e.owner.camera;e.x=-t.x*e.ratiox,e.y=-t.y*e.ratioy,e.items.forEach(function(e){e.update()})},t.prototype.destroy=function(){var e=this;e.isvalid&&(e.isvalid=!0,e.items.forEach(function(e){e.destroy()}),e.onDestroy(),e.scaleX=e.scaleY=1,e.owner=null,e.items=null,e.removeChildren(),ObjectPool.push(e))},t.prototype.onDestroy=function(){},t}(egret.DisplayObjectContainer);__reflect(MapLayer.prototype,"MapLayer"),window.MapLayer=MapLayer;var MapTile=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.initialize=function(e,t,i,r,n,a,o,s){var l=this;l.isvalid=!0,l.owner=e,l.parent=t,l.thumb=i,l.url=r,l.row=n,l.column=a,l.width=o,l.height=s,l.isShow=!1,l.isReady=!1,l.tile=ObjectPool.pop(egret.Bitmap,"tileBitmap"),l.tile.x=i.x=a*o,l.tile.y=i.y=n*s,i.visible=!0,i.alpha=1,t.addChild(l.tile),t.addChild(i),LoadUtils.loadLazyResByUrl(Urls.mapRes(r),1,l.onLoadComplete,l,!1,RES.ResourceItem.TYPE_IMAGE)},t.prototype.onLoadComplete=function(e,t){var i=this;i.isReady=!0,i.tile.texture=e,i.isShow&&(egret.Tween.removeTweens(i.thumb),i.thumb.alpha=1,egret.Tween.get(i.thumb).to({alpha:0},100).call(i.endThumbTween,i))},t.prototype.endThumbTween=function(){this.thumb.visible=!1},t.prototype.inViewpoint=function(){var e=this;e.isShow||(e.isShow=!0,e.tile.visible=!0,e.thumb.visible=!e.isReady)},t.prototype.outViewpoint=function(){var e=this;e.isShow&&(egret.Tween.removeTweens(e.thumb),e.isShow=e.thumb.visible=e.tile.visible=!1)},t.prototype.destroy=function(){var e=this;if(e.isvalid){e.isvalid=!1,LoadUtils.cancleLoadTarget(e);var t=e.thumb;egret.Tween.removeTweens(t),e.onDestroy(),e.isShow=!1,e.isReady=!1,e.owner=null,e.parent=null,e.thumb=null,e.tile.texture=null;var i=t.texture;i&&(t.texture=null,i.$bitmapData=null,ObjectPool.push(i)),ObjectPool.push(e.tile),e.tile=null,ObjectPool.push(t),ObjectPool.push(e)}},t.prototype.onDestroy=function(){},t}(egret.HashObject);__reflect(MapTile.prototype,"MapTile"),window.MapTile=MapTile;var RoomMap=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.initialize=function(t){var i=this;i.shapeList=[],i.floatTexts={},i.splashs=[],i.blindShader=new EraserCircleShader,e.prototype.initialize.call(this,t)},t.prototype.layerTouchChildren=function(e){return 7==e},t.prototype.updateRectShape=function(){var e=this,t=e.shapeList;if(t.forEach(function(e){e.graphics.clear(),e.parent&&e.parent.removeChild(e),ObjectPool.push(e)}),t.length=0,DebugStatic.isShowRect){var i=e.owner.roleList,r=e.owner.bulletList,n=i.concat(r),a=e.layers[12];n.forEach(function(e){var i=e.rect,r=ObjectPool.pop(egret.Shape);r.parent!=a&&a.addChild(r),t.push(r),r.x=i.x,r.y=i.y,r.rotation=i.rotation*e.multiply,r.graphics.clear(),r.graphics.lineStyle(1,16711680,1),r.graphics.moveTo(-i.cw,-i.ch),r.graphics.lineTo(i.cw,-i.ch),r.graphics.lineTo(i.cw,i.ch),r.graphics.lineTo(-i.cw,i.ch),r.graphics.lineTo(-i.cw,-i.ch),r.graphics.endFill()})}if(DebugStatic.showTrapNum)for(var o=e.layers[12],s=DebugStatic.showTrapNum,l=1;s>=l;l++){var u=ObjectPool.pop(egret.Shape);u.parent!=o&&o.addChild(u),t.push(u);var c=l%12;c=0==c?12:c;var p=6>=c;p?(u.x=Math.round(138+(l-c)/12*204.8+35*(c-1)),u.y=Math.round(531+48.6*(c-1))):(u.x=Math.round(258+(l-c)/12*204.8+35*(c-6-1)),u.y=Math.round(555+48.6*(c-6-1)));var d=16,f=22;u.graphics.clear(),u.graphics.lineStyle(1,16711680,1),u.graphics.moveTo(-d,-f),u.graphics.lineTo(d,-f),u.graphics.lineTo(d,f),u.graphics.lineTo(-d,f),u.graphics.lineTo(-d,-f),u.graphics.endFill()}},t.prototype.addGuise=function(e){var t=this.layers;if(e instanceof GRole)t[7].addChild(e),t[11].addChild(e.upperHalo),t[6].addChild(e.shadow),e.spineBody&&t[2].addChildAt(e.spineBody,0);else if(e instanceof GPortal)t[5].addChild(e);else if(e instanceof GNpc)t[7].addChild(e);else if(e instanceof GBullet||e instanceof GTrap){var i=void 0,r=void 0,n=e.owner.effectCfg.utype||0,a=e.owner.effectCfg.ltype||0;i=1==n||3==n?t[8]:2==n?t[10]:t[7],r=1==a||3==a?t[5]:2==a?t[4]:t[7],e instanceof GTrap?e.setParent(t[7],i,r):e.setParent(i,r)}return!0},t.prototype.addWarn=function(e){this.layers[5].addChild(e)},t.prototype.onBuffAdd=function(e){if(!DebugStatic.isVideo&&SceneMgr.battleFloat){var t=e.buffCfg;if(!t.unfloat){var i,r=this,n=r.owner,a=n.master,o=e.caster,s=e.target;o instanceof BattNpc&&(i=o.battNpcCfg.showFloat),i=o instanceof Monster?a&&a.prid==s.prid||s instanceof Monster||s instanceof BattNpc:a&&o.prid==a.prid?!0:a&&a.prid==s.prid,i&&(23==t.id?(r.playStateFloatText(s,"防御力下降",36,15680322,2,986896),r.playStateFloatText(o,"破甲",36,10083824,2,986896)):31==t.id?r.playStateFloatText(s,"获得护盾",36,14869218,2,986896):32==t.id?Functor.delay(r.playStateFloatText,200,r,s,"防御力上升",36,7526750,2,986896):123==t.id?r.playStateFloatText(s,"防御力下降",36,15680322,2,986896):133==t.id?r.playStateFloatText(s,"恢复生命",36,7526750,2,986896):152==t.id?r.playStateFloatText(s,"恢复生命",36,7526750,2,986896):162==t.id&&r.playStateFloatText(s,"攻击力上升",36,7526750,2,986896))}}},t.prototype.onBuffRemove=function(e,t){if(!DebugStatic.isVideo&&SceneMgr.battleFloat){var i=e.buffCfg;if(!i.unfloat){var r,n=this,a=n.owner,o=a.master,s=e.caster,l=e.target;if(r=s instanceof Monster?o&&o.prid==l.prid||l instanceof Monster||l instanceof BattNpc:o&&s.prid==o.prid?!0:o&&o.prid==l.prid){var u;64&t&&i.state&&-1!=i.state.indexOf(8)&&(u="破")}}}},t.prototype.onBuffEffect=function(e,t,i,r,n,a,o){if(!DebugStatic.isVideo&&SceneMgr.battleFloat){var s=e.buffCfg;if(!s.unfloat){var l,u=this,c=u.owner,p=c.master,d=e.caster,f=e.target;if(l=d instanceof Monster?p.prid==f.prid||f instanceof Monster||f instanceof BattNpc:d.prid!=p.prid?p.prid==f.prid:!0){d.agent&&d.agent.fuseing;16&t&&u.playStateFloatText(f,"闪避",28,14869218,2,986896),i=Math.abs(i),r=Math.abs(r),4194304&t?(i&&u.playStateFloatText(d,"识破",36,10083824,2,986896),i&&u.playDamageFloatText(d,f,"-"+i,60,10083824,2,986896)):1&t?(i&&133==e.buffId&&u.playStateFloatText(f,"恢复生命",36,7526750,2,986896),i&&u.playDamageFloatText(d,f,"+"+i,44,7526750,2,986896)):4&t?i&&u.playDamageFloatText(d,f,"-"+i,48,15392562,2,986896):i&&u.playDamageFloatText(d,f,"-"+i,36,f instanceof Avatar?15680322:14869218,2,986896),r&&u.playDamageFloatText(d,f,"-"+r,20,f instanceof Avatar?15680322:14869218,2,986896)}}}},t.prototype.playStateFloatText=function(e,t,i,r,n,a){var o=this;if(e&&e.guise&&o.owner){var s=e.guise.getRefPoint("p_hp"),l=ConstD.createDamageLabel(e.x+25*e.multiply,e.y-e.z+s.y-70,1.5,0,0,i,r,n,a),u=o.layers[12];u!=l.parent?u.addChild(l):u.setChildIndex(l,u.numChildren),l.text=t,l.anchorOffsetX=l.width/2,l.anchorOffsetY=l.height/2,l.disy=-20;var c=egret.Tween.get(l);c.to({alpha:1,scaleX:1,scaleY:1},100).wait(500).to({alpha:0,factor:1},200).call(o.onFloatAllEnd,o,[e,l]),egret.Point.release(s)}},t.prototype.playDamageFloatText=function(e,t,i,r,n,a,o){var s=this;if(t&&t.guise&&s.owner){var l=t.guise.getRefPoint("p_defence"),u=s.getTextMultiply(t);u||(u=e.x==t.x?-t.multiply:e.x<t.x?1:-1);var c=t.x+40*u,p=t.y-t.z+l.y-90,d=ConstD.createDamageLabel(c,p,.5,1,0,r,n,a,o),f=s.layers[12];f!=d.parent?f.addChild(d):f.setChildIndex(d,f.numChildren),d.text=i,d.anchorOffsetX=d.width/2,d.anchorOffsetY=d.height/2,d.disy=-120,s.addFloatText(t,d);var h=egret.Tween.get(d);h=h.wait(100).to({x:c+40*u,factor:0,scaleX:1.4,scaleY:1.4},200).wait(100).call(s.onFloatFirstEnd,s,[d,"",i]),h.to({scaleX:1,scaleY:1},100).wait(100).to({factor:.88},800).to({alpha:0,factor:1},100).call(s.onFloatAllEnd,s,[t,d]),egret.Point.release(l)}},t.prototype.onFloatFirstEnd=function(e,t,i){e.disy=-40,e.factor=0,e.text=i},t.prototype.onFloatAllEnd=function(e,t){t&&(egret.Tween.removeTweens(t),t.parent&&(t.visible=!1),t.text="",this.removeFloatText(e,t),ObjectPool.push(t))},t.prototype.addFloatText=function(e,t){var i=this.floatTexts;if(e&&t&&i){var r=i[e.$eid];if(r)for(var n=r.length,a=t.y,o=void 0,s=n-1;s>=0;s--)a-=45,o=r[s],o.y>a&&o.y<=t.y+30&&(o.y=a);else r=i[e.$eid]=[];r.push(t)}},t.prototype.getTextMultiply=function(e){var t=this.floatTexts;if(!e||!t)return 0;var i=t[e.$eid],r=i?i[0]:null;return r?r.multiply:0},t.prototype.removeFloatText=function(e,t){if(e&&t){var i=this.floatTexts;if(i){var r=i[e.$eid];if(r){var n=r.indexOf(t);n>=0&&r.splice(n,1),r.length||delete i[e.$eid]}}}},t.prototype.updateSize=function(){e.prototype.updateSize.call(this),this.updateSplashSize()},t.prototype.playSplashEffect=function(e,t){var i=this,r=ObjectPool.pop(SplashInfo);r.play(e,t,i),i.splashs.push(r),r.updateSize(App.battleWidth,App.battleHeight)},t.prototype.stopSplashEffect=function(e,t){void 0===t&&(t=0),this.splashs.forEach(function(i){i.idx!=e||t&&t!=i.id||i.stop()})},t.prototype.updateSplashFrame=function(){var e,t=this;t.splashs.forEach(function(t){t.isComplete?(e=e||[],e.push(t)):t.onEnterFrame()}),e&&e.forEach(function(e){t.removeSplash(e)})},t.prototype.removeSplash=function(e){var t=this,i=t.splashs.indexOf(e);i>=0&&t.splashs.splice(i,1),e.dispose()},t.prototype.updateSplashSize=function(){var e=App.battleWidth,t=App.battleHeight;this.splashs.forEach(function(i){i.updateSize(e,t)})},t.prototype.showBlindMask=function(e){var t=this,i=t.blindRect;i||(i=t.blindRect=ObjectPool.pop(eui.Rect,"BlindRect"),i.touchEnabled=!1,i.fillColor=0,i.left=i.right=i.top=i.bottom=0,i.parent!=t&&t.addChild(i)),i.visible=!0,i.filters=[t.blindShader.filter],t.blindTarget=e,t.updateBlindPos(e)},t.prototype.updateBlindPos=function(e){var t=this,i=t.blindRect;if(i&&t.blindTarget==e){var r=e.guise?e.guise.getRefPoint("p_defence"):egret.Point.create(0,0),n=t.owner.camera;r.x+=e.x-n.x,r.y+=e.y-n.y,t.blindShader.setUniformByEgret(r.x,r.y,t.width,t.height,200,t.scaleContent.scaleX,1),egret.Point.release(r)}},t.prototype.hideBlindMask=function(e){void 0===e&&(e=null);var t=this;e&&t.blindTarget!=e||(t.blindRect&&(t.blindRect.visible=!1),t.blindTarget=null,t.mask=null)},t.prototype.showPath=function(e,t){this.pathEffs||(this.pathEffs=[]),this.updatePath(e,t)},t.prototype.updatePath=function(e,t){var i=this;if(i.hidePath(),e&&t&&(e.x!=t.x||e.y!=t.y))for(var r,n=i.layers[2],a=t.x-e.x,o=t.y-e.y,s=Math.sqrt(Math.pow(a,2)+Math.pow(o,2)),l=50*a/s,u=50*o/s,c=Math.round(Math.atan2(t.y-e.y,t.x-e.x)/Math.PI*180),p=Math.max(1,Math.floor(s/50)),d=i.pathEffs,f=1;p>=f;f++)r=i.getArrowEff(),r.rotation=c,r.x=t.x-(f-1)*l,r.y=t.y-(f-1)*u,n.addChild(r),d.push(r)},t.prototype.hidePath=function(e){void 0===e&&(e=0);var t=this,i=t.pathEffs;if(i){if(e){var r=t.waitEffs;r||(r=t.waitEffs=[]),i.forEach(function(i){r.push(i),egret.Tween.get(i).to({alpha:0},e).call(t.onPathEffEnd,t,[i])})}else i.forEach(function(e){egret.Tween.removeTweens(e),e.dispose()});i.length=0}},t.prototype.onPathEffEnd=function(e){egret.Tween.removeTweens(e);var t=this.waitEffs.indexOf(e);t>=0&&this.waitEffs.splice(t,1),e.dispose()},t.prototype.getArrowEff=function(){var e=ObjectPool.pop(MmeEffect,"BattleMmeEffect");return RenderUtils.playUIEffect(e,"100021",Urls.effect(),"a2",1,!0),e},t.prototype.playSceneEffect=function(e,t,i,r){var n=this,a=n.layers[2],o=ObjectPool.pop(MmeEffect,"BattleMmeEffect");o.addEventListener("action_play_end",n.onSceneEffectEnd,n),o=RenderUtils.playUIEffect(null,e,Urls.effect(),t,1,!1),o.x=i,o.y=r,a.addChild(o);var s=n.sceneEffs;s||(s=n.sceneEffs=[]),s.push(o)},t.prototype.onSceneEffectEnd=function(e){var t=this,i=t.sceneEffs,r=e.target;if(r.removeEventListener("action_play_end",t.onSceneEffectEnd,t),i){var n=i.indexOf(r);n>=0&&i.splice(n,1)}r.dispose()},t.prototype.onDestroy=function(){var t=this,i=t.scaleContent;i.anchorOffsetX=i.anchorOffsetY=t.x=t.y=0,i.scaleX=i.scaleY=1,t.splashs.forEach(function(e){e.dispose()}),t.blindShader=null;var r=t.blindRect;r&&(r.filters=null,r.parent&&r.parent.removeChild(r),t.blindRect=null,ObjectPool.push(r)),t.hidePath(),t.pathEffs=null,t.waitEffs&&(t.waitEffs.forEach(function(e){egret.Tween.removeTweens(e),e.dispose()}),t.waitEffs=null);var n=t.sceneEffs;n&&n.forEach(function(e){e.removeEventListener("action_play_end",t.onSceneEffectEnd,t),e.dispose()}),t.sceneEffs=null,e.prototype.onDestroy.call(this)},t}(BaseMap);__reflect(RoomMap.prototype,"RoomMap"),window.RoomMap=RoomMap;var SplashInfo=function(){function e(){}return e.prototype.play=function(e,t,i){var r=this;r.isvalid=!0,r.idx=e,r.id=t,r.map=i;var n=r.cfg=Data.getItem("SplashData",t);Functor.assert(!!r.cfg,"闪屏模版数据不存在："+t),r.totalFrame=n.frame||0,r.curFrame=1,r.isEnd=!1,r.isComplete=!1;var a=r.splash;a||(a=r.splash=new eui.Rect,a.touchEnabled=!1,a.alpha=0),a.alpha=n.alphad||0,a.fillColor=Number(n.color),a.fillAlpha=1;var o=i.getLayer(n.upper?9:3);if(n.monster?a.parent!=o?o.addChildAt(a,0):o.setChildIndex(a,0):a.parent!=o?o.addChild(a):o.setChildIndex(a,o.numChildren),egret.Tween.removeTweens(a),n.times){var s=egret.Tween.get(a);s.to({alpha:n.alphat||0},n.times)}else a.alpha=n.alphat||0},e.prototype.stop=function(){var e=this,t=e.splash;if(e.isEnd=!0,!t)return void(e.isComplete=!0);egret.Tween.removeTweens(t);var i=e.cfg;if(i.timee){var r=egret.Tween.get(t);r.to({alpha:i.alphae||0},i.timee).call(e.onStopEnd,e)}else t.alpha=i.alphae||0,e.onStopEnd()},e.prototype.onStopEnd=function(){this.isComplete=!0},e.prototype.onEnterFrame=function(){var e=this;!e.isEnd&&e.totalFrame&&(e.curFrame++,e.curFrame>=e.totalFrame&&e.stop())},e.prototype.updateSize=function(e,t){var i=this.splash;i&&(i.width=e,i.height=t,i.x=i.anchorOffsetX=.5*e,i.y=i.anchorOffsetY=.5*t,i.scaleX=i.scaleY=1.5)},e.prototype.dispose=function(){var e=this;if(e.isvalid){e.isvalid=!1;var t=e.splash;t.parent&&t.parent.removeChild(t),egret.Tween.removeTweens(t),ObjectUtils.clearKeys(e,["map","idx","id","cfg","totalFrame","curFrame","isEnd","isComplete"]),ObjectPool.push(e)}},e}();__reflect(SplashInfo.prototype,"SplashInfo"),window.SplashInfo=SplashInfo;var BlackAndWhiteShader=function(e){function t(){return e.call(this,{})||this}return __extends(t,e),t.prototype.getFragmentSrc=function(){return"\n/**\n * 黑白滤镜\n */\n\nprecision mediump float;\n\nuniform sampler2D uSampler;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    vec4 color = texture2D(uSampler, vTextureCoord);\n\n    if (color.a <= 0.0)\n    {\n        discard;\n    }\n\n    float r = color.r;\n    float g = color.g;\n    float b = color.b;\n\n    // 颜色平均值\n    float average = (r + g + b) / 3.0;\n\n    // 平均值大于 (100 / 256) 为白色，否则为黑色\n    float c = average >= 0.39 ? 1.0 : 0.0;\n\n    gl_FragColor = vec4(c, c, c, color.a);\n}\n"},t}(core.ShaderBase);__reflect(BlackAndWhiteShader.prototype,"BlackAndWhiteShader"),window.BlackAndWhiteShader=BlackAndWhiteShader;var CastShader=function(e){function t(){return e.call(this,{})||this}return __extends(t,e),t.prototype.getFragmentSrc=function(){return"\n/**\n * 熔铸滤镜\n */\n\nprecision mediump float;\n\nuniform sampler2D uSampler;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    vec4 color = texture2D(uSampler, vTextureCoord);\n\n    if (color.a <= 0.0)\n    {\n        discard;\n    }\n\n    float r = color.r;\n    float g = color.g;\n    float b = color.b;\n\n    // data[i] = r * 128 / (g + b + 1);\n    // data[i + 1] = g * 128 / (r + b + 1);\n    // data[i + 2] = b * 128 / (g + r + 1);\n    float cr = r * 0.5 / (g + b + 0.004);\n    float cg = g * 0.5 / (r + b + 0.004);\n    float cb = b * 0.5 / (g + r + 0.004);\n\n    gl_FragColor = vec4(cr, cg, cb, color.a);\n}\n"},t}(ShaderBase);__reflect(CastShader.prototype,"CastShader"),window.CastShader=CastShader;var ComicShader=function(e){function t(){return e.call(this,{})||this}return __extends(t,e),t.prototype.getFragmentSrc=function(){return"\n/**\n * 连环画滤镜\n */\n\nprecision mediump float;\n\nuniform sampler2D uSampler;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    vec4 color = texture2D(uSampler, vTextureCoord);\n\n    if (color.a <= 0.0)\n    {\n        discard;\n    }\n\n    float r = color.r;\n    float g = color.g;\n    float b = color.b;\n\n    // data[i] = ~~(Math.abs(2 * g + r - b) * r / 256);\n    // data[i + 1] = ~~(Math.abs(2 * b + r - g) * r / 256);\n    // data[i + 2] = ~~(Math.abs(2 * b + r - g) * g / 256);\n    float cr = abs(2.0 * g + r - b) * r;\n    float cg = abs(2.0 * b + r - g) * r;\n    float cb = abs(2.0 * b + r - g) * g;\n\n    gl_FragColor = vec4(cr, cg, cb, color.a);\n}\n"},t}(core.ShaderBase);__reflect(ComicShader.prototype,"ComicShader"),window.ComicShader=ComicShader;var DissolveShader=function(e){function t(){return e.call(this,{r:0,g:0,b:0,edgeWidth:0,threshold:0})||this}return __extends(t,e),Object.defineProperty(t.prototype,"r",{get:function(){return this.filter.uniforms.r},set:function(e){this.filter.uniforms.r=e,this.filter.onPropertyChange()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"g",{get:function(){return this.filter.uniforms.g},set:function(e){this.filter.uniforms.g=e,this.filter.onPropertyChange()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"b",{get:function(){return this.filter.uniforms.b},set:function(e){this.filter.uniforms.b=e,this.filter.onPropertyChange()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"edgeWidth",{get:function(){return this.filter.uniforms.edgeWidth},set:function(e){this.filter.uniforms.edgeWidth=e,this.filter.onPropertyChange()
},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"threshold",{get:function(){return this.filter.uniforms.threshold},set:function(e){this.filter.uniforms.threshold=e},enumerable:!0,configurable:!0}),t.prototype.initialize=function(t){var i=this.uniforms=this.filter.uniforms;i.r=t.r,i.g=t.g,i.b=t.b,i.threshold=t.threshold,i.edgeWidth=t.edgeWidth,e.prototype.initialize.call(this,t),this.filter.onPropertyChange()},t.prototype.getFragmentSrc=function(){return"\n/**\n * 溶解效果\n */\n\nprecision mediump float;\n\nuniform float threshold;\nuniform float edgeWidth;\nuniform float r;\nuniform float g;\nuniform float b;\nuniform float a;\n\nuniform sampler2D uSampler;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    vec4 color = texture2D(uSampler, vTextureCoord);\n\n    // 颜色平均值\n    float avg = (color.r + color.g + color.b) / 3.0;\n\n    // 平均值小于边界，不渲染\n    if (avg <= threshold)\n    {\n        discard;\n    }\n\n    // 平均值在过度范围内，使用外部传递进来的颜色\n    if (avg - edgeWidth <= threshold)\n    {\n        color = vec4(r, g, b, 1.0);\n    }\n\n    gl_FragColor = color;\n}\n"},t.prototype.to=function(e,t,i,r,n,a){void 0===t&&(t=0),void 0===i&&(i=1),void 0===r&&(r=.01),void 0===n&&(n=null),void 0===a&&(a=null);for(var o=[],s=6;s<arguments.length;s++)o[s-6]=arguments[s];var l=this;l.playing=!0,l.target=e,l.threshold=t,l.des=i,l.step=r,l.callback=n,l.thisArg=a,l.args=o,e.filters=[l.filter]},t.prototype.play=function(e,t,i,r,n,a){void 0===t&&(t=0),void 0===i&&(i=1),void 0===r&&(r=.01),void 0===n&&(n=null),void 0===a&&(a=null);for(var o=[],s=6;s<arguments.length;s++)o[s-6]=arguments[s];this.to(e,t,i,r,n,a,o),e.addEventListener(Evt.enterFrame,this.onEnterFrame,this)},t.prototype.stop=function(e){void 0===e&&(e=!1);var t=this;t.playing&&(t.target&&(t.target.removeEventListener(Evt.enterFrame,t.onEnterFrame,t),t.target.filters=null),e&&t.callback&&t.callback.apply(t.thisArg,t.args),t.clear())},t.prototype.manualEnterFrame=function(){this.playing&&this.onEnterFrame()},t.prototype.onEnterFrame=function(){var e=this;return e.step>0&&e.threshold>=e.des||e.step<0&&e.threshold<=e.des?void this.stop(!0):void(e.threshold+=e.step)},t.prototype.clear=function(){var e=this;e.playing=!1,e.des=0,e.target=null,e.callback=null,e.thisArg=null,e.args=null},t.prototype.onDestroy=function(){this.stop()},t}(core.ShaderBase);__reflect(DissolveShader.prototype,"DissolveShader",["DissolveShaderUniforms","core.ShaderBaseUniforms"]),window.DissolveShader=DissolveShader;var EraserCircleShader=function(e){function t(){return e.call(this,{x:0,y:0,r:0,scaleX:1,scaleY:1,alpha:1})||this}return __extends(t,e),Object.defineProperty(t.prototype,"x",{get:function(){return this.filter.uniforms.x},set:function(e){this.filter.uniforms.x=e,this.filter.onPropertyChange()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"y",{get:function(){return this.filter.uniforms.y},set:function(e){this.filter.uniforms.y=e,this.filter.onPropertyChange()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"r",{get:function(){return this.filter.uniforms.r},set:function(e){this.filter.uniforms.r=e,this.filter.onPropertyChange()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scaleX",{get:function(){return this.filter.uniforms.scaleX},set:function(e){this.filter.uniforms.scaleX=e,this.filter.onPropertyChange()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scaleY",{get:function(){return this.filter.uniforms.scaleY},set:function(e){this.filter.uniforms.scaleY=e,this.filter.onPropertyChange()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"alpha",{get:function(){return this.filter.uniforms.alpha},set:function(e){this.filter.uniforms.alpha=e,this.filter.onPropertyChange()},enumerable:!0,configurable:!0}),t.prototype.initialize=function(t){var i=this.uniforms=this.filter.uniforms;ObjectUtils.assignKeysNum(t,i,["x","y","r","scaleX","scaleY","alpha"]),e.prototype.initialize.call(this,t),this.filter.onPropertyChange()},t.prototype.setUniformByEgret=function(e,t,i,r,n,a,o){this.width=i,this.height=r;var s=this.uniforms=this.filter.uniforms,l=Math.max(r,i),u=Math.min(r,i),c=l/r/a,p=l/i/a;s.x=e/i*c,s.y=t/r*p,s.r=n/u,s.scaleX=c,s.scaleY=p,void 0!==o&&(s.alpha=o),this.filter.onPropertyChange()},t.prototype.setXY=function(e,t){var i=this.uniforms=this.filter.uniforms;i.x=e/this.width*i.scaleX,i.y=t/this.height*i.scaleY,this.filter.onPropertyChange()},t.prototype.getFragmentSrc=function(){return"\n/**\n * 圆形挖孔效果\n */\n\nprecision mediump float;\n\nuniform sampler2D uSampler;\n\nvarying vec2 vTextureCoord;\n\nuniform float x;\nuniform float y;\nuniform float r;\nuniform float scaleX;\nuniform float scaleY;\nuniform float alpha;\n\nvoid main(void)\n{\n    vec4 color = texture2D(uSampler, vTextureCoord);\n\n    float dis = distance(vec2(vTextureCoord.x * scaleX, vTextureCoord.y * scaleY), vec2(x, y));\n\n    // 在圆内则不渲染\n    if (dis < r)\n    {\n        discard;\n    }\n\n    gl_FragColor = color * alpha;\n}\n"},t}(core.ShaderBase);__reflect(EraserCircleShader.prototype,"EraserCircleShader",["EraserCircleShaderUniforms","core.ShaderBaseUniforms"]),window.EraserCircleShader=EraserCircleShader;var HalfBlackShader=function(e){function t(){return e.call(this,{})||this}return __extends(t,e),t.prototype.getFragmentSrc=function(){return"\n/**\n * 50% 透明度黑色叠加\n */\n\nprecision mediump float;\n\nuniform sampler2D uSampler;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    vec4 color = texture2D(uSampler, vTextureCoord);\n\n    float a = color.a;\n    float ao;\n\n    // 非透明区域才做计算\n    if (a > 0.0)\n    {\n        ao = 0.5 + 0.5 * a;\n    }\n    // 透明区域是使用 alpha = 0 还是 discard 有待研究。\n    else\n    {\n        ao = 0.0;\n    }\n\n    gl_FragColor = vec4(0.5 * a * (color.rgb) / ao, ao);\n}\n"},t}(core.ShaderBase);__reflect(HalfBlackShader.prototype,"HalfBlackShader"),window.HalfBlackShader=HalfBlackShader;var PetFuseSkillIconShader=function(e){function t(){var t=e.call(this,{t:0,centerX:0,centerY:0,alpha:1,scaleX:1,scaleY:1,isGray:!1,r:0,topCircle:{x:0,y:0,z:0},bottomCircle:{x:0,y:0,z:0},leftCircle:{x:0,y:0,z:0},rightCircle:{x:0,y:0,z:0}})||this;return t._centerPoint={x:.5,y:.5},t._bP0={},t._bP1={},t._bP2={},t._bResult={},t}return __extends(t,e),Object.defineProperty(t.prototype,"t",{get:function(){return this._t},set:function(e){this._t=e;var t=this._t,i=this.uniforms=this.filter.uniforms,r=Math.sqrt(t),n=i.scaleX,a=i.scaleY,o=this._bResult;i.t=t,1>=t&&(this.getBezierPoint(this._centerPoint,this._topEnd,this._topIntersect,r),i.topCircle.x=o.x*n,i.topCircle.y=o.y*a,this.getBezierPoint(this._centerPoint,this._bottomEnd,this._bottomIntersect,r),i.bottomCircle.x=o.x*n,i.bottomCircle.y=o.y*a,this.getBezierPoint(this._centerPoint,this._leftEnd,this._leftIntersect,r),i.leftCircle.x=o.x*n,i.leftCircle.y=o.y*a,this.getBezierPoint(this._centerPoint,this._rightEnd,this._rightIntersect,r),i.rightCircle.x=o.x*n,i.rightCircle.y=o.y*a,i.topCircle.z=i.bottomCircle.z=i.leftCircle.z=i.rightCircle.z=t*t*.5),this.filter.onPropertyChange()},enumerable:!0,configurable:!0}),t.prototype.initial=function(e,t){void 0===t&&(t=e),this._icon=e,this._target=t},t.prototype.play=function(){var e=this._icon,t=this._target;e&&t&&(this.initialPos(),this._useShader=!0,e.filters=void 0,t.filters=[this.filter],egret.Tween.get(this,void 0,void 0,!0).to({t:1},800).to({t:3},300))},t.prototype.cancel=function(){this._useShader&&egret.Tween.get(this,void 0,void 0,!0).set({t:1}).to({t:0},800).call(this.stop,this)},t.prototype.stop=function(){var e=this._icon,t=this._target,i=this.uniforms=this.filter.uniforms;e&&t&&(i.isGray?e.filters=FiltersUtils.GRAY_FILTERS:(e.filters=void 0,t.filters=void 0),e.alpha=i.alpha),egret.Tween.removeTweens(this),this._useShader=!1,this.filter.onPropertyChange()},t.prototype.setGray=function(e){var t=this._icon,i=this._target;if(t&&i){var r=this.uniforms=this.filter.uniforms;r.isGray=e,this._useShader||(e?t.filters=FiltersUtils.GRAY_FILTERS:(t.filters=void 0,i.filters=void 0)),this.filter.onPropertyChange()}},t.prototype.setAlpha=function(e){var t=this._icon;if(t){var i=this.uniforms=this.filter.uniforms;i.alpha=t.alpha=e,this.filter.onPropertyChange()}},t.prototype.clear=function(){this.stop(),this._icon=void 0,this._target=void 0,ObjectPool.push(this)},t.prototype.getFragmentSrc=function(){return"\n/**\n * 守护灵融合后，技能图标效果\n */\n\nprecision mediump float;\n\n// 坐标\nvarying vec2 vTextureCoord;\n\n// 纹理\nuniform sampler2D uSampler;\n\n// 圆型数据\nuniform vec3 topCircle;\nuniform vec3 bottomCircle;\nuniform vec3 leftCircle;\nuniform vec3 rightCircle;\n\n// x 轴缩放比例\nuniform float scaleX;\n// y 轴缩放比例\nuniform float scaleY;\n\n// 透明度\nuniform float alpha;\n\n// 是否灰色\nuniform bool isGray;\n\nuniform float r;\nuniform float centerX;\nuniform float centerY;\nuniform float t;\n\n/**\n * 计算距离比值\n * @param {vec2} coord 当前坐标\n * @param {vec3} circle 圆数据\n */\nfloat dv(vec2 coord, vec3 circle)\n{\n    float dx = circle.x - coord.x;\n    float dy = circle.y - coord.y;\n    float r = circle.z;\n\n    // r / sqrt(dx^2 + dy^2) 为半径和距离的比值，此处返回该比值的平方\n    // [r / sqrt(dx^2 + dy^2)] ^ 2\n    return r * r / (dx * dx + dy * dy);\n}\n\n/**\n * rgb 转 hsv\n * @param {vec4} c rgb 颜色， rgb 取值范围 0~1\n * @return {vec3} hsv 颜色， h 取值范围 0~360 ， sv 取值范围 0~1\n */\nvec3 rgb2hsv(vec4 c)\n{\n    vec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);\n    vec4 p = mix(vec4(c.bg, K.wz), vec4(c.gb, K.xy), step(c.b, c.g));\n    vec4 q = mix(vec4(p.xyw, c.r), vec4(c.r, p.yzx), step(p.x, c.r));\n\n    float d = q.x - min(q.w, q.y);\n    float e = 1.0e-10;\n    return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), d / (q.x + e), q.x);\n}\n\nvec3 hsv2rgb(vec3 c)\n{\n    vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);\n    vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);\n    return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);\n}\n\nvoid main()\n{\n    // 矫正当前坐标\n    vec2 coord = vec2(vTextureCoord.x * scaleX, vTextureCoord.y * scaleY);\n    float v = 0.0;\n\n    v += dv(coord, topCircle);\n    v += dv(coord, bottomCircle);\n    v += dv(coord, leftCircle);\n    v += dv(coord, rightCircle);\n\n    // 获取坐标处颜色\n    vec4 colorR = texture2D(uSampler, vTextureCoord);\n    vec4 color;\n    float dis = distance(coord, vec2(centerX, centerY));\n\n    // 圆内才做效果\n    if (dis <= r)\n    {\n        // 外圈颜色不变\n        if (v < 0.95)\n        {\n            color = colorR;\n        }\n        // 过渡颜色\n        else if (v < 1.05)\n        {\n            color.r = 0.86;\n            color.g = 0.61;\n            color.b = 0.12;\n            color.a = colorR.a;\n        }\n        // 内圈颜色效果\n        else\n        {\n            vec3 hsv = rgb2hsv(colorR);\n\n            hsv.x += 0.4;\n\n            color = vec4(hsv2rgb(hsv), colorR.a);\n        }\n\n        float lightT = t - 1.0;\n\n        // t 大于1时做扫光效果\n        if (lightT > 0.0)\n        {\n            // 水平坐标矫正为斜向45°\n            float deltaX = coord.x + coord.y - lightT;\n\n            // 在扫光范围内\n            if (abs(deltaX) < 0.2)\n            {\n                // 做颜色叠加\n\n                // 背景 alpha\n                float ab = color.a;\n                // 前景 alpha\n                float af = 0.3;\n                // 背景颜色\n                vec3 cb = color.rgb;\n                // 前景颜色\n                vec3 cf = vec3(1.0, 1.0, 0.2);\n                // 混合透明度 1 - (1 - ab)(1 - af) = ab + af - ab * af\n                float ao = ab + af - ab * af;\n                // 混合颜色  (af * cf + (1 - af) * ab * cb) / ao\n                vec4 c = vec4((af * cf + (1.0 - af) * ab * cb) / ao, ao);\n\n                // 高亮\n                c += vec4(0.1, 0.1, 0.1, 0);\n\n                // 正方向不做衰减过度\n                if (deltaX > 0.0)\n                {\n                    color = c;\n                }\n                // 反方向做插值，衰减过度\n                else\n                {\n                    float inc = smoothstep(0.0, 1.0, (1.0 - (-deltaX) / 0.2));\n                    vec4 deltaC = c - color;\n\n                    color = inc * deltaC;\n                }\n            }\n        }\n    }\n\n    // 置灰\n    if (isGray)\n    {\n        float gray = color.r * 0.299 + color.g * 0.587 + color.b * 0.114;\n\n        color.r = color.g = color.b = gray;\n    }\n\n    // 设置透明度\n    color.a = alpha * color.a;\n\n    gl_FragColor = color;\n}\n"},t.prototype.getBezierPoint=function(e,t,i,r){var n=1-r,a=n*n,o=2*r*n,s=r*r,l=this._bP0;l.x=e.x*a,l.y=e.y*a;var u=this._bP1;u.x=i.x*o,u.y=i.y*o;var c=this._bP2;c.x=t.x*s,c.y=t.y*s;var p=this._bResult;return p.x=l.x+u.x+c.x,p.y=l.y+u.y+c.y,p},t.prototype.initialPos=function(){var e=this;egret.Tween.removeTweens(e);var t=this._icon,i=t.height,r=t.width,n=Math.max(i,r),a=n/i,o=n/r,s=.5*a,l=.5*o;e._t=0,e._topEnd={x:Math.random(),y:0},e._topIntersect={x:Math.random(),y:Math.random()},e._topCircle={x:s,y:l,z:0},e._bottomEnd={x:Math.random(),y:1},e._bottomIntersect={x:Math.random(),y:Math.random()},e._bottomCircle={x:s,y:l,z:0},e._leftEnd={x:0,y:Math.random()},e._leftIntersect={x:Math.random(),y:Math.random()},e._leftCircle={x:s,y:l,z:0},e._rightEnd={x:1,y:Math.random()},e._rightIntersect={x:Math.random(),y:Math.random()},e._rightCircle={x:s,y:l,z:0};var u=e.uniforms=this.filter.uniforms;u.t=0,u.scaleX=a,u.scaleY=o,u.alpha=1,u.r=.42,u.centerX=s,u.centerY=l,u.topCircle=e._topCircle,u.bottomCircle=e._bottomCircle,u.leftCircle=e._leftCircle,u.rightCircle=e._rightCircle,this.filter.onPropertyChange()},t}(ShaderBase);__reflect(PetFuseSkillIconShader.prototype,"PetFuseSkillIconShader",["core.ShaderBaseUniforms"]),window.PetFuseSkillIconShader=PetFuseSkillIconShader;var PureColorAddShader=function(e){function t(){return e.call(this,{r:0,g:0,b:0,a:1})||this}return __extends(t,e),Object.defineProperty(t.prototype,"a",{get:function(){return this.filter.uniforms.a},set:function(e){this.filter.uniforms.a=e,this.filter.onPropertyChange()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"b",{get:function(){return this.filter.uniforms.b},set:function(e){this.filter.uniforms.b=e,this.filter.onPropertyChange()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"g",{get:function(){return this.filter.uniforms.g},set:function(e){this.filter.uniforms.g=e,this.filter.onPropertyChange()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"r",{get:function(){return this.filter.uniforms.r},set:function(e){this.filter.uniforms.r=e,this.filter.onPropertyChange()},enumerable:!0,configurable:!0}),t.prototype.initialize=function(t){var i=this.uniforms=this.filter.uniforms;ObjectUtils.assignKeysNum(t,i,[]),e.prototype.initialize.call(this,t),this.filter.onPropertyChange()},t.prototype.getFragmentSrc=function(){return"\n/**\n * 纯色和背景色叠加效果\n * @description 可以扩展到两张纹理叠加，但是 egret 对用户自定义纹理通道不提供官方支持，用起来很麻烦，并且需要在下一帧刷新才有效果\n */\nprecision mediump float;\n\nuniform sampler2D uSampler;\n\nvarying vec2 vTextureCoord;\n\nuniform float r;\nuniform float g;\nuniform float b;\nuniform float a;\n\nvoid main(void)\n{\n    vec4 color = texture2D(uSampler, vTextureCoord);\n\n    // 背景 alpha\n    float ab = color.a;\n    // 前景 alpha\n    float af = a;\n    // 背景颜色\n    vec3 cb = color.rgb;\n    // 前景颜色\n    vec3 cf = vec3(r, g, b);\n    // 混合透明度 1 - (1 - ab)(1 - af) = ab + af - ab * af\n    float ao = ab + af - ab * af;\n\n    // 混合颜色  (af * cf + (1 - af) * ab * cb) / ao\n    gl_FragColor = vec4((af * cf + (1.0 - af) * ab * cb) / ao, ao);\n}\n"},t}(core.ShaderBase);__reflect(PureColorAddShader.prototype,"PureColorAddShader",["PureColorAddShaderUniforms","core.ShaderBaseUniforms"]),window.PureColorAddShader=PureColorAddShader;var ReverseShader=function(e){function t(){return e.call(this,{})||this}return __extends(t,e),t.prototype.getFragmentSrc=function(){return"\n/**\n * 反色滤镜\n */\n\nprecision mediump float;\n\nuniform sampler2D uSampler;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    vec4 color = texture2D(uSampler, vTextureCoord);\n\n    if (color.a <= 0.0)\n    {\n        discard;\n    }\n\n    float r = color.r;\n    float g = color.g;\n    float b = color.b;\n\n    gl_FragColor = vec4(1.0 - r, 1.0 - g, 1.0 - b, color.a);\n}\n"},t}(core.ShaderBase);__reflect(ReverseShader.prototype,"ReverseShader"),window.ReverseShader=ReverseShader;var TelegramUtils=function(){function e(){}return e.initialize=function(){},e}();__reflect(TelegramUtils.prototype,"TelegramUtils"),window.TelegramUtils=TelegramUtils;var BaseBarRender=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.update=function(){var e=this.data;e&&(!isNaN(e.maximum)&&(this.bar.maximum=e.maximum),!isNaN(e.minimum)&&(this.bar.minimum=e.minimum),!isNaN(e.value)&&(this.bar.value=e.value),this.upLabel(this.bar.value,this.bar.maximum))},t.prototype.initUI=function(){this.slideDuration=this.bar.slideDuration},t.prototype.addUI=function(){this.bar.labelFunction=this.labelFunction?this.labelFunction.bind(this):null},t.prototype.upLabel=function(e,t){},t.prototype.removeUI=function(){this.bar.labelFunction=null},t}(BaseItem);__reflect(BaseBarRender.prototype,"BaseBarRender"),window.BaseBarRender=BaseBarRender;var SubPullColAction=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.checkEnd=function(t,i,r,n,a){if(!r){var o=this,s=o.owner,l=o.action,u=l.ctime;if(!l.stime||l.stime&&l.cstime<l.stime){var c=Fixed.value(t).div(a).value;if(l.cstime=Fixed.value(l.cstime).add(c).value,l.time<=u){var p=l.time=Fixed.value(l.time).add(c).value,d=Fixed.value(l.disx).sub(l.stopDis).value;if(l.disz||l.lastDisx<d){var f=Fixed.value(u).sub(p).value,h=Fixed.value(u).pow(3).value,v=l.useWeight?s.props.gv("weight"):50,m=Fixed.value(f).pow(2).mul(3).mul(1).mul(p).value;m=Fixed.value(p).pow(2).mul(3).mul(1).mul(f).add(m).value,m=Fixed.value(p).pow(3).mul(1).add(m).div(h).min(1).value;var y=Fixed.value(50).div(v).pow(1.25).min(1).value,g=0,b=0;if(l.disz){var x=Fixed.value(l.disz).mul(m).value;x=Fixed.value(x).mul(y).value,b=Fixed.value(x).sub(l.lastDisz).value,l.lastDisz=x}if(l.lastDisx<d){var I=Fixed.value(l.disx).mul(m).value;I=Fixed.value(I).mul(y).min(d).value,g=Fixed.value(I).sub(l.lastDisx).value,l.lastDisx=I}if(g||b){var _=s.scene.limitX(Fixed.value(g).mul(l.multiply).add(s.ox).value),S=Fixed.value(s.oz).add(b).value;s.updatePos(_,s.oy,S,s.right)}}}}}e.prototype.checkEnd.call(this,t,i,r,n,a)},t}(SubAction);__reflect(SubPullColAction.prototype,"SubPullColAction"),window.SubPullColAction=SubPullColAction;var SubPullPointAction=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.checkEnd=function(t,i,r,n,a){if(!r){var o=this,s=o.owner,l=o.action,u=l.ctime;if(!l.stime||l.stime&&l.cstime<l.stime){var c=t/a;if(l.cstime=l.cstime+c,l.time<=u){var p=l.time=Fixed.value(l.time).add(c).value,d=Fixed.value(l.dis).sub(l.stopRadius).value;if(l.disz||l.lastDis<d){var f=Fixed.value(u).sub(p).value,h=Fixed.value(u).pow(3).value,v=l.useWeight?s.props.gv("weight"):50,m=Fixed.value(f).pow(2).mul(3).mul(1).mul(p).value;m=Fixed.value(p).pow(2).mul(3).mul(1).mul(f).add(m).value,m=Fixed.value(p).pow(3).mul(1).add(m).div(h).min(1).value;var y=Fixed.value(50).div(v).pow(1.25).min(1).value,g=0,b=0,x=0;if(l.disz){var I=Fixed.value(l.disz).mul(m).value;I=Fixed.value(I).mul(y).value,x=Fixed.value(I).sub(l.lastDisz).value,l.lastDisz=I}if(l.lastDis<d){var _=Fixed.value(l.dis).mul(m).value;_=Fixed.value(_).mul(y).min(d).value;var S=Fixed.value(_).sub(l.lastDis).value;l.lastDis=_,g=Fixed.value(l.radian).cos().mul(S).value,b=Fixed.value(l.radian).sin().mul(S).value}if(g||b||x){var T=s.scene.limitX(Fixed.value(s.ox).add(g).value),w=s.scene.limitY(Fixed.value(s.oy).add(b).value),A=Fixed.value(s.oz).add(x).value;s.updatePos(T,w,A,s.right)}}}}}e.prototype.checkEnd.call(this,t,i,r,n,a)},t}(SubAction);__reflect(SubPullPointAction.prototype,"SubPullPointAction"),window.SubPullPointAction=SubPullPointAction;var MultBar=function(e){function t(){var t=e.call(this)||this;return t._isOverToplimit=!0,t._valueDisplay=0,t._tempValue=0,t.thumb=null,t.tempThumb=null,t.labelDisplay=null,t._labelFunction=null,t._slideDuration=500,t._direction=eui.Direction.LTR,t.slideToValue=0,t.animationValue=0,t.thumbInitX=0,t.thumbInitY=0,t.tempThumbInitX=0,t.tempThumbInitY=0,t.animation=new eui.sys.Animation(t.animationUpdateHandler,t),t}return __extends(t,e),Object.defineProperty(t.prototype,"isOverToplimit",{get:function(){return this._isOverToplimit},set:function(e){var t=this;e!==t.isOverToplimit&&(t._isOverToplimit=e,t.labelDisplay&&(e?t.labelDisplay.text=t.valueToLabel(t.valueDisplay,t.maximum):t.labelDisplay.text=t.valueToLabel(t.value+t.tempValue,t.maximum)))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"valueDisplay",{get:function(){return this._valueDisplay},set:function(e){var t=this;e!==t.valueDisplay&&(t._valueDisplay=e,t.labelDisplay&&(t.isOverToplimit?t.labelDisplay.text=t.valueToLabel(t.valueDisplay,t.maximum):t.labelDisplay.text=t.valueToLabel(t.value+t.tempValue,t.maximum)))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"value",{get:function(){return egret.superGetter(t,this,"value")},set:function(e){e=+e||0,this.valueDisplay=e+this.tempValue,this.$setValue(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"tempValue",{get:function(){return this._tempValue},set:function(e){var t=this;e!=t._tempValue&&(e=Math.max(0,e),t.isOverToplimit||(e=Math.min(e,t.maximum-t.value)),t.valueDisplay=t.valueDisplay-t.tempValue+e,t._tempValue=e,t.invalidateDisplayList())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"labelFunction",{get:function(){return this._labelFunction},set:function(e){this._labelFunction!=e&&(this._labelFunction=e,this.invalidateDisplayList())},enumerable:!0,configurable:!0}),t.prototype.valueToLabel=function(e,t){return null!=this.labelFunction?this._labelFunction(e,t):e+" / "+t},Object.defineProperty(t.prototype,"slideDuration",{get:function(){return this._slideDuration},set:function(e){e=0|+e;var t=this;t._slideDuration!==e&&(t._slideDuration=e,t.animation.isPlaying&&(t.animation.stop(),t.setValue(t.slideToValue)))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"direction",{get:function(){return this._direction},set:function(e){var t=this;t._direction!=e&&(t.thumb&&(t.thumb.x=t.thumbInitX),t.thumb&&(t.thumb.y=t.thumbInitY),t.tempThumb&&(t.tempThumb.x=t.tempThumbInitX),t.tempThumb&&(t.tempThumb.y=t.tempThumbInitY),t._direction=e,t.invalidateDisplayList())},enumerable:!0,configurable:!0}),t.prototype.$setValue=function(t){var i=this;if(i.value===t)return!1;var r=i.$Range,n=e.prototype.$setValue.call(this,t);if(i._slideDuration>0&&i.$stage){i.validateProperties();var a=i.animation;if(a.isPlaying&&(i.animationValue=i.slideToValue,i.invalidateDisplayList(),a.stop()),i.slideToValue=i.nearestValidValue(t,r[7]),i.slideToValue===i.animationValue)return n;var o=i._slideDuration*(Math.abs(i.animationValue-i.slideToValue)/(r[0]-r[2]));a.duration=o===1/0?0:o,a.from=i.animationValue,a.to=i.slideToValue,a.play()}else i.animationValue=i.value;return n},t.prototype.animationUpdateHandler=function(e){var t=this,i=t.$Range,r=t.nearestValidValue(e.currentValue,i[7]);t.animationValue=Math.min(i[0],Math.max(i[2],r)),t.invalidateDisplayList()},t.prototype.partAdded=function(t,i){e.prototype.partAdded.call(this,t,i);var r=this;i===r.thumb&&(r.thumb.x&&(r.thumbInitX=r.thumb.x),r.thumb.y&&(r.thumbInitY=r.thumb.y),r.thumb.addEventListener(egret.Event.RESIZE,r.onThumbResize,r)),i===r.tempThumb&&(r.tempThumb.x&&(r.tempThumbInitX=r.tempThumb.x),r.tempThumb.y&&(r.tempThumbInitY=r.tempThumb.y),r.tempThumb.addEventListener(egret.Event.RESIZE,r.onThumbResize,r))},t.prototype.partRemoved=function(t,i){e.prototype.partRemoved.call(this,t,i);var r=this;i===r.thumb&&r.thumb.removeEventListener(egret.Event.RESIZE,r.onThumbResize,r),i===r.tempThumb&&r.tempThumb.removeEventListener(egret.Event.RESIZE,r.onThumbResize,r)},t.prototype.onThumbResize=function(e){this.updateSkinDisplayList()},t.prototype.updateSkinDisplayList=function(){var e=this,t=e.animation.isPlaying?e.animationValue:e.value,i=e.maximum,r=e.thumb;if(r){var n=r.width,a=r.height,o=Math.round(t/i*n);(0>o||o===1/0)&&(o=0);var s=Math.round(t/i*a);(0>s||s===1/0)&&(s=0);var l=r.$scrollRect;l||(l=egret.$TempRectangle),l.setTo(0,0,n,a);var u=r.x-l.x,c=r.y-l.y;switch(e._direction){case eui.Direction.LTR:l.width=o,r.x=u;break;case eui.Direction.RTL:l.width=o,l.x=n-o,r.x=l.x;break;case eui.Direction.TTB:l.height=s,r.y=c;break;case eui.Direction.BTT:l.height=s,l.y=a-s,r.y=l.y}r.scrollRect=l}t+=e.tempValue;var p=e.tempThumb;if(p){var n=p.width,a=p.height,o=Math.round(t/i*n);(0>o||o===1/0)&&(o=0);var s=Math.round(t/i*a);(0>s||s===1/0)&&(s=0);var l=p.$scrollRect;l||(l=egret.$TempRectangle),l.setTo(0,0,n,a);var u=p.x-l.x,c=p.y-l.y;switch(e._direction){case eui.Direction.LTR:l.width=o,p.x=u;break;case eui.Direction.RTL:l.width=o,l.x=n-o,p.x=l.x;break;case eui.Direction.TTB:l.height=s,p.y=c;break;case eui.Direction.BTT:l.height=s,l.y=a-s,p.y=l.y}p.scrollRect=l}e.labelDisplay&&(e.isOverToplimit&&(t=e.valueDisplay),e.labelDisplay.text=e.valueToLabel(t,i))},t}(eui.Range);__reflect(MultBar.prototype,"MultBar"),window.MultBar=MultBar;var MultBar2=function(e){function t(){var t=e.call(this)||this;t.thumb=null,t.tempThumb=null,t.thumbBg=null,t.thumbFadeArr=[],t.labelDisplay=null,t.thumbNumDisplay=null,t._labelFunction=null,t._thumbNumFunction=null,t._slideDuration=500,t._fadeDelay=0,t._direction=eui.Direction.LTR,t._cutOffValue=1/0,t._thumbSrcArr=[],t._thumbFadeSrcArr=[],t._slideDirection="b",t.slideToValue=0,t.animationValue=0,t.animationFadeValue=0,t.thumbInitX=0,t.thumbInitY=0;var i=t;return i.animation=new eui.sys.Animation(i.animationUpdateHandler,i),i.animationFade=new eui.sys.Animation(i.animationFadeUpdateHandler,i),t}return __extends(t,e),Object.defineProperty(t.prototype,"labelFunction",{get:function(){return this._labelFunction},set:function(e){this._labelFunction!==e&&(this._labelFunction=e,this.invalidateDisplayList())},enumerable:!0,configurable:!0}),t.prototype.valueToLabel=function(e,t){return null!==this.labelFunction?this._labelFunction(e,t):e+" / "+t},Object.defineProperty(t.prototype,"thumbNumFunction",{get:function(){return this._thumbNumFunction},set:function(e){this._thumbNumFunction!==e&&(this._thumbNumFunction=e,this.invalidateDisplayList())},enumerable:!0,configurable:!0}),t.prototype.thumbNumToLabel=function(e,t){return null!==this.thumbNumFunction?this._thumbNumFunction(e,t):e+""},Object.defineProperty(t.prototype,"slideDuration",{get:function(){return this._slideDuration},set:function(e){e=0|+e;var t=this;if(t._slideDuration!==e){t._slideDuration=e;var i=t.slideDuration*(Math.abs(t.animationValue-t.slideToValue)/(t.maximum-t.minimum));t.animation.duration=i===1/0?0:i}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fadeDelay",{get:function(){return this._fadeDelay},set:function(e){e=0|+e;var t=this;if(t._fadeDelay!==e){t._fadeDelay=e;var i=t.slideDuration*(Math.abs(t.animationFadeValue-t.slideToValue)/(t.maximum-t.minimum));t.animationFade.duration=i===1/0?0:i}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"direction",{get:function(){return this._direction},set:function(e){var t=this;t._direction!==e&&(t.thumb&&(t.thumb.x=t.thumbInitX),t.thumb&&(t.thumb.y=t.thumbInitY),t._direction=e,t.invalidateDisplayList())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cutOffValue",{get:function(){return this._cutOffValue},set:function(e){"number"!=typeof e||isNaN(e)||e===this._cutOffValue||(this._cutOffValue=e,this.invalidateDisplayList())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"thumbSrcArr",{get:function(){return this._thumbSrcArr},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"thumbSrcStr",{set:function(e){var t=e.split(",");t&&t.length&&t!==this._thumbSrcArr&&(this._thumbSrcArr=t,this.invalidateDisplayList())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"thumbFadeSrcArr",{get:function(){return this._thumbFadeSrcArr},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"thumbFadeSrcStr",{set:function(e){var t=e.split(",");t&&t.length&&t!==this._thumbFadeSrcArr&&(this._thumbFadeSrcArr=t,this.invalidateDisplayList())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"slideDirection",{get:function(){return this._slideDirection},set:function(e){var t=this;if(t._slideDirection!==e){t._slideDirection=e;var i=t.animationValue,r=t.slideToValue;t.animation.isPlaying&&(r-i>0&&"d"===e||0>r-i&&"i"===e)&&(t.animationValue=r,t.invalidateDisplayList(),t.animation.stop())}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"animationEndFunction",{get:function(){return this.animation.endFunction},set:function(e){this.animation.endFunction=e?function(t){e(t)}:null},enumerable:!0,configurable:!0}),t.prototype.$setValue=function(t){var i=this,r=i.animationValue;if(i.value===t)return!1;var n=e.prototype.$setValue.call(this,t),a=i.animation,o=i.animationFade;if(i.slideDuration>0&&i.$stage&&("b"===i.slideDirection||t-r>0&&"i"===i.slideDirection||0>t-r&&"d"===i.slideDirection)){if(i.validateProperties(),i.slideToValue=i.nearestValidValue(t,i.snapInterval),i.slideToValue===i.animationValue)return n;var s=i.slideDuration*(Math.abs(i.animationValue-i.slideToValue)/(i.maximum-i.minimum));a.duration=s===1/0?0:s,a.from=i.animationValue,a.to=i.slideToValue,a.play(),i.fadeDelay>0&&(o.duration=Math.max(Math.floor(1.3*a.duration),200),o.from=i.animationFadeValue,o.to=i.slideToValue,o.play())}else a.isPlaying&&a.stop(),o.isPlaying&&o.stop(),i.animationValue=i.animationFadeValue=i.nearestValidValue(t,i.snapInterval),this.invalidateDisplayList();return n},t.prototype.animationUpdateHandler=function(e){var t=this;t.animationValue=t.nearestValidValue(e.currentValue,t.snapInterval),t.invalidateDisplayList()},t.prototype.animationFadeUpdateHandler=function(e){var t=this;t.animationFadeValue=t.nearestValidValue(e.currentValue,t.snapInterval),t.invalidateDisplayList()},t.prototype.partAdded=function(t,i){e.prototype.partAdded.call(this,t,i);var r=this;i===r.thumb&&(r.thumb.x&&(r.thumbInitX=r.thumb.x),r.thumb.y&&(r.thumbInitY=r.thumb.y),r.thumb.addEventListener(egret.Event.RESIZE,r.onThumbResize,r),r.thumb instanceof eui.Image&&(r.thumbSrcArr&&r.thumbSrcArr.length||(r.thumbSrcStr=(r.thumb.source||"")+""),r.thumbFadeArr&&r.thumbFadeArr.length||(r.thumbFadeSrcStr=(r.thumb.source||"")+"")))},t.prototype.partRemoved=function(t,i){e.prototype.partRemoved.call(this,t,i);var r=this;i===r.thumb&&r.thumb.removeEventListener(egret.Event.RESIZE,r.onThumbResize,r)},t.prototype.onThumbResize=function(e){this.updateSkinDisplayList()},t.prototype.updateSkinDisplayList=function(){var e,t=this,i=this,r=i.animation.isPlaying?i.animationValue:i.value,n=i.animationFade.isPlaying?i.animationFadeValue:r,a=i.cutOffValue===1/0?i.maximum:i.cutOffValue,o=i.thumb,s=i.thumbBg,l=+(r/a).toFixed(3),u=Math.floor(l),c=l-u,p=+(n/a).toFixed(3),d=Math.floor(p),f=p-d;if(o){var h=o.width,v=o.height;if(u&&!s){var m=egret.getQualifiedClassName(o),y=egret.getDefinitionByName(m),g=new y;g.left=o.left,g.right=o.right,g.top=o.top,g.bottom=o.bottom,s=i.thumbBg=g,i.addChildAt(s,i.getChildIndex(o))}var b=i.thumbSrcArr;b&&b.length&&(s&&s instanceof eui.Image&&(s.source=b[NumberUtils.limit(u-1,-1,b.length-1)]||null),o&&o instanceof eui.Image&&(o.source=b[NumberUtils.limit(u,0,b.length-1)]||null));var x=i.thumbFadeArr,I=i.thumbFadeSrcArr,_=x.length;if(n!==r&&I&&I.length){var S=d-u+1;if(_>S){for(var T=_-1;T>=0;T--)if(T>=S){var w=x[T];-1!==i.getChildIndex(w)&&i.removeChild(w)}else{var A=x[T],P=A.scrollRect;P||(P=egret.$TempRectangle),P.setTo(0,0,h,v),A.scrollRect=P,A instanceof eui.Image&&(A.source=I[NumberUtils.limit(u+T,0,_-1)]||null)}x.splice(S,_-S)}else if(S>_)for(var T=0;S>T;T++)if(_>T){var A=x[T],P=A.scrollRect;P||(P=egret.$TempRectangle),P.setTo(0,0,h,v),A.scrollRect=P,A instanceof eui.Image&&(A.source=I[NumberUtils.limit(u+T,0,_-1)]||null)
}else{var m=egret.getQualifiedClassName(o),y=egret.getDefinitionByName(m),C=new y;C.left=o.left,C.right=o.right,C.top=o.top,C.bottom=o.bottom,0===T?i.addChildAt(C,i.getChildIndex(o)):i.addChild(C),x.push(C),C instanceof eui.Image&&(C.source=I[NumberUtils.limit(u+T,0,_-1)]||null)}else for(var T=0;_>T;T++){var A=x[T],P=A.scrollRect;P||(P=egret.$TempRectangle),P.setTo(0,0,h,v),A.scrollRect=P,A instanceof eui.Image&&(A.source=I[NumberUtils.limit(u+T,0,_-1)]||null)}e=x[_-1]}else x.forEach(function(e){-1!==t.getChildIndex(e)&&t.removeChild(e)},i),i.thumbFadeArr=[];var D=Math.round(c*h);(0>D||D===1/0)&&(D=0);var B=Math.round(c*v);(0>B||B===1/0)&&(B=0);var k=o.$scrollRect;k||(k=egret.$TempRectangle),k.setTo(0,0,h,v);var E=o.x-k.x,R=o.y-k.y;switch(i.direction){case eui.Direction.LTR:k.width=D,o.x=E;break;case eui.Direction.RTL:k.width=D,k.x=h-D,o.x=k.x;break;case eui.Direction.TTB:k.height=B,o.y=R;break;case eui.Direction.BTT:k.height=B,k.y=v-B,o.y=k.y}if(o.scrollRect=k,e){var F=Math.round(f*h);(0>F||F===1/0)&&(F=0);var M=Math.round(f*v);(0>M||M===1/0)&&(M=0);var L=e.$scrollRect;L||(L=egret.$TempRectangle),L.setTo(0,0,h,v);var U=e.x-L.x,O=e.y-L.y;switch(i.direction){case eui.Direction.LTR:L.width=F,o.x=U;break;case eui.Direction.RTL:L.width=F,L.x=h-F,o.x=L.x;break;case eui.Direction.TTB:L.height=M,o.y=O;break;case eui.Direction.BTT:L.height=M,L.y=v-M,o.y=L.y}e.scrollRect=L}}i.labelDisplay&&(i.labelDisplay.text=i.valueToLabel(r,i.maximum)),i.thumbNumDisplay&&(i.thumbNumDisplay.text=i.thumbNumToLabel(Math.ceil(l),Math.ceil(+(i.maximum/a).toFixed(3))))},t}(eui.Range);__reflect(MultBar2.prototype,"MultBar2"),window.MultBar2=MultBar2;var SliderBar1=function(e){function t(){var t=e.call(this)||this;return t.oneBarMean=1,t}return __extends(t,e),t.prototype.initialize=function(t,i,r,n){var a=this;a.maxCount=n,a.oneBarMean=NumberUtils.toFixed(a.maximum/n,4),a.count=NumberUtils.limit(Math.ceil(a.value/a.oneBarMean),1,n),e.prototype.init.call(this,t,i,r)},t.prototype.getOneBarValue=function(){return this.oneBarMean},t.prototype.getThumbValue=function(e){var t=e!=this.maximum?e%this.oneBarValue:0;return 0==t&&e&&(t=this.oneBarValue),t},t.prototype.getValueToPercent=function(e,t,i){return e/this.oneBarValue},t.prototype.getTickValue=function(){var e=this;return e.nearestValidValue(e.thumbStop?e.value:(e.count-1+e.thumbPercent)*e.oneBarValue,e.snapInterval)},t}(BaseSliderBar);__reflect(SliderBar1.prototype,"SliderBar1"),window.SliderBar1=SliderBar1;var SliderBar2=function(e){function t(){var t=e.call(this)||this;return t.oneBarValues=[1],t.totalValues=[1],t.maxValueCount=1,t.totalValue=1,t.lastValue=1,t}return __extends(t,e),t.prototype.initialize=function(t,i,r,n,a){var o=this;o.maxCount=n,o.oneBarValues=a,o.maxValueCount=a.length;var s=o.maxValueCount,l=[],u=0;a.forEach(function(e,t){u+=e,l.push(u),t==s-1&&(o.lastValue=e)}),o.totalValues=l,o.totalValue=u||1;var c=-1,p=o.value;if(p>u)c=Math.ceil((p-u)/o.lastValue);else for(var d=o.maxValueCount-1;d>=0;d--)if(u=l[d],p>u){c=d+2;break}o.count=Math.max(1,c),e.prototype.init.call(this,t,i,r)},t.prototype.getOneBarValue=function(){var e=this.oneBarValues;return e[this.count-1]||this.lastValue||1},t.prototype.getThumbValue=function(e){var t=this,i=t.totalValue,r=t.totalValues,n=t.oneBarValues,a=e;if(e>i)a=e%i%t.lastValue,0==a&&e>0&&(a=t.lastValue);else for(var o=t.maxValueCount-1;o>=0;o--)if(i=r[o],e>=i){a=e-i,0==a&&e>0&&(a=n[o]);break}return a},t.prototype.getValueToPercent=function(e,t,i){var r=this,n=r.thumbPercent+r.count,a=1===r.thumbPercent?n-2:0===r.thumbPercent?n:n-1,o=r.getPercent(i);return o>a?o-Math.floor(a):o-Math.ceil(a-1)},t.prototype.getPercent=function(e){var t=this,i=t.totalValue,r=t.totalValues,n=t.oneBarValues,a=e;if(e>i)return t.maxValueCount+(e-i)/t.lastValue;for(var o=n[0],s=-1,l=t.maxValueCount-1;l>=0;l--)if(i=r[l],e>=i){s=e>i?l+2:l+1,o=n[s-1],a=e-i,0==a&&e>0&&(a=o);break}return s=Math.max(1,s),s-1+a/o},t.prototype.getTickValue=function(){var e=this,t=0;if(e.thumbStop)t=e.value;else{var i=e.count-e.maxValueCount-1;t=i>=0?e.thumbPercent*e.oneBarValue+e.totalValue+i*e.lastValue:e.thumbPercent*e.oneBarValue+(e.totalValues[e.count-2]||0)}return e.nearestValidValue(t,e.snapInterval)},t}(BaseSliderBar);__reflect(SliderBar2.prototype,"SliderBar2"),window.SliderBar2=SliderBar2;var StackView=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.hasAddToShow=!1,t.specialTab=!1,t.isNotchTab=!0,t}return __extends(t,e),Object.defineProperty(t.prototype,"isReady",{get:function(){return this.isSkinReady&&this.isCreated&&this.$hasAddToStage&&this.hasAddToShow},enumerable:!0,configurable:!0}),t.prototype.initUI=function(){var e=this;e.tabBar&&(!e.specialTab&&(e.tabBar.itemRenderer=e.isNotchTab?TabBarItemNotch:TabBarImgItem),e.tabSwitch&&(e.tabSwitch.tabBar=e.tabBar),e.tabSwitch&&(e.tabSwitch.tabBar=e.tabBar)),e.tabSwitch&&(e.tabSwitch.owner=e)},t.prototype.addUI=function(){this.tabSwitch&&(this.tabSwitch.selectIndex=0)},t.prototype.onShow=function(){var e=this;if(e.hasAddToShow=!0,e.tabSwitch){var t=e.vo||{},i=t.params||{};if("viewData"in i&&e.tabSwitch.setData(i.viewData),"viewDataMap"in i){var r=i.viewDataMap||{};for(var n in r)e.tabSwitch.setDatumByIndex(r[n],Number(n))}}},t.prototype.onHide=function(){this.hasAddToShow=!1},t.prototype.onDataChange=function(e){this.data!==e&&this.isReady&&this.update()},t.prototype.update=function(){var e=this,t=e.vo.params;if(e.tabSwitch){var i=-1;if(t&&e.tabBar){var r=e.tabBar.dataProvider.source;if(t.pid&&(i=Data.getItemAtt("PanelData",t.pid,"index")||-1),0>i&&(i=t.index),0>i)for(var n=0,a=r;n<a.length;n++){var o=a[n];if(o.enable){i=o.index;break}}i>=0||(i=0)}this.tabSwitch.selectIndex=i}},t.prototype.removeUI=function(){this.hasAddToShow=!1,this.data=void 0},t}(BaseView);__reflect(StackView.prototype,"StackView",["TabSwitchOwner"]),window.StackView=StackView;var HSlider=eui.HSlider,StepNumView=function(e){function t(){var t=e.call(this)||this;return t._editable=!1,t._num=0,t._stopChange=!1,t._stepNum=1,t._maximum=1/0,t._minimum=1,t}return __extends(t,e),Object.defineProperty(t.prototype,"editable",{get:function(){return this._editable},set:function(e){this._editable=e,this.updateEditable()},enumerable:!0,configurable:!0}),t.prototype.updateEditable=function(){var e=this.editable;this.numLabelDisplay&&(this.numLabelDisplay.touchEnabled=e)},Object.defineProperty(t.prototype,"num",{get:function(){return this._num},set:function(e){var t=this;if(t._num!=e){if(e<t.minimum&&(e=t.minimum),e>t.maximum&&(e=t.maximum),"number"!=typeof e||isNaN(e)||e===t.num)return void(t.numLabelDisplay&&(t.numLabelDisplay.text=t.displayNum+""));if(t._stopChange)return void(t._stopChange=!1);var i=e>t.num;t._num=e,t.numLabelDisplay&&(t.numLabelDisplay.text=t.displayNum+""),t.slider&&(t.slider.value=e),t.sliderTF&&t.sliderTF.formatStr(e+"/"+t.maximum),t._changeCallBack&&t._changeCallBack(e,i)}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"displayNum",{get:function(){return this.num},enumerable:!0,configurable:!0}),t.prototype.setChangeCallBack=function(e,t){for(var i=[],r=2;r<arguments.length;r++)i[r-2]=arguments[r];this._changeCallBack=e.bind.apply(e,[t].concat(i))},t.prototype.stopChange=function(){this._stopChange=!0},Object.defineProperty(t.prototype,"longPressEnable",{get:function(){return this._longPressEnable},enumerable:!0,configurable:!0}),t.prototype.setLongPressEnable=function(e){var t=this;"boolean"==typeof e&&e!==t._longPressEnable&&(t._longPressEnable=e,t.addBtn&&(t.addBtn.longPressEnabled=e),t.minusBtn&&(t.minusBtn.longPressEnabled=e),t.addBtn_Ten&&(t.addBtn_Ten.longPressEnabled=e),t.minusBtn_Ten&&(t.minusBtn_Ten.longPressEnabled=e))},Object.defineProperty(t.prototype,"stepNum",{get:function(){return this._stepNum},set:function(e){"number"!=typeof e||isNaN(e)||e==this._stepNum||(this._stepNum=e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maximum",{get:function(){return this._maximum},set:function(e){if("number"==typeof e&&!isNaN(e)){var t=this;e!=t._maximum&&(t._maximum=e,t._minimum=Math.min(t._minimum,e),t.slider&&t.slider.maximum!=e&&(t.slider.maximum=e),t.num=NumberUtils.limit(t._num,t._minimum,t._maximum),t.sliderTF&&t.sliderTF.formatStr(t._num+"/"+t._maximum))}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"minimum",{get:function(){return this._minimum},set:function(e){if("number"==typeof e&&!isNaN(e)){var t=this;t._minimum!=e&&(t._minimum=e,t._maximum=Math.max(e,t.maximum),this.num=NumberUtils.limit(t.num,t.minimum,t.maximum))}},enumerable:!0,configurable:!0}),t.prototype.initUI=function(){this.setLongPressEnable(!1)},t.prototype.addUI=function(){var e=this;e.addBtn&&e.addBtn.setOnceHandler(e.onTapAdd,e),e.minusBtn&&e.minusBtn.setOnceHandler(e.onTapMinus,e),e.addBtn_Ten&&e.addBtn_Ten.setOnceHandler(e.onTapAdd_Ten,e),e.minusBtn_Ten&&e.minusBtn_Ten.setOnceHandler(e.onTapMinus_Ten,e),e.numLabelDisplay&&(e.numLabelDisplay.addEventListener(egret.Event.FOCUS_OUT,e.onFocusOut,e),e.numLabelDisplay.addEventListener(egret.Event.FOCUS_IN,e.onFocusIn,e)),e.addMaxBtn&&e.addMaxBtn.setOnceHandler(e.onTapMax,e),e.slider&&(e.slider.minimum=0,e.slider.maximum=e.maximum,e.slider.addEventListener(Evt.change,e.onSlider,e)),e.updateEditable()},t.prototype.onSlider=function(e){var t=this,i=t.slider.pendingValue;(i<t._minimum||i>t._maximum)&&(e.preventDefault(),i=Math.min(t._maximum,Math.max(t._minimum,i))),t.num=i,t.slider.value=i},t.prototype.onFocusOut=function(){if(this.numLabelDisplay){var e=+this.numLabelDisplay.text;this.num=e}},t.prototype.onFocusIn=function(){if(this.numLabelDisplay){var e=this.num;this.numLabelDisplay.text=e+""}},t.prototype.partAdded=function(t,i){e.prototype.partAdded.call(this,t,i);var r=this;i===r.numLabelDisplay?(r.numLabelDisplay.text=r.displayNum+"",r.numLabelDisplay.addEventListener(egret.Event.FOCUS_OUT,r.onFocusOut,r),r.numLabelDisplay.addEventListener(egret.Event.FOCUS_IN,r.onFocusIn,r)):i===r.addBtn?r.addBtn.setOnceHandler(r.onTapAdd,r):i===r.minusBtn?r.minusBtn.setOnceHandler(r.onTapMinus,r):i===r.addBtn_Ten?r.addBtn_Ten.setOnceHandler(r.onTapAdd_Ten,r):i===r.minusBtn_Ten&&r.minusBtn_Ten.setOnceHandler(r.onTapMinus_Ten,r)},t.prototype.partRemoved=function(t,i){e.prototype.partRemoved.call(this,t,i);var r=this;i===r.addBtn?r.addBtn.removeHandler():i===r.minusBtn?r.minusBtn.removeHandler():i===r.addBtn_Ten?r.addBtn_Ten.removeHandler():i===r.minusBtn_Ten&&r.minusBtn_Ten.removeHandler()},t.prototype.onTapMax=function(){this.num=this.maximum},t.prototype.onTapAdd=function(){this.num+=this.stepNum},t.prototype.onTapMinus=function(){this.num-=this.stepNum},t.prototype.onTapAdd_Ten=function(){this.num+=10*this.stepNum},t.prototype.onTapMinus_Ten=function(){this.num-=10*this.stepNum},t.prototype.removeUI=function(){var e=this;e.addBtn&&e.addBtn.removeHandler(),e.minusBtn&&e.minusBtn.removeHandler(),e.addBtn_Ten&&e.addBtn_Ten.removeHandler(),e.minusBtn_Ten&&e.minusBtn_Ten.removeHandler(),e.numLabelDisplay&&(e.numLabelDisplay.removeEventListener(egret.Event.FOCUS_OUT,e.onFocusOut,e),e.numLabelDisplay.removeEventListener(egret.Event.FOCUS_IN,e.onFocusIn,e)),e.slider&&e.slider.removeEventListener(Evt.change,e.onSlider,e),e._changeCallBack=null},t}(BaseView);__reflect(StepNumView.prototype,"StepNumView"),window.StepNumView=StepNumView;var SubPullRotationAction=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.checkEnd=function(t,i,r,n,a){if(!r){var o=this,s=o.owner,l=o.action,u=l.bullet,c=l.frame;if(c){var p=Fixed.value(c).mul(l.radianSpd).div(a).add(l.radian).value,d=Fixed.value(c).mul(l.radiusSpd).div(a).value;d=Fixed.value(l.radius).sub(d).max(0).value;var f=s.scene.limitX(Fixed.value(p).cos().mul(d).add(u.x).value),h=s.scene.limitY(Fixed.value(p).sin().mul(d).mul(-.5).add(u.y).value);s.updatePos(f,h,s.oz,s.right)}l.frame=c+1}e.prototype.checkEnd.call(this,t,i,r,n,a)},t}(SubAction);__reflect(SubPullRotationAction.prototype,"SubPullRotationAction"),window.SubPullRotationAction=SubPullRotationAction;var SubPullRowAction=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.checkEnd=function(t,i,r,n,a){if(!r){var o=this,s=o.owner,l=o.action,u=l.ctime;if(!l.stime||l.stime&&l.cstime<l.stime){var c=Fixed.value(t).div(a).value;if(l.cstime=Fixed.value(l.cstime).add(c).value,l.time<=u){var p=l.time=Fixed.value(l.time).add(c).value,d=Fixed.value(l.disy).sub(l.stopDis).value;if(l.disz||l.lastDisy<d){var f=Fixed.value(u).sub(p).value,h=Fixed.value(u).pow(3).value,v=l.useWeight?s.props.gv("weight"):50,m=Fixed.value(f).pow(2).mul(3).mul(1).mul(p).value;m=Fixed.value(p).pow(2).mul(3).mul(1).mul(f).add(m).value,m=Fixed.value(p).pow(3).mul(1).add(m).div(h).min(1).value;var y=Fixed.value(50).div(v).pow(1.25).min(1).value,g=0,b=0;if(l.disz){var x=Fixed.value(l.disz).mul(m).value;x=Fixed.value(x).mul(y).value,b=Fixed.value(x).sub(l.lastDisz).value,l.lastDisz=x}if(l.lastDisy<d){var I=Fixed.value(l.disy).mul(m).value;I=Fixed.value(I).mul(y).min(d).value,g=Fixed.value(I).sub(l.lastDisy).value,l.lastDisy=I}if(g||b){var _=s.scene.limitY(Fixed.value(g).mul(l.multiply).add(s.oy).value),S=Fixed.value(s.oz).add(b).value;s.updatePos(s.ox,_,S,s.right)}}}}}e.prototype.checkEnd.call(this,t,i,r,n,a)},t}(SubAction);__reflect(SubPullRowAction.prototype,"SubPullRowAction"),window.SubPullRowAction=SubPullRowAction;var TabBarItemNotch=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.isNotchTab=!0,t}return __extends(t,e),t}(TabBarImgItem);__reflect(TabBarItemNotch.prototype,"TabBarItemNotch"),window.TabBarItemNotch=TabBarItemNotch;var TabSwitch=function(e){function t(){var t=e.call(this)||this;return t.owner=void 0,t.viewList=[],t.viewData=[],t._selectIndex=-1,t.initGroup(),t}return __extends(t,e),Object.defineProperty(t.prototype,"curView",{get:function(){return this._curView},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"selectIndex",{get:function(){return this._selectIndex},set:function(e){if(e!==this._selectIndex){var t=this.viewList[e];t&&(this._curView&&this._curView.onHide(),t.index=e,t.data=this.viewData[e],this.owner&&(t.vo=this.owner.vo),t.onShow(),this._curView&&this.viewGroup.removeChild(this._curView),this._selectIndex=e,this._curView=t,this.viewGroup.addChild(t),this._tabBar&&(this._tabBar.selectedIndex=e),this.owner&&this.owner.onTabSwitchChange&&this.owner.onTabSwitchChange(e))}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"tabBar",{get:function(){return this._tabBar},set:function(e){e!==this._tabBar&&(this._tabBar&&this._tabBar.removeEventListener(egret.Event.CHANGE,this.onTabChange,this),this._tabBar=e,this._tabBar&&(this._tabBar.addEventListener(egret.Event.CHANGE,this.onTabChange,this),-1!=this.selectIndex?this._tabBar.selectedIndex=this.selectIndex:this.selectIndex=this._tabBar.selectedIndex))},enumerable:!0,configurable:!0}),t.prototype.update=function(){var e=this._curView;e&&e.isReady&&e.update()},t.prototype.setData=function(e){if(e&&e.length)for(var t=0,i=e.length;i>t;++t)this.setDatumByIndex(e[t],t)},t.prototype.setDatumByIndex=function(e,t){this.viewData[t]=e;var i=this.viewList[t];if(i){var r=i.data;i.data=e,i===this._curView&&i.isReady&&i.onDataChange(r)}},t.prototype.$onAddToStage=function(t,i){e.prototype.$onAddToStage.call(this,t,i);var r=this.tabBar;r&&r.addEventListener(egret.Event.CHANGE,this.onTabChange,this)},t.prototype.addChild=function(e,t){return this.addChildAt(e,-1,t)},t.prototype.addChildAt=function(e,t,i){if(void 0===i&&(i=0),e instanceof StackView&&1!==i&&3!==i)0>t?this.viewList.push(e):this.viewList.splice(t,0,e),e.owner=this;else switch(0===i&&(i=this.viewList.length?3:1),i){case 1:0>t?this.bottomGroup.addChild(e):this.bottomGroup.addChildAt(e,t);break;case 2:break;case 3:0>t?this.topGroup.addChild(e):this.topGroup.addChildAt(e,t)}return e},t.prototype.$onRemoveFromStage=function(){this.clear();var t=this.tabBar;t&&t.addEventListener(egret.Event.CHANGE,this.onTabChange,this),e.prototype.$onRemoveFromStage.call(this);for(var i=this.viewList.length,r=0;i>r;r++)UI.clearUIImageRef(this.viewList[r])},t.prototype.clear=function(){this._curView&&(this._curView.onHide(),this._curView.parent&&this._curView.parent.removeChild(this._curView),this._curView.data=void 0,this._curView=void 0),this._selectIndex=-1,this.viewData=[]},t.prototype.onDestroy=function(){this.clear(),this.viewData=[],this.removeChildren(),this.bottomGroup=void 0,this.viewGroup=void 0,this.topGroup=void 0},t.prototype.onTabChange=function(){this.selectIndex=this._tabBar.selectedIndex},t.prototype.initGroup=function(){this.bottomGroup||(this.bottomGroup=new eui.Group),this.viewGroup||(this.viewGroup=new eui.Group),this.topGroup||(this.topGroup=new eui.Group),this.bottomGroup.parent||e.prototype.addChild.call(this,this.bottomGroup),this.viewGroup.parent||e.prototype.addChild.call(this,this.viewGroup),this.topGroup.parent||e.prototype.addChild.call(this,this.topGroup),this.bottomGroup.left=this.bottomGroup.right=this.bottomGroup.top=this.bottomGroup.bottom=this.viewGroup.left=this.viewGroup.right=this.viewGroup.top=this.viewGroup.bottom=this.topGroup.left=this.topGroup.right=this.topGroup.top=this.topGroup.bottom=0,this.bottomGroup.touchEnabled=this.viewGroup.touchEnabled=this.topGroup.touchEnabled=!1},t}(eui.Group);__reflect(TabSwitch.prototype,"TabSwitch"),window.TabSwitch=TabSwitch;var UILabel=function(e){function t(){var t=e.call(this)||this;return t._zcode=0,t._format="",t._colorKey="",t._lMaxWidth=0,t.lMaxScale=0,t._format="",t}return __extends(t,e),Object.defineProperty(t.prototype,"zcode",{get:function(){return this._zcode},set:function(e){this._zcode=e,this._format=Msg.msg(e),this.formatStr()},enumerable:!0,configurable:!0}),t.prototype.formatStr=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var i=PHE.format(this._format,e);return this.textFlow=CommonUtils.rich(i),this.text},Object.defineProperty(t.prototype,"format",{get:function(){return this._format},set:function(e){this._format=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"colorKey",{get:function(){return this._colorKey},set:function(e){e&&(this._colorKey=e,this.textColor=login.ColorEnum[e])},enumerable:!0,configurable:!0}),t.prototype.setDiffText=function(e,t){void 0===t&&(t=!1),this._text!==e&&(this._text=e,t?this.textFlow=CommonUtils.rich(e):this.text=e)},Object.defineProperty(t.prototype,"lMaxWidth",{get:function(){return this._lMaxWidth},set:function(e){this._lMaxWidth=e,this.onResize(),e>0?this.addEventListener(Evt.resize,this.onResize,this):this.removeEventListener(Evt.resize,this.onResize,this)},enumerable:!0,configurable:!0}),t.prototype.onResize=function(){var e=1;this.width>this._lMaxWidth?(e=this.lMaxScale>0?this.lMaxScale:+(this._lMaxWidth/this.width).toFixed(2),this.scaleX=this.scaleY=e):this.scaleX=this.scaleY=1},t}(eui.Label);__reflect(UILabel.prototype,"UILabel"),window.UILabel=UILabel;var SubTemptAction=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.play=function(){e.prototype.play.call(this);var t=this.owner,i=this.action;this.frameCount=0,t&&(t.standLand(),t.scene&&t.scene.guise&&t.scene.guise.showPath(t,i.bullet))},t.prototype.doAction=function(e,t,i,r,n){var a=this;if(a.frameCount++,a.frameCount%20==0){var o=a.owner,s=a.action;o&&o.scene&&o.scene.guise&&o.scene.guise.updatePath(o,s.bullet)}},t.prototype.doMove=function(e,t,i,r,n){var a=this,o=a.owner,s=a.action,l=s.bullet;if(l){var u=Fixed.value(l.x).sub(o.x).abs().value,c=Fixed.value(l.y).sub(o.y).abs().value;if(u>0||c>0){o.updateSpdByPos(o.x,o.y,l.x,l.y);var p=o.ox,d=o.speedx;d>0?p=Fixed.value(o.ox).add(d).min(l.x).value:0>d&&(p=Fixed.value(o.ox).add(d).max(l.x).value);var f=o.oy,h=o.speedy;h>0?f=Fixed.value(o.oy).add(h).min(l.y).value:0>h&&(f=Fixed.value(o.oy).add(h).max(l.y).value),o.updatePos(o.scene.limitX(p),o.scene.limitY(f),o.z,d?d>0:o.right)}}},t.prototype.onDestroy=function(){var t=this.owner;t&&t.scene&&t.scene.guise&&t.scene.guise.hidePath(500),e.prototype.onDestroy.call(this)},t}(SubAction);__reflect(SubTemptAction.prototype,"SubTemptAction"),window.SubTemptAction=SubTemptAction;var BattleBossBuffItem=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.addUI=function(){},t.prototype.update=function(){var e=this.data,t=Data.getItem("BuffData",e.buffId),i=e.grade||0;this.icon.source="battle_buff_"+t.icon,this.num.text=i>1?i+"":""},t}(BaseItem);__reflect(BattleBossBuffItem.prototype,"BattleBossBuffItem"),window.BattleBossBuffItem=BattleBossBuffItem;var BattleBossPassiveItem=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.update=function(){var e=this.data;this.icon.source="battle_passive_"+e},t}(BaseItem);__reflect(BattleBossPassiveItem.prototype,"BattleBossPassiveItem"),window.BattleBossPassiveItem=BattleBossPassiveItem;var BattleBossSkillItem=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.update=function(){var e=this.data;this.icon.source="battle_skill_"+e},t}(BaseItem);__reflect(BattleBossSkillItem.prototype,"BattleBossSkillItem"),window.BattleBossSkillItem=BattleBossSkillItem;var BattlePlayerBuffItem=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.addUI=function(){},t.prototype.update=function(){var e=this.data,t=Data.getItem("BuffData",e.buffId),i=e.grade||0;this.icon.source="battle_buff_"+t.icon,this.num.text=i>1?i+"":""},t}(BaseItem);__reflect(BattlePlayerBuffItem.prototype,"BattlePlayerBuffItem"),window.BattlePlayerBuffItem=BattlePlayerBuffItem;var BattlePlayerPassiveItem=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.update=function(){var e=this.data;this.icon.source="battle_passive_"+e},t}(BaseItem);__reflect(BattlePlayerPassiveItem.prototype,"BattlePlayerPassiveItem"),window.BattlePlayerPassiveItem=BattlePlayerPassiveItem;var BattlePlayerSkillItem=function(e){function t(){var t=e.call(this)||this;return t.touchChildren=!1,t}return __extends(t,e),Object.defineProperty(t.prototype,"commands",{get:function(){return["c56","c57","c72","c107","c106","c74","c79","c67","c68","c105"]},enumerable:!0,configurable:!0}),t.prototype.command=function(e,t){var i=this,r=i.data;if(r&&r.owner)switch(e){case"c56":(t.skillId==r.skillId||r.isDodge&&t.skillId==r.owner.skill.escapeSkillId)&&i.updateSkill();break;case"c57":t.skillIds&&(-1!=t.skillIds.indexOf(r.skillId)||r.isDodge&&-1!=t.skillIds.indexOf(r.owner.skill.escapeSkillId))&&i.updateSkill();break;case"c72":r.isDodge?i.updateSkill():i.updateSkillState();break;case"c74":break;case"c79":break;case"c106":case"c107":t.caster==r.owner&&i.updateSkillState();break;case"c67":r&&r.owner&&t.rid==r.owner.prid&&i.updateSkillState();break;case"c68":t.rid==r.owner.prid&&i.update();break;case"c105":i.updatePause(t.pauseTime,t.pauseFrame)}},t.prototype.initUI=function(){var e=this;e.cdMaskItem=new MaskCDItem(e.cdItem.graphics,e.cdItem.width,!1,!1,e.cdTxt,null,0,"{$0}"),e.cdMaskItem.end()},t.prototype.addUI=function(){var e=this;e.addL(e,Evt.touchBegin,e.onItemTouchBegin)},t.prototype.update=function(){var e=this;e.data&&(e.skillGrp.visible=!0,e.updateSkill(),e.keyTxt.visible=!DeviceUtils.isMobile)},t.prototype.updateSkill=function(){var e=this,t=e.data;if(t){var i=t.owner;if(i&&i.agent){var r=i.skill,n=t.skillId,a=t.cfg,o=r.getCD(n),s=t.cd,l=i.scene.pauseFrame,u=i.agent.getSkillSlot(n);if(t.isDodge){var c=r.escapeSkillId,p=r.getSkillInfo(c),d=r.getCD(c);i.beControl?(e.icon.source="battle_skill_"+p.cfg.icon,d>0?(e.cdMaskItem.start(p.cd,d+egret.getTimer(),l),e.cdIcon.visible=!0,e.setIconAlpha(.5)):(e.cdMaskItem.end(),e.cdIcon.visible=!1,e.setIconAlpha(1))):(e.icon.source="battle_skill_"+a.icon,o>0?(e.cdMaskItem.start(s,o+egret.getTimer(),l),e.cdIcon.visible=!0,e.setIconAlpha(.5)):(e.cdMaskItem.end(),e.cdIcon.visible=!1,e.setIconAlpha(1)))}else if(e.icon.source="battle_skill_"+a.icon,o>0)e.cdMaskItem.start(s,o+egret.getTimer(),l),e.cdIcon.visible=!0,e.setIconAlpha(.5);else{var f=t.hasSub?r.getSubTime(n):null;f?e.setIconAlpha(.5):(e.cdMaskItem.end(),e.cdIcon.visible=!1,e.setIconAlpha(1))}switch(n){case 2:e.typeTxt.text="破甲";break;case 3:e.typeTxt.text="盾防"}switch(u.slotId){case 1:e.keyTxt.text="K";break;case 2:e.keyTxt.text="L";break;case 3:e.keyTxt.text="Y";break;case 4:e.keyTxt.text="U";break;case 5:e.keyTxt.text="I";break;case 6:e.keyTxt.text="O";break;case 7:e.keyTxt.text="P";break;case 8:e.keyTxt.text="T";break;case 9:e.keyTxt.text="B";break;case 10:e.keyTxt.text="N";break;case 11:e.keyTxt.text="M";break;case 99:e.keyTxt.text="H"}e.updateSkillState()}}},t.prototype.updateSkillState=function(){var e=this,t=e.data;if(t){var i=t.owner;if(i){var r=i.skill,n=t.isDodge&&i.beControl?r.escapeSkillId:t.skillId;e.setIconGray(!r.canUse(n))}}},t.prototype.updatePause=function(e,t){var i=this;e||t?i.cdMaskItem.pause():i.cdMaskItem.resume()},t.prototype.onItemTouchBegin=function(e){var t=this,i=t.data,r=i.owner;r&&ActionMgr.playerOp&&r.scene&&r.scene.isControl&&(t.touchId=e.touchPointID,t.removeL(t,Evt.touchBegin,t.onItemTouchBegin),t.addL(App.stage,Evt.touchEnd,t.onItemTouchEnd),egret.Tween.removeTweens(t.skillGrp),egret.Tween.get(t.skillGrp).to({scaleX:.9,scaleY:.9},200).to({scaleX:1.1,scaleY:1.1},200),r.skill.onTouchSkillBegin(i.isDodge&&r.beControl?r.skill.escapeSkillId:i.skillId,!0))},t.prototype.onItemTouchEnd=function(e){var t=this;if(t.touchId==e.touchPointID){t.addL(t,Evt.touchBegin,t.onItemTouchBegin),t.removeL(App.stage,Evt.touchEnd,t.onItemTouchEnd),egret.Tween.removeTweens(t.skillGrp),egret.Tween.get(t.skillGrp).to({scaleX:1.2,scaleY:1.2},200).to({scaleX:1,scaleY:1},200);var i=t.data;if(i){var r=i.owner;r&&r.skill&&r.skill.onTouchSkillEnd(i.isDodge&&r.beControl?r.skill.escapeSkillId:i.skillId,!1)}}},t.prototype.removeUI=function(){var e=this;e.data=null,e.touchId=-1,e.cdMaskItem.end(),egret.Tween.removeTweens(e.skillGrp),e.skillGrp.scaleX=e.skillGrp.scaleY=1},t.prototype.setIconAlpha=function(e){this.icon.alpha=e},t.prototype.setIconGray=function(e){this.icon.filters=e?FiltersUtils.GRAY_FILTERS:void 0},t}(BaseItem);__reflect(BattlePlayerSkillItem.prototype,"BattlePlayerSkillItem"),window.BattlePlayerSkillItem=BattlePlayerSkillItem;var MaskCDItem=function(e){function t(t,i,r,n,a,o,s,l){void 0===r&&(r=!1),void 0===n&&(n=!1),void 0===a&&(a=null),void 0===o&&(o=null),void 0===s&&(s=1),void 0===l&&(l="");var u=e.call(this)||this,c=u;return c._mask=t,c._sl=i,c._hl=c._sl>>1,c._anticlockwise=r,c._isRemain=n,c._cdTF=a,c._cdBar=o,c._fixed=s,c._msg=l,u}return __extends(t,e),t.prototype.start=function(e,t,i){var r=this;r.end();var n=t-egret.getTimer();0>=e||0>=t||0>=n||(r._total=e,r._endTime=t,r._remain=n,!i&&TimerManager.addCycleTask(100,r.enterFrame,r),r.update())},t.prototype.enterFrame=function(){var e=this,t=e._endTime-egret.getTimer();return 0>=t?void e.end():(e._remain=t,void e.update())},t.prototype.update=function(){var e=this,i=e._isRemain?e._remain:e._total-e._remain,r=2*Math.PI/e._total;e._radus=i*r,e._mask.clear(),e._mask.beginFill(t.COLOR,t.ALPHA),e._anticlockwise?e._radus<t._45?(e._y=0,e._x=e._hl-Math.tan(e._radus)*e._hl,e._mask.moveTo(e._hl,0),e._mask.lineTo(e._hl,e._hl),e._mask.lineTo(e._x,e._y),e._mask.lineTo(0,0),e._mask.lineTo(0,e._sl),e._mask.lineTo(e._sl,e._sl),e._mask.lineTo(e._sl,0),e._mask.lineTo(e._hl,0)):e._radus>=t._45&&e._radus<t._135?(e._x=0,e._y=e._hl-e._hl/Math.tan(e._radus),e._mask.moveTo(e._hl,0),e._mask.lineTo(e._hl,e._hl),e._mask.lineTo(e._x,e._y),e._mask.lineTo(0,e._sl),e._mask.lineTo(e._sl,e._sl),e._mask.lineTo(e._sl,0),e._mask.lineTo(e._hl,0)):e._radus>=t._135&&e._radus<t._225?(e._y=e._sl,e._x=e._radus>t._lt180&&e._radus<t._gt180?e._hl:e._hl+e._hl*Math.tan(e._radus),e._mask.moveTo(e._hl,0),e._mask.lineTo(e._hl,e._hl),e._mask.lineTo(e._x,e._y),e._mask.lineTo(e._sl,e._sl),e._mask.lineTo(e._sl,0),e._mask.lineTo(e._hl,0)):e._radus>=t._225&&e._radus<t._315?(e._x=e._sl,e._y=e._hl+e._hl/Math.tan(e._radus),e._mask.moveTo(e._hl,0),e._mask.lineTo(e._hl,e._hl),e._mask.lineTo(e._x,e._y),e._mask.lineTo(e._sl,0),e._mask.lineTo(e._hl,0)):e._radus>=t._315&&(e._y=0,e._x=e._hl-Math.tan(e._radus)*e._hl,e._mask.moveTo(e._hl,0),e._mask.lineTo(e._hl,e._hl),e._mask.lineTo(e._x,e._y),e._mask.lineTo(e._hl,0)):e._radus<t._45?(e._y=0,e._x=e._hl+Math.tan(e._radus)*e._hl,e._mask.moveTo(e._hl,0),e._mask.lineTo(e._hl,e._hl),e._mask.lineTo(e._x,e._y),e._mask.lineTo(e._sl,0),e._mask.lineTo(e._sl,e._sl),e._mask.lineTo(0,e._sl),e._mask.lineTo(0,0),e._mask.lineTo(e._hl,0)):e._radus>=t._45&&e._radus<t._135?(e._x=e._sl,e._y=e._hl-e._hl/Math.tan(e._radus),e._mask.moveTo(e._hl,0),e._mask.lineTo(e._hl,e._hl),e._mask.lineTo(e._x,e._y),e._mask.lineTo(e._sl,e._sl),e._mask.lineTo(0,e._sl),e._mask.lineTo(0,0),e._mask.lineTo(e._hl,0)):e._radus>=t._135&&e._radus<t._225?(e._y=e._sl,e._x=e._radus>t._lt180&&e._radus<t._gt180?e._hl:e._hl-e._hl*Math.tan(e._radus),e._mask.moveTo(e._hl,0),e._mask.lineTo(e._hl,e._hl),e._mask.lineTo(e._x,e._y),e._mask.lineTo(0,e._sl),e._mask.lineTo(0,0),e._mask.lineTo(e._hl,0)):e._radus>=t._225&&e._radus<t._315?(e._x=0,e._y=e._hl+e._hl/Math.tan(e._radus),e._mask.moveTo(e._hl,0),e._mask.lineTo(e._hl,e._hl),e._mask.lineTo(e._x,e._y),e._mask.lineTo(0,0),e._mask.lineTo(e._hl,0)):e._radus>=t._315&&(e._y=0,e._x=e._hl+Math.tan(e._radus)*e._hl,e._mask.moveTo(e._hl,0),e._mask.lineTo(e._hl,e._hl),e._mask.lineTo(e._x,e._y),e._mask.lineTo(e._hl,0)),e._mask.endFill(),e.viewCdInfo()},t.prototype.viewCdInfo=function(){var e=this;if(e._cdTF||e._cdBar){var t=Math.max(0,e._remain);if(e._cdTF){var i=Math.ceil(t/1e3*10)/10,r=i.toFixed(e._fixed);e._msg&&(r=PHE.format(e._msg,[r])),e._cdTF.text=r}e._cdBar&&(e._cdBar.maximum=e._total,e._cdBar.value=t)}},t.prototype.end=function(){var e=this;TimerManager.removeTask(e.hashCode),e._total=0,e._remain=0,e._mask&&e._mask.clear(),e._cdTF&&(e._cdTF.text="")},t.prototype.pause=function(){TimerManager.removeTask(this.hashCode)},t.prototype.resume=function(){var e=this;e._total&&e._remain&&e.start(e._total,e._remain+egret.getTimer(),!1)},t.prototype.dispose=function(){this.end(),this._mask=null,this._cdTF=null},t.COLOR=0,t.ALPHA=1,t._45=.25*Math.PI,t._135=.75*Math.PI,t._225=1.25*Math.PI,t._315=1.75*Math.PI,t._360=2*Math.PI,t._gt180=180.1*Math.PI/180,t._lt180=179.9*Math.PI/180,t}(egret.HashObject);__reflect(MaskCDItem.prototype,"MaskCDItem"),window.MaskCDItem=MaskCDItem;var NormalBattleUI=function(e){function t(){var t=e.call(this)||this;return t.skinName="NormalBattleSkin",t}return __extends(t,e),Object.defineProperty(t.prototype,"commands",{get:function(){return["c85","c87","c61","c59","c66","c103","c99","c70","c71","c74","c79","c83","c107","c72","c106","c111","c67","c68","c96"]},enumerable:!0,configurable:!0}),t.prototype.command=function(e,t){switch(e){case"c85":this.updateDisk(),this.updatePlayerSkill();break;case"c87":t.agent&&t.agent.hold&&ActionMgr.exit(this.room);break;case"c61":t.avatar&&t.avatar.hold&&this.update();break;case"c99":this.updateBoss();break;case"c59":var i=t.target,r=t.changedKeys,n="hp"in r,a="maxHp"in r;if(this.boss==i&&(n||a)){var o=i.props.gv("hp");this.updateBossHp(!1,n?r.hp:o,o)}break;case"c66":this.boss==t.target&&this.updateBossHp(!1,0,0);break;case"c103":this.boss&&this.boss.$eid==t.eid&&this.updateBossBuff();break;case"c70":this.updatePlayerSkill();break;case"c71":t.owner instanceof Avatar&&this.updatePlayerSkill();break;case"c61":t.avatar&&t.avatar.hold&&this.updatePlayerSkill();break;case"c111":this.updatePlayerSkill();break;case"c68":t.target&&t.target.hold&&this.updatePlayerSkill();break;case"c67":t.target&&t.target.hold&&this.updatePlayerSkill();break;case"c96":var s=JSON.parse(t);1==s.type?this.onBattleWin():this.onBattleFail()}},t.prototype.initUI=function(){e.prototype.initUI.call(this),this.bossBuffColl=new eui.ArrayCollection,this.bossBuffList.dataProvider=this.bossBuffColl,this.bossBuffList.itemRenderer=BattleBossBuffItem,this.bossPassiveColl=new eui.ArrayCollection,this.bossPassiveList.dataProvider=this.bossPassiveColl,this.bossPassiveList.itemRenderer=BattleBossPassiveItem,this.bossSkillColl=new eui.ArrayCollection,this.bossSkillList.dataProvider=this.bossSkillColl,this.bossSkillList.itemRenderer=BattleBossSkillItem,this.playerPassiveColl=new eui.ArrayCollection,this.playerPassiveList.dataProvider=this.playerPassiveColl,this.playerPassiveList.itemRenderer=BattlePlayerPassiveItem,this.playerSkillColl=new eui.ArrayCollection,this.playerSkillList.dataProvider=this.playerSkillColl,this.playerSkillList.itemRenderer=BattlePlayerSkillItem
},t.prototype.addUI=function(){e.prototype.addUI.call(this),this.battleGrp.visible=!0,this.pickupGrp.visible=!1,this.exitGrp.visible=!1,this.addL(this.exitBtn,Evt.touchTap,this.onExitTap),this.addL(this.bossTipBtn,Evt.touchTap,this.onBossTipTap),this.addL(this.pickupBtn,Evt.touchTap,this.onPickupTap),this.addL(this.exitBtn,Evt.touchTap,this.onExitTap)},t.prototype.update=function(){e.prototype.update.call(this),this.updateDisk(),this.updateBoss(),this.updatePlayerSkill()},t.prototype.updateDisk=function(){var e=this,t=e.room;t&&t.player&&t.player.avatar&&ActionMgr.startBattle(e.room,e.diskItem,e.diskRect,e.diskGrp,e.diskBg,e.disk)},t.prototype.updateBoss=function(){var e=this.room.monsterList[0];if(e&&!e.$isRemoved){this.boss=e,GameStatic.target=e;var t=e.props.gv("hp");this.bossLvTxt.text="Lv."+e.level,this.bossNameTxt.text=e.heroCfg.name,this.updateBossHp(!0,t,t),this.updateBossBuff(),this.replace(this.bossPassiveColl,[161,162],!0),this.replace(this.bossSkillColl,[102,103],!0)}},t.prototype.updateBossHp=function(e,t,i){var r=GameStatic.target,n=r.props.gv("maxHp"),a=r instanceof Monster?Data.getMonsterHpNum(r.type,n):1;e&&(this.bossHpBar.maximum=n,this.bossHpBar.value=t,this.bossHpBar.initialize(5,1,[2,3,4],a)),this.bossHpBar.change(i)},t.prototype.updateBossBuff=function(){if(this.boss&&this.boss.buff){var e=this.boss.buff.getShowBuffs();e=e.reverse(),this.replace(this.bossBuffColl,e)}},t.prototype.updatePlayerSkill=function(){var e=this,t=e.room.player;if(t){var i=t.avatar;if(i){var r=i.skill,n=[];if(e.room instanceof RelayRoom&&e.room.isPetSally)for(var a=i.heroCfg.skill||[],o=1;12>o;o++)n.push(r.getSkillInfo(a[o-1]));else if(i.transHeroId)for(var s=i.transHeroCfg.skill||[],o=1;12>o;o++)n.push(r.getSkillInfo(s[o-1]));else for(var o=1;12>o;o++){var l=t.getSkillSlotId(o);n.push(l?r.getSkillInfo(l.skillId):null)}n.push(r.getSkillInfo(r.dodgeSkillId)),n.length=2,e.replace(e.playerSkillColl,n),e.replace(e.playerPassiveColl,[1,2,3],!0)}}},t.prototype.onExitTap=function(){Player["in"].restartEnterRoom(1,1)},t.prototype.onBossTipTap=function(){},t.prototype.onBattleWin=function(){this.battleGrp.visible=!1,this.pickupGrp.visible=!0,this.exitGrp.visible=!1,this.dropGrp.visible=!0},t.prototype.onBattleFail=function(){this.battleGrp.visible=!1,this.pickupGrp.visible=!1,this.exitGrp.visible=!0,this.dropGrp.visible=!1},t.prototype.onPickupTap=function(){this.pickupGrp.visible=!1,this.exitGrp.visible=!0,this.dropImg.alpha=1,this.dropImg.scaleX=0,this.dropImg.scaleY=0,this.dropImg.y=0;var e=this.gt(this.dropImg);e.to({scaleX:1,scaleY:1},500,egret.Ease.backOut),e.wait(5e3),e.to({y:-300,alpha:0},2e3,egret.Ease.circOut)},t.prototype.removeUI=function(){ActionMgr.exit(this.room),this.boss=null,e.prototype.removeUI.call(this)},t}(PvEBattleUI);__reflect(NormalBattleUI.prototype,"NormalBattleUI"),window.NormalBattleUI=NormalBattleUI;var TransUpAction=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.checkEnd=function(t,i,r,n,a){e.prototype.checkEnd.call(this,t,i,r,n,a);var o=this;if(!r&&2!=o.status){var s=o.owner,l=o.action,u=l.nspy;if(0>u)return void(o.status=2);var c=Fixed.value(2).mul(60).mul(a).value,p=Fixed.value(160).mul(a).value;p=Fixed.value(u).mul(2).sub(p).div(c).add(s.oz).max(0).value,c=Fixed.value(160).div(a).value,l.nspy=Fixed.value(u).sub(c).value,s.updatePos(s.ox,s.oy,p,s.right),l.nspy<0&&(o.status=2)}},t}(SubAction);__reflect(TransUpAction.prototype,"TransUpAction"),window.TransUpAction=TransUpAction;var CityActTipsGroup=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.commands=["c256","c726"],t}return __extends(t,e),t.prototype.command=function(e,t){var i=this;switch(e){case"c726":i.updateGroup();break;case"c256":}},t.prototype.initUI=function(){this.itemMap={}},t.prototype.addUI=function(){var e=this;e.updateGroup()},t.prototype.updateGroup=function(){var e=this,t=this,i=Data.getData("ActivityTipsData");i.forEach(function(i,r){var n=e.getItem(i);t.itemGrp.addChildAt(n,r)})},t.prototype.getItem=function(e){var t=this.itemMap[e.id];return t||(t=new CityActTipsItem,t.data=e,this.itemMap[e.id]=t),t},t}(BaseView);__reflect(CityActTipsGroup.prototype,"CityActTipsGroup"),window.CityActTipsGroup=CityActTipsGroup;var CityActTipsItem=function(e){function t(){var t=e.call(this)||this;return t.nextUpdateTime=0,t.status=0,t.commands=["c256","c726"],t.skinName="CityActTipsItemSkin",t}return __extends(t,e),t.prototype.command=function(e,t){var i=this;switch(e){case"c726":i.updateItem();break;case"c256":t.funcId&&i.data&&i.data.funcID==t.funcId&&i.updateItem()}},t.prototype.addUI=function(){var e=this;e.addTap(e,e.tapLink),e.addCycle(1e3,e.countTime)},t.prototype.countTime=function(){var e=this;if(this.nextUpdateTime){var t=Math.round(Math.max(0,(e.nextUpdateTime-DateUtils.serverNow)/1e3));e.timeGrp.visible&&(e.timeLab.text=DateUtils.formatShortDigitTimespan(t)),0>=t&&this.updateItem()}},t.prototype.update=function(){this.updateItem()},t.prototype.updateItem=function(){var e=this,t=e.data.funcID;e.icon.source="city_func_open_"+t,e.addEff(e.lightEff,"422",Urls.uieff(),"idle",0,!0),e.addEff(e.tipEff,"413",Urls.uieff(),"saoguang",0,!0),e.updateTime()},t.prototype.updateTime=function(){var e=this;if(e.status=0,e.data){e.openSeasonTriggerCycle(!0);var t=!0;if(e.data.seasonCycles){t=!1;for(var i=e.data.seasonCycles,r=0;r<i.length;r++){var n=i[r];t||(t=CronUtils.checkIsInCycle(n))}}if(!t)return e.nextUpdateTime=0,void(e.visible=e.includeInLayout=!1);if(e.data.cId2&&!CronUtils.checkIsInCycle(e.data.cId2))return void(e.visible=e.includeInLayout=!1);if(e.data.cycles){for(var a=e.data.cycles,o=0,s=0,r=0;r<a.length;r++){var n=a[r];o=o?Math.min(o,CronUtils.getNextTime(n)):CronUtils.getNextTime(n),s=Math.max(CronUtils.getEndTime(n,null,null,null,e.data.duration),s)}if(s)return e.nextUpdateTime=s,e.visible=e.includeInLayout=e.checkFuncPlaying(e.data.funcID),e.timeGrp.visible=!1,e.tipGrp.visible=!0,void(e.status=1);var l=e.data.time;if(o-DateUtils.serverNow<1e3*l)return e.status=2,e.nextUpdateTime=o,e.visible=e.includeInLayout=e.checkFuncPlaying(e.data.funcID),e.timeGrp.visible=!0,void(e.tipGrp.visible=!1);e.nextUpdateTime=o-1e3*l,e.timeGrp.visible=!1,e.visible=e.includeInLayout=!1}}},t.prototype.checkFuncPlaying=function(e){return!1},t.prototype.checkActOpen=function(e){},t.prototype.tapLink=function(){},t.prototype.openSeasonTriggerCycle=function(e){},t.prototype.removeUI=function(){var e=this;e.openSeasonTriggerCycle(!1)},t}(BaseItem);__reflect(CityActTipsItem.prototype,"CityActTipsItem"),window.CityActTipsItem=CityActTipsItem;var CityBanner=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.setBannerIndex=function(e,t){},t}(core.Banner);__reflect(CityBanner.prototype,"CityBanner"),window.CityBanner=CityBanner;var CityBannerItem=function(e){function t(){return e.call(this)||this}return __extends(t,e),Object.defineProperty(t.prototype,"commands",{get:function(){return["c555","c554","c553"]},enumerable:!0,configurable:!0}),t.prototype.command=function(e,t){var i=this,r=i.data;if(r)switch(e){case"c555":1701==r.type&&!t.code&&t.id==r.actId&&t.pageChange&&i.update();break;case"c554":1701==r.type&&-1!=t.crossDayIds.indexOf(r.actId)&&i.update();break;case"c553":t.id==r.actId&&i.update()}},t.prototype.update=function(){var e=this;if(e.data)switch(e.data.type){case 1701:e.updateSevenLogin();break;case 1801:e.updateSevenCarnial();break;default:e.updateOther()}},t.prototype.updateSevenLogin=function(){},t.prototype.updateSevenCarnial=function(){},t.prototype.updateOther=function(){},t.prototype.clearSevenLogin=function(){var e=this;e.sevenLoginGrp.visible=!1,e.dayIcon1.source=null,e.dayIcon2.source=null},t}(BaseItem);__reflect(CityBannerItem.prototype,"CityBannerItem"),window.CityBannerItem=CityBannerItem;var CityChatItem=function(e){function t(){var t=e.call(this)||this;return t.skinName="CityChatItemSkin",t}return __extends(t,e),t.prototype.initUI=function(){var e=this;e.txt.maxW=400,e.txt.touchEnabled=!1,e.txt.touchChildren=!1,e.txt.lineSpacing=-5,e.txt.oneLine=!0,e.txt.emoSizeEqualLabel=!0,e.touchEnabled=!1},t.prototype.setOneLine=function(e){this.txt.oneLine=e},t.prototype.setTxtMaxW=function(e){this.txt.maxW=e},t.prototype.addUI=function(){var e=this;e.addL(e,Evt.touchTap,e.onClick)},t.prototype.onClick=function(e){},t.prototype.update=function(){},t}(BaseItem);__reflect(CityChatItem.prototype,"CityChatItem"),window.CityChatItem=CityChatItem;var CityConvActionItem=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.update=function(){this.icon.source="emotion_action_"+this.data.face,this.text.text=this.data.label},t}(BaseItem);__reflect(CityConvActionItem.prototype,"CityConvActionItem"),window.CityConvActionItem=CityConvActionItem;var CityConvEmotionItem=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.update=function(){this.icon.source=this.data.face},t}(BaseItem);__reflect(CityConvEmotionItem.prototype,"CityConvEmotionItem");var CityConvInfo=function(){function e(){}return e}();__reflect(CityConvInfo.prototype,"CityConvInfo"),window.CityConvEmotionItem=CityConvEmotionItem,window.CityConvInfo=CityConvInfo;var CityConvPanel=function(e){function t(){var t=e.call(this)||this,i=t;return i.fullScreen=!1,i.adaptation=!1,i.modal=!0,i.autoClose=!0,i.layerIndex=4,i.skinName="CityConvPanelSkin",t}return __extends(t,e),Object.defineProperty(t.prototype,"commands",{get:function(){return[]},enumerable:!0,configurable:!0}),t.prototype.command=function(e,t){},t.prototype.initUI=function(){var e=this;e.emotionList.dataProvider=e.emotionColl=new eui.ArrayCollection,e.emotionList.itemRenderer=CityConvEmotionItem,e.actionList.dataProvider=e.actionColl=new eui.ArrayCollection,e.actionList.itemRenderer=CityConvActionItem},t.prototype.addUI=function(){var e=this;e.addL(e.emotionList,Evt.itemTap,e.onItemClick),e.addL(e.actionList,Evt.itemTap,e.onItemClick)},t.prototype.onOpen=function(){e.prototype.onOpen.call(this),this.data=this.vo.params},t.prototype.update=function(){var e=this;e.text.textFlow=Msg.rich(7008,e.data.name);Data.getChangeAttrMap;this.replace(this.emotionColl,Data.getCityConvEmotion()),this.replace(this.actionColl,Data.getCityConvAction())},t.prototype.onItemClick=function(e){var t=SceneMgr.scene;t instanceof MainCity&&t.player.reqCityConv(e.item.id,this.data.rid),this.close()},t.prototype.removeUI=function(){},t}(BaseUI);__reflect(CityConvPanel.prototype,"CityConvPanel"),window.CityConvPanel=CityConvPanel;var CityConvTalk=function(e){function t(){var t=e.call(this)||this;return t.duration=3e3,t.skinName="CityConvTalkSkin",t}return __extends(t,e),t.prototype.clear=function(){var e=this;e.parent&&e.parent.removeChild(e)},t.prototype.onFadeOut=function(){this.clear()},t.prototype.dispose=function(){var e=this;e.clear(),ObjectPool.push(e)},t.prototype.updateText=function(e,t){var i=this,r=Data.getItem("CityConvData",e)||{};1==r.type?i.icon.source=r.face:i.icon.source="emotion_action_"+r.face,i.text.text=t,i.anchorOffsetX=i.width/2,i.anchorOffsetY=i.height,i.gt(i).wait(i.duration,!0).call(i.dispose,i)},t}(BaseView);__reflect(CityConvTalk.prototype,"CityConvTalk"),window.CityConvTalk=CityConvTalk;var CityDownloadView=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._isStop=!1,t}return __extends(t,e),t.prototype.initUI=function(){var e=this;e.visible=!1},t.prototype.addUI=function(){var e=this;NativeCon["in"].addListener("updateBehindDownloadInfo",e.updateDownloadInfo,e),GameSDK.getBehindDownloadInfo()},t.prototype.updateDownloadInfo=function(e){var t=JSON.parse(e),i=this;i.setDownloadInfo(t)},t.prototype.setDownloadInfo=function(e){return e?(this.visible=!e.isDownloadFinished,void(e.isDownloadFinished||(this.bar.value=Math.floor(e.dlProgress),this.speed.text=this._unitConversion(e.speed)+"/S",this.total.text=this._unitConversion(e.totalSize)))):void(this.visible=!1)},t.prototype["switch"]=function(){var e=this;e._isStop?e._open():e._push(),e.bg.source=e._isStop?"city_download_stop":"city_download"},t.prototype._open=function(){this._isStop=!1,this.total.visible=!0,this.speed.visible=!0,GameSDK.openBehindDownload()},t.prototype._push=function(){this._isStop=!0,this.total.visible=!1,this.speed.visible=!1,GameSDK.pushBehindDownload()},t.prototype._unitConversion=function(e){if(isNaN(e)||0==e)return"0B";var t=["B","KB","MB","GB"],i=Math.floor(Math.log(e)/Math.log(1024));return(e/Math.pow(1024,i)).toFixed(2)+t[i]},t.prototype.removeUI=function(){NativeCon["in"].removeListener("updateBehindDownloadInfo",this.updateDownloadInfo,this)},t}(BaseView);__reflect(CityDownloadView.prototype,"CityDownloadView"),window.CityDownloadView=CityDownloadView;var CityExchangeView=function(e){function t(){var t=e.call(this)||this;return t.skinName="CityExchangeViewSkin",t.autoClose=!0,t.layerIndex=5,t.scaleAnimation=!0,t.defaultVisible=!1,t}return __extends(t,e),Object.defineProperty(t.prototype,"commands",{get:function(){return["c44"]},enumerable:!0,configurable:!0}),t.prototype.command=function(e,t){switch(e){case"c44":(1==t.currencyType||2==t.currencyType)&&this.updateOwnCurrency()}},t.prototype.onOpen=function(){e.prototype.onOpen.call(this);var t=this.exchangeType=this.vo.params.type;2==t?this.currentState="gold":3==t&&(this.currentState="bindGold")},t.prototype.update=function(){var e=this;egret.callLater(function(){e.updateOwnCurrency(),e.updateGainTxt()},this)},t.prototype.updateOwnCurrency=function(){},t.prototype.initUI=function(){var e=this;e.ownTxt.setIconWH(31,30).setTextH(22).setGap(5).setTextColor(0),e.gainTxt.setIconWH(31,30).setTextH(22).setGap(5).setTextColor(0),e.panel&&(e.panel.owner=e),e.stepView.editable=!0,e.stepView.stepNum=1e3},t.prototype.addUI=function(){var e=this;e.addL(e.btnCancel,Evt.touchTap,e.onCancel),e.addL(e.btnExchange,Evt.touchTap,e.onExchange),e.addL(e.btnClose,Evt.touchTap,e.onCancel),e.stepView.setChangeCallBack(e.updateGainTxt,e),e.stepView.num=1},t.prototype.onCancel=function(){this.close()},t.prototype.onExchange=function(){},t.prototype.updateGainTxt=function(){},t}(BaseUI);__reflect(CityExchangeView.prototype,"CityExchangeView"),window.CityExchangeView=CityExchangeView;var CityLineItem=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.update=function(){this.labelDisplay.text=Msg.phe(7005,this.data.lineId)},t}(BaseItem);__reflect(CityLineItem.prototype,"CityLineItem"),window.CityLineItem=CityLineItem;var CityNpcTarget=function(e){function t(){var t=e.call(this)||this;return t.skinName="CityNpcTargetSkin",t.enabled=!1,t}return __extends(t,e),Object.defineProperty(t.prototype,"commands",{get:function(){return[CommonUtils.getKey("c333",13),"c138","c137","c139","c136","c21","c22"]},enumerable:!0,configurable:!0}),t.prototype.command=function(e,t){switch(e){case CommonUtils.getKey("c333",13):case"c138":case"c137":case"c139":case"c136":this.update()}},t.prototype.initUI=function(){var e=this;e.anchorOffsetX=e.width,e.anchorOffsetY=.5*e.height},t.prototype.update=function(){},t.prototype.updateItem=function(e){void 0===e&&(e=!0)},t.prototype.show=function(e,t){void 0===t&&(t=!0);var i=this;e?(i.updateItem(t),t?(i.right=0/0,i.left=28):(i.left=0/0,i.right=28)):i.visible=!1},t.prototype.removeUI=function(){},t}(core.BaseItem);__reflect(CityNpcTarget.prototype,"CityNpcTarget"),window.CityNpcTarget=CityNpcTarget;var CityPetItem=function(e){function t(){return e.call(this)||this}return __extends(t,e),Object.defineProperty(t.prototype,"commands",{get:function(){return["c49"]},enumerable:!0,configurable:!0}),t.prototype.command=function(e,t){if("c49"==e){var i=this,r=i.data.petId;if(r==t.now||r==t.old){var n=r==t.now;i.sign.visible=n,i.showBtn.visible=!n}}},t.prototype.initUI=function(){this.showBtn.sound="UI_Shl_Change"},t.prototype.addUI=function(){this.addL(this.showBtn,Evt.touchTap,this.onShowTap)},t.prototype.update=function(){},t.prototype.onShowTap=function(){},t}(BaseItem);__reflect(CityPetItem.prototype,"CityPetItem"),window.CityPetItem=CityPetItem;var CityPowerBar=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.barList=[],t}return __extends(t,e),t.prototype.initUI=function(){for(var e=this.barList=[this.bar_0,this.bar_1,this.bar_2,this.bar_3,this.bar_4,this.bar_5],t=0,i=e;t<i.length;t++){var r=i[t];r.slideDuration=0,r.maximum=1e4}},t.prototype.setData=function(e,t){e=e>=1?e:1,t=t>e?e:t;for(var i=this.barList,r=i.length,n=e/r,a=Math.ceil(t/n)-1,o=t%n/n,s=0;r>s;++s){var l=i[s];l&&(a>s?l.value=1e4:s===a?l.value=1e4*o:l.value=0)}},t}(BaseView);__reflect(CityPowerBar.prototype,"CityPowerBar"),window.CityPowerBar=CityPowerBar;var CityPowerInfoTip=function(e){function t(){var t=e.call(this)||this;return t.skinName="CityPowerInfoTipSkin",t}return __extends(t,e),t.prototype.addUI=function(){this.onTick()},t.prototype.onTick=function(){},t.getTimeString=function(e){var t=Math.floor(e/3600);e%=3600;var i=Math.floor(e/60);return e%=60,""+(9>=t?"0":"")+t+":"+(9>=i?"0":"")+i+":"+(9>=e?"0":"")+e},t}(BaseMenu);__reflect(CityPowerInfoTip.prototype,"CityPowerInfoTip"),window.CityPowerInfoTip=CityPowerInfoTip;var CityRenameUI=function(e){function t(){var t=e.call(this)||this;return t.commands=["c127","c126"],t.aniDuration=250,t.skinName="CityRenameSkin",t.layerIndex=4,t.adaptation=!1,t.fullScreen=!0,t.modalAlpha=0,t.isScene=!0,t}return __extends(t,e),t.prototype.command=function(e,t){switch(e){case"c127":this.nameL.text=t.name||"";break;case"c126":t.ret?this.userControl(!0):this.upNameEffect()}},t.prototype.onOpen=function(){e.prototype.onOpen.call(this)},t.prototype.addUI=function(){this.addTap([this.randomBtn,this.nameBtn],[this.onRandomTap,this.onNameTap]),this.addName(this.nameBtn,"CityRenameUI.nameBtn"),this.fillOut=new core.FillOutShader(void 0,"x",!1),this.fillOut.initialize({scale:-1,t:0,edge:.2}),this.nameEffectLabel.filters=[this.fillOut.filter]},t.prototype.update=function(){this.userControl(!0),this.addEff(this.eBound,"141",Urls.uieff(),"idle_1",0,!0,!1,!0),this.bgImg.source=Urls.uibg("city_rename_bg")},t.prototype.userControl=function(e){this.nameL.touchEnabled=this.randomBtn.enabled=this.nameBtn.enabled=e,this.nameBtn.filters=this.randomBtn.filters=e?null:FiltersUtils.GRAY_FILTERS},t.prototype.onRandomTap=function(){Player["in"].hall.getCityName()},t.prototype.onNameTap=function(){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(t){return e=this.nameL.text,e?e.length>3?(Prompt.msgId(7028),[2]):[2]:(Prompt.msgId(7009),[2])})})},t.prototype.upNameEffect=function(){},t.prototype.onCityNamed=function(){this.close()},t}(BaseUI);__reflect(CityRenameUI.prototype,"CityRenameUI"),window.CityRenameUI=CityRenameUI;var CityTaskBtn=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t}(UIButton);__reflect(CityTaskBtn.prototype,"CityTaskBtn"),window.CityTaskBtn=CityTaskBtn;var CityUI=function(e){function t(){var t=e.call(this)||this;t.total=0,t.times1=0,t.times2=0;var i=t;return i.fullScreen=!1,i.adaptation=!0,i.modal=!1,i.soundEnabled=!1,i.layerIndex=1,i.skinName="CitySkin",i.touchEnabled=!1,i.isScene=!0,t}return __extends(t,e),t.prototype.addUI=function(){this.city=this.vo.params.scene,this.addL(this.startBtn,Evt.touchTap,this.onStartTap),this.addL(this.tipBtn,Evt.touchTap,this.onTipTap),this.addL(this.closeBtn,Evt.touchTap,this.onCloseTap),this.addL(this.payBtn1,Evt.touchTap,this.onPayTap1),this.addL(this.payBtn2,Evt.touchTap,this.onPayTap2),this.addL(this.disconnectBtn,Evt.touchTap,this.onDisconnectTap)},t.prototype.update=function(){var e=this;ActionMgr.startCity(e.city,e.diskItem,e.diskRect,e.diskGrp,e.diskBg,e.disk),e.tipGrp.visible=!1,e.updateGold(),e.updateAddress()},t.prototype.onStartTap=function(){Player["in"].enterRoom(1,1)},t.prototype.onTipTap=function(){this.tipGrp.visible=!0},t.prototype.onCloseTap=function(){this.tipGrp.visible=!1},t.prototype.onPayTap1=function(){console.log("点击充值0.001TON"),this.payTon("testnet",.001)},t.prototype.onPayTap2=function(){console.log("点击充值0.002TON"),this.payTon("testnet",.002)},t.prototype.onDisconnectTap=function(){TonPayMgr.disconnect()},t.prototype.payTon=function(e,t){return __awaiter(this,void 0,void 0,function(){var i;return __generator(this,function(r){switch(r.label){case 0:return[4,TonPayMgr.pay(e,t)];case 1:return i=r.sent(),console.log("充值"+t+"TON结果："+i),0==i&&(.001==t?(this.total+=1e3,this.times1+=1):.002==t&&(this.total+=2e3,this.times2+=1),this.updateGold()),[2]}})})},t.prototype.updateGold=function(){this.totalTxt.text="金币:"+this.total,this.timesTxt1.text="成功次数:"+this.times1,this.timesTxt2.text="成功次数:"+this.times2},t.prototype.updateAddress=function(){var e=TonPayMgr.connectedWallet;if(e){var t=new window.TonWeb.Address(e.account.address);this.disconnectBtn.visible=!0,this.addressTxt.text="钱包地址：\n"+t.toString(!0,!0,!1)}else this.disconnectBtn.visible=!1,this.addressTxt.text="钱包地址：\n未连接钱包"},t}(BaseUI);__reflect(CityUI.prototype,"CityUI"),window.CityUI=CityUI;var FuncGroup=function(e){function t(){var t=e.call(this)||this;return t.isSkinReady=!0,t.touchEnabled=!1,t}return __extends(t,e),t.prototype.removeUI=function(){},t}(BaseView);__reflect(FuncGroup.prototype,"FuncGroup"),window.FuncGroup=FuncGroup;var UnderLandAction=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.play=function(){e.prototype.play.call(this),this.owner.ai.trig(16)},t}(SubAction);__reflect(UnderLandAction.prototype,"UnderLandAction"),window.UnderLandAction=UnderLandAction;var FuncRedItem=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t}(FuncItem);__reflect(FuncRedItem.prototype,"FuncRedItem"),window.FuncRedItem=FuncRedItem;var FuncSkin=function(e){function t(){var t=e.call(this)||this;return t.skinName="FuncSkinSkin",t}return __extends(t,e),t}(FuncItem);__reflect(FuncSkin.prototype,"FuncSkin"),window.FuncSkin=FuncSkin;var FuncTargetSysItem=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t}(BaseItem);__reflect(FuncTargetSysItem.prototype,"FuncTargetSysItem"),window.FuncTargetSysItem=FuncTargetSysItem;var FuncTimeItem=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t}(FuncItem);__reflect(FuncTimeItem.prototype,"FuncTimeItem"),window.FuncTimeItem=FuncTimeItem;var CityHellProItem=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.update=function(){this.onImg.visible=this.data},t}(BaseItem);__reflect(CityHellProItem.prototype,"CityHellProItem"),window.CityHellProItem=CityHellProItem;var CityHellView=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t}(BaseView);__reflect(CityHellView.prototype,"CityHellView"),window.CityHellView=CityHellView;var TonAPI=function(){function e(){}return e.getTransactionByHashHex=function(e){return __awaiter(this,void 0,void 0,function(){var t,i,r,n,a;return __generator(this,function(o){switch(o.label){case 0:return t=window.TonWeb,i=t.boc.Cell.oneFromBoc(t.utils.base64ToBytes(e)),[4,i.hash()];case 1:return r=o.sent(),n=t.utils.bytesToBase64(r),a=t.utils.bytesToHex(r),console.log("hashHex："+a),a="4725a2e3dea949fb17037d59cbd7d72c6e349ceaadbecbeb3d4deca7ca71e1e1",HttpMgr.send("https://tonapi.io/v2/blockchain/transactions/"+a,null,egret.URLRequestMethod.GET,this.getByTxHashSucc,this.getByTxHashFail,this),[2]}})})},e.getByTxHashSucc=function(e){},e.getByTxHashFail=function(e){},e.getTransactionByTxHash1=function(e){return __awaiter(this,void 0,void 0,function(){var t,i,r,n,a,o;return __generator(this,function(s){switch(s.label){case 0:return t=window.TonWeb,i=t.boc.Cell.oneFromBoc(t.utils.base64ToBytes(e)),[4,i.hash()];case 1:return r=s.sent(),n=t.utils.bytesToBase64(r),a=t.utils.bytesToHex(r),o=new egret.HttpRequest,o.responseType=egret.HttpResponseType.TEXT,o.open("https://tonapi.io/v2/blockchain/transactions/"+a,egret.HttpMethod.GET),o.send(),o.addEventListener(egret.Event.COMPLETE,function(e){},this),o.addEventListener(egret.IOErrorEvent.IO_ERROR,function(e){console.error("请求失败:",e)},this),[2]}})})},e}();__reflect(TonAPI.prototype,"TonAPI");var TonPayMgr=function(){function e(){}return e.initialize=function(){var e=this;e.initialized||(e.initialized=!0,e.createTonConnectUI())},e.createTonConnectUI=function(){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(t){return e=this,e.tonConnectUI=new window.TON_CONNECT_UI.TonConnectUI({manifestUrl:"https://leowu0608.github.io/ton_dungeon_dev/tonconnect-manifest.json",chain:"testnet",network:"testnet"}),console.log("tonConnectUI uiOptions"),e.tonConnectUI.uiOptions={twaReturnUrl:"https://t.me/leowu06082015_little_bot",skipRedirectToWallet:"always"},e.tonConnectUI.onStatusChange(function(t){console.log("Wallet status changed:",t),e.connectedWallet=t,e.updateAddress()}),[2]})})},e.disconnect=function(){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(t){switch(t.label){case 0:if(!this.tonConnectUI)return[2];t.label=1;case 1:return t.trys.push([1,5,,6]),[4,this.tonConnectUI.disconnect()];case 2:return t.sent(),this.connectedWallet=null,[4,this.sleep(1e3)];case 3:return t.sent(),[4,this.tonConnectUI.connector.restoreConnection()];case 4:return t.sent(),[3,6];case 5:return e=t.sent(),console.error("Error disconnecting from wallet:",e),[3,6];case 6:return[2]}})})},e.pay=function(e,t){return __awaiter(this,void 0,void 0,function(){var i,r,n,a,o,s;return __generator(this,function(l){switch(l.label){case 0:return this.tonConnectUI.connected?[3,6]:[4,this.tonConnectUI.openModal()];case 1:return l.sent(),console.log("tonConnectUI connectWallet"),null!=this.connectedWallet?[3,4]:(i=this,[4,this.tonConnectUI.connectWallet()["catch"](function(e){console.error("Error connecting to wallet:",e)})]);case 2:return i.connectedWallet=l.sent(),this.updateAddress(),[4,this.tonConnectUI.connector.restoreConnection()];case 3:l.sent(),l.label=4;case 4:return console.log("tonConnectUI wallet connected1"),[4,this.sleep(1e3)];case 5:l.sent(),console.log("tonConnectUI wallet connected2"),l.label=6;case 6:return console.log("requestPay"),r=1e9,n={modals:["before","success","error"],notifications:["before","success","error"],skipRedirectToWallet:"always",validUntil:Math.floor(Date.now()/1e3)+600,messages:[{address:"testnet"==e?"0QCCSsa_FrnZrKm_Q8qnJpYsS0ATp54hrubO32QnURNyn7cQ":"UQCCSsa_FrnZrKm_Q8qnJpYsS0ATp54hrubO32QnURNynwya",amount:""+t*r}]},[4,this.tonConnectUI.sendTransaction(n)];case 7:return a=l.sent(),console.log("requestPay result:"+JSON.stringify(a)),o=1,[4,this.getTransactionByBoc(e,a.boc)];case 8:s=l.sent(),l.label=9;case 9:return 0!=s&&5>o?(o++,console.log("waiting for query transaction..."),[4,this.sleep(5e3)]):[3,12];case 10:return l.sent(),[4,this.getTransactionByBoc(e,a.boc)];case 11:return s=l.sent(),[3,9];case 12:return[2,s]}})})},e.getTransactionByBoc=function(e,t){return __awaiter(this,void 0,void 0,function(){var i,i,r,n,a,o;return __generator(this,function(s){switch(s.label){case 0:return"testnet"==e?(i={boc:"te6cckECAgEAAKkAAeGIAQSVjX4tc7NZU36HlU5NLFiWgCdPPENdzZ2+yE6iJuU+BJv5QCrKKCa7mDjfIeWlTcKc7tTEj7o8dM+KQhYXtoILCSocUHM6Akv2ejZDSBOgXFmg09S2ZWZSuLFY/+WWEHFNTRi7PkDYaAAAAGAAHAEAZkIATK5bx6zL0o5A9U3iQs2B2ucgn/Fk14Hltwd7Cvj2EaEYehIAAAAAAAAAAAAAAAAAAGx7ZSY="},t=i.boc):(i={boc:"te6cckECFwEAA6sAA+OIAEdREdlYtCRJ4I+u1aw1xO4g7orsBQtwd58I6W0BtnH+EZ+ha+XJcilWgXb+4QD5DgLnmEkUzSXAWZMVWqFdGbT5cRNnm5HI79l/0HUN96aW79W1NFhLjDEEiA5RwVgUNUAlNTRi7PlVpCAAAAAAAHADAgEAZkIAQSVjX4tc7NZU36HlU5NLFiWgCdPPENdzZ2+yE6iJuU+YehIAAAAAAAAAAAAAAAAAAABRAAAAACmpoxe3ZF647YtfUK1PRzP3yCanFkNX94KOnmYrgESoeYBHrkABFP8A9KQT9LzyyAsEAgEgCQUE+PKDCNcYINMf0x/THwL4I7vyZO1E0NMf0x/T//QE0VFDuvKhUVG68qIF+QFUEGT5EPKj+AAkpMjLH1JAyx9SMMv/UhD0AMntVPgPAdMHIcAAn2xRkyDXSpbTB9QC+wDoMOAhwAHjACHAAuMAAcADkTDjDQOkyMsfEssfy/8IBwYWAGyBAQjXGPoA0z8wUiSBAQj0WfKnghBkc3RycHSAGMjLBcsCUAXPFlAD+gITy2rLHxLLP8lz+wAAcIEBCNcY+gDTP8hUIEeBAQj0UfKnghBub3RlcHSAGMjLBcsCUAbPFlAE+gIUy2oSyx/LP8lz+wACAG7SB/oA1NQi+QAFyMoHFcv/ydB3dIAYyMsFywIizxZQBfoCFMtrEszMyXP7AMhAFIEBCPRR8qcCAgFIDgoCASAMCwBZvSQrb2omhAgKBrkPoCGEcNQICEekk30pkQzmkD6f+YN4EoAbeBAUiYcVnzGEAgEgEQ0AEbjJftRNDXCx+ALm0AHQ0wMhcbCSXwTgItdJwSCSXwTgAtMfIYIQcGx1Z70ighBkc3RyvbCSXwXgA/pAMCD6RAHIygfL/8nQ7UTQgQFA1yH0BDBcgQEI9ApvoTGzkl8H4AXTP8glghBwbHVnupI4MOMNA4IQZHN0crqSXwbjDRAPAIpQBIEBCPRZMO1E0IEBQNcgyAHPFvQAye1UAXKwjiOCEGRzdHKDHrFwgBhQBcsFUAPPFiP6AhPLassfyz/JgED7AJJfA+IAeAH6APQEMPgnbyIwUAqhIb7y4FCCEHBsdWeDHrFwgBhQBMsFJs8WWPoCGfQAy2kXyx9SYMs/IMmAQPsABgIBWBUSAgEgFBMAGa8d9qJoQBBrkOuFj8AAGa3OdqJoQCBrkOuF/8AAPbKd+1E0IEBQNch9AQwAsjKB8v/ydABgQEI9ApvoTGAACvQAye1U1JyYjQ=="},t=i.boc),r=window.TonWeb,n=r.boc.Cell.oneFromBoc(r.utils.base64ToBytes(t)),[4,n.hash()];case 1:return a=s.sent(),o=r.utils.bytesToHex(a),console.log("hashHex："+o),[2,new Promise(function(t,i){function r(e){e&&e.success?(console.log("查询成功：result = "+e.success+"，data = "+JSON.stringify(e)),t(0)):(console.log("查询失败1：result = false"),t(1))}function n(e){console.log("查询失败2：result = false"),t(2)}HttpMgr.send("https://"+("testnet"==e?"testnet.":"")+"tonapi.io/v2/blockchain/transactions/"+o,null,egret.URLRequestMethod.GET,r,n,null)})]}})})},e.updateAddress=function(){var e=PanelMgr.getUI(130);e&&e.updateAddress()},e.sleep=function(e){return new Promise(function(t){return setTimeout(t,e)})},e}();__reflect(TonPayMgr.prototype,"TonPayMgr");var TonScan=function(){function e(){}return e.getByTxHash1=function(e){return __awaiter(this,void 0,void 0,function(){var t,i,r,n,a;return __generator(this,function(o){switch(o.label){case 0:return t=window.TonWeb,i=t.boc.Cell.oneFromBoc(t.utils.base64ToBytes(e)),[4,i.hash()];case 1:return r=o.sent(),n=t.utils.bytesToBase64(r),a=new egret.HttpRequest,a.responseType=egret.HttpResponseType.TEXT,a.open("https://tonscan.org/tx/by-msg-hash/"+n,egret.HttpMethod.GET),a.send(),a.addEventListener(egret.Event.COMPLETE,function(e){},this),a.addEventListener(egret.IOErrorEvent.IO_ERROR,function(e){console.error("请求失败:",e)},this),[2]}})})},e.getByTxHash2=function(e){return __awaiter(this,void 0,void 0,function(){var t,i,r,n;return __generator(this,function(a){switch(a.label){case 0:return t=window.TonWeb,i=t.boc.Cell.oneFromBoc(t.utils.base64ToBytes(e)),[4,i.hash()];case 1:return r=a.sent(),n=t.utils.bytesToBase64(r),HttpMgr.send("https://tonscan.org/tx/by-msg-hash/"+n,null,egret.URLRequestMethod.GET,this.getByTxHashSucc,this.getByTxHashFail,this),[2]}})})},e.getByTxHashSucc=function(e){},e.getByTxHashFail=function(e){},e}();__reflect(TonScan.prototype,"TonScan");var IconTxtRender=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.update=function(){var e=this;e.data.icon&&(e.icon.source=e.data.icon),e.updateMsg(e.data.msg)},t.prototype.updateMsg=function(e){return this.txt&&(this.txt.textFlow=DeviceUtils.isAndroid?StringUtils.rich(e+" "):StringUtils.rich(e)),this},t.prototype.setGap=function(e){return this.container.layout&&(this.container.layout.gap=e),this},t.prototype.setFontSize=function(e){return this.txt&&(this.txt.size=e),this},t.prototype.setTextColor=function(e){return this.txt&&(this.txt.textColor=e),this},t.prototype.setTextW=function(e){return this.txt&&(this.txt.width=e),this},t.prototype.setTextH=function(e){return this.txt&&(this.txt.height=e),this},t.prototype.setIconWH=function(e,t){return this.icon&&(this.icon.width=e,this.icon.height=t),this},t}(BaseItem);__reflect(IconTxtRender.prototype,"IconTxtRender"),window.IconTxtRender=IconTxtRender;var PanelTopView=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._titleImg="",t._bgshow=!0,t}return __extends(t,e),Object.defineProperty(t.prototype,"owner",{get:function(){return this._owner},set:function(e){this._owner=e,this.btnIntro.visible=!!this.getConfigDesc(),this.updateUIName()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"bgshow",{set:function(e){this._bgshow=e,this.updatebg()
},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"titleUrl",{get:function(){return this._titleImg},set:function(e){this._titleImg=e,this.updateTitle()},enumerable:!0,configurable:!0}),t.prototype.update=function(){this.updateTitle(),this.btnIntro.visible=!!this.getConfigDesc(),this.updateUIName(),this.updatebg()},t.prototype.updateInfo=function(){this.btnIntro.visible=!!this.getConfigDesc()},t.prototype.updatebg=function(){this.bg&&(this.bg.visible=this._bgshow)},t.prototype.updateUIName=function(){var e=Data.getUIConfig(this.owner,!1);e&&(this.addName(this.btnBack,"PanelTopView.btnBack:"+e.id),this.addName(this.btnHome,"PanelTopView.btnHome:"+e.id))},t.prototype.initUI=function(){this.touchEnabled=!1,this.left=this.top=0},t.prototype.addUI=function(){var e=this;if(e.addL(e.btnBack,Evt.touchTap,e.onCloseHandler),e.addL(e.btnHome,Evt.touchTap,e.onHomeTap),e.addL(e.btnIntro,Evt.touchTap,e.onBtnIntro),DeviceUtils.isIOS){var t=DeviceUtils.riskArea.leftTop;e.btnBack.left=t?t+4:4,e.btnHome.left=t?t+229:229,e.btnIntro.left=t?t+391:391}},t.prototype.onCloseHandler=function(){var e=this._owner;e&&(e.close(),e.onBtnBack&&e.onBtnBack())},t.prototype.onHomeTap=function(){var e=this._owner;e&&(e.removeTween&&e.removeTween(),UI.closeOpenedUI(!0),SceneMgr.goHome())},t.prototype.onBtnIntro=function(){var e=this._owner;if(e)if(e&&e.onBtnIntro)e.onBtnIntro();else{var t=this.getConfigDesc();t&&PanelMgr.open(116,{desc:t})}},t.prototype.updateTitle=function(){var e=this;e.btnBack&&e._titleImg&&(e.btnBack.icon=e._titleImg)},t.prototype.getConfigDesc=function(){var e=Data.getUIConfig(this.owner);return e?e.desc||"":""},t}(BaseView);__reflect(PanelTopView.prototype,"PanelTopView"),window.PanelTopView=PanelTopView;var SceneLoadUI=function(e){function t(){var t=e.call(this)||this;return t.skinName="SceneLoadSkin",t.fullScreen=!0,t.adaptation=!0,t.layerIndex=11,t.modalAlpha=1,t}return __extends(t,e),t.prototype.initUI=function(){var e=this,t=e.vo.params.bgUrl;t||(t="preload_bg_"+Math.floor(9*Math.random())+"_jpg"),e.bg.source=t,e.bg.visible=!1,e.loadGrp.visible=!1},t.prototype.addUI=function(){this.addEff(this.loadBar.eff,"jdthy",Urls.uieff(),"idle",0,!0),this.tipTxt.textFlow=StringUtils.rich(Login.getTipMsg())},t.prototype.layout=function(e,t){this.bg.scaleX=this.bg.scaleY=t},t.prototype.start=function(){},t.prototype.complete=function(){},t.prototype.setProgress=function(e,t,i){var r=this;r.loadBar.maximum=i,r.loadBar.value=t,r.loadTxt.text=Math.min(100,Math.floor(100*e))+"%"},t}(BaseUI);__reflect(SceneLoadUI.prototype,"SceneLoadUI",["core.ILoadingView"]),window.SceneLoadUI=SceneLoadUI;var SysAlertItem=function(e){function t(){var t=e.call(this)||this,i=t;return i.skinName="SysAlertItemSkin",i.touchChildren=!1,i.touchEnabled=!1,i.horizontalCenter=0,t}return __extends(t,e),t.prototype.showText=function(e,t){this.width=App.stage.stageWidth;var i=this;i.lifeTime=i.state=0,i.alpha=1,i.visible=!0,isNaN(t)?i.c_text.textColor=16777215:i.c_text.textColor=t,i.c_text.textFlow=HtmlUtils.htmlTxt(e||""),i.con&&(i.con.scaleY=0,i.gt(i.con).to({scaleY:1},200).wait(1e3).to({scaleY:0},200))},t.prototype.dispose=function(){this.visible=!1,ObjectPool.push(this),this.parent&&this.parent.removeChild(this)},t}(BaseView);__reflect(SysAlertItem.prototype,"SysAlertItem"),window.SysAlertItem=SysAlertItem;var SysAlertItem2=function(e){function t(){var t=e.call(this)||this,i=t;return i.skinName="SysAlertItem2Skin",i.touchChildren=!1,i.touchEnabled=!1,i.horizontalCenter=0,t}return __extends(t,e),t.prototype.showItem=function(e){this.width=App.stage.stageWidth;var t=this;t.lifeTime=t.state=0,t.alpha=1,t.visible=!0;var i=Data.getItem("ItemData",e.id);i&&(t.c_img.source=Urls.icon(i.icon),t.c_text.textFlow=StringUtils.rich(ColorUtils.quality(i.name,i.color,!1)+" X "+e.num),t.con&&(t.con.scaleY=0,t.gt(t.con).to({scaleY:1},200).wait(1e3).to({scaleY:0},200)))},t.prototype.dispose=function(){this.visible=!1,ObjectPool.push(this),this.parent&&this.parent.removeChild(this)},t}(BaseView);__reflect(SysAlertItem2.prototype,"SysAlertItem2"),window.SysAlertItem2=SysAlertItem2;var SysAlertItem3=function(e){function t(){var t=e.call(this)||this,i=t;return i.skinName="SysAlertItem3Skin",i.touchChildren=!1,i.touchEnabled=!1,i.horizontalCenter=0,t}return __extends(t,e),t.prototype.addUI=function(){this.addL(this.c_text,Evt.resize,this.onTFResize)},t.prototype.showText=function(e,t){var i=this;i.lifeTime=i.state=0,i.alpha=1,i.scaleX=i.scaleY=1,i.visible=!0,isNaN(t)?i.c_text.textColor=16777215:i.c_text.textColor=t,i.c_text.textFlow=HtmlUtils.htmlTxt(e||"")},t.prototype.onTFResize=function(){this.width=this.c_text.width+56},t.prototype.dispose=function(){this.visible=!1,ObjectPool.push(this)},t}(BaseView);__reflect(SysAlertItem3.prototype,"SysAlertItem3"),window.SysAlertItem3=SysAlertItem3;var SysAlertItem4=function(e){function t(){var t=e.call(this)||this,i=t;return i.skinName="BulletChatGiftItemSkin",i.touchChildren=!1,i.touchEnabled=!1,i.horizontalCenter=0,t}return __extends(t,e),t.prototype.showHead=function(e){var t=this;t.lifeTime=t.state=0,t.alpha=1,t.visible=!0,e.id<0||(t.header.source=Urls.head(e.id),t.desc.text=e.desc)},t.prototype.dispose=function(){this.visible=!1,ObjectPool.push(this)},t}(BaseView);__reflect(SysAlertItem4.prototype,"SysAlertItem4"),window.SysAlertItem4=SysAlertItem4;var SysAlertItem5=function(e){function t(){var t=e.call(this)||this,i=t;return i.skinName="SysAlertItem5Skin",i.touchChildren=!1,i.touchEnabled=!1,i.horizontalCenter=0,t}return __extends(t,e),t.prototype.showText=function(e,t){this.width=App.stage.stageWidth;var i=this;i.lifeTime=i.state=0,i.alpha=1,i.visible=!0,isNaN(t)?i.c_text.textColor=16777215:i.c_text.textColor=t,i.c_text.textFlow=HtmlUtils.htmlTxt(e||""),i.con&&(i.con.scaleY=0,i.gt(i.con).to({scaleY:1},200).wait(1e3).to({scaleY:0},200))},t.prototype.dispose=function(){this.visible=!1,ObjectPool.push(this)},t}(BaseView);__reflect(SysAlertItem5.prototype,"SysAlertItem5"),window.SysAlertItem5=SysAlertItem5;var SysSpecialItem=function(e){function t(){var t=e.call(this)||this,i=t;return i.skinName="SysSpecialItemSkin",i.touchChildren=!1,i.touchEnabled=!1,i.horizontalCenter=0,t}return __extends(t,e),t.prototype.showItem=function(e){var t=this;t.lifeTime=t.state=0,t.alpha=1,t.visible=!0;var i=Data.getItem("ItemData",e.id);i&&(t.c_img.source=Urls.icon(i.icon),t.c_text.textFlow=StringUtils.rich(ColorUtils.quality(i.name,i.color,!0)+" X "+e.num))},t.prototype.dispose=function(){this.visible=!1,ObjectPool.push(this)},t}(BaseView);__reflect(SysSpecialItem.prototype,"SysSpecialItem"),window.SysSpecialItem=SysSpecialItem;var CallQueue=function(){function e(e){this._priorCalls=[],this._priorCallWaitId=0,Multiton.set(this,e),this._queue=[]}return e.get=function(t){return Multiton.get(e,t)},Object.defineProperty(e.prototype,"length",{get:function(){return this._queue.length+(null==this._calling?0:1)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"remainLength",{get:function(){return this._queue.length},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"callingItem",{get:function(){return this._calling},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"callingMethod",{get:function(){return this._calling?this._calling.method:null},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"priorCallNum",{get:function(){return this._priorCalls.length},enumerable:!0,configurable:!0}),e.prototype.add=function(e){for(var t=[],i=1;i<arguments.length;i++)t[i-1]=arguments[i];null!=e&&(this._queue.push(new QueueItem(e,t)),!this._calling&&this.next(!0))},e.prototype.addAsync=function(e){void 0===e&&(e=null);for(var t=[],i=1;i<arguments.length;i++)t[i-1]=arguments[i];null!=e&&(this._queue.push(new QueueItem(e,t,!0)),!this._calling&&this.next(!0))},e.prototype.pushAsync=function(e){for(var t=[],i=1;i<arguments.length;i++)t[i-1]=arguments[i];e&&this._queue.push(new QueueItem(e,t,!0))},e.prototype.next=function(e){void 0===e&&(e=!1);var t=this;t._queue.length>0?(t._calling=t._queue.shift(),e?t.process(t._calling):egret.$callAsync(t.process,t,t._calling)):t._calling=null},e.prototype.getQueueItem=function(e){return e>=0&&e<this._queue.length?this._queue[e]:null},e.prototype.clear=function(e){void 0===e&&(e=!1),this._queue.length=0,e&&(this._calling=null)},e.prototype.process=function(e){e.method&&e.method.apply(e.method,e.args),this._calling!=e||e.async||this.next()},e.prototype.priorCall=function(e,t,i){for(var r=[],n=3;n<arguments.length;n++)r[n-3]=arguments[n];var a=this;a._priorCalls.push(new PriorCallItem(e,i,r)),a._priorCallWaitId&&clearTimeout(a._priorCallWaitId),a._priorCallWaitId=Functor.delay(a.checkPriorCalls,t,a)},e.prototype.priorAdd=function(e,t,i){for(var r=[],n=3;n<arguments.length;n++)r[n-3]=arguments[n];var a=this;a.priorCall.apply(a,[e,t,a.add.bind(a),i].concat(r))},e.prototype.priorAddAsync=function(e,t,i){for(var r=[],n=3;n<arguments.length;n++)r[n-3]=arguments[n];var a=this;a.priorCall.apply(a,[e,t,a.addAsync.bind(a),i].concat(r))},e.prototype.clearPriorCalls=function(){this._priorCalls.length=0},e.prototype.checkPriorCalls=function(){this._priorCallWaitId=0;var e=this._priorCalls;this._priorCalls=[],ArrayUtils.sortOn(e,"priority",18);for(var t=e.length,i=0;t>i;i++){var r=e[i];r.method&&r.method.apply(r.method,r.args)}},e}();__reflect(CallQueue.prototype,"CallQueue");var QueueItem=function(){function e(e,t,i){void 0===i&&(i=!1),this.method=e,this.args=t,this.async=i}return e}();__reflect(QueueItem.prototype,"QueueItem");var PriorCallItem=function(){function e(e,t,i){this.priority=e,this.method=t,this.args=i}return e}();__reflect(PriorCallItem.prototype,"PriorCallItem"),window.CallQueue=CallQueue,window.QueueItem=QueueItem,window.PriorCallItem=PriorCallItem;var ColorUtils=function(){function e(){}return e.color=function(t,i){void 0===i&&(i=!0);var r=Object.keys(e.COLORS).length,n=e.COLORS[NumberUtils.limit(t,1,r)];return i?n:"#"+n.toString(16)},e.quality=function(e,t,i){return void 0===i&&(i=!1),PHE.formatMark("color",e,i?this.lightColor(t,!1):this.color(t,!1))},e.lightColor=function(e,t){void 0===t&&(t=!1);var i=Object.keys(this.COLORS_LIGHT).length,r=this.COLORS_LIGHT[NumberUtils.limit(e,1,i)];return t?r:"#"+r.toString(16)},e.colorToString=function(e){for(var t=e.toString(16);t.length<6;)t="0"+t;return"#"+t},e.COLORS={1:16777215,2:5092863,3:13070333,4:16361e3,5:15486780,6:16603773},e.COLORS_LIGHT={1:1,2:5092863,3:13070333,4:16361e3,5:15486780,6:16603773},e}();__reflect(ColorUtils.prototype,"ColorUtils"),window.ColorUtils=ColorUtils;var CommonUtils=function(){function e(){}return e.setGrayBtnTip=function(t,i,r,n,a,o){if(void 0===i&&(i=!0),void 0===r&&(r=!1),void 0===n&&(n=""),void 0===a&&(a=null),void 0===o&&(o=null),t){i&&(t.filters=FiltersUtils.GRAY_FILTERS),t.enabled=!1;var s=e._grayObjs[t.hashCode];s||(s=new eui.Rect,s.alpha=0,s.includeInLayout=!1,e._fundic[s.hashCode]||(e._fundic[s.hashCode]=Functor.functor(a,o,n)),null===a||s.hasEventListener(egret.TouchEvent.TOUCH_TAP)||s.addEventListener(egret.TouchEvent.TOUCH_TAP,e._fundic[s.hashCode],s),t.parent&&t.parent.addChild(s),e._grayObjs[t.hashCode]=s,r&&t.once(egret.Event.REMOVED_FROM_STAGE,function(t){e.clearGrayBtnTip(t.target)},this)),s.x!==t.x&&(s.x=t.x),s.y!==t.y&&(s.y=t.y),s.width!==t.width&&(s.width=t.width),s.height!==t.height&&(s.height=t.height),s.visible!==t.visible&&(s.visible=t.visible)}},e.clearGrayBtnTip=function(t){if(t){t.enabled=!0,t.filters&&(t.filters=null);var i=e._grayObjs[t.hashCode];i&&(e._fundic[i.hashCode]&&(i.removeEventListener(egret.TouchEvent.TOUCH_TAP,e._fundic[i.hashCode],i),delete e._fundic[i.hashCode]),i.parent&&i.parent.removeChild(i),delete e._grayObjs[t.hashCode])}},e.drawToBitmap=function(e){var t=new egret.RenderTexture;return t.drawToTexture(e),t},e.adjustListWH=function(e,t,i,r,n){if(void 0===i&&(i=0),void 0===r&&(r=0),e.dataProvider){var a=e.layout;if(a){a.horizontalAlign=egret.HorizontalAlign.JUSTIFY,a.verticalAlign=egret.VerticalAlign.JUSTIFY;var o=e.dataProvider.length;if(!(0>=o)){var s,l=n?n[o]:0/0;s=isNaN(l)?Math.min(t,o):l;var u=Math.max(1,Math.ceil(o/s));a.horizontalGap=Math.ceil(t/s)*i,a.verticalGap=r,a.requestedRowCount=u,a.requestedColumnCount=s}}}},e.drawImg=function(e){if(e){var t=new egret.RenderTexture;return t.drawToTexture(e),new eui.Image(t)}},e.changePageBtns=function(e,t,i,r,n,a,o){void 0===a&&(a=1),void 0===o&&(o=!1);var s,l;s=l=1===a?"enabled":"visible",1===e?i>e?(1===a&&(r.visible=!0,n.visible=!0),s in r&&l in n&&(r[s]=!1,n[l]=!0)):(s=l=o?"enabled":"visible",s in r&&l in n&&(r[s]=n[l]=!1)):e>t?i>e?s in r&&l in n&&(n[l]=r[s]=!0):s in r&&l in n&&(n[l]=!1,r[s]=!0):s in r&&l in n&&(r[s]=!1,n[l]=!0)},e.byteLimit=function(t,i,r,n){if(void 0===r&&(r=".."),void 0===n&&(n=2),!t)return"";var a=e._buffer;if(a.length=0,a.writeUTFBytes(t),a.length>i){a.position=0;var o=i>n?a.readUTFBytes(i+1-n):"";return o.charCodeAt(o.length-1)!==t.charCodeAt(o.length-1)&&(o=o.slice(0,-1)),o+(r||"")}return t},e.byteLen=function(t){if(!t)return 0;var i=e._buffer;return i.length=0,i.writeUTFBytes(t),i.length},e.formatCycleTimeStr=function(e){var t=Msg.phe(4004),i=t.split(","),r=e>=86400?DateUtils.formatTimespan(3600*Math.floor(e/3600),i):DateUtils.formatDigitTimespan(e);return r},e.formatCycleTimeStr2=function(e){var t=Msg.phe(4004),i=t.split(","),r=i[0],n="#"+i[1],a="#"+i[2];return e>=86400?DateUtils.formatTimespan(e,[r,n,a]):DateUtils.formatDigitTimespan(e)},e.formatRemainTime=function(e,t){if(e>=86400){var i=DateUtils.getRelativeDate(t);return Msg.phe(4022,i.getMonth()+1,i.getDate())}if(e>=3600){var r=StringUtils.rtrim((e/3600).toFixed(1),"0");return"."==r.charAt(r.length-1)&&(r=r.substring(0,r.length-1)),Msg.phe(4021,r)}if(e>=60){var n=e/60>>0;return Msg.phe(4020,n)}return Msg.msg(4019)},e.formatOffTimeDes=function(e){var t,i,r,n=[2592e3,604800,259200,3600,60],a=[Msg.msg(725),Msg.msg(724),Msg.msg(723),Msg.msg(722),Msg.msg(721)],o="";if(r=3,--r,60>e)o=Msg.msg(727);else for(var s in n)if(t=n[s],i=e/t|0,i>=1){o=+s>r?i+a[s]:a[s];break}return o},e.formatRemainTime2=function(e){return e>=86400?DateUtils.formatTimespan(e,Msg.msg(98005).split(",")):DateUtils.formatDigitTimespan(e)},e.formatRemainTime3=function(e){return DateUtils.formatDigitTimespan(0).replace(":",".")},e.formatRemainTime4=function(e){return DateUtils.formatShortDigitTimespan(e).replace(":",".")},e.formatTime1=function(e){return e=1e3*e,CronUtils.checkIsTodayTimespan(e)?DateUtils.formatDigitTimespan(Math.round(Math.max(e-DateUtils.serverNow,0)/1e3)):DateUtils.formatTime(e,"EE HH:mm")},e.longTap=function(t,i,r,n,a){void 0===n&&(n=null),void 0===a&&(a=100);var o=e.tapDic[t.hashCode];o||(o={},o.item=t,o.handler=i,o.endHandler=n,o.onBegin=function(t){var n=t.target,o=e.tapDic[n.hashCode];o&&(n.addEventListener(egret.TouchEvent.TOUCH_CANCEL,o.onEnd,o),n.addEventListener(egret.TouchEvent.TOUCH_END,o.onEnd,o),n.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,o.onEnd,o)),o.timeId>0&&(clearInterval(o.timeId),o.timeId=0),o.timeId=setInterval(i,a,r)},o.onEnd=function(t){var i=t.target,r=e.tapDic[i.hashCode];clearInterval(r.timeId),r.timeId=0,r.endHandler&&r.endHandler(),i.removeEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,r.onEnd,r),i.removeEventListener(egret.TouchEvent.TOUCH_END,r.onEnd,r),i.removeEventListener(egret.TouchEvent.TOUCH_CANCEL,r.onEnd,r)},t.addEventListener(egret.TouchEvent.TOUCH_BEGIN,o.onBegin,o),e.tapDic[t.hashCode]=o)},e.cancelLongTap=function(t){var i=e.tapDic[t.hashCode];i&&(delete e.tapDic[t.hashCode],t.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,i.onBegin,i),t.removeEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,i.onEnd,i),t.removeEventListener(egret.TouchEvent.TOUCH_END,i.onEnd,i),t.removeEventListener(egret.TouchEvent.TOUCH_CANCEL,i.onEnd,i),clearInterval(i.timeId),i.timeId=0,i.item=null,i.handler=null,i.endHandler=null,i.onBegin=null,i.onEnd=null,i=null)},e.loopPic=function(e,t,i,r,n,a,o){for(var s,l,u,c,p=1===n?"x":"y",d=0;d<e.length;d++)l=o[d],s=e[d],u=l.att1,c=l.att2,1===a?(c+=r,c=c>t?-u+r:c):(c-=r,c=-u+r>c?t:c),l.att2=c,s[p]=c},e.ArrayEquals=function(t,i){if(!i)return!1;if(!t||!i)return!1;if(t.length!==i.length)return!1;for(var r=0,n=t.length;n>r;r++)if(t[r]instanceof Array&&i[r]instanceof Array){if(!e.ArrayEquals(t[r],i[r]))return!1}else if(t[r]!==i[r])return!1;return!0},e.getCircularArray=function(e,t,i){return void 0===t&&(t=5),void 0===i&&(i=0),function(){var r=e.slice(),n=function(e){void 0===e&&(e=1);var t=r.splice(0,e);r.push.apply(r,t)},a=function(e){void 0===e&&(e=1);var t=r.splice(-e);t.reverse(),r.unshift.apply(r,t)};i>0?n(i):0>i&&a(-i);var o=function(){return r.slice(0,t)};return{forward:n,backward:a,getData:o}}()},e.disableBtn=function(e){e.filters!==FiltersUtils.GRAY_FILTERS&&(e.filters=FiltersUtils.GRAY_FILTERS),e.enabled=!1},e.enableBtn=function(e){e.filters=null,e.enabled=!0},e.setFullProgressBar=function(e){e&&(e.labelFunction=function(){return""},e.maximum=1,e.value=1)},e.unsetFullProgressBar=function(e){e&&(e.labelFunction=void 0)},e.numToPercent=function(e){return Number((e+"00").replace(/\.([\d]{2})/,"$1."))},e.percentToNum=function(e){var t=-1===e.toString().indexOf(".")?e+".0":e+"";return Number(("00"+t).replace(/([\d]{2})\./,".$1"))},e.copyToClipboard=function(e){if(e+="",egret.Capabilities.runtimeType==egret.RuntimeType.RUNTIME2)try{egret.ExternalInterface.call("Copy",e)}catch(t){}else{var i=window.clipboardData;if(i)i.clearData(),i.setData("Text",e);else{var r=document.createElement("input");document.body.appendChild(r),r.style.opacity="0",r.value=e,r.select(),r.setSelectionRange(0,r.value.length),document.execCommand("Copy"),document.body.removeChild(r)}}},e.textOverFlow=function(e,t,i){if(void 0===i&&(i="..."),e)for(var r=[],n=0,a=e.$getLinesArr2()||[],o=0,s=0,l=a.length;l>s;s++)for(var u=a[s],c=0,p=u.elements.length;p>c;c++){if(o=u.elements[c].text.length,n+=o,n>=t){var d=n-t;return d>0&&(u.elements[c].text=u.elements[c].text.slice(0,o-d)+i),r.push(u.elements[c]),void(e.textFlow=r)}r.push(u.elements[c])}},e.textLimit=function(e){var t=e.$getLinesArr2()||[];if(t.length>1){var i=t[0],r=i.elements.concat(),n=r[r.length-1].text;r[r.length-1].text=n.slice(0,n.length-2)+"...",e.textFlow=r}},e.updateTxtColor=function(e,t){if(e)for(var i=void 0,r=0,n=e.length;n>r;r++)i=e[r],i&&(i.style=i.style||{},i.style.textColor=t);return e},e.checkHasCost=function(e){return e?this.checkCostHasItem(e.item)||this.checkCostHasMoney(e.money):!1},e.makeCostArr=function(e){var t=[];if(e)for(var i in e)t.push.apply(t,e[i]);return t},e.checkCostHasMoney=function(e,t){return void 0===t&&(t=!0),e&&e[0]&&e[0].moneyType>0&&(!t||e[0].num>0)},e.checkCostHasItem=function(e,t){return void 0===t&&(t=!0),e&&e[0]&&e[0].id>0&&(!t||e[0].num>0)},e.parseCfgToCostItem=function(e){if(e){var t=[];return e.forEach(function(e){e.id&&e.num&&t.push(e)}),t}return[]},e.parseCfgToCostMoney=function(e){if(e){var t=[];return e.forEach(function(e){e.moneyType&&e.num&&t.push(e)}),t}return[]},e.getItemIds=function(e){var t=new HashMap;return e.forEach(function(e){e.id&&t.add(e.id,e.id)}),t.valueSet},e.getItemSubTypesFromCost=function(e){var t=[];if(e.subTypes)for(var i=e.subTypes.length,r=void 0;i--;)r=e.subTypes[i].subType,r&&t.push(r);return t},e.safeRemove=function(e){e&&e.parent&&e.parent.removeChild(e)},e.arrayJoin=function(e,t){var i=e.length;if(i>1){for(var r=e.concat();i--;)e[2*i]=r[i],e[2*i+1]=t;e.splice(e.length-1,1)}return e},e.arrayFind=function(e,t,i){return e[ArrayUtils.find(e,t,i)]},e.arrayPush=function(e,t){return-1===e.indexOf(t)?(e.push(t),!0):!1},e.arrayRemove=function(e,t){e=e||[];var i=e.indexOf(t);return i>-1?(e.splice(i,1),!0):void 0},e.arrayCopy=function(e,t){for(var i=[],r=t;r--;)i[r]=e;return i},e.arraySplit=function(e,t){void 0===t&&(t=2);var i;i=[];for(var r=t;r--;)i[r]=[];return e.forEach(function(e,r){i[r%t].push(e)}),i},e.fullImg=function(e,t,i){void 0===i&&(i={width:App.stage.stageWidth,height:App.stage.stageHeight}),t.width>0&&(e.scaleX=e.scaleY=Math.max(i.width/t.width,i.height/t.height))},e.full=function(e,t,i){var r=this,n=function(){r.fullImg(e,e,t)};core.RenderUtils.addL(e,Evt.resize,n,i),core.RenderUtils.addL(t,Evt.resize,n,i)},e.getCycleLast=function(e){var t=new Date(DateUtils.serverDateTime.getTime());switch(t.setMinutes(0),t.setHours(0),t.setSeconds(0),e){case 2:;t.setTime(t.getTime()+864e5);break;case 3:var i=t.getDay();t.setTime(t.getTime()+864e5*(7-i));break;case 4:var i=t.getDate();t.setTime(t.getTime()-864e5*i),t.setMonth(t.getMonth()+1)}return t.getTime()-DateUtils.serverDateTime.getTime()},e.getTaskUID=function(){return"A"+ ++this.UID},e.countDownBtn=function(e,t,i){void 0===t&&(t=5),void 0===i&&(i=!0);var r=this.countDownMap;r[e.hashCode]||(r[e.hashCode]={now:0,total:t,isDisable:i,oldLabel:e.label,target:e}),this.checkCountdownMap()},e.checkCountdownMap=function(){var e=this.countDownMap,t=Object.keys(e),i=this;if(t.length>0){if(i.isCheckCountdown)return;i.isCheckCountdown=!0,i.checkCountdownTimeId=egret.$hashCount++;var r=Msg.msg(4004).substr(-1)||"S";TimerManager.addCycleTask(1e3,function(){var t=Object.keys(e);if(t.length>0)for(var n in e){var a=e[n];a&&(a.now<a.total?(a.isDisable&&(a.target.enabled=!1),a.target.filters||(a.target.filters=FiltersUtils.GRAY_FILTERS),a.target.label=a.oldLabel+("("+(a.total-a.now)+r+")"),a.now++):(a.target.filters=null,a.target.label=a.oldLabel,a.target.enabled||(a.target.enabled=!0),delete e[n]))}else i.checkCountdownTimeId>0&&(TimerManager.removeTask(i.checkCountdownTimeId),i.checkCountdownTimeId=0,i.isCheckCountdown=!1)},i,0,i.checkCountdownTimeId)}else i.checkCountdownTimeId>0&&(TimerManager.removeTask(i.checkCountdownTimeId),i.isCheckCountdown=!1,i.checkCountdownTimeId=0)},e.getLeagueLvStr=function(e){var t=Msg.msg(4036);if(t){var i=t.split(",");return i.reverse(),i[e]}return""},e.getItemSubTypeName=function(e){var t=Data.getSysValue("ITEM_SUB_TYPE_NAME");return t[e]||t[0]},e.rich=function(e){return StringUtils.rich(PHE.format(e))},e.getPureText=function(e){var t=this.rich(e),i="";return t.forEach(function(e){return i+=e.text}),i},e.percentLabelFunction=function(e,t){var i=e/t*100;return(i>0&&1>i?Math.ceil(i):Math.floor(i))+"%"},e.toCHN=function(e){var t=["零","一","二","三","四","五","六","七","八","九","十"];return t[e]},e.getKey=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return e.join("_")},e.isSameDay=function(e,t){var i=new Date(e),r=new Date(t);return i.setHours(0,0,0,0)==r.setHours(0,0,0,0)},e.stopVideo=function(e,t){e&&(this.safeRemove(e),e.dispose()),VideoMgr.stop(t)},e.sourceGo=function(){Prompt.msgId(370107)},e.parseInt=function(e){return"number"!=typeof e&&(e=+e,isNaN(e)&&(e=0)),e},e.formatActivityTime=function(e){var t=86400,i="";return i=e>=t?DateUtils.formatTimespan(e,["天","小时"]):DateUtils.formatTimespan(e,["","##:","##:","##"])},e.createScreenshot=function(e){var t=new egret.RenderTexture;return t.drawToTexture(e),t},e.base64CreateScreenshot=function(e){var t=this.createScreenshot(e),i=t.toDataURL("image/png");return i},e.getDayLastTime=function(e){e=DateUtils.serverNow;var t=new Date(e);t.setHours(24,0,0,0);var i=t.getTime()-e;return i},e.getWeekDayName=function(e){var t="";t=Msg.msg(837);var i=t.split(","),r=i[(e+7-1)%7]||"";return r},e.getWeekDaysName=function(e,t){void 0===t&&(t="、");var i=Data.getItem("CycleData",e);if(i&&i&&i.crontab&&i.crontab.week){for(var r=i.crontab.week.split(","),n=[],a=0,o=r;a<o.length;a++){var s=o[a];n.push(this.getWeekDayName(+s-1))}return n.join(t)}return""},e.getUIDataImgUrl=function(e,t){var i=Data.getItem("UIData",e);if(!i)return null;var r=i.datas[ArrayUtils.find(i.datas,t,"name")];if(!r)return null;var n,a=r.url;a&&(n=a.indexOf(",")>-1?a.split(",")[Player["in"].job-1]:a);var o;if(r.isTexture)o=n;else switch(r.source){case 4:o=Urls.uibg(n,!r.isJpg);break;case 5:o=Urls.nameImg(n);break;case 6:o=Urls.icon(n);break;default:o=Urls.uiicon(n)}return o},e.getCycleDes=function(e){var t=Data.getItem("CycleData",e);return t?t.desc||"":""},e._fundic={},e._grayObjs={},e._costItems={},e._cacheItems={},e.UID=0,e._buffer=new egret.ByteArray,e.tapDic={},e.effectMap={},e.renderTask={},e.countDownMap={},e.isCheckCountdown=!1,e.checkCountdownTimeId=0,e}();__reflect(CommonUtils.prototype,"CommonUtils"),window.CommonUtils=CommonUtils;var CronUtils=function(){function e(){}return e.match=function(e,t){for(var i=e.split(","),r=0,n=i;r<n.length;r++){var a=n[r];if("*"==a)return!0;if(-1!=a.indexOf("-")){var o=a.split("-");if(2==o.length){var s=Number(o[0]),l=Number(o[1]);if("*"==o[1]&&t>=s)return!0;if("*"==o[0]&&l>=t)return!0;if(t>=s&&l>=t)return!0}}else if(Number(a)==t)return!0}return!1},e.getDecYear=function(e,t){return t>0?(e.setFullYear(e.getFullYear()-t),e.setMonth(11),e.setDate(31),e.setHours(23),e.setMinutes(59),e.setSeconds(59),e.setMilliseconds(0),e):0>t?(e.setFullYear(e.getFullYear()-t),e):e},e.getDecMonth=function(e,t){return t>0?(e.setMonth(e.getMonth()-t),e.setDate(31),e.setHours(23),e.setMinutes(59),e.setSeconds(59),e.setMilliseconds(0),e):0>t?(e.setMonth(e.getMonth()-t),e):e},e.getDecDay=function(e,t){return t>0?(e.setDate(e.getDate()-t),e.setHours(23),e.setMinutes(59),e.setSeconds(59),e.setMilliseconds(0),e):0>t?(e.setDate(e.getDate()-t),e):e},e.getDecHour=function(e,t){return t>0?(e.setHours(e.getHours()-t),e.setMinutes(59),e.setSeconds(59),e.setMilliseconds(0),e):0>t?(e.setHours(e.getHours()-t),e):e},e.getDecMinute=function(e,t){return t>0?(e.setMinutes(e.getMinutes()-t),e.setSeconds(0),e.setMilliseconds(0),e):0>t?(e.setMinutes(e.getMinutes()-t),e.setSeconds(0),e.setMilliseconds(0),e):e},e.getDecSeconds=function(e,t){return t>0?(e.setSeconds(e.getSeconds()-t),e.setMilliseconds(0),e):0>t?(e.setSeconds(e.getSeconds()-t),e.setMilliseconds(0),e):e},e.adjustTime=function(e){var t=DateUtils.getRelativeDate(e);return t.setHours(0),t.setMinutes(0),t.setSeconds(0),t.setMilliseconds(0),t.getTime()},e.getStartTime=function(e,t,i,r,n,a){void 0===n&&(n=null);var o=this,s=Data.getItem("CycleData",e);if(!s)return 0;t=t||DateUtils.serverDateTime;var l=Player["in"];i=i||l&&l.openServerTime||0,r=r||l&&l.combineServerTime||0;var u=s.crontab;a=1e3*(a||Number(s.duration));var c=i>0?o.adjustTime(i):i,p=r>0?o.adjustTime(r):r;for(n||(n=DateUtils.serverDateTime,n.setTime(t.getTime()));!(o.match(u.year,n.getFullYear())&&o.match(u.month,n.getMonth()+1)&&o.match(u.day,n.getDate())&&o.match(u.week,n.getDay()+1));)if(n=o.getDecDay(n,1),n.getTime()+a<=t.getTime())return 0;for(var d,f,h;;){if(d=n.getTime(),f=d>c?Math.floor((d-c)/864e5)+1:1,h=p>0?d>p?Math.floor((d-p)/864e5)+1:1:0,d+a<=t.getTime())return 0;if(o.match(u.openDays,f)&&o.match(u.combineDays,h)&&o.match(u.year,n.getFullYear())&&o.match(u.month,n.getMonth()+1)&&o.match(u.day,n.getDate())&&o.match(u.week,n.getDay()+1))break;n=o.getDecDay(n,1)}for(;!o.match(u.hour,n.getHours());)if(n=o.getDecHour(n,1),n.getTime()+a<=t.getTime())return 0;for(;!o.match(u.minute,n.getMinutes());)if(n=o.getDecMinute(n,1),n.getTime()+a<=t.getTime())return 0;return n.setSeconds(0),d=n.getTime(),f=d>c?Math.floor((d-c)/864e5)+1:1,h=p>0?d>p?Math.floor((d-p)/864e5)+1:1:0,o.match(u.year,n.getFullYear())&&o.match(u.month,n.getMonth()+1)&&o.match(u.day,n.getDate())&&o.match(u.week,n.getDay()+1)&&o.match(u.openDays,f)&&o.match(u.combineDays,h)&&o.match(u.hour,n.getHours())&&o.match(u.minute,n.getMinutes())?DateUtils.getServerTime(n.getTime()):o.getStartTime(e,t,i,r,n,a/1e3)},e.getLastTime=function(e,t,i,r,n){void 0===n&&(n=null);var a=this,o=Data.getItem("CycleData",e);if(!o)return 0;t=t||DateUtils.serverDateTime,i=i||Player["in"].openServerTime,r=r||Player["in"].combineServerTime;var s=i>0?a.adjustTime(i):i,l=r>0?a.adjustTime(r):r,u=o.crontab;n||(n=DateUtils.serverDateTime,n.setTime(t.getTime()));for(var c,p,d;;){if(c=n.getTime(),p=c>s?Math.floor((c-s)/864e5)+1:1,d=l>0?c>l?Math.floor((c-l)/864e5)+1:1:0,t.getTime()-c>=864e8)return 0;if(a.match(u.openDays,p)&&a.match(u.combineDays,d)&&a.match(u.year,n.getFullYear())&&a.match(u.month,n.getMonth()+1)&&a.match(u.day,n.getDate())&&a.match(u.week,n.getDay()+1))break;n=a.getDecDay(n,1)}for(;!(a.match(u.year,n.getFullYear())&&a.match(u.month,n.getMonth()+1)&&a.match(u.day,n.getDate())&&a.match(u.week,n.getDay()+1));)if(n=a.getDecDay(n,1),t.getTime()-n.getTime()>=864e8)return 0;for(;!a.match(u.hour,n.getHours());)if(n=a.getDecHour(n,1),t.getTime()-n.getTime()>=864e8)return 0;for(;!a.match(u.minute,n.getMinutes());)if(n=a.getDecMinute(n,1),t.getTime()-n.getTime()>=864e8)return 0;return n.setSeconds(0),c=n.getTime(),p=c>s?Math.floor((c-s)/864e5)+1:1,d=l>0?c>l?Math.floor((c-l)/864e5)+1:1:0,a.match(u.year,n.getFullYear())&&a.match(u.month,n.getMonth()+1)&&a.match(u.day,n.getDate())&&a.match(u.week,n.getDay()+1)&&a.match(u.openDays,p)&&a.match(u.combineDays,d)&&a.match(u.hour,n.getHours())&&a.match(u.minute,n.getMinutes())?DateUtils.getServerTime(n.getTime()):a.getLastTime(e,t,i,r,n)},e.getNextTime=function(e,t,i,r){var n=this,a=Data.getItem("CycleData",e);if(!a)return 0;t=t||DateUtils.serverDateTime,i=i||Player["in"].openServerTime,r=r||Player["in"].combineServerTime;var o=i>0?n.adjustTime(i):i,s=r>0?n.adjustTime(r):r,l=a.crontab,u=DateUtils.serverDateTime;for(u.setTime(t.getTime());0!=u.getSeconds();)if(u=n.getDecSeconds(u,-1),u.getTime()-t.getTime()>=864e8)return 0;for(;!n.match(l.minute,u.getMinutes());)if(u=n.getDecMinute(u,-1),u.getTime()-t.getTime()>=864e8)return 0;for(;!n.match(l.hour,u.getHours());)if(u=n.getDecHour(u,-1),u.getTime()-t.getTime()>=864e8)return 0;for(;;){var c=u.getTime(),p=c>o?Math.floor((c-o)/864e5)+1:1,d=s>0?c>s?Math.floor((c-s)/864e5)+1:1:0;if(u.getTime()-t.getTime()>=864e8)return 0;if(n.match(l.openDays,p)&&n.match(l.combineDays,d)&&n.match(l.week,u.getDay()+1)&&n.match(l.day,u.getDate())&&n.match(l.month,u.getMonth()+1)&&n.match(l.year,u.getFullYear()))break;u=n.getDecDay(u,-1)}for(;!(n.match(l.year,u.getFullYear())&&n.match(l.month,u.getMonth()+1)&&n.match(l.day,u.getDate())&&n.match(l.week,u.getDay()+1));)if(u=n.getDecDay(u,-1),u.getTime()-t.getTime()>=864e8)return 0;return u.setSeconds(0),DateUtils.getServerTime(u.getTime())},e.getEndTime=function(e,t,i,r,n){var a=Data.getItem("CycleData",e);if(!a)return 0;var o=this.getStartTime(e,t,i,r,null,n);if(!(o>0))return 0;var s=0;return n=n||a.duration,n&&(s=o+1e3*n),s},e.checkIsTodayActivity=function(e,t,i,r){var n=this,a=n.getDuration(e);t=t||DateUtils.serverDateTime,t.setHours(0),t.setMinutes(0),t.setSeconds(0),t.setMilliseconds(0);var o=t.getTime(),s=o+864e5-1,l=n.getStartTime(e);if(l)return!0;var u=n.getLastTime(e);if(u){if(u>=o&&s>=u)return!0;if(u+a>=o&&s>=u+a)return!0}var c=n.getNextTime(e);return c>=o&&s>=c?!0:!1},e.checkIsInCycle=function(e,t,i,r,n){if(!Player["in"])return!1;if(!e)return!0;var a=Data.getItem("CycleData",e);if(!a)return!1;t=t||DateUtils.serverNow,i=i||Player["in"].openServerTime,r=r||Player["in"].combineServerTime;var o=DateUtils.getRelativeDate(t);n=n||Number(a.duration);var s=this.getStartTime(e,o,i,r,null,n);return t>=s&&s+1e3*n>=t},e.getRemainTime=function(e,t,i,r,n){void 0===t&&(t=DateUtils.serverDateTime),void 0===i&&(i=0/0),void 0===r&&(r=0/0),void 0===n&&(n=null);var a=Player["in"];i=i||a&&a.openServerTime||0,r=r||a&&a.combineServerTime||0;var o=Data.getItem("CycleData",e);if(!o)return 0;var s=this.getStartTime(e,t,i,r,n);return s?s+1e3*o.duration-DateUtils.serverNow:0},e.getDuration=function(e){var t=Data.getItem("CycleData",e);return t?1e3*t.duration:0},e.getOpenDays=function(e,t){e=e||(Player["in"]?Player["in"].openServerTime:0),t=t||DateUtils.serverNow;var i=this.adjustTime(e),r=this.adjustTime(t);return Math.floor((r-i)/864e5)+1},e.checkIsTodayTimespan=function(e){var t=DateUtils.serverDateTime,i=new Date(DateUtils.getRelativeTime(e));return t.getFullYear()==i.getFullYear()&&t.getMonth()==i.getMonth()&&t.getDate()==i.getDate()?!0:!1},e}();__reflect(CronUtils.prototype,"CronUtils"),window.CronUtils=CronUtils;var DropUtils=function(){function e(){}return e.getEntryDesc=function(e,t){void 0===e&&(e={}),void 0===t&&(t=1);for(var i=e.l||[],r={attrs:[],buffs:[],skills:[],specials:[],holes:[],dict:{}},n=r.attrs,a=r.buffs,o=r.skills,s=(r.specials,r.holes),l=r.dict,u=0,c=i;u<c.length;u++){var p=c[u],d=p.i,f=Data.getItem("EntryData",d);
if(f){var h=f.type||0,v=void 0,m=this.getEntryValue(p,t);switch(h){case 0:v={tp:0,property:f.attr,value:m,color:f.color},n[n.length]=v;break;case 1:v={tp:1,skillId:f.skillId,lv:m},o[o.length]=v;break;case 2:v={tp:2,buffId:f.buffId,lv:m},a[a.length]=v;break;case 4:v={tp:4,value:m},s[s.length]=v}l[d]=v}}for(var y=Object.keys(r),g=0,b=y;g<b.length;g++){var x=b[g];r[x]instanceof Array&&!r[x].length&&delete r[x]}return r},e.getEntryValue=function(e,t){if(void 0===e&&(e={}),void 0===t&&(t=1),1>t)return 1;var i=e.i,r=e.n||0,n=Data.getItem("EntryData",i);if(!n)return 1;var a=n.vtype||0;if(2===a)return r;var o=n.value;if(!o||!o.length)return 1;var s=o[NumberUtils.limit(t-1,0,o.length-1)];if(!s)return 1;var l=s.min||0;if(1===a)return l;var u=s.max||0;if(l>=u&&(u=l),u===l)return l;if(1>=r)return l;if(r>=1e4)return u;var c=n.accuracy||1;return this.getValue(l,u,c,r)},e.getValue=function(e,t,i,r){var n=Math.floor(((t-e)/i+1)*(r-1)/1e4);return Math.ceil(n+e/i)*i},e.dropEntryGroup=function(e,t,i,r,n){void 0===i&&(i=1),r||(r={attrs:[],buffs:[],skills:[],specials:[],holes:[],dict:{}});var a=Data.getItem("DropEntryData",e);return a?r=this.dropEntryLimit(a.data,a.limit,t,i,r,n):r},e.dropEntryItem=function(e,t,i,r,n){void 0===i&&(i=1),r||(r={attrs:[],buffs:[],skills:[],specials:[],holes:[],dict:{}});var a=e.type;switch(a){case 1:this.insertEntryToDesc(r,this.dropEntry(e.entryId,i,n),e.entryId);break;case 2:r=this.dropEntryLimit(e.group,e.limit,t,i,r,n);break;case 3:this.dropEntryGroup(e.groupId,t,i,r)}return r},e.dropEntry=function(e,t,i){void 0===t&&(t=1);var r=Data.getItem("EntryData",e);if(!r)return{tp:-1};i||(i={l:[]});var n=r.value,a={i:e};if(n){t=-1===t?n.length-1:t;var o=0==t?{}:n[t-1]||n[n.length-1];a.n=o.min||o.max||0,a.max=o.max||0,a.min=o.min||0}var s=this.getEntryValue(a,t),l=r.type||0;switch(i.l.push(a),l){case 0:return{tp:l,property:r.attr,value:s,color:r.color};case 1:return{tp:l,skillId:r.skillId,lv:s};case 2:return{tp:l,buffId:r.buffId,lv:s};case 4:return{tp:l,value:s}}},e.dropEntryList=function(e,t){void 0===t&&(t=1);for(var i={attrs:[],buffs:[],skills:[],specials:[],holes:[],dict:{}},r=0,n=e;r<n.length;r++){var a=n[r];this.insertEntryToDesc(i,this.dropEntry(a,t),a)}return i},e.insertEntryToDesc=function(e,t,i){if(e||(e={attrs:[],buffs:[],skills:[],specials:[],holes:[],dict:{}}),!t)return e;switch(t.tp){case 0:e.attrs.push(t);break;case 2:e.buffs.push(t);break;case 1:e.skills.push(t);break;case 3:e.specials.push(t);break;case 4:e.holes.push(t)}return e.dict[i]=t,e},e.compDescAttrType=function(e){if(!(e.length<2)){for(var t,i,r,n=new HashMap,a=0,o=e;a<o.length;a++)if(t=o[a])for(var s=0,l=t;s<l.length;s++)i=l[s],i&&(r=n.getValue(i.property),r?r.value+=i.value:(r={property:i.property,value:i.value,tp:i.tp,color:i.color},n.add(r.property,r)));return n.valueSet}return 1==e.length?e[0]:void 0},e.getEntryLimitList=function(e,t,i,r,n){i=i||0,r=r||1,n=n||1;var a=[],o=[],s=[],l=t.job||0,u=t.level||0;switch(i){case 0:break;case 1:0===l&&(i=0);break;case 2:0===u&&(i=0)}switch(i){case 0:for(var c=0,p=e;c<p.length;c++){var d=p[c],f=d.randType||0;switch(f){case 0:o.push(d);break;case 1:s.push(d);break;case 2:a.push(d)}}break;case 1:for(var h=0,v=e;h<v.length;h++){var d=v[h],m=d.job||0;if(!m||m===l){var f=d.randType||0;switch(f){case 0:o.push(d);break;case 1:s.push(d);break;case 2:a.push(d)}}}break;case 2:for(var y=0,g=e;y<g.length;y++){var d=g[y],b=d.maxlv||0,x=d.minlv||0;if(!(x&&x>u||b&&u>b)){var f=d.randType||0;switch(f){case 0:o.push(d);break;case 1:s.push(d);break;case 2:a.push(d)}}}}for(var I=this.getRandomWeight(o,r,null),_=0,S=I;_<S.length;_++){var d=S[_];a.push(o[d])}for(var T=this.getRandomChance(s,n,null),w=0,A=T;w<A.length;w++){var d=A[w];a.push(s[d])}return a},e.getRandomWeight=function(e,t,i,r){function n(e,t){if(!e)return 0;for(var i,r=0,n=e.length-1;n>=r;)if(i=Math.ceil((r+n)/2),t>=e[i].ew)r=i+1;else{if(!(t<e[i].bw))return i;n=i-1}return r}void 0===r&&(r=null),t=t||1;for(var a=[],o=0,s=[],l=0,u=e.length;u>l;++l){var c=e[l];if(c&&(!r||!r[l])){var p=c.weight||0;p>0&&(a.push({idx:l,bw:o+1,ew:o+1+p,w:p}),o+=p)}}if(t>=a.length){for(var d=0,f=a;d<f.length;d++){var c=f[d];s.push(c.idx)}return s}for(var l=0;t>l;++l){var h=i?Fixed.rand(1,o,i):NumberUtils.rand(1,o),v=n(a,h);if(s.push(a[v].idx),t>l){o=a[v].bw-1,a.splice(v,1);for(var m=v,u=a.length;u>m;++m){var c=a[m];if(c){var p=c.w;c.bw=o+1,c.ew=o+1+p,o+=p}}}}return s},e.getRandomChance=function(e,t,i){t=t||1;for(var r=[],n=0,a=e.length;a>n;++n){var o=e[n];if(o){var s=o.weight||0;s&&(i?Fixed.rand(1,1e4,i):NumberUtils.rand(1,1e4))<=s*t&&r.push(n)}}return r},e.randomInMaxAndMin=function(e){var t=e.min||1,i=e.max||1;return t>i&&(i=t),NumberUtils.rand(t,i)},e.dropEntryLimit=function(e,t,i,r,n,a){switch(void 0===r&&(r=1),t){case 0:t=0;break;case 1:t=0===i?0:1}switch(t){case 0:for(var o=0,s=e;o<s.length;o++){var l=s[o];n=this.dropEntryItem(l,i,r,n,a)}break;case 1:for(var u=0,c=e;u<c.length;u++){var l=c[u],p=l.job||0;p&&p!==i||(n=this.dropEntryItem(l,i,r,n,a))}}return n},e.getEntryData=function(e,t){var i=Data.getItem("DropEntryData",e);if(i){if("string"==typeof t){var r=Data.getOppItem("AttData",t);if(!r)return;t=r.id}for(var n=i.data.length,a=void 0,o=void 0;n--;)if(a=i.data[n],o=Data.getItem("EntryData",a.entryId),o&&+o.attr==t)return o}},e.getEntryDataInGroup=function(e,t){var i=Data.getItem("DropEntryData",e);if(i)for(var r=i.data,n=void 0,a=0,o=r;a<o.length;a++){var s=o[a];if(n=this.getEntryDataFromDrop(s.groupId),n&&n.color===t){var l=Data.getItem("DropEntryData",s.groupId);return l}}},e.getEntryDataFromDrop=function(e,t){void 0===t&&(t=0);var i=Data.getItem("DropEntryData",e);if(i){var r=i.data[t];if(r){var n=Data.getItem("EntryData",r.entryId);if(r)return n}}},e.dropEntryListToAttr=function(t,i){void 0===i&&(i=1);var r=[],n=e.dropEntryList(t,i).attrs;return n.forEach(function(e,t){r[t]=Data.getAttVo(e.property,e.value)}),r},e.dropVariant=function(e,t){var i=Data.getItem("VariantGroupData",e),r=this.getRandomWeight(i.weight,1,t),n=r[1]||1,a=i.weight[n],o=a?a.num||1:1;return this.getVariantList(i.data,o,t)},e.getVariantList=function(e,t,i){t=t||1;var r=[],n=[],a=[];e.forEach(function(e){var t=e.randType||0;0==t?n.push(e):1==t?a.push(e):2==t&&r.push(e.variantId)});var o=this.getRandomWeight(n,t,i);o.forEach(function(e){r.push(n[e].variantId)});var s=this.getRandomChance(a,1,i);return s.forEach(function(e){r.push(a[e].variantId)}),r},e.getPropItemType=function(e,t,i){var r,n=Data.getItem("EntryData",e);if(n&&n.value&&n.attr){var a=Data.getItemAtt("AttData",n.attr,"name"),o=n.value;o[t]?r={name:a,val:o[t].min||0}:i&&(r={name:a,val:o[o.length-1].min||0})}return r},e}();__reflect(DropUtils.prototype,"DropUtils"),window.DropUtils=DropUtils;var FiltersUtils=function(){function e(){}return e.GRAY_FILTERS=[new egret.ColorMatrixFilter([.3,.6,0,0,0,.3,.6,0,0,0,.3,.6,0,0,0,0,0,0,1,0])],e.BLACK_FILTERS=[new egret.ColorMatrixFilter([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0])],e.WHITE_FILTERS=[new egret.GlowFilter(16777215,.9,60,60,2,1,!1,!1)],e.GRAY_FILTER=new egret.ColorMatrixFilter([.3,.6,0,0,0,.3,.6,0,0,0,.3,.6,0,0,0,0,0,0,1,0]),e.GRAY_FILTERS_ALPHA_PERCENT_40=[new egret.ColorMatrixFilter([.3,.6,0,0,0,.3,.6,0,0,0,.3,.6,0,0,0,0,0,0,.4,0])],e.GRAY_FILTER_WEIGHTED_AVERAGE=new egret.ColorMatrixFilter([.299,.587,.114,0,0,.299,.587,.114,0,0,.299,.587,.114,0,0,0,0,0,1,0]),e.GRAY_FILTER_WEIGHTED_AVERAGE_2=new egret.ColorMatrixFilter([.299,.587,.114,0,30,.299,.587,.114,0,30,.299,.587,.114,0,30,0,0,0,1,0]),e.RED_FILTER=new egret.ColorMatrixFilter([1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0]),e.GREEN_FILTER=new egret.ColorMatrixFilter([0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0]),e.BLUE_FILTER=new egret.ColorMatrixFilter([0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,1,0]),e.NOSTALGIC_FILTER=new egret.ColorMatrixFilter([.393,.769,.189,0,0,.349,.686,.168,0,0,.272,.534,.131,0,0,0,0,0,1,0]),e.FROZEN_FILTER=new egret.ColorMatrixFilter([1.5,-1.5,-1.5,0,0,-.15,1.5,-1.5,0,0,-.15,-1.5,1.5,0,0,0,0,0,1,0]),e.HIGH_LIGHT_FILTER=new egret.ColorMatrixFilter([1,0,0,0,50,0,1,0,0,50,0,0,1,0,50,0,0,0,1,0]),e.HIGH_LIGHT_2_FILTER=new egret.ColorMatrixFilter([1,0,0,0,100,0,1,0,0,100,0,0,1,0,100,0,0,0,1,0]),e.HALF_BLACK_FILTER=new egret.ColorMatrixFilter([.5,0,0,0,0,0,.5,0,0,0,0,0,.5,0,0,0,0,0,1,0]),e.LABEL_SHADOW_FILTER=new egret.DropShadowFilter(1,0,0,1,0,0,1,1,!1,!1,!1),e.CITY_ROLE_SELECT=new egret.GlowFilter(16580077,1,5,5,3),e.GOLD_FILTER=new egret.GlowFilter(16776960,1,8,8),e.BLUE_FILTER_G=new egret.GlowFilter(4166115,1,8,8),e.REVERSE_FILTER=new egret.ColorMatrixFilter([-1,0,0,0,255,0,-1,0,0,255,0,0,-1,0,255,0,0,0,1,0]),e}();__reflect(FiltersUtils.prototype,"FiltersUtils"),window.FiltersUtils=FiltersUtils;var ChatConstD=function(){function e(){}return e.CHANNEL_MSG_TYPES={0:0,1:2,2:3,3:1,4:4,5:7,6:6},e.CHANNEL_NAME_COLORS=(_a={},_a[2]="#932a94",_a[3]="#2d5399",_a[1]="#ffff00",_a[4]="#0e706e",_a[7]="#9f711c",_a[6]="#932a94",_a),e.CHANNEL_TAB_INDEX=(_b={},_b[0]=0,_b[7]=1,_b[3]=2,_b[2]=3,_b[4]=4,_b[1]=5,_b[6]=6,_b),e.CHANNEL_MSG_COLORS={1:"#ffffff",2:"#ffffff",3:"#ffffff",4:"#ffffff",5:"#ffffff",6:"#ffffff",7:"#ffffff",8:"#ffffff",9:"#ffffff",10:"#ffffff"},e.CHANNEL_ME_COLORS=(_c={},_c[7]="#34d4ff",_c[3]="#34d4ff",_c[2]="#34d4ff",_c[4]="#34d4ff",_c[6]="#34d4ff",_c),e.CHANNEL_OTHER_COLORS=(_d={},_d[7]="#ffdc18",_d[3]="#65ff15",_d[2]="#ffdc18",_d[4]="#ffdc18",_d[6]="#ffdc18",_d),e.EMOT_LIST=["01","02","03","04","05","06","07","08","09","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33"],e}();__reflect(ChatConstD.prototype,"ChatConstD");var ColorComEnum;!function(e){e[e.gray=3355443]="gray",e[e.red=10688789]="red",e[e.yellow=15318064]="yellow",e[e.blue=4166115]="blue",e[e.green0=2475891]="green0",e[e.green1=6684437]="green1",e[e.d_q1=16777215]="d_q1",e[e.d_q2=4166115]="d_q2",e[e.d_q3=10515190]="d_q3",e[e.d_q4=15425532]="d_q4",e[e.d_q5=16360747]="d_q5",e[e.d_q6=16724275]="d_q6",e[e.d_q7=16768024]="d_q7",e[e.l_q2=1794992]="l_q2",e[e.l_q3=8662995]="l_q3",e[e.l_q4=12463823]="l_q4",e[e.l_q5=12612096]="l_q5",e[e.l_q6=12713986]="l_q6",e[e.l_q7=11704064]="l_q7",e[e.c1=2160760]="c1",e[e.c2=16735554]="c2",e[e.c3=13716791]="c3",e[e.lv_up_tip=14520320]="lv_up_tip",e[e.attr_up_tip=13122857]="attr_up_tip",e.h_gray="#333333",e.h_red="#a31915",e.h_yellow="#e9bc30",e.h_blue="#3f91e3",e.h_green0="#25c773",e.h_green1="#65ff15",e.h_d_q1="#ffffff",e.h_d_q2="#3f91e3",e.h_d_q3="#a072f6",e.h_d_q4="#eb5ffc",e.h_d_q5="#f9a52b",e.h_d_q6="#ff3133",e.h_d_q7="#ffdc18",e.h_l_q2="#1B63B0",e.h_l_q3="#842FD3",e.h_l_q4="#be2ecf",e.h_l_q5="#c07200",e.h_l_q6="#c20002",e.h_l_q7="#b29700",e.h_c1="#20f878",e.h_c2="#ff5d42",e.h_c3="#d14d37"}(ColorComEnum||(ColorComEnum={})),window.ChatConstD=ChatConstD,window.ColorComEnum=ColorComEnum;var _a,_b,_c,_d,HtmlUtils=function(){function e(){}return e.font=function(e,t){return void 0===t&&(t=null),e},e.color=function(e,t){return"number"==typeof e?PHE.formatMark("color",t,"#"+e.toString(16)):"string"==typeof e?PHE.formatMark("color",t,e):t},e.colorRich=function(e,t){return StringUtils.rich(this.color(e,t))},e.link=function(e,t,i){return void 0===i&&(i=16763904),e?PHE.formatMark("linkText",t,e,"#"+i.toString(16)):t},e.bold=function(e){return"<b>"+e+"</b>"},e.size=function(e,t){return e>=0?PHE.formatMark("size",t,e):t},e.leading=function(e,t){return e?PHE.formatMark("leading",t,e):t},e.htmlTxt=function(e){return(new egret.HtmlTextParser).parser(e)},e.undeline=function(e){return(new egret.HtmlTextParser).parser("<font><u>"+e+"</u></font>")},e}();__reflect(HtmlUtils.prototype,"HtmlUtils"),window.HtmlUtils=HtmlUtils;var ImgTxtGroup=function(e){function t(t,i){void 0===t&&(t=415),void 0===i&&(i=18);var r=e.call(this)||this;r.REG_ICON=/\[.*?]/g,r._maxW=0,r._fontSize=18,r._textColor=16777215,r._stroke=0,r._strokeColor=0,r._lineSpacing=0,r._bold=0,r.litterBin=[],r._imgSize=0,r.emoSizeEqualLabel=!1;var n=r;n._maxW=t,n.fontSize=i,n.container=new eui.Group,n.addChild(r.container);var a=new eui.VerticalLayout;return n.container.layout=a,a.gap=10,n.invisibleGrp=new egret.DisplayObjectContainer,n.addChild(n.invisibleGrp),n.invisibleGrp.visible=!1,r}return __extends(t,e),Object.defineProperty(t.prototype,"imgSize",{get:function(){return this._imgSize},set:function(e){this._imgSize=e},enumerable:!0,configurable:!0}),t.getEmotionChar=function(e){if(!this.emotionToCNMaps){this.emotionToCNMaps=new Map;var t=Data.getSysValue("EMOTION_ID_CN")||{};for(var i in t)this.emotionToCNMaps.set(t[i],i)}return this.emotionToCNMaps.get(e)},t.prototype.onProperChange=function(e){"contentHeight"==e.property&&(this.height=this.container.contentHeight)},Object.defineProperty(t.prototype,"fontSize",{get:function(){return this._fontSize},set:function(e){var t=this;t._fontSize=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maxW",{get:function(){return this._maxW},set:function(e){var t=this;e!==t._maxW&&(t._maxW=e,t._source&&t.parser(t._source))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"stroke",{get:function(){return this._stroke},set:function(e){var t=this;t._stroke=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"bold",{get:function(){return this._bold},set:function(e){var t=this;t._bold=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"textColor",{get:function(){return this._textColor},set:function(e){var t=this;t._textColor=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"strokeColor",{get:function(){return this._strokeColor},set:function(e){var t=this;t._strokeColor=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"lineSpacing",{get:function(){return this._lineSpacing},set:function(e){var t=this;t._lineSpacing=e,t.container.layout&&(t.container.layout.gap=e)},enumerable:!0,configurable:!0}),t.prototype.parser=function(e){var i=this,r=this;r._source=e;var n=r.container;n&&n.removeChildren(),r.clearLitterbin();for(var a={},o=t.htmlParse.parse(e),s=0,l="",u=0,c=o;u<c.length;u++){var p=c[u];l+=p.text;for(var d=0;d<p.text.length;d++)a[s]=ObjectUtils.clone(p,!0),s++}e=l;for(var f,h=e.split(r.REG_ICON),v=e.match(r.REG_ICON)||[],m=0,y=r.maxW,g=[],d=0,b=v.length;b>d;d++)g[d]=r.createDisplayData(v[d]);g.reverse();for(var x=[],d=0;d<h.length;d++)0==h[d].length?g.length>0&&x.push(g.pop()):(x.push(h[d]),g.length>0&&x.push(g.pop()));for(var I=0,_=0,d=0;d<x.length;d++){var S=x[d];if(m>=y&&(f=null,m=0),!f){if(++_,r.oneLine&&_>1)break;f=new eui.Group,f.touchEnabled=!1;var T=new eui.HorizontalLayout;T.gap=2,T.paddingTop=T.paddingBottom=5,T.verticalAlign=egret.VerticalAlign.MIDDLE,f.layout=T,n.addChild(f)}if("string"==typeof S){var w=r.fetchSuitableTxt(S,y-m);if(w){m+=w.item.w,f.addChild(w.item.displayObj);for(var A=[],P=void 0,C=w.item.displayObj,D=!1,B=0;B<C.text.length;B++)P?P!=a[I]?(a[I].text=C.text.charAt(B),A.push(a[I]),P=a[I]):P.text+=C.text.charAt(B):(a[I].text=C.text.charAt(B),A.push(a[I]),P=a[I]),P.style&&P.style.href&&!D&&(D=!0),I++;C.textFlow=A,w.words.length>0&&x.splice(d+1,0,w.words)}else m=y,d--}else m+S.w<=y&&f.addChild(S.displayObj),I+=S.size,m+=S.w}egret.callLater(function(){i.height=i.contentHeight},this)},t.prototype.clearLitterbin=function(){if(this.litterBin){for(var e=0,t=this.litterBin;e<t.length;e++){var i=t[e];i.item.removeEventListener(i.item.evt,i.item.handler,i.item.thisObj)}this.litterBin=[]}},t.prototype.fetchSuitableTxt=function(e,t){var i=this.measureTxtW(e);if(t>=i)return{item:this.createDisplayData(e),words:""};for(var r=1;r<e.length&&!(this.measureTxtW(e.slice(0,r))>t);r++);var n;return r>1?(n=e.slice(r-1),e=e.slice(0,r-1),{item:this.createDisplayData(e),words:n}):null},t.prototype.measureTxtW=function(e){return Math.round(egret.sys.measureText(e,egret.TextField.default_fontFamily,this.fontSize,!!this.bold,!1))},t.prototype.createDisplayData=function(e){var i,r=this,n={};r.REG_ICON.lastIndex=0;var a=e.slice(1,-1),o=t.getEmotionChar(a);return r.REG_ICON.test(e)&&o?(i=new UIImage,i.source="emotion_"+o,r.emoSizeEqualLabel?i.width=i.height=r.fontSize:r._imgSize&&(i.width=i.height=r._imgSize)):(i=new eui.Label(e),i.size=r.fontSize,i.textColor=r.textColor,i.stroke=r.stroke,i.strokeColor=r.strokeColor,i.lineSpacing=r.lineSpacing,i.bold=!!this.bold),r.invisibleGrp.addChild(i),i.touchEnabled=!1,n.displayObj=i,n.w=i.width||60,n.id=e,n.size=e.length,n},t.prototype.$onAddToStage=function(t,i){e.prototype.$onAddToStage.call(this,t,i);var r=this;r.addEventListener(Evt.removedFromStage,r.onRemoveFromStage,r),r.container.addEventListener(Evt.propertyChange,this.onProperChange,this)},t.prototype.onRemoveFromStage=function(e){var t=this;t.removeEventListener(Evt.removedFromStage,t.onRemoveFromStage,t),t.container.removeEventListener(Evt.propertyChange,this.onProperChange,this),t.clearLitterbin()},t.htmlParse=new egret.HtmlTextParser,t}(eui.Group);__reflect(ImgTxtGroup.prototype,"ImgTxtGroup"),window.ImgTxtGroup=ImgTxtGroup;var KeyBoardMgr=function(){function e(){}return e.initialize=function(){var e=this;e.initialized||(e.initialized=!0,KeyBoard.initialize(),KeyBoard.down(e.onkeydown,e))},e.onkeydown=function(e){if(KeyBoard.shiftKey&&e==KeyBoard.F1&&(UI.isOpen("GMTestView")?UI.close("GMTestView"):UI.open("GMTestView")),KeyBoard.shiftKey&&e==KeyBoard.F2&&(UI.isOpen("PropCompareView")?UI.close("PropCompareView"):UI.open("PropCompareView")),KeyBoard.shiftKey&&e==KeyBoard.F3&&(DebugStatic.isShowRect=!DebugStatic.isShowRect),e==KeyBoard.F4&&DebugStatic.isOpenFrameOper&&SceneMgr.scene&&SceneMgr.scene.onEnterFrame(!1,0),KeyBoard.shiftKey&&e==KeyBoard.F4&&(DebugStatic.isOpenFrameOper=!DebugStatic.isOpenFrameOper,SceneMgr.scene&&SceneMgr.scene.changePauseFrame(DebugStatic.isOpenFrameOper)),KeyBoard.shiftKey&&e==KeyBoard.key_1){DebugStatic.isVideo=!DebugStatic.isVideo;var t=SceneMgr.scene;if(t instanceof Room){var i=PanelMgr.getUI(t.scenePanelId);i&&(i.visible=!DebugStatic.isVideo),t.roleList.forEach(function(e){e.visible_top=!DebugStatic.isVideo})}}if(KeyBoard.shiftKey&&e==KeyBoard.key_2&&(KeyBoard.ctrlKey?DebugStatic.isOpenMonsterTrig=!DebugStatic.isOpenMonsterTrig:DebugStatic.isOpenMonsterAI=!DebugStatic.isOpenMonsterAI),KeyBoard.shiftKey&&e==KeyBoard.key_3&&Player["in"]&&Player["in"].enterCity(),KeyBoard.shiftKey&&e==KeyBoard.key_4&&(DebugStatic.isOpenDPS=!DebugStatic.isOpenDPS,DebugStatic.resetDps(),DebugStatic.isOpenDPS?UI.open("GMDPSUI"):UI.close("GMDPSUI")),KeyBoard.shiftKey&&e==KeyBoard.key_5){var t=SceneMgr.scene;if(t instanceof Room&&t.player){var r="",n=t.player.avatar;if(n){r+="主角技能信息：";var a=n.svrSkills;a&&a.forEach(function(e){var t=Data.getItem("SkillData",e.id),i=StringUtils.padRight(e.id+"",5," "),n=StringUtils.padRight(t.name+"",10," "),a=StringUtils.padRight(e.lv+"",5," ");r+="\nid："+i+"等级："+a+"名称："+n}),r+="\n\n主角BUFF信息：";var o=n.svrBuffs;o&&o.forEach(function(e){var t=Data.getItem("BuffData",e.buffId),i=Data.getLvBaseValue(t.duration,e.lv,t.durbase,0),n=StringUtils.padRight(e.buffId+"",5," "),a=StringUtils.padRight(t.name+"",10," "),o=StringUtils.padRight(e.lv+"",5," "),s=StringUtils.padRight(0>i?"无限":i+"s",8," ");r+="\nid："+n+"等级："+o+"持续时间："+s+"名称："+a})}var s=t.player.pet;if(s){r+="\n\n守护灵BUFF信息：";var o=s.svrBuffs;o&&o.forEach(function(e){var t=Data.getItem("BuffData",e.buffId),i=Data.getLvBaseValue(t.duration,e.lv,t.durbase,0),n=StringUtils.padRight(e.buffId+"",5," "),a=StringUtils.padRight(t.name+"",10," "),o=StringUtils.padRight(e.lv+"",5," "),s=StringUtils.padRight(0>i?"无限":i+"s",8," ");r+="\nid："+n+"等级："+o+"持续时间："+s+"名称："+a})}}}if(e==KeyBoard.Backspace){var t=SceneMgr.scene;if(t instanceof RelayRoom&&t.player&&t.player.avatar){var n=t.player.avatar;n.skill.cds={},n.skill.subTimes={},n.skill.xuliTimes={},App.dispatch("c71",{owner:n}),t.player.petInfoList.forEach(function(e){!e.isEnd&&e.pet&&e.pet.skill&&(e.pet.skill.cds={},e.pet.skill.subTimes={},e.pet.skill.xuliTimes={},App.dispatch("c71",{owner:e.pet}))});var l=t.player.fruit;l&&l.skill&&(l.skill.cds={},l.skill.subTimes={},l.skill.xuliTimes={})}}KeyBoard.shiftKey&&e==KeyBoard.key_6&&(DebugStatic.statisticsId?DebugStatic.stopStatistics():DebugStatic.startStatistics()),KeyBoard.shiftKey&&e==KeyBoard.key_7&&(DebugStatic.soundPause=!DebugStatic.soundPause),KeyBoard.shiftKey&&e==KeyBoard.key_8&&(KeyBoard.ctrlKey?DebugStatic.isOpenPeTrig=!DebugStatic.isOpenPeTrig:DebugStatic.isOpenPetAI=!DebugStatic.isOpenPetAI),KeyBoard.shiftKey&&e==KeyBoard.key_9&&(DebugStatic.petTime=DebugStatic.petTime?0:1e6)},e}();__reflect(KeyBoardMgr.prototype,"KeyBoardMgr"),window.KeyBoardMgr=KeyBoardMgr;var LockStepUtils=function(){function e(){}return e.reg=function(e,t){if(e){var i=this.getLockStep(e);i.reg(t)}},e.unreg=function(e,t){var i=this.getLockStep(e);i&&i.unreg(t)},e.onEnterFrame=function(e,t){},e.command=function(e,t,i){for(var r=[],n=3;n<arguments.length;n++)r[n-3]=arguments[n];var a=this.getKeys();if(a[i]){var o=this.getLockStep(e);o&&o.command(t,i,r)}},e.code=function(e,t){var i=0;return t.forEach(function(t){i|=+e[t]}),i},e.upload=function(e,t){void 0===t&&(t=0);var i=this.lockSteps[e];i&&i.upload(t)},e.getLockStep=function(e){var t=this.lockSteps,i=t[e];return i||(i=t[e]=ObjectPool.pop(LockStep),i.initialize(e)),i},e.getKeys=function(){var e=this.keys;return e||(e=this.keys={},e.create_scene=!0,e.enter_room=!0,e.add_buff_1=!0,e.add_buff_2=!0,e.remove_buff=!0,e.use_skill_begin_1=!0,e.use_skill_begin_2=!0,e.use_skill_end=!0,e.agent_enter_scene=!0,e.role_enter_scene_1=!0,e.role_enter_scene_2=!0,e.bullet_enter_scene_1=!0,e.bullet_enter_scene_2=!0,e.agent_leave_scene=!0,e.role_leave_scene=!0,e.bullet_leave_scene=!0,e.start_move=!0,e.stop_move=!0,e.buff_effect_1=!0,e.buff_effect_2=!0,e.add_state=!0,e.remove_state=!0,e.change_action_state=!0,e.scene_start=!0,e.avatar_relive=!0,e.role_dead=!0,e.set_combo_skill=!0,e.change_press=!0,e.interrupt_xu_li=!0,e.pet_hide_1=!0,e.pet_hide_2=!0,e.pet_fuse_1=!0,e.pet_fuse_2=!0,e.next_round=!0,e.start_pre_war=!0,e.start_round_wait=!0,e.start_pvp_round=!0,e.stop_pvp_round=!0,e.round_time_out=!0,e.kill_target_1=!0,e.kill_target_2=!0,e.send_scene_loaded=!0,e.send_round_loaded=!0,e.send_hero_die_1=!0,e.send_hero_die_2=!0,e.send_hero_die_3=!0,e.send_hero_die_4=!0,e.send_hero_die_5=!0,e.send_hero_die_6=!0,e.send_pet_die_1=!0,e.send_pet_die_2=!0,e.send_remove_pet=!0,e.send_kill_monster=!0,e.room_role_dead_1=!0,e.room_role_dead_2=!0,e.pet_exeunt_scene=!0,e.set_scene_player=!0,e.clear_scene_player=!0,e.sync_battle_result=!0,e.check_auto_skill_1=!0,e.check_auto_skill_2=!0,e.check_auto_skill_3=!0,e.battle_over=!0,e.init_ai_trig=!0,e.remove_ai_trig=!0,e.remove_ai_trigs=!0,e.active_ai_trigs=!0,e.bullet_create=!0,e.ai_trig_bullet=!0,e.ai_check_trig=!0,e.ai_enter_frame=!0,e.pass_round=!0,e.on_pass_round=!0,e.check_room_wave=!0,e.spawn_next_monster=!0,e.on_stop_round_1=!0,e.on_stop_round_2=!0,e.on_portal_complete=!0,e.start_load_next_round=!0,e.start_next_round=!0,e.sync_next_round_ready=!0,e.on_next_round_ready_1=!0,e.on_next_round_ready_2=!0,e.on_agent_next_round=!0,e.start_portal_time_out=!0,e.stop_portal_timeout=!0,e.ability_dmg_dec=!0,e.cmd_next_round_ready=!0,e.stopmove_attack_action=!1,e.stopmove_ai_change_target=!1,e.stopmove_ai_next_round=!1,e.stopmove_ai_close_to_end=!1,e.stopmove_ai_close_to_destroy=!1,e.stopmove_ai_close_portal_end=!1,e.stopmove_ai_close_portal_destroy=!1,e.stopmove_ai_far_away_end=!1,e.stopmove_ai_far_away_destroy=!1,e.stopmove_ai_follow_avatar_destroy=!1,e.stopmove_ai_move_dest_end=!1,e.stopmove_ai_move_dest_destroy=!1,e.stopmove_ai_patrol_end=!1,e.stopmove_ai_patrol_destroy=!1,e.stopmove_skill_begin_end=!1,e.stopmove_tempt_add=!1,e.stopmove_avatar_touch_end=!1,e.stopmove_trans_begin=!1,e.stopmove_trans_stop=!1,e.stopmove_start_pvp_wait=!1,e.stopmove_stop_pvp_round=!1,e.stopmove_close_control=!1,e.stopmove_room_stop_ai=!1),e},e.dispose=function(e){var t=this.lockSteps,i=t[e];i&&i.dispose(),delete t[e]},e.lockSteps={},e}();__reflect(LockStepUtils.prototype,"LockStepUtils"),window.LockStepUtils=LockStepUtils;var Multiton=function(){function e(){}return e.set=function(e,t){var i=e.constructor,r=egret.getQualifiedClassName(i),n=this._instances[r];if(n){if(n[t])throw Error("Multiton instance already exists: "+r+":"+t);return void(n[t]=e)}this._add(i,e,t)},e._add=function(e,t,i){var r={};r[i]=t;var n=egret.getQualifiedClassName(e);this._instances[n]=r;var a=n.lastIndexOf(".");a>=0&&(this._instances[n.slice(a+1)]=r)},e.get=function(e,t){var i,r=egret.getQualifiedClassName(e),n=this._instances[r];return n?(i=n[t],i||(i=new e(t),n[t]=i)):(i=new e(t),n=this._instances[r],n?n[t]=i:this._add(e,i,t)),i},e.getByName=function(e,t){return this._instances[e]?this._instances[e][t]:null},e._instances={},e}();__reflect(Multiton.prototype,"Multiton"),window.Multiton=Multiton;var PlayerResMgr=function(){function e(){}return e}();__reflect(PlayerResMgr.prototype,"PlayerResMgr"),window.PlayerResMgr=PlayerResMgr;var PreloadUtils=function(){function e(){}return e.getPreloadUrls=function(e,t,i){for(var r=this,n={},a=[],o={},s=Data.getItem("BattleData",t),l=0,u=i;l<u.length;l++){var c=u[l];r.getPlayerUrls(e,o,a,c,n)}s.pNpcId&&r.getBattNpcUrls(e,o,a,s.pNpcId,!1,n);var p=s.allyNpcs;if(p)for(var d=0,f=p;d<f.length;d++){var h=f[d];r.getBattNpcUrls(e,o,a,h,!1,n)}var v=s.enemyNpcId;if(v)for(var m=0,y=v;m<y.length;m++){var g=y[m];r.getBattNpcUrls(e,o,a,g,!1,n)}var b=s.data;if(b)for(var x=0,I=b;x<I.length;x++){var _=I[x];r.getMonsterUrls(e,o,a,_,n)}var S=s.traps;if(S)for(var T=0,w=S;T<w.length;T++){var A=w[T];if(A)for(var P=0,C=A;P<C.length;P++){var D=C[P];r.getTrapAreaUrls(e,o,a,D,!1,n)}}if(e instanceof OfferRewardRoom||e instanceof InfernalHellRoom){var B=e.bossBuffs;if(B)for(var k=0,E=B;k<E.length;k++){var R=E[k];r.getBuffUrls(e,o,a,R.buffId,!1,null,null,null,!1,n,0,0)}}return r.getMapUrls(o,a,s.roundMap,s.portal),s.waveEffId&&r.getBattleEffectUrls(o,a,s.waveEffId),s.effectId&&r.getBattleEffectUrls(o,a,s.effectId),r.getTextureUrls(o,a,"1",1,Urls.halo()),a},e.getMapUrls=function(e,t,i,r){var n,a=this,o=Data.getItem("MapData",i),s=o.layer;if(s)for(var l=0,u=s;l<u.length;l++){var c=u[l];if(c.item)for(var p=0,d=c.item;p<d.length;p++){var f=d[p];n=Data.getItem("MapItemData",f),a.addUrls(e,t,Urls.mapRes(n.guise+"_min"))}}if(o.portals&&r){var h=o.portals[r-1];h&&h.portal&&a.getPortalUrls(e,t,h.portal)}},e.getPortalUrls=function(e,t,i){var r=Data.getItem("PortalData",i);r.guise&&this.getTextureUrls(e,t,r.guise,1,Urls.effect())},e.getBattleEffectUrls=function(e,t,i){var r=this,n=Data.getItem("BattleEffectData",i),a=n.datas;if(a)for(var o=0,s=a;o<s.length;o++){var l=s[o];l.res&&r.getTextureUrls(e,t,l.res,1,100==l.type?Urls.effect():Urls.uieff())}},e.getPlayerUrls=function(e,t,i,r,n){var a,o=this,s=e.isPetSally,l=r.weaponId,u=r.avatars,c=Player["in"],p=c&&r.side==e.masterSide&&r.rid!=c.rid&&!e.battleEffect;a=c&&r.rid==c.rid?!e.ownerPetEffect:c&&r.rid!=c.rid&&r.side==e.masterSide?!e.teamPetEffect:r.side!=e.masterSide?!e.enemyPetEffect:!1;for(var d=0,f=u;d<f.length;d++){var h=f[d];o.getAvatarUrls(e,t,i,h,r,p,n)}var v=e.getAgent(r.rid);if(v){var m=v.avatar;if(m&&m.transNpcCfg&&m.transNpcCfg.id&&o.getBattNpcUrls(e,t,i,m.transNpcCfg.id,!0,n),v&&v.pickupTrapList)for(var y=0,g=v.pickupTrapList;y<g.length;y++){var b=g[y];b&&b.trapCfg&&o.getTrapUrls(e,t,i,b.trapCfg.id,!1,n,0,0)}}var x=o.getBattPetMax(e.playId);r.pets.forEach(function(s,l){x>l&&o.getPetUrls(e,t,i,s,a,n,r.rid)});var I=r.fruit;if(I.fruitId&&o.getFruitUrls(e,t,i,I,p,n,r.rid),!s&&r.fashionId){var _=Data.getItem("ClothData",r.fashionId);o.getTextureUrls(t,i,_.res,_.resNum,Urls.fashion())}if(!s&&r.titleId){var S=Data.getItem("TitleData",r.titleId);o.getTextureUrls(t,i,S.res,S.resNum,Urls.title())}if(!s&&l){var T=Data.getItem("EquipApData",r.weaFasId||l);o.getTextureUrls(t,i,T.res,T.resNum,Urls.weapon())}if(!s&&l&&r.weaponRTimes){var w=Data.getItem("EquipApData",l);o.getTextureUrls(t,i,w.battleRes,w.battleResNum,Urls.weapon())}if(!s&&r.wingFasId){var A=Data.getItem("WingSkinData",r.wingFasId);o.getTextureUrls(t,i,A.exteriorRes,A.resNum,Urls.wing())}x>0&&r.pets.length>0&&o.getEffectUrls(t,i,+("20000"+r.job))},e.getAvatarUrls=function(e,t,i,r,n,a,o){for(var s=this,l={},u=r.buffs,c=0,p=u;c<p.length;c++){var d=p[c];l[d.buffId]=d.lv}for(var f=s.getHeroUrls(e,t,i,r.heroId,0,!1,n.aiid,0,n,!1,r.skills,l,n.equipSkillList,a,o,n.rid),h=0,v=u;h<v.length;h++){var d=v[h];s.getBuffUrls(e,t,i,d.buffId,!1,l,f.actbullets,f.unabullets,a,o,n.rid,r.heroId)}if(e.roomCfg.useItem)for(var m=n.useItems,y=0,g=m;y<g.length;y++){var d=g[y];s.getDrugUrls(e,t,i,d,l,a,o,n.rid)}if(e instanceof PvPRoom&&3==e.playType)for(var b=n.helpSkills,x=0,I=b;x<I.length;x++){var d=I[x];d&&s.getHelpSkillUrls(e,t,i,d,l,a,o,n.rid)}},e.getFruitUrls=function(e,t,i,r,n,a,o){for(var s=this,l={},u=r.buffs,c=0,p=u;c<p.length;c++){var d=p[c];l[d.buffId]=d.lv}for(var f=s.getHeroUrls(e,t,i,r.heroId,0,!1,0,0,null,!1,r.skills,l,null,n,a,o),h=0,v=u;h<v.length;h++){var d=v[h];s.getBuffUrls(e,t,i,d.buffId,!1,l,f.actbullets,f.unabullets,n,a,o,r.heroId)}},e.getDrugUrls=function(e,t,i,r,n,a,o,s){var l=this,u=Data.getItem("ItemData",r.itemId),c=Data.getItem("RoomItemUseData",u.bUseEff),p=c.buff;if(p)for(var d=0,f=p;d<f.length;d++){var h=f[d];l.getBuffUrls(e,t,i,h.id,!1,n,null,null,a,o,s,0)}},e.getHelpSkillUrls=function(e,t,i,r,n,a,o,s){var l=this,u=Data.getItem("HelpSkillData",r);u.buff&&l.getBuffUrls(e,t,i,u.buff,!1,n,null,null,a,o,s,0),u.ctid&&l.getBulletUrls(e,t,i,u.ctid,!1,n,null,null,a,o,s,0),u.ttid&&l.getBulletUrls(e,t,i,u.ttid,!1,n,null,null,a,o,s,0)},e.getPetUrls=function(e,t,i,r,n,a,o){for(var s=this,l={},u=r.buffs,c=0,p=u;c<p.length;c++){var d=p[c];l[d.buffId]=d.lv}for(var f=s.getHeroUrls(e,t,i,r.heroId,0,!1,0,0,null,!1,r.skills,l,null,n,a,o),h=0,v=u;h<v.length;h++){var d=v[h];s.getBuffUrls(e,t,i,d.buffId,!1,l,f.actbullets,f.unabullets,n,a,o,r.heroId)}s.getEffectUrls(t,i,7108)},e.getMonsterUrls=function(e,t,i,r,n){var a=this;r.sRate&&r.vGroupId&&a.getVariantGroupUrls(e,t,i,r.vGroupId,null,r.enter,r.effect,r.ai,r.monsterLevel,!1,n,r.monsterId),a.getHeroUrls(e,t,i,r.monsterId,r.enter,r.effect,r.ai,r.monsterLevel,null,!1,null,null,null,!1,n,0)},e.getBattNpcUrls=function(e,t,i,r,n,a){var o=this,s=Data.getItem("BattNpcData",r);!n&&s.heroId&&o.getHeroUrls(e,t,i,s.heroId,0,!1,s.aiId,s.lvId,null,!0,null,null,null,!1,a,0),3==s.type&&s.trans&&(s.trans.heroId&&o.getHeroUrls(e,t,i,s.trans.heroId,0,!1,0,0,null,!1,null,null,null,!1,a,0),s.trans.buffId&&o.getBuffUrls(e,t,i,s.trans.buffId,!0,null,null,null,!1,a,0,s.heroId),o.getEffectUrls(t,i,69084))},e.getTrapAreaUrls=function(e,t,i,r,n,a){var o=this;if(o.addLoadItem(a,"trapAreas",r)){var s,l,u=Data.getItem("TrapAreaData",r),c=u.datas;if(c)for(var p=0,d=c;p<d.length;p++){var f=d[p];if(f.isRandom){if(s=Data.getItem("TrapGroupData",f.groupId),!s)continue;if(l=s.datas,!l)continue;for(var h=0,v=l;h<v.length;h++){var m=v[h];o.getTrapUrls(e,t,i,m.trapId,n,a,0,0)}}else!f.index&&f.trapId&&o.getTrapUrls(e,t,i,f.trapId,n,a,0,0)}}},e.getTrapUrls=function(e,t,i,r,n,a,o,s){var l=this;if(l.addLoadHeroItem(a,"traps",o,s,r)){var u=Data.getItem("TrapData",r),c=16==e.playId;u.guise&&l.getEffectUrls(t,i,u.guise);var p,d=u.datas;if(d)for(var f=0,h=d;f<h.length;f++){var v=h[f];switch(p=c&&v.hasParty?v.pval:v.val,v.type){case 1:var m=p[0];m&&l.getBuffUrls(e,t,i,m,!1,null,null,null,n,a,o,s);break;case 2:var y=p[0];y&&l.getBulletUrls(e,t,i,y,!1,null,null,null,n,a,o,s);break;case 3:var g=p[0];g&&g!=r&&l.getTrapUrls(e,t,i,g,n,a,o,s);break;case 4:var b=p[0];b&&l.getSkillUrls(e,t,i,b,!1,null,null,null,null,null,null,n,a,o,s)}}}},e.getHeroUrls=function(e,t,i,r,n,a,o,s,l,u,c,p,d,f,h,v){var m=this,y=e.isPetSally,g=Data.getItem("HeroData",r),b=Data.getItem("HeroResData",g.guise),x={},I=s?Data.getItem("MonsterLevel",s):null,_=I?I.skillLv:null,S=b.spine;S&&(m.addUrls(t,i,Urls.spine()+S+".json"),m.addUrls(t,i,Urls.spine()+S+".atlas",RES.ResourceItem.TYPE_TEXT),m.addUrls(t,i,Urls.spine()+S+".png")),(y||!l||!l.fashionId)&&b.res&&m.getTextureUrls(t,i,b.res,b.resNum,Urls.hero()),(y||!l||!l.weaFasId&&!l.weaponId)&&b.weapon&&m.getTextureUrls(t,i,b.weapon,b.weaponNum,Urls.weapon()),a&&g.sskill&&(x[g.sskill]=1),g.normal&&(x[g.normal]=1),g.dodge&&(x[g.dodge]=1),g.escape&&(x[g.escape]=1),g.prot&&(x[g.prot]=1);
var T=g.defaults;if(T)for(var w=0,A=T;w<A.length;w++){var P=A[w];x[P]=1}if(c)for(var C=0,D=c;C<D.length;C++){var B=D[C];x[B.id]=B.lv,Data.isEnterSkill(B.id)&&!n&&(n=B.id)}n||(n=g.enter),n&&(x[n]=1),_&&g.skill&&g.skill.forEach(function(e,t){_[t]>0&&(x[e]=_[t])});var k,E,R,F,M,L,U,O,N,H,j,V,G;if(d){L={},U={},O={},N={},H={};for(var z=0,K=d;z<K.length;z++)k=K[z],E=Data.getItem("SkillForceData",k.id),F=E.sId,M=E.nId,F&&M&&x[F]&&(x[M]=x[F],delete x[F]);for(var W=0,X=d;W<X.length;W++){if(k=X[W],E=Data.getItem("SkillForceData",k.id),F=E.sId,M=E.nId,E.actionIds&&x[F]){j=L[F],j||(j=L[F]={});for(var q=0,$=E.actionIds;q<$.length;q++){var Y=$[q];j[Y]=!0}}if(E.bullet)for(var Q=0,J=E.bullet;Q<J.length;Q++){var B=J[Q];if(R=B.skillId){if(x[R]){if(B.atids){V=N[R],V||(V=N[R]={});for(var Z=0,et=B.atids;Z<et.length;Z++){var tt=et[Z];V[tt]=!0}}if(B.dtids){G=H[R],G||(G=H[R]={});for(var it=0,rt=B.dtids;it<rt.length;it++){var tt=rt[it];G[tt]=!0}}}}else{if(B.atids)for(var nt=0,at=B.atids;nt<at.length;nt++){var tt=at[nt];U[tt]=!0}if(B.dtids)for(var ot=0,st=B.dtids;ot<st.length;ot++){var tt=st[ot];O[tt]=!0}}}}}for(var lt in x)R=+lt,m.getSkillUrls(e,t,i,R,u,p,U,O,N,H,L,f,h,v,r);if(g.callEff&&m.getTextureUrls(t,i,"77_1",1,Urls.uieff()),g.callEff&&m.getTextureUrls(t,i,"77_"+g.id,1,Urls.uieff()),g.ba&&g.ba.buff&&m.getBuffUrls(e,t,i,g.ba.buff,u,p,U,O,f,h,v,r),g.idleBuff&&m.getBuffUrls(e,t,i,g.idleBuff,u,p,U,O,f,h,v,r),g.moveBuff&&m.getBuffUrls(e,t,i,g.moveBuff,u,p,U,O,f,h,v,r),g.upBuff&&m.getBuffUrls(e,t,i,g.upBuff,u,p,U,O,f,h,v,r),I&&I.buff)for(var ut=0,ct=I.buff;ut<ct.length;ut++){var B=ct[ut];B.lv&&m.getBuffUrls(e,t,i,B.name,u,p,U,O,f,h,v,r)}return o=o||g.ai,o&&m.getAIUrls(e,t,i,o,l,u,x,p,U,O,N,H,L,f,h,r),{skillLvs:x,actbullets:U,unabullets:O,sactbullets:N,sunabullets:H,actactions:L}},e.getVariantGroupUrls=function(e,t,i,r,n,a,o,s,l,u,c,p){var d=this,f=n?n.rid:0;if(d.addLoadHeroItem(c,"variantGroups",f,p,r)){var h=Data.getItem("VariantGroupData",r),v=h.data;if(v)for(var m=0,y=v;m<y.length;m++){var g=y[m];d.getVarientUrls(e,t,i,g.variantId,n,a,o,s,l,u,c,p)}}},e.getVarientUrls=function(e,t,i,r,n,a,o,s,l,u,c,p){var d=this,f=n?n.rid:0;if(d.addLoadHeroItem(c,"variants",f,p,r)){var h=Data.getItem("VariantData",r);h.buff&&d.getBuffUrls(e,t,i,h.buff,!1,null,null,null,u,c,f,p),h.trig&&d.getAITrigUrls(e,t,i,h.trig,n,!1,null,null,null,null,null,null,null,u,c,p),h.ai&&d.getAIUrls(e,t,i,h.ai,n,!1,null,null,null,null,null,null,null,u,c,p),h.heroId&&d.getHeroUrls(e,t,i,h.heroId,a,o,h.ai||s,l,null,!1,null,null,null,u,c,0)}},e.getAIUrls=function(e,t,i,r,n,a,o,s,l,u,c,p,d,f,h,v){var m=this,y=n?n.rid:0;if(m.addLoadHeroItem(h,"ais",y,v,r)){var g=Data.getItem("AIData",r);g.idle&&m.getAIActionUrls(e,t,i,g.idle,a,s,l,u,f,h,y,v),g.battle&&m.getAIActionUrls(e,t,i,g.battle,a,s,l,u,f,h,y,v),g.trig&&m.getAITrigUrls(e,t,i,g.trig,n,a,o,s,l,u,c,p,d,f,h,v)}},e.getAITrigUrls=function(e,t,i,r,n,a,o,s,l,u,c,p,d,f,h,v){var m=this,y=n?n.rid:0;if(m.addLoadHeroItem(h,"trigs",y,v,r)){var g=Data.getItem("AITrigData",r),b=g.datas;if(b)for(var x=0,I=b;x<I.length;x++){var _=I[x];_.subId&&m.getAISubTrigUrls(e,t,i,_.subId,!0,!1,n,a,o,s,l,u,c,p,d,f,h,v)}}},e.getAISubTrigUrls=function(e,t,i,r,n,a,o,s,l,u,c,p,d,f,h,v,m,y){var g=this,b=o?o.rid:0,x=Data.getItem("AISubTrigData",r),I=e.playId;if(!a){var _=!0,S=x.actVal;switch(x.actType){case 1:_=!0;break;case 2:_=!n;break;case 3:_=10==I||e instanceof InfernalHellRoom&&1==e.dtype;break;case 4:_=e.isAllPetUp;break;case 5:_=!0;break;case 6:_=S&&e instanceof RelayRoom&&-1!=S.indexOf(e.dungeonId);break;case 7:_=S&&S[0]&&u&&!!u[S[0]];break;case 8:_=S&&S[0]&&o&&o.hellLvId>=S[0];break;case 9:_=S&&S[0]&&l&&(l[S[0]]||0)>=(S[1]||0);break;case 10:_=S&&-1!=S.indexOf(I);break;case 11:_=e instanceof RelayRoom;break;case 12:_=e instanceof PvPRoom;break;case 14:_=S&&S[0]&&o&&o.equipSkillList.some(function(e){return e.id==S[0]});break;case 15:_=S&&e instanceof FairyLandTrialsRoom&&-1!=S.indexOf(e.trialsCfg.t);break;case 13:if(e instanceof RelayRoom&&o&&e.roomCfg.ability){var T=e.getEquipScore();_=18==I?o.petAbility>T:o.ability>T}}if(!_)return}if(g.addLoadHeroItem(m,"subTrigs",b,y,r)){var w=x.actSubs;if(w)for(var A=0,P=w;A<P.length;A++){var C=P[A];g.getAISubTrigUrls(e,t,i,C,!1,x.skipAct,o,s,l,u,c,p,d,f,h,v,m,y)}x.skillId&&g.getSkillUrls(e,t,i,x.skillId,s,u,c,p,d,f,h,v,m,b,y);var D=x.datas;if(D)for(var B,k=function(r){switch(B=r.val,r.type){case 2:B&&B[0]&&g.getBulletUrls(e,t,i,B[0],s,u,c,p,v,m,b,y);break;case 3:B&&B.forEach(function(r){r&&g.getBulletUrls(e,t,i,r,s,u,c,p,v,m,b,y)});break;case 4:B&&B[0]&&g.getBuffUrls(e,t,i,B[0],s,u,c,p,v,m,b,y);break;case 5:B&&B.forEach(function(r){r&&g.getBuffUrls(e,t,i,r,s,u,c,p,v,m,b,y)});break;case 7:B&&B[0]&&g.getAIUrls(e,t,i,B[0],o,s,l,u,c,p,d,f,h,v,m,y);break;case 8:B&&B[0]&&g.getAIActionUrls(e,t,i,B[0],s,u,c,p,v,m,b,y);break;case 14:B&&B[0]&&g.getTrapUrls(e,t,i,B[0],v,m,b,y);break;case 16:B&&B[1]&&3!=B[2]&&g.getHeroUrls(e,t,i,B[1],B[11],!!B[13],B[12],B[0],null,!1,null,null,null,v,m,b);break;case 25:B&&B[3]&&g.getBulletUrls(e,t,i,B[3],s,u,c,p,v,m,b,y);break;case 27:B&&B[0]&&g.getEffectUrls(t,i,B[0]);break;case 29:B&&B[1]&&g.getBuffUrls(e,t,i,B[1],s,u,c,p,v,m,b,y);break;case 30:B&&B[1]&&String(B[1]).split(":").forEach(function(e){e&&g.getEffectUrls(t,i,+e)});break;case 36:B&&B[0]&&g.getBulletUrls(e,t,i,B[0],s,u,c,p,v,m,b,y);break;case 37:B&&B[0]&&g.getBuffUrls(e,t,i,B[0],s,u,c,p,v,m,b,y);break;case 40:B&&B[0]&&g.getBulletUrls(e,t,i,B[0],s,u,c,p,v,m,b,y);break;case 42:B&&B[0]&&g.getHeroUrls(e,t,i,B[0],0,!1,0,0,null,!1,null,null,null,v,m,b);break;case 45:B&&B[0]&&g.getBuffUrls(e,t,i,B[0],s,u,c,p,v,m,b,y);break;case 33:B&&(B[2]&&g.getBuffUrls(e,t,i,B[2],s,u,c,p,v,m,b,y),B[3]&&g.getBuffUrls(e,t,i,B[3],s,u,c,p,v,m,b,y));break;case 46:if(o&&o.pets.length>0&&5!=I&&12!=I&&18!=I){var n,a=g.getBattPetMax(I);o.pets.forEach(function(r,o){o>=a||(n=Data.getItem("PetKillData",r.petId),n.tid&&g.getBulletUrls(e,t,i,n.tid,s,u,c,p,v,m,b,y))})}}},E=0,R=D;E<R.length;E++){var F=R[E];k(F)}}},e.getAIActionUrls=function(e,t,i,r,n,a,o,s,l,u,c,p){var d=this;if(d.addLoadHeroItem(u,"actions",c,p,r)){var f,h=Data.getItem("AIActionData",r),v=h.actions;if(v)for(var m=0,y=v;m<y.length;m++){var g=y[m];f=g.vals,12==g.type&&f&&f[5]&&d.getBuffUrls(e,t,i,f[5],n,a,o,s,l,u,c,p)}}},e.getSkillUrls=function(e,t,i,r,n,a,o,s,l,u,c,p,d,f,h){var v=this;if(v.addLoadHeroItem(d,"skills",f,h,r)){var m=Data.getItem("SkillData",r),y=c?c[r]:null,g=l?l[r]:null,b=u?u[r]:null;!p&&m.nameEff&&v.getEffectUrls(t,i,m.nameEff);var x=m.ebuff;if(x)for(var I=0,_=x;I<_.length;I++){var S=_[I];v.getBuffUrls(e,t,i,S,n,a,o,s,p,d,f,h)}if(m.hasSub)for(var T=0,w=m.sub;T<w.length;T++){var A=w[T];A.skillId&&A.skillId!=r&&v.getSkillUrls(e,t,i,A.skillId,n,a,o,s,l,u,c,p,d,f,h)}if(m.at)for(var P=0,C=m.at;P<C.length;P++){var D=C[P];if(!D.aid||y&&y[D.aid]){if(!p&&D.eff&&v.getEffectUrls(t,i,D.eff),D.buff)for(var B=0,k=D.buff;B<k.length;B++){var E=k[B];v.getBuffUrls(e,t,i,E,n,a,o,s,p,d,f,h)}if(D.tid&&(!b||!b[D.tid])&&v.getBulletUrls(e,t,i,D.tid,n,a,o,s,p,d,f,h),D.tids)for(var R=0,F=D.tids;R<F.length;R++){var M=F[R];b&&b[M]||v.getBulletUrls(e,t,i,M,n,a,o,s,p,d,f,h)}if(D.atids)for(var L=0,U=D.atids;L<U.length;L++){var M=U[L];g&&g[M]&&v.getBulletUrls(e,t,i,M,n,a,o,s,p,d,f,h)}if(D.wid)for(var O=0,N=D.wid;O<N.length;O++){var H=N[O];v.getWarnUrls(t,i,H)}if(D.rtid&&(!b||!b[D.rtid])&&v.getBulletUrls(e,t,i,D.rtid,n,a,o,s,p,d,f,h),D.rtids)for(var j=0,V=D.rtids;j<V.length;j++){var M=V[j];b&&b[M]||v.getBulletUrls(e,t,i,M,n,a,o,s,p,d,f,h)}if(D.ratids)for(var G=0,z=D.ratids;G<z.length;G++){var M=z[G];g&&g[M]&&v.getBulletUrls(e,t,i,M,n,a,o,s,p,d,f,h)}}}}},e.getBulletUrls=function(e,t,i,r,n,a,o,s,l,u,c,p){var d=this;if(d.addLoadHeroItem(u,"bullets",c,p,r)){var f=Data.getItem("BulletTrigData",r),h=Data.getItem("BulletData",f.bid);if(!f.allPetBreak||!n&&5!=e.playId&&12!=e.playId&&18!=e.playId){if(!l&&h&&h.guise&&d.getEffectUrls(t,i,h.guise),h&&h.etids)for(var v=0,m=h.etids;v<m.length;v++){var y=m[v];s&&s[y]||d.getBulletUrls(e,t,i,y,n,a,o,s,l,u,c,p)}if(h&&h.aetids)for(var g=0,b=h.aetids;g<b.length;g++){var y=b[g];o&&o[y]&&d.getBulletUrls(e,t,i,y,n,a,o,s,l,u,c,p)}if(h&&h.trigs)for(var x=0,I=h.trigs;x<I.length;x++){var _=I[x];if(_.ids)for(var S=0,T=_.ids;S<T.length;S++){var y=T[S];s&&s[y]||d.getBulletUrls(e,t,i,y,n,a,o,s,l,u,c,p)}if(_.aids)for(var w=0,A=_.aids;w<A.length;w++){var y=A[w];o&&o[y]&&d.getBulletUrls(e,t,i,y,n,a,o,s,l,u,c,p)}}if(h&&h.warnId&&d.getWarnUrls(t,i,h.warnId),h&&h.buffs)for(var P=0,C=h.buffs;P<C.length;P++){var D=C[P];if(D.eff&&d.getEffectUrls(t,i,D.eff),D.buff&&d.getBuffUrls(e,t,i,D.buff,n,a,o,s,l,u,c,p),D.hbuff)for(var B=0,k=D.hbuff;B<k.length;B++){var E=k[B];a&&a[E]&&d.getBuffUrls(e,t,i,E,n,a,o,s,l,u,c,p)}if(D.sbuff&&d.getBuffUrls(e,t,i,D.sbuff,n,a,o,s,l,u,c,p),D.dbuff)for(var R=0,F=D.dbuff;R<F.length;R++){var E=F[R];d.getBuffUrls(e,t,i,E,n,a,o,s,l,u,c,p)}if(D.lvbuff)for(var M=0,L=D.lvbuff;M<L.length;M++){var E=L[M];a&&a[E]&&d.getBuffUrls(e,t,i,E,n,a,o,s,l,u,c,p)}D.atid&&o&&o[D.atid]&&d.getBulletUrls(e,t,i,D.atid,n,a,o,s,l,u,c,p)}}}},e.getBuffUrls=function(e,t,i,r,n,a,o,s,l,u,c,p){var d=this;if(d.addLoadHeroItem(u,"buffs",c,p,r)){var f=Data.getItem("BuffData",r);if(f.hpeff&&d.getTextureUrls(t,i,"706",1,Urls.uieff()),f.isHalo&&f.hceffect&&d.getEffectUrls(t,i,f.hceffect),f.aeffect&&d.getEffectUrls(t,i,f.aeffect),f.ceffect&&d.getEffectUrls(t,i,f.ceffect),f.reffect&&d.getEffectUrls(t,i,f.reffect),f.seffect&&d.getEffectUrls(t,i,f.seffect),f.gbuff&&d.getBuffUrls(e,t,i,f.gbuff,n,a,o,s,l,u,c,p),f.sbuff&&d.getBuffUrls(e,t,i,f.sbuff,n,a,o,s,l,u,c,p),f.btid&&d.getBulletUrls(e,t,i,f.btid,n,a,o,s,l,u,c,p),f.isTrig&&f.trig){var h=f.trig;if(h.buff)for(var v=0,m=h.buff;v<m.length;v++){var y=m[v];d.getBuffUrls(e,t,i,y,n,a,o,s,l,u,c,p)}h.btid&&(!s||!s[h.btid])&&d.getBulletUrls(e,t,i,h.btid,n,a,o,s,l,u,c,p),h.batid&&o&&o[h.batid]&&d.getBulletUrls(e,t,i,h.batid,n,a,o,s,l,u,c,p)}}},e.getWarnUrls=function(e,t,i){var r=Data.getItem("WarnData",i);this.getTextureUrls(e,t,r.guise,1,Urls.effect())},e.getEffectUrls=function(e,t,i){var r=this,n=Data.getItem("EffectData",i);n.res&&r.getTextureUrls(e,t,n.res,n.resNum,Urls.effect())},e.getTextureUrls=function(e,t,i,r,n){var a=this;if(r=r||1,a.addUrls(e,t,n+i+".json"),1==r)return void a.addUrls(e,t,n+i+".png");for(var o=1;r>=o;o++)a.addUrls(e,t,n+i+"_"+o+".png")},e.addUrls=function(e,t,i,r){if(!e[i]){var n={url:i,resItem:r};e[i]=n,t.push(n)}},e.getBattPetMax=function(e){return 5==e||12==e?4:18==e||1005==e?0:2},e.addLoadItem=function(e,t,i){var r=e[t];return r||(r=e[t]={}),r[i]?!1:(r[i]=!0,!0)},e.addLoadPlayerItem=function(e,t,i,r){var n=e[t];n||(n=e[t]={});var a=n[i];return a||(a=n[i]={}),a[r]?!1:(a[r]=!0,!0)},e.addLoadHeroItem=function(e,t,i,r,n){var a=e[t];a||(a=e[t]={});var o=a[i];o||(o=a[i]={});var s=o[r];return s||(s=o[r]={}),s[n]?!1:(s[n]=!0,!0)},e}();__reflect(PreloadUtils.prototype,"PreloadUtils"),window.PreloadUtils=PreloadUtils;var PropUtils=function(){function e(){}return e.getCeilValue=function(e,t){e=e||0,t=t||1;var i=1/t;return Math.ceil(e*i)/i},e.getFixedValue=function(e,t){e=e||0,t=t||1;var i=Fixed.value(1).div(t).value;return Fixed.value(e).mul(i).ceil().div(i).value},e.minusValue=function(e,t,i){var r=1,n=Data.getOppItem("AttDouble",i);n&&n.accuracy&&(r=1/n.accuracy);var a=t*r-e*r,o=a/r;return o},e.getAttrCeilValue=function(e,t){var i=1,r=Data.getOppItem("AttDouble",t);return r&&r.accuracy&&(i=r.accuracy),this.getCeilValue(e,i)},e.getAttrFixedValue=function(e,t){var i=1,r=Data.getOppItem("AttDouble",t);return r&&r.accuracy&&(i=r.accuracy),this.getFixedValue(e,i)},e.getPropsByCfg=function(e){if(!e||!e.length)return[];for(var t=e.length,i=[],r=0;t>r;r++){var n=e[r];if(n&&n.name){var a=this.getAttrCeilValue(n.val||0,n.name);i.push({name:n.name||"",val:a,cname:this.getCName(n.name)})}}return i},e.percent=function(e,t){if(!e||!t)return e;var i=1,r=Data.getOppItem("AttDouble",t);return r&&r.accuracy&&(i=r.accuracy),r.feature?Math.floor(1e4*e)/100:e},e.getCName=function(e){var t=Data.getOppItem("AttDouble",e);return t?t.cname:""},e.getCfg=function(e){return Data.getOppItem("AttDouble",e)},e.percentStr=function(e,t){if(!t)return"";var i=typeof e;e=e||0;var r=1,n=Data.getOppItem("AttDouble",t);if(n&&n.accuracy&&(r=n.accuracy),n.feature){if("number"===i)return Math.floor(1e4*e)/100+"%";if("string"===i)return e+"%"}else{if("number"===i)return this.getCeilValue(e,r)+"";if("string"===i)return e}},e.addPropToList=function(e,t,i){if(e&&t&&i){for(var r=0,n=i;r<n.length;r++){var a=n[r],o=t[a.name];o?o.val+=a.val:(o={name:a.name,cname:a.cname,val:a.val},t[a.name]=o,e.push(o))}return e}},e.getPropNameById=function(e){var t=Data.getItem("AttData",e);return t?t.name:""},e.getPropIdByName=function(e){var t=Data.getOppItem("AttData",e);return t?t.id:0},e.getSplitText=function(e,t,i){var r=void 0!==t,n=void 0!==i,a=[],o=[],s={name:a,val:o};if(!e||!e.length)return s;for(var l=0,u=e;l<u.length;l++){var c=u[l],p=Data.getOppItem("AttDouble",c.name);if(p){var d=this.percentStr(c.val,c.name);a.push(r?HtmlUtils.color(t,p.cname):p.cname),o.push(n?HtmlUtils.color(i,d):d)}}return s},e.getMergeText=function(t,i){for(var r=[],n=2;n<arguments.length;n++)r[n-2]=arguments[n];var a=[];if(r=r||[],!t||!t.length)return a;t=this.sortAttrs(t);for(var o=0;o<t.length;o++){var s=t[o];t||a.push(""),a.push(e.getOnePropText(s,i,r[o]))}return a},e.getMergeText1=function(t,i,r){void 0===r&&(r=!0);for(var n=[],a=3;a<arguments.length;a++)n[a-3]=arguments[a];var o=[];if(n=n||[],!t||!t.length)return o;r&&(t=this.sortAttrs(t));for(var s=0;s<t.length;s++){var l=t[s];t||o.push(""),o.push(e.getOnePropText(l,i,n[s]))}return o},e.getMergeRichText=function(e,t){for(var i=[],r=2;r<arguments.length;r++)i[r-2]=arguments[r];return StringUtils.rich(this.getMergeText.apply(this,[e,t].concat(i)).join("\n"))},e.getOnePropText=function(e,t){void 0===t&&(t="{$0}: {$1}");for(var i=[],r=2;r<arguments.length;r++)i[r-2]=arguments[r];if(!e)return"";var n=this.getValueAndName(e),a=n.cname,o=n.val,s=this.percentStr(o,n.name);return PHE.format(t,[a,s].concat(i))},e.getTwoPropText=function(e,t,i){void 0===i&&(i="{$0}: {$1}");for(var r=[],n=3;n<arguments.length;n++)r[n-3]=arguments[n];if(!e&&!t)return"";var a=this.getValueAndName(e),o=this.getValueAndName(t),s=a.cname,l=a.val,u=this.percentStr(l,a.name);return a.val!=o.val&&(u="["+u+"-"+this.percent(o.val,o.name)+"]"),PHE.format(i,[s,u].concat(r))},e.transPropByServerType=function(e,t){void 0===t&&(t=!0);for(var i=e?e.attrs||[]:[],r=[],n=0,a=i;n<a.length;n++){var o=a[n];if(t||o.value){var s=Data.getItem("AttData",o.property);s&&r.push({name:o.property,val:o.value,cname:s.cname})}}return r},e.transPropFromServer=function(t,i){var r=DropUtils.getEntryDesc({l:t},i);return e.transPropByServerType(r)},e.transCfgByServerEntry=function(e){var t=[];if(!e)return t;var i=e.l;if(!i||!i.length)return t;for(var r=0,n=i;r<n.length;r++){var a=n[r];t.push(Data.getItem("EntryData",a.i))}return t},e.getEntryMaxValue=function(e){if(!e)return 0;var t=e.value;if(!t||!t.length)return 0;var i=t[t.length-1];return i?i.max||i.min||0:0},e.diffProps=function(e,t,i,r){void 0===i&&(i=!1),void 0===r&&(r=!1);for(var n,a={},o={},s={},l=0,u=e;l<u.length;l++)n=u[l],a[n.name]=!0,o[n.name]=n;for(var c=0,p=t;c<p.length;c++)n=p[c],a[n.name]=!0,s[n.name]=n;var d=[],f=[],h=[];for(var v in a){var m=o[v]||{name:v,val:0},y=s[v]||{name:v,val:0};m.cname||(m.cname=y.cname);var g=m.val||0,b=y.val||0;(i||g||b)&&(r&&g===b||(d.push(m),f.push(y),h.push({name:v,val:g,nextVal:b,diff:this.minusValue(g,b,v),cname:y.cname})))}return{curPropList:d,nextPropList:f,diffPropList:h}},e.mergePropGroup=function(e,t,i){void 0===t&&(t=0),void 0===i&&(i=!1);var r=[];if(!e)return r;var n=e.length;if(!n)return r;for(var a={},o=[],s=0;n>s;s++){var l=o[s]={},u=e[s];if(u&&u.length)for(var c=0,p=u;c<p.length;c++){var d=p[c];a[d.name]=!0,l[d.name]=d}}for(var f in a){for(var h=f,v=this.getCName(f),d={name:h,cname:v,val:0,valList:[],valStrList:[],level:t},m=!1,s=0;n>s;++s){var y=o[s];if(y){var g=y[f];if(g){!m&&g.val&&(m=!0);var b=this.getValueAndName(g);s===t&&(d.val=b.val),d.valList.push(b.val),d.valStrList.push(b.valStr)}}}(i||m)&&r.push(d)}return r},e.mergeProps=function(e){for(var t,i,r=new HashMap,n=e.length;n--;)i=e[n],t=r.getValue(i.name),t?t.val+=i.val:(t=ObjectUtils.clone(i),r.add(t.name,t));return r.valueSet},e.clearEmptyProps=function(e){var t=[];if(!e)return t;for(var i=0,r=e;i<r.length;i++){var n=r[i];n.val&&t.push(n)}return t},e.getValueAndName=function(t){var i={name:"",cname:"",val:0,valStr:""};if(!t)return i;if(t.cname){var r=t;i.name=r.name,i.cname=r.cname,i.val=r.val,i.valStr=this.percentStr(r.val,r.name)}else if(t.name){var r=t;i.name=r.name,i.cname=e.getCName(r.name),i.val=r.val,i.valStr=this.percentStr(r.val,r.name)}else if(t.property){var r=t;i.name=r.property,i.cname=e.getCName(r.property),i.val=r.value,i.valStr=this.percentStr(r.value,r.property)}return i},e.getFilterAttrs=function(e,t,i,r){void 0===i&&(i=!1),void 0===r&&(r=!0);var n,a=[],o=[];for(var s in t)n=t[s],o.push(Data.getItem("AttData",n));r&&o.sort(function(e,t){return e.showSort-t.showSort||e.id-t.id});var l;return o.forEach(function(t,r){l=e.gv(t.name),i&&0==l||a.push(Data.getAttVo(t.id,l))}),a},e.sortAttrs=function(e){var t,i,r=e;return r.sort(function(e,r){return t=Data.getOppItem("AttDouble",e.name),i=Data.getOppItem("AttDouble",r.name),t.showSort>0&&i.showSort>0?t.showSort-i.showSort||t.id-i.id:t.id-i.id}),r},e.sortEntry=function(e){var t,i,r,n,a=e.concat();return a.sort(function(e,a){return t=Data.getItem("EntryData",e.i),i=Data.getItem("EntryData",a.i),t&&i?(r=Data.getItem("AttData",t.attr),n=Data.getItem("AttData",i.attr),r&&n?r.showSort-n.showSort||r.id-n.id:0):0}),a},e.getNamesVals=function(e){var t=[],i=[];return e.forEach(function(e,r){t[r]=e.cname,i[r]=e.des}),{names:t,nums:i}},e.addNameFromId=function(e){if(e&&!(e.length<1)){var t;if(isNaN(+e[0].name)||(t="name"),t)for(var i=e.length,r=void 0,n=void 0;i--;)r=e[i],n=Data.getOppItem("AttDouble",r[t]),r.id=n.id,r.name=n.name}},e.formatProps=function(t,i,r,n){var a=this;if(void 0===r&&(r=1),2===r){(!n||!n.noSort)&&e.sortAttrs(t);var o,s;o=[],s=[],t.forEach(function(t,i){o[i]=e.getCName(t.name),s[i]=a.percentStr(t.val,t.name),n&&n.curValStyle&&(s[i]=PHE.format(n.curValStyle,[s[i]]))}),i[0].text=o.join("\n"),i[1].text=s.join("\n")}else if(1===r){e.sortAttrs(t);var l,u,c,p;l=[],u=[],c=[],p=[],t.forEach(function(t,i){i%2===0?(l.push(e.getCName(t.name)+":"),c.push(a.percentStr(t.val,t.name))):(u.push(e.getCName(t.name)+":"),p.push(a.percentStr(t.val,t.name)))}),i[0].text=l.join("\n"),i[1].text=u.join("\n"),i[2].text=c.join("\n"),i[3].text=p.join("\n")}else if(3===r){if(!t[0]||!t[1])return;var d=this.diffProps(t[0],t[1],n&&n.empty);e.sortAttrs(d.diffPropList);var f,h,v;f=[],h=[],v=[],d.diffPropList.forEach(function(t,i){f[i]=e.getCName(t.name),h[i]=a.percentStr(t.val,t.name),v[i]=a.percentStr(t.nextVal,t.name)}),i[0].text=f.join("\n"),i[1].text=h.join("\n"),i[2]&&(i[2].text=v.join("\n"))}else if(4===r){var m=t[0],y=t[1];if(!m)return;var g=void 0,b=void 0,x=void 0,I=void 0,_=void 0;if(g=i[0],b=i[1],x=i[2],I=i[3],_=i[4],i.forEach(function(e){e&&(e.visible=!0)}),y){var S=n&&!n.showAll&&n.diff,d=this.diffProps(m,y,n&&n.empty,S);(!n||!n.noSort)&&e.sortAttrs(d.diffPropList);var T,w,A,P,C;T=[],w=[],A=[],P=[],C=[];var D=[];d.diffPropList.forEach(function(t,i){T[i]=e.getCName(t.name),C[i]=a.percentStr(t.nextVal,t.name),w[i]=a.percentStr(t.val,t.name),A[i]=n&&!n.diff||0!==t.diff?a.percentStr(t.diff,t.name):"",n&&n.next?P[i]=a.percentStr(t.nextVal,t.name):P[i]=n&&!n.diff||0!==t.diff?a.percentStr(t.nextVal,t.name):"",D[i]=n&&!n.diff||0!==t.diff?"":!1,n&&n.nextSameColor&&0===t.diff&&(P[i]="{color:"+n.nextSameColor+"}"+P[i]+"{/color}")}),g.text=T.join("\n"),n&&n.useNext?b.text=C.join("\n"):b.text=w.join("\n"),_&&(n&&n.nextSameColor?_.textFlow=CommonUtils.rich(P.join("\n")):_.text=P.join("\n")),x&&(x.text=A.join("\n")),I&&(D.length=T.length,I.dataProvider.source=D)}else this.formatProps(m,[g,b],2),x&&(x.visible=!1),I&&(I.visible=!1),_&&(_.visible=!1)}},e.splitProps=function(e,t){void 0===t&&(t=2);var i;i=[];for(var r=t;r--;)i[r]=[];return e.forEach(function(e,r){i[r%t].push(e)}),i},e.getPropFromDEntryIds=function(e){var t,i=DropUtils.dropEntryList(e).attrs,r=[];return i.forEach(function(e,i){t=Data.getItem("AttData",e.property),t&&r.push({name:t.name,val:e.value})}),r},e}();__reflect(PropUtils.prototype,"PropUtils"),window.PropUtils=PropUtils;var SoundUtils=function(){function e(){}return e.initialize=function(){var e=this;if(!e.initialized){e.initialized=!0,App.addL("app_pause",e.onAppPause,e),App.addL("app_resume",e.onAppResume,e),App.addL("app_ui_show",e.onUIShow,e),App.addL("app_ui_hide",e.onUIHide,e),SoundPlayer.maxLimitCount=32,e.battleSounds={};for(var t=e.limitCounts={1:5,2:1,3:5,4:79,5:5,6:20},i=1;6>=i;i++)SoundPlayer.setChannelLimitCount(i,t[i]||1);var r=SoundPlayer.getPlayer(6);r.setVolumeRate(.8)}},e.onAppPause=function(e){GameLog.info("应用暂停"),this.onSoundPause()},e.onAppResume=function(e){GameLog.info("应用继续"),this.onSoundResume()},e.onUIShow=function(e){var t=e.data;if(t){var i=t.view;i&&i.bgmUrl&&(this.playingUIBgm=i.hashCode,this.playBGM(i.bgmUrl,i.hashCode))}},e.onUIHide=function(e){var t=UI._openedStack;if(t&&t.length)for(var i=t.length-1;i>=0;--i){var r=t[i];if(r&&r.bgmUrl)return this.playingUIBgm=r.hashCode,void this.playBGM(r.bgmUrl,r.hashCode)}var n=SceneMgr.scene;return n&&n.allowBgm?(this.playingUIBgm=0,void n.playBGM()):(this.playBGM("0",this.playingUIBgm),void(this.playingUIBgm=0))},e.onSoundPause=function(){var e=this,t=!0;if(App.stage.addEventListener(Evt.touchTap,e.onStageTouchTap,e),t=DebugStatic.soundPause)for(var i=1;6>=i;i++)e.setMute(i,!0)},e.onSoundResume=function(){var e=this,t=!0;App.stage.removeEventListener(Evt.touchTap,e.onStageTouchTap,e),t=DebugStatic.soundPause,t&&(e.setBgmMute(!1),e.setVoiceMute(!1),e.setSoundMute(!1))},e.onStageTouchTap=function(e){this.onSoundResume()},e.getVolume=function(e){var t=SoundPlayer.getPlayer(e);return t.settingRate},e.setBgmVolume=function(e,t){void 0===t&&(t=0);var i=SoundPlayer.getPlayer(2);i.setSettingRate(e/100,t)},e.setVoiceVolume=function(e,t){void 0===t&&(t=0),e/=100;var i=SoundPlayer.getPlayer(3);i.setSettingRate(e,t),i=SoundPlayer.getPlayer(5),i.setSettingRate(e,t),i=SoundPlayer.getPlayer(6),i.setSettingRate(e,t)},e.setSoundVolume=function(e,t){void 0===t&&(t=0);var i=SoundPlayer.getPlayer(1);i.setSettingRate(e/100,t),i=SoundPlayer.getPlayer(4),i.setSettingRate(e/100,t)},e.getMute=function(e){var t=SoundPlayer.getPlayer(e);return t.mute},e.setMute=function(e,t,i){void 0===t&&(t=!0),void 0===i&&(i=.5);var r=SoundPlayer.getPlayer(e);r.setMute(t,i)},e.setBgmMute=function(e,t){void 0===e&&(e=!0),void 0===t&&(t=.5),this.setMute(2,e,t)},e.setVoiceMute=function(e,t){void 0===e&&(e=!0),void 0===t&&(t=.5),this.setMute(3,e,t),this.setMute(5,e,t),this.setMute(6,e,t)},e.setSoundMute=function(e,t){void 0===e&&(e=!0),void 0===t&&(t=.5),this.setMute(1,e,t),this.setMute(4,e,t)},e.pauseSound=function(e,t){SoundPlayer.pauseSound(e,null,t)},e.resumeSound=function(e,t){SoundPlayer.resumeSound(e,null,t)},e.stopSoundByChannel=function(e,t){void 0===t&&(t=0),SoundPlayer.unregisterChannelSound(e,t)},e.stopSoundByHashCode=function(e,t,i){void 0===i&&(i=0),SoundPlayer.unregisterHashCodeSound(e,t,i)},e.playSoundById=function(e,t,i,r){void 0===r&&(r=.5);var n=Data.getItem("SoundData",e);Functor.assert(!!n,"音效配置不存在id："+e);var a=this,o=n.channel;if(4==o)return void GameLog.warning("音效配置暂不支持战斗音效类型 channel："+n.channel);var s=n.datas;Functor.assert(!!s||!!s.length,"音效配置列表数据不存在id："+e),i&&i.length&&(s=s.concat(i));var l,u=s.length;l=1==u?s[0]:s[Math.floor(Math.random()*u)],Functor.assert(!!l.name,"音效配置音效名称不存在id："+e),1==o?a.playUISound(l.name,t,!1):2==o?a.playBGM(l.name,t,!0):(n.solo&&a.stopSoundByChannel(o,r),a.playVoiceByName(o,l.name,t))},e.playBattleSound=function(e,t,i,r,n,a,o,s,l,u){void 0===u&&(u=0);var c=this;if(!this.getMute(e)&&(4==e||6==e)){var p=this.battleSounds;if(u){for(var d in p)if(c.checkBattleSoundSkip(+d,t,i,r,n,a,o,l,u))return}else if(c.checkBattleSoundSkip(r,t,i,r,n,a,o,l,u))return;var f=p[r],h=ObjectPool.pop(BattleSound);h.parse(e,t,i,r,n,a,o,l),f||(f=p[r]=[]),f.push(h);var v=4==l||5==l;4==e?c.playSoundByUrl(e,h.url,r,s,v):6==e&&c.playVoiceByUrl(e,h.url,r,s,v)}},e.checkBattleSoundSkip=function(e,t,i,r,n,a,o,s,l){var u=this.battleSounds[e];if(!u||!u.length)return!1;for(var c=e==r&&0!=s&&1!=s,p=0,d=u;p<d.length;p++){var f=d[p];if(f.name==o){if(c&&f.playType==s&&f.actionName==n&&f.frame==a)return!0;if(l&&f.castereid==t&&i-f.totalFrame<=l)return!0}}return!1},e.stopBattleSound=function(){SoundPlayer.unregisterChannelSound(4),SoundPlayer.unregisterChannelSound(6)},e.onBattleActionEnd=function(e){var t=this.battleSounds[e];if(t){for(var i,r,n=0,a=t;n<a.length;n++){var o=a[n];i=o.playType,r=SoundPlayer.stopWaitSound(o.channel,o.url,o.soundId),0==i||2==i||4==i?!r&&SoundPlayer.stopPlayingSound(o.channel,o.url,o.soundId):5==i&&!r&&SoundPlayer.changeSoundLoop(o.channel,o.url,o.soundId,!1),o.dispose()}t.length=0,delete this.battleSounds[e]}},e.playUISound=function(e,t,i){void 0===i&&(i=!1),this.getMute(1)||SoundPlayer.registerSound(1,Urls.sound(e),t,1,i,!1)},e.stopUISound=function(e,t,i){void 0===i&&(i=0),SoundPlayer.unregisterSound(1,Urls.sound(e),t,i)},e.playBGM=function(e,t,i,r){void 0===i&&(i=!0),void 0===r&&(r=1);var n=this,a=n.curBgmName;return e&&a!=e?"0"==e?(a&&n.stopBGM(),n.curBgmName=null,void(n.curBgmId=0)):void(this.getMute(2)||(n.curBgmName=e,n.curBgmId=t,SoundPlayer.registerSound(2,Urls.sound(e),t,1,i,!0,r))):void 0},e.stopBGM=function(e){void 0===e&&(e=1),this.curBgmName&&SoundPlayer.unregisterSound(2,Urls.sound(this.curBgmName),this.curBgmId,e)},e.playSoundByUrl=function(e,t,i,r,n){void 0===r&&(r=1),void 0===n&&(n=!1),this.getMute(e)||SoundPlayer.registerSound(e,t,i,r,n)},e.stopSoundByUrl=function(e,t,i,r,n){void 0===r&&(r=0),void 0===n&&(n=!1),SoundPlayer.unregisterSound(e,t,i,r,n)},e.playVoiceByUrl=function(e,t,i,r,n){void 0===r&&(r=1),void 0===n&&(n=!1),this.getMute(e)||SoundPlayer.registerSound(e,t,i,r,n)},e.stopVoiceByUrl=function(e,t,i,r,n){void 0===r&&(r=0),void 0===n&&(n=!1),SoundPlayer.unregisterSound(e,t,i,r,n)},e.playVoiceByName=function(e,t,i,r,n){void 0===r&&(r=1),void 0===n&&(n=!1),this.getMute(e)||SoundPlayer.registerSound(e,Urls.sound(t),i,r,n)},e.stopVoiceByName=function(e,t,i,r,n){void 0===r&&(r=0),void 0===n&&(n=!1),SoundPlayer.unregisterSound(e,Urls.sound(t),i,r,n)},e.reg=function(e,t){e&&(t=t||"sound_button_press",this.un(e),e.addEventListener(Evt.touchTap,this.bindMap[e.hashCode]=Functor.functor(this.playUISound,this,t,e.hashCode),this))},e.un=function(e){if(e){var t=this.bindMap[e.hashCode];t&&(e.removeEventListener(Evt.touchTap,t,this),this.bindMap[e.hashCode]=null)}},e.bindMap={},e.playingUIBgm=0,e.initialized=!1,e.soundNUm=0,e}();__reflect(SoundUtils.prototype,"SoundUtils"),window.SoundUtils=SoundUtils;var SysAlertMgr=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.initialize=function(){var e=this;if(!e.initialized){e.initialized=!0;var t=e.alertContainer=new eui.Group;t.touchChildren=!1,t.touchEnabled=!1,t.horizontalCenter=0,t.percentWidth=0,LayerManager.addLayer(9,t),BattleAlertMgr.init();var i=e.specialContainer=new eui.Group;i.touchChildren=!1,i.touchEnabled=!1,i.horizontalCenter=0,LayerManager.addLayer(9,i);var r=e.headContainer=new eui.Group;r.touchChildren=!1,r.touchEnabled=!1,r.x=-10,LayerManager.addLayer(12,r),App.stage.addEventListener(Evt.resize,e.onStageResize,e),e.onStageResize()}},t.onStageResize=function(){var e=this,t=App.stage.stageHeight;e.alertContainer.top=.5*t,e.specialContainer.top=.3*t,BattleAlertMgr.onResize()},t.alert=function(e,t){var i=this.getAlertObj(SysAlertItem);i.showText(e,t),this.handleAlert(i)},t.alertSimple=function(e,t){var i=this.getAlertObj(SysAlertItem5);i.showText(e,t),this.handleAlert(i)},t.gainItems=function(e){var t=this.getAlertObj(SysAlertItem2);t.showItem(e),this.handleAlert(t)},t.getAlertObj=function(e){for(var t,i=this,r=i.alertItems;r.length>=3;){var n=r.shift();if(n instanceof e){t=n;break}n.dispose()}return t||(t=ObjectPool.pop(e)),t},t.handleAlert=function(e){var t=this,i=t.alertContainer,r=t.alertItems;e.y=t.alertOffY,e.parent?e.parent!==i?i.addChild(e):i.setChildIndex(e,i.numChildren-1):i.addChild(e),r.push(e),1===r.length&&(t.alertLast=egret.getTimer(),egret.startTick(t.onTickHandler,t))},t.onTickHandler=function(e){var t=this;if(e-t.alertDelay<10)return!1;t.alertDelay=e;var i=t,r=i.alertItems,n=e-i.alertLast;i.alertLast=e;for(var a=[],o=0,s=n/16*5,l=0,u=r.length-1;u>=0;u--){var c=r[u];if(c){var p=i.alertOffY-50-46*l,d=2+(2e3-c.lifeTime)/1e3*s;c.y-d>p?c.y-=d:c.y=p,c.lifeTime+=n,l>6&&(c.state=2,c.lifeTime=1e6),l+=1,0===c.state?c.lifeTime>=1e3&&(c.state=1):1===c.state?c.lifeTime>=1500&&(c.state=2):2===c.state&&(c.alpha-=.066,c.lifeTime>=2e3&&(a.push(c),c.dispose(),o+=1))}}if(o>0){for(var f=0,h=a;f<h.length;f++){var v=h[f],m=r.indexOf(v);-1!==m&&r.splice(m,1)}t.alertItems.length<=0&&egret.stopTick(t.onTickHandler,t)}return!0},t.gainSpecials=function(e){var t=this.getSpecialObj(SysSpecialItem);t.showItem(e),this.handleSpecial(t)},t.getSpecialObj=function(e){for(var t,i=this,r=i.specialItems;r.length>=6;){var n=r.shift();if(n instanceof e){t=n;break}n.dispose()}return t||(t=ObjectPool.pop(e)),t},t.handleSpecial=function(e){var t=this,i=t.specialContainer,r=t.specialItems;e.y=t.specialOffY,e.parent?e.parent!==i?i.addChild(e):i.setChildIndex(e,i.numChildren-1):i.addChild(e),r.push(e),1===r.length&&(t.specialLast=egret.getTimer(),egret.startTick(t.onSpecialTick,t))},t.onSpecialTick=function(e){var t=this;if(e-t.specialDelay<10)return!1;t.specialDelay=e;var i=t,r=i.specialItems,n=e-i.specialLast;i.specialLast=e;for(var a=[],o=0,s=n/16*5,l=0,u=r.length-1;u>=0;u--){var c=r[u];if(c){var p=i.specialOffY-50-46*l,d=2+(2e3-c.lifeTime)/1e3*s;c.y-d>p?c.y-=d:c.y=p,c.lifeTime+=n,l>6&&(c.state=2,c.lifeTime=1e6),l+=1,0===c.state?c.lifeTime>=1e3&&(c.state=1):1===c.state?c.lifeTime>=1500&&(c.state=2):2===c.state&&(c.alpha-=.066,c.lifeTime>=2e3&&(a.push(c),c.dispose(),o+=1))}}if(o>0){for(var f=0,h=a;f<h.length;f++){var v=h[f],m=r.indexOf(v);-1!==m&&r.splice(m,1)}t.specialItems.length<=0&&egret.stopTick(t.onSpecialTick,t)}return!0},t.initialized=!1,t.alertItems=[],t.alertOffY=0,t.alertLast=0,t.alertDelay=0,t.specialItems=[],t.specialOffY=0,t.specialLast=0,t.specialDelay=0,t.alertHeads=[],t.headOffY=420,t.headlLast=1e4,t.headlDelay=1e4,t}(egret.HashObject);__reflect(SysAlertMgr.prototype,"SysAlertMgr");var BattleAlertMgr=function(){function e(){}return e.init=function(){var e=this,t=e.alertContainer=new eui.Group;t.touchChildren=!1,t.touchEnabled=!1,t.horizontalCenter=0,LayerManager.addLayer(9,t)},e.onResize=function(){var e=this,t=App.stage.stageHeight;e.alertContainer.top=.85*t},e.alert=function(e,t){var i=this.getAlertObj();i.showText(e,t),this.handleAlert(i)},e.getAlertObj=function(){var e,t=this,i=t.alertItems;return i.length>=3&&(e=i.shift()),e||(e=ObjectPool.pop(SysAlertItem3)),e},e.handleAlert=function(e){var t=this,i=t.alertContainer,r=t.alertItems;e.y=t.alertOffY,e.parent?e.parent!==i?i.addChild(e):i.setChildIndex(e,i.numChildren-1):i.addChild(e),r.push(e);var n=1.2;egret.Tween.get(e).to({scaleX:n,scaleY:n},230).to({scaleX:1,scaleY:1},100),1===r.length&&(t.alertLast=egret.getTimer(),egret.startTick(t.onTickHandler,t))},e.onTickHandler=function(e){var t=this;if(e-t.alertDelay<10)return!1;t.alertDelay=e;var i=t,r=i.alertItems,n=e-i.alertLast;i.alertLast=e;for(var a=[],o=0,s=t.maxSize,l=1e3/60,u=2e3,c=n/l*3,p=0,d=r.length-1;d>=0;d--){var f=r[d];if(f){var h=i.alertOffY-50-f.height*p,v=2+(u-f.lifeTime)/1e3*c;0==f.state&&(f.y-v>h?f.y-=v:f.y=h),f.lifeTime+=n,p>s&&(f.state=2,f.lifeTime=u),p+=1,0===f.state?f.lifeTime>=500&&(f.state=2):2===f.state&&(f.alpha-=.066,f.y-=v,f.lifeTime>=u&&(a.push(f),f.dispose(),o+=1))}}if(o>0){for(var m=0,y=a;m<y.length;m++){var g=y[m],b=r.indexOf(g);-1!==b&&r.splice(b,1)}t.alertItems.length<=0&&egret.stopTick(t.onTickHandler,t)
}return!0},e.alertOffY=0,e.alertLast=0,e.alertDelay=0,e.alertItems=[],e.maxSize=2,e}();__reflect(BattleAlertMgr.prototype,"BattleAlertMgr"),window.BattleAlertMgr=BattleAlertMgr,window.SysAlertMgr=SysAlertMgr;var TimeoutLock=function(){function e(e,t,i){void 0===e&&(e=3e3),this._taskId=0,this._isLock=!1,this._timeout=e,this._owner=t,this._key=i}return e.prototype.refresh=function(e,t,i){void 0===e&&(e=3e3),this._timeout=e,this._owner=t,this._key=i},Object.defineProperty(e.prototype,"isLock",{get:function(){return this._isLock},set:function(e){e!==this._isLock&&(e?this.lock():this.unlock())},enumerable:!0,configurable:!0}),e.prototype.lock=function(){this._taskId&&(clearTimeout(this._taskId),this._taskId=0),this._timeout&&(this._taskId=Functor.delay(this.unlock,this._timeout,this)),this._isLock=!0,App.dispatch("c5",{owner:this._owner,key:this._key})},e.prototype.unlock=function(){this._isLock&&(this._taskId&&(clearTimeout(this._taskId),this._taskId=0),this._isLock=!1,App.dispatch("c6",{owner:this._owner,key:this._key}))},e.prototype.clear=function(){this._taskId&&(clearTimeout(this._taskId),this._taskId=0),this._isLock=!1,this._owner=void 0,this._key=void 0,this._timeout=0},e.Create=function(t,i,r){void 0===t&&(t=500);var n=ObjectPool.pop(e);return n.refresh(t,i,r),n},e.Recover=function(e){e&&(e.clear(),ObjectPool.push(e))},e.checkLock=function(t,i){void 0===i&&(i=500);var r=this._map.getValue(t);if(r){if(r.isLock)return!0}else r=e.Create(i),this._map.add(t,r);return r.lock(),!1},e.removeLock=function(e){var t=this._map.removeKey(e);t&&this.Recover(t)},e.clear=function(){var e=this,t=this._map.valueSet;t.forEach(function(t){e.Recover(t)}),this._map.clear()},e._map=new HashMap,e}();__reflect(TimeoutLock.prototype,"TimeoutLock"),window.TimeoutLock=TimeoutLock;var Urls=function(){function e(){}return e.res=function(){return GameConfig.RES},e.effect=function(){return GameConfig.RES+"effect/ktx/"},e.weaponEffect=function(){return GameConfig.RES+"effect/ktx/"},e.fashion=function(){return GameConfig.RES+"fashion/ktx/"},e.fashion_c=function(){return GameConfig.RES+"fashion_c/ktx/"},e.halo=function(){return GameConfig.RES+"halo/ktx/"},e.hero=function(){return GameConfig.RES+"hero/ktx/"},e.npc=function(){return GameConfig.RES+"npc/ktx/"},e.spine=function(){return GameConfig.RES+"spine/ktx/"},e.title=function(){return GameConfig.RES+"title/ktx/"},e.uieff=function(){return GameConfig.RES+"uieff/ktx/"},e.weapon=function(){return GameConfig.RES+"weapon/ktx/"},e.weapon_c=function(){return GameConfig.RES+"weapon_c/ktx/"},e.wing=function(){return GameConfig.RES+"wing/ktx/"},e.wing_c=function(){return GameConfig.RES+"wing_c/ktx/"},e.uibg=function(e,t){return void 0===t&&(t=!1),e?GameConfig.RES+"uibg/"+e+(t?".png":".jpg"):null},e.dungeon=function(e,t){return void 0===t&&(t=!0),GameConfig.RES+"dungeon/"+e+(t?".png":".jpg")},e.mapRes=function(e){return GameConfig.RES+"map/"+e+".png"},e.mapJson=function(e){return GameConfig.RES+"map/"+e+".json"},e.bust=function(e,t){return void 0===t&&(t=!0),e?GameConfig.RES+"bust/"+e+(t?".png":".jpg"):null},e.sound=function(e){return GameConfig.RES+"sound/"+e+".mp3"},e.icon=function(e){return e?GameConfig.RES+"icon/"+e+".png":""},e.drop=function(e){return GameConfig.RES+"drop/"+e+".png"},e.buffIcon=function(e){var t=Data.getItem("BuffData",e);return t?this.icon(t.icon):null},e.head=function(e){var t=Data.getItem("HeadData",e)||{},i=t.pic;return this.icon(i)},e.headFrame=function(e){var t=Data.getItem("HeadFrameData",e)||{},i=t.pic;return i?this.icon(i):""},e.battle=function(e){return GameConfig.RES+"ui/battle/"+e+".png"},e.nameImg=function(e){return e?GameConfig.RES+"zhcn/"+e+".png":null},e.cnameImg=function(e){return GameConfig.RES+"zhcn/c"+e+".png"},e.headImg=function(e){return GameConfig.RES+"head/"+e+".png"},e.modelImg=function(e){return GameConfig.RES+"bust/"+e+".png"},e.illImg=function(e){return GameConfig.RES+"illustrated/"+e+".png"},e.uiicon=function(e,t){return e?GameConfig.RES+"uiicon/"+e+(t?".jpg":".png"):null},e.partyJob=function(e){return GameConfig.RES+"party/job/party_job"+e+".png"},e.partyBuild=function(e){return GameConfig.RES+"party/build/party_build"+e+".png"},e.partyIcon=function(e){var t=Data.getItem("PartyIconData",e);return t?GameConfig.RES+"party/partyIcon/"+t.pic+".png":""},e.partyIconName=function(e){return GameConfig.RES+"party/partyName/"+e+".png"},e.partyBigIconName=function(e){return GameConfig.RES+"party/partyBigName/"+e+".png"},e.video=function(e){return GameConfig.RES+"video/"+e+".mp4"},e.recharge=function(e){return GameConfig.RES+"recharge/"+e+".png"},e.getJob=function(e){return e?"job"+e:null},e.getPvpUrl=function(e){return this.uiicon("ladder_icon_"+e)},e.getHellGrade=function(e){return GameConfig.RES+"ui/hell/lv/"+e+".png"},e.getAchUrl=function(e){return GameConfig.RES+"ui/achieve/icon/"+e+".png"},e.getSommonHeader=function(e){return GameConfig.RES+"ui/summon/head/"+e+".png"},e.getChatUrl=function(e){return GameConfig.RES+"ui/info/Chat/"+e+".png"},e.cardEffect=function(){return GameConfig.RES+"card/"},e.getChatIcon=function(e){return GameConfig.RES+"ui/chat/chat_icon"+e+".png"},e.preload_role=function(e){return GameConfig.RES+"preload/preload_role"+e+".png"},e.getFishionBg=function(e){return e?GameConfig.RES+"fashion_bg/"+e+".jpg":null},e.hellBigIcon=function(e){return GameConfig.RES+"ui/hell/bigIcon/hell_big_"+e+".png"},e.hellLine=function(e){return GameConfig.RES+"ui/hell/bigIcon/hell_line_"+e+".png"},e.hellGradeIcon=function(e){return GameConfig.RES+"ui/hell/lv/"+e+".png"},e.rememberSign=function(t){return e.uiicon("battle_la"+t)},e.preload=function(){return GameConfig.RES+"preload/"},e.soulCardBg=function(e){return GameConfig.RES+"soulCard/card_bg_"+e+".png"},e.soulCardIcon=function(e){return GameConfig.RES+"soulCard/"+e+".png"},e.animator=GameConfig.RES+"animator/ktx/",e}();__reflect(Urls.prototype,"Urls"),window.Urls=Urls;var LockStep=function(){function e(){this.objects=[],this.logs={}}return e.prototype.initialize=function(e){this.isvalid=!0,this.roomsn=e},e.prototype.reg=function(e){this.objects.push(e)},e.prototype.unreg=function(e){var t=this.objects,i=t.indexOf(e);i>=0&&t.splice(i,1)},e.prototype.onEnterFrame=function(e){var t=0,i=this.getStepLog(e);this.objects.forEach(function(e){t|=e.lockStepCode,i.objectCodes.push({name:e.__class__,code:e.lockStepCode})}),i.totalCode=t},e.prototype.command=function(e,t,i){var r=this.getStepLog(e);r.commands.push({type:t,args:i})},e.prototype.upload=function(e){void 0===e&&(e=0),console.log("[战斗日志]：",this.roomsn,e,JSON.stringify(this.logs))},e.prototype.getStepLog=function(e){var t=this.logs[e];return t||(t=this.logs[e]={totalCode:0,objectCodes:[],commands:[]}),t},e.prototype.dispose=function(){var e=this;e.isvalid&&(e.objects=[],e.logs={},ObjectUtils.clearKeys(e,["isvalid","roomsn"]),ObjectPool.push(e))},e}();__reflect(LockStep.prototype,"LockStep"),window.LockStep=LockStep;